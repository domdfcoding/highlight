     1^I[37m//+------------------------------------------------------------------+[39;49;00m$
     2^I[37m//|                                                        Array.mqh |[39;49;00m$
     3^I[37m//|                   Copyright 2009-2013, MetaQuotes Software Corp. |[39;49;00m$
     4^I[37m//|                                              http://www.mql4.com |[39;49;00m$
     5^I[37m//+------------------------------------------------------------------+[39;49;00m$
     6^I[36m#[39;49;00m[36minclude[39;49;00m[37m [39;49;00m[37m<Object.mqh>[39;49;00m[36m[39;49;00m$
     7^I[37m//+------------------------------------------------------------------+[39;49;00m$
     8^I[37m//| Class CArray                                                     |[39;49;00m$
     9^I[37m//| Purpose: Base class of dynamic arrays.                           |[39;49;00m$
    10^I[37m//|          Derives from class CObject.                             |[39;49;00m$
    11^I[37m//+------------------------------------------------------------------+[39;49;00m$
    12^I[34mclass[39;49;00m[37m [39;49;00m[04m[32mCArray[39;49;00m[37m [39;49;00m:[37m [39;49;00m[34mpublic[39;49;00m[37m [39;49;00mCObject[37m[39;49;00m$
    13^I[37m  [39;49;00m{[37m[39;49;00m$
    14^I[34mprotected[39;49;00m:[37m[39;49;00m$
    15^I[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00mm_step_resize;[37m      [39;49;00m[37m// increment size of the array[39;49;00m$
    16^I[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00mm_data_total;[37m       [39;49;00m[37m// number of elements[39;49;00m$
    17^I[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00mm_data_max;[37m         [39;49;00m[37m// maximmum size of the array without memory reallocation[39;49;00m$
    18^I[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00mm_sort_mode;[37m        [39;49;00m[37m// mode of array sorting[39;49;00m$
    19^I[37m[39;49;00m$
    20^I[34mpublic[39;49;00m:[37m[39;49;00m$
    21^I[37m                     [39;49;00mCArray([36mvoid[39;49;00m);[37m[39;49;00m$
    22^I[37m                    [39;49;00m~CArray([36mvoid[39;49;00m);[37m[39;49;00m$
    23^I[37m   [39;49;00m[37m//--- methods of access to protected data[39;49;00m$
    24^I[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mStep[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_step_resize);[37m [39;49;00m}[37m[39;49;00m$
    25^I[37m   [39;49;00m[36mbool[39;49;00m[37m              [39;49;00m[32mStep[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mstep);[37m[39;49;00m$
    26^I[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mTotal[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_data_total);[37m [39;49;00m}[37m[39;49;00m$
    27^I[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mAvailable[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_data_max-m_data_total);[37m [39;49;00m}[37m[39;49;00m$
    28^I[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mMax[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_data_max);[37m [39;49;00m}[37m[39;49;00m$
    29^I[37m   [39;49;00m[36mbool[39;49;00m[37m              [39;49;00m[32mIsSorted[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmode=[34m0[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_sort_mode==mode);[37m [39;49;00m}[37m[39;49;00m$
    30^I[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mSortMode[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_sort_mode);[37m [39;49;00m}[37m[39;49;00m$
    31^I[37m   [39;49;00m[37m//--- cleaning method[39;49;00m$
    32^I[37m   [39;49;00m[36mvoid[39;49;00m[37m              [39;49;00m[32mClear[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m{[37m [39;49;00mm_data_total=[34m0[39;49;00m;[37m [39;49;00m}[37m[39;49;00m$
    33^I[37m   [39;49;00m[37m//--- methods for working with files[39;49;00m$
    34^I[37m   [39;49;00m[34mvirtual[39;49;00m[37m [39;49;00m[36mbool[39;49;00m[37m      [39;49;00m[32mSave[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mfile_handle);[37m[39;49;00m$
    35^I[37m   [39;49;00m[34mvirtual[39;49;00m[37m [39;49;00m[36mbool[39;49;00m[37m      [39;49;00m[32mLoad[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mfile_handle);[37m[39;49;00m$
    36^I[37m   [39;49;00m[37m//--- sorting method[39;49;00m$
    37^I[37m   [39;49;00m[36mvoid[39;49;00m[37m              [39;49;00m[32mSort[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmode=[34m0[39;49;00m);[37m[39;49;00m$
    38^I[37m[39;49;00m$
    39^I[34mprotected[39;49;00m:[37m[39;49;00m$
    40^I[37m   [39;49;00m[34mvirtual[39;49;00m[37m [39;49;00m[36mvoid[39;49;00m[37m      [39;49;00mQuickSort([36mint[39;49;00m[37m [39;49;00mbeg,[36mint[39;49;00m[37m [39;49;00mend,[34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmode=[34m0[39;49;00m)[37m [39;49;00m{[37m [39;49;00m}[37m[39;49;00m$
    41^I[37m  [39;49;00m};[37m[39;49;00m$
    42^I[37m//+------------------------------------------------------------------+[39;49;00m$
    43^I[37m//| Constructor                                                      |[39;49;00m$
    44^I[37m//+------------------------------------------------------------------+[39;49;00m$
    45^ICArray::CArray([36mvoid[39;49;00m)[37m [39;49;00m:[37m [39;49;00mm_step_resize([34m16[39;49;00m),[37m[39;49;00m$
    46^I[37m                       [39;49;00mm_data_total([34m0[39;49;00m),[37m[39;49;00m$
    47^I[37m                       [39;49;00mm_data_max([34m0[39;49;00m),[37m[39;49;00m$
    48^I[37m                       [39;49;00mm_sort_mode([34m-1[39;49;00m)[37m[39;49;00m$
    49^I[37m  [39;49;00m{[37m[39;49;00m$
    50^I[37m  [39;49;00m}[37m[39;49;00m$
    51^I[37m//+------------------------------------------------------------------+[39;49;00m$
    52^I[37m//| Destructor                                                       |[39;49;00m$
    53^I[37m//+------------------------------------------------------------------+[39;49;00m$
    54^ICArray::~CArray([36mvoid[39;49;00m)[37m[39;49;00m$
    55^I[37m  [39;49;00m{[37m[39;49;00m$
    56^I[37m  [39;49;00m}[37m[39;49;00m$
    57^I[37m//+------------------------------------------------------------------+[39;49;00m$
    58^I[37m//| Method Set for variable m_step_resize                            |[39;49;00m$
    59^I[37m//+------------------------------------------------------------------+[39;49;00m$
    60^I[36mbool[39;49;00m[37m [39;49;00mCArray::Step([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mstep)[37m[39;49;00m$
    61^I[37m  [39;49;00m{[37m[39;49;00m$
    62^I[37m//--- check[39;49;00m$
    63^I[37m   [39;49;00m[34mif[39;49;00m(step>[34m0[39;49;00m)[37m[39;49;00m$
    64^I[37m     [39;49;00m{[37m[39;49;00m$
    65^I[37m      [39;49;00mm_step_resize=step;[37m[39;49;00m$
    66^I[37m      [39;49;00m[34mreturn[39;49;00m([36mtrue[39;49;00m);[37m[39;49;00m$
    67^I[37m     [39;49;00m}[37m[39;49;00m$
    68^I[37m//--- failure[39;49;00m$
    69^I[37m   [39;49;00m[34mreturn[39;49;00m([36mfalse[39;49;00m);[37m[39;49;00m$
    70^I[37m  [39;49;00m}[37m[39;49;00m$
    71^I[37m//+------------------------------------------------------------------+[39;49;00m$
    72^I[37m//| Sorting an array in ascending order                              |[39;49;00m$
    73^I[37m//+------------------------------------------------------------------+[39;49;00m$
    74^I[36mvoid[39;49;00m[37m [39;49;00mCArray::Sort([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmode)[37m[39;49;00m$
    75^I[37m  [39;49;00m{[37m[39;49;00m$
    76^I[37m//--- check[39;49;00m$
    77^I[37m   [39;49;00m[34mif[39;49;00m(IsSorted(mode))[37m[39;49;00m$
    78^I[37m      [39;49;00m[34mreturn[39;49;00m;[37m[39;49;00m$
    79^I[37m   [39;49;00mm_sort_mode=mode;[37m[39;49;00m$
    80^I[37m   [39;49;00m[34mif[39;49;00m(m_data_total<=[34m1[39;49;00m)[37m[39;49;00m$
    81^I[37m      [39;49;00m[34mreturn[39;49;00m;[37m[39;49;00m$
    82^I[37m//--- sort[39;49;00m$
    83^I[37m   [39;49;00mQuickSort([34m0[39;49;00m,m_data_total[34m-1[39;49;00m,mode);[37m[39;49;00m$
    84^I[37m  [39;49;00m}[37m[39;49;00m$
    85^I[37m//+------------------------------------------------------------------+[39;49;00m$
    86^I[37m//| Writing header of array to file                                  |[39;49;00m$
    87^I[37m//+------------------------------------------------------------------+[39;49;00m$
    88^I[36mbool[39;49;00m[37m [39;49;00mCArray::Save([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mfile_handle)[37m[39;49;00m$
    89^I[37m  [39;49;00m{[37m[39;49;00m$
    90^I[37m//--- check handle[39;49;00m$
    91^I[37m   [39;49;00m[34mif[39;49;00m(file_handle!=[31mINVALID_HANDLE[39;49;00m)[37m[39;49;00m$
    92^I[37m     [39;49;00m{[37m[39;49;00m$
    93^I[37m      [39;49;00m[37m//--- write start marker - 0xFFFFFFFFFFFFFFFF[39;49;00m$
    94^I[37m      [39;49;00m[34mif[39;49;00m([32mFileWriteLong[39;49;00m(file_handle,[34m-1[39;49;00m)==[34msizeof[39;49;00m([36mlong[39;49;00m))[37m[39;49;00m$
    95^I[37m        [39;49;00m{[37m[39;49;00m$
    96^I[37m         [39;49;00m[37m//--- write array type[39;49;00m$
    97^I[37m         [39;49;00m[34mif[39;49;00m([32mFileWriteInteger[39;49;00m(file_handle,Type(),INT_VALUE)==INT_VALUE)[37m[39;49;00m$
    98^I[37m            [39;49;00m[34mreturn[39;49;00m([36mtrue[39;49;00m);[37m[39;49;00m$
    99^I[37m        [39;49;00m}[37m[39;49;00m$
   100^I[37m     [39;49;00m}[37m[39;49;00m$
   101^I[37m//--- failure[39;49;00m$
   102^I[37m   [39;49;00m[34mreturn[39;49;00m([36mfalse[39;49;00m);[37m[39;49;00m$
   103^I[37m  [39;49;00m}[37m[39;49;00m$
   104^I[37m//+------------------------------------------------------------------+[39;49;00m$
   105^I[37m//| Reading header of array from file                                |[39;49;00m$
   106^I[37m//+------------------------------------------------------------------+[39;49;00m$
   107^I[36mbool[39;49;00m[37m [39;49;00mCArray::Load([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mfile_handle)[37m[39;49;00m$
   108^I[37m  [39;49;00m{[37m[39;49;00m$
   109^I[37m//--- check handle[39;49;00m$
   110^I[37m   [39;49;00m[34mif[39;49;00m(file_handle!=[31mINVALID_HANDLE[39;49;00m)[37m[39;49;00m$
   111^I[37m     [39;49;00m{[37m[39;49;00m$
   112^I[37m      [39;49;00m[37m//--- read and check start marker - 0xFFFFFFFFFFFFFFFF[39;49;00m$
   113^I[37m      [39;49;00m[34mif[39;49;00m([32mFileReadLong[39;49;00m(file_handle)==[34m-1[39;49;00m)[37m[39;49;00m$
   114^I[37m        [39;49;00m{[37m[39;49;00m$
   115^I[37m         [39;49;00m[37m//--- read and check array type[39;49;00m$
   116^I[37m         [39;49;00m[34mif[39;49;00m([32mFileReadInteger[39;49;00m(file_handle,INT_VALUE)==Type())[37m[39;49;00m$
   117^I[37m            [39;49;00m[34mreturn[39;49;00m([36mtrue[39;49;00m);[37m[39;49;00m$
   118^I[37m        [39;49;00m}[37m[39;49;00m$
   119^I[37m     [39;49;00m}[37m[39;49;00m$
   120^I[37m//--- failure[39;49;00m$
   121^I[37m   [39;49;00m[34mreturn[39;49;00m([36mfalse[39;49;00m);[37m[39;49;00m$
   122^I[37m  [39;49;00m}[37m[39;49;00m$
   123^I//+------------------------------------------------------------------+$
