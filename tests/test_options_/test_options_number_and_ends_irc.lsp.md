     1	[36m#!/usr/bin/env newlisp[39;49;00m[37m[39;49;00m$
     2	[37m[39;49;00m$
     3	[37m;; @module IRC[39;49;00m[37m[39;49;00m$
     4	[37m;; @description a basic irc library[39;49;00m[37m[39;49;00m$
     5	[37m;; @version early alpha! 0.1 2011-10-31 14:21:26[39;49;00m[37m[39;49;00m$
     6	[37m;; @author cormullion[39;49;00m[37m[39;49;00m$
     7	[37m;; Usage:[39;49;00m[37m[39;49;00m$
     8	[37m;; (IRC:init "newlithper") ; a username/nick (not that one obviously :-)[39;49;00m[37m[39;49;00m$
     9	[37m;; (IRC:connect "irc.freenode.net" 6667) ; irc/server[39;49;00m[37m[39;49;00m$
    10	[37m;; (IRC:join-channel {#newlisp}) ; join a room[39;49;00m[37m[39;49;00m$
    11	[37m;; either (IRC:read-irc-loop) ; loop - monitor only, no input[39;49;00m[37m[39;49;00m$
    12	[37m;; or     (IRC:session)       ; a command-line session, end with /QUIT[39;49;00m[37m[39;49;00m$
    13	[37m[39;49;00m$
    14	([34mcontext[39;49;00m[37m [39;49;00m'[33mIRC[39;49;00m)[37m[39;49;00m$
    15	[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m)[37m[39;49;00m$
    16	[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
    17	[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m)[37m[39;49;00m$
    18	[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mIconnected[39;49;00m)[37m[39;49;00m$
    19	[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mIcallbacks[39;49;00m[37m [39;49;00m'())[37m[39;49;00m$
    20	[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mIdle-time[39;49;00m[37m [39;49;00m[33m400[39;49;00m)[37m [39;49;00m[37m; seconds[39;49;00m[37m[39;49;00m$
    21	[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mItime-stamp[39;49;00m)[37m   [39;49;00m[37m; time since last message was processed[39;49;00m[37m[39;49;00m$
    22	[37m[39;49;00m$
    23	([34mdefine[39;49;00m[37m [39;49;00m([31mregister-callback[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mfunction[39;49;00m)[37m[39;49;00m$
    24	[37m    [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mregistering callback for [39;49;00m[33m}[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m : [39;49;00m[33m}[39;49;00m[37m [39;49;00m([34msym[39;49;00m[37m [39;49;00m([34mterm[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mfunction[39;49;00m)[37m [39;49;00m([34mprefix[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mfunction[39;49;00m)))[37m[39;49;00m$
    25	[37m    [39;49;00m([34mpush[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m([34msym[39;49;00m[37m [39;49;00m([34mterm[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mfunction[39;49;00m)[37m [39;49;00m([34mprefix[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mfunction[39;49;00m)))[37m [39;49;00m[33mIcallbacks[39;49;00m))[37m [39;49;00m$
    26	[37m[39;49;00m$
    27	([34mdefine[39;49;00m[37m [39;49;00m([31mdo-callback[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33mdata[39;49;00m)[37m[39;49;00m$
    28	[37m   [39;49;00m([34mwhen[39;49;00m[37m [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mfunc[39;49;00m[37m [39;49;00m([34mlookup[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33mIcallbacks[39;49;00m))[37m [39;49;00m[37m; find first callback[39;49;00m[37m[39;49;00m$
    29	[37m         [39;49;00m([34mif-not[39;49;00m[37m [39;49;00m([34mcatch[39;49;00m[37m [39;49;00m([34mapply[39;49;00m[37m [39;49;00m[33mfunc[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33mdata[39;49;00m))[37m [39;49;00m'[33merror[39;49;00m)[37m[39;49;00m$
    30	[37m                 [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33merror in callback [39;49;00m[33m}[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m: [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33merror[39;49;00m))))[37m[39;49;00m$
    31	[37m[39;49;00m$
    32	([34mdefine[39;49;00m[37m [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33mdata[39;49;00m)[37m[39;49;00m$
    33	[37m   [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mrf[39;49;00m[37m [39;49;00m([34mref-all[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33mIcallbacks[39;49;00m))[37m[39;49;00m$
    34	[37m        [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[34mcallback[39;49;00m[34m-[39;49;00m[33mentry[39;49;00m[37m [39;49;00m([31mIcallbacks[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m[33mrf[39;49;00m)))[37m[39;49;00m$
    35	[37m        [39;49;00m([34mwhen[39;49;00m[37m   [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mfunc[39;49;00m[37m [39;49;00m([34mlast[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mentry[39;49;00m))[37m[39;49;00m$
    36	[37m                [39;49;00m([34mif-not[39;49;00m[37m [39;49;00m([34mcatch[39;49;00m[37m [39;49;00m([34mapply[39;49;00m[37m [39;49;00m[33mfunc[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33mdata[39;49;00m))[37m [39;49;00m'[33merror[39;49;00m)[37m[39;49;00m$
    37	[37m                [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33merror in callback [39;49;00m[33m}[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m: [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33merror[39;49;00m)))))[37m[39;49;00m$
    38	[37m[39;49;00m$
    39	([34mdefine[39;49;00m[37m [39;49;00m([31minit[39;49;00m[37m [39;49;00m[33mstr[39;49;00m)[37m[39;49;00m$
    40	[37m   [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mInickname[39;49;00m[37m [39;49;00m[33mstr[39;49;00m)[37m[39;49;00m$
    41	[37m   [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mIconnected[39;49;00m[37m [39;49;00m[34mnil[39;49;00m)[37m[39;49;00m$
    42	[37m   [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mIchannels[39;49;00m[37m [39;49;00m'())[37m[39;49;00m$
    43	[37m   [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mItime-stamp[39;49;00m[37m [39;49;00m([34mtime-of-day[39;49;00m)))[37m[39;49;00m$
    44	[37m[39;49;00m$
    45	([34mdefine[39;49;00m[37m [39;49;00m([31mconnect[39;49;00m[37m [39;49;00m[33mserver[39;49;00m[37m [39;49;00m[33mport[39;49;00m)[37m[39;49;00m$
    46	[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mIserver[39;49;00m[37m     [39;49;00m([34mnet-connect[39;49;00m[37m [39;49;00m[33mserver[39;49;00m[37m [39;49;00m[33mport[39;49;00m))[37m[39;49;00m$
    47	[37m    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"USER %s %s %s :%s\r\n"[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m))[37m[39;49;00m$
    48	[37m    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"NICK %s \r\n"[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m))[37m[39;49;00m$
    49	[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mIconnected[39;49;00m[37m [39;49;00m[34mtrue[39;49;00m)[37m[39;49;00m$
    50	[37m    [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"connect"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"server"[39;49;00m[37m [39;49;00m[33mserver[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"port"[39;49;00m[37m [39;49;00m[33mport[39;49;00m))))[37m[39;49;00m$
    51	[37m[39;49;00m$
    52	([34mdefine[39;49;00m[37m [39;49;00m([31midentify[39;49;00m[37m [39;49;00m[33mpassword[39;49;00m)[37m[39;49;00m$
    53	[37m    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PRIVMSG nickserv :identify %s\r\n"[39;49;00m[37m [39;49;00m[33mpassword[39;49;00m)))[37m[39;49;00m$
    54	[37m[39;49;00m$
    55	([34mdefine[39;49;00m[37m [39;49;00m([34mjoin[39;49;00m[34m-[39;49;00m[33mchannel[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)[37m[39;49;00m$
    56	[37m    [39;49;00m([34mwhen[39;49;00m[37m [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"JOIN %s \r\n"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m))[37m[39;49;00m$
    57	[37m          [39;49;00m([34mpush[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
    58	[37m          [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"join-channel"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"nickname"[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m)))))[37m[39;49;00m$
    59	[37m[39;49;00m$
    60	([34mdefine[39;49;00m[37m [39;49;00m([31mpart[39;49;00m[37m [39;49;00m[33mchan[39;49;00m)[37m[39;49;00m$
    61	[37m    [39;49;00m([34mif-not[39;49;00m[37m [39;49;00m([31mempty?[39;49;00m[37m [39;49;00m[33mchan[39;49;00m)[37m[39;49;00m$
    62	[37m        [39;49;00m[37m; leave specified[39;49;00m[37m[39;49;00m$
    63	[37m        [39;49;00m([34mbegin[39;49;00m[37m[39;49;00m$
    64	[37m            [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PART %s\r\n"[39;49;00m[37m [39;49;00m[33mchan[39;49;00m))[37m[39;49;00m$
    65	[37m            [39;49;00m([34mreplace[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
    66	[37m            [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"part"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m))))[37m[39;49;00m$
    67	[37m        [39;49;00m[37m; leave all[39;49;00m[37m[39;49;00m$
    68	[37m        [39;49;00m([34mbegin[39;49;00m[37m[39;49;00m$
    69	[37m            [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mchannel[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
    70	[37m                [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PART %s\r\n"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m))[37m[39;49;00m$
    71	[37m                [39;49;00m([34mreplace[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
    72	[37m                [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"part"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)))))))[37m[39;49;00m$
    73	[37m[39;49;00m$
    74	([34mdefine[39;49;00m[37m [39;49;00m([31mdo-quit[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)[37m[39;49;00m$
    75	[37m    [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"quit"[39;49;00m[37m [39;49;00m'())[37m [39;49;00m[37m; chance to do stuff before quit...[39;49;00m[37m[39;49;00m$
    76	[37m    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"QUIT :%s\r\n"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))[37m[39;49;00m$
    77	[37m    [39;49;00m([34msleep[39;49;00m[37m [39;49;00m[33m1000[39;49;00m)[37m[39;49;00m$
    78	[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mIchannels[39;49;00m[37m [39;49;00m'())[37m[39;49;00m$
    79	[37m    [39;49;00m([34mclose[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m)[37m[39;49;00m$
    80	[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mIconnected[39;49;00m[37m [39;49;00m[34mnil[39;49;00m))[37m[39;49;00m$
    81	[37m[39;49;00m$
    82	([34mdefine[39;49;00m[37m [39;49;00m([31mprivmsg[39;49;00m[37m [39;49;00m[33muser[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)[37m[39;49;00m$
    83	[37m    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PRIVMSG %s :%s\r\n"[39;49;00m[37m [39;49;00m[33muser[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)))[37m[39;49;00m$
    84	[37m[39;49;00m$
    85	([34mdefine[39;49;00m[37m [39;49;00m([31mnotice[39;49;00m[37m [39;49;00m[33muser[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)[37m[39;49;00m$
    86	[37m    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"NOTICE %s :%s\r\n"[39;49;00m[37m [39;49;00m[33muser[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)))[37m[39;49;00m$
    87	[37m[39;49;00m$
    88	([34mdefine[39;49;00m[37m [39;49;00m([34msend[39;49;00m[34m-[39;49;00m[33mto-server[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m([31mchannel[39;49;00m[37m [39;49;00m[34mnil[39;49;00m))[37m[39;49;00m$
    89	[37m    [39;49;00m([34mcond[39;49;00m[37m[39;49;00m$
    90	[37m        [39;49;00m(([34mstarts-with[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m/[39;49;00m[33m}[39;49;00m)[37m [39;49;00m[37m; default command character[39;49;00m[37m[39;49;00m$
    91	[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mthe-message[39;49;00m[37m [39;49;00m([34mreplace[39;49;00m[37m [39;49;00m[33m"^/"[39;49;00m[37m [39;49;00m([34mcopy[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m))[37m [39;49;00m[37m; keep original[39;49;00m[37m[39;49;00m$
    92	[37m            [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"%s \r\n"[39;49;00m[37m [39;49;00m[33mthe-message[39;49;00m))[37m [39;49;00m[37m; send it[39;49;00m[37m[39;49;00m$
    93	[37m            [39;49;00m[37m; do a quit[39;49;00m[37m[39;49;00m$
    94	[37m            [39;49;00m([34mif[39;49;00m[37m [39;49;00m([34mstarts-with[39;49;00m[37m [39;49;00m([34mlower-case[39;49;00m[37m [39;49;00m[33mthe-message[39;49;00m)[37m [39;49;00m[33m"quit"[39;49;00m)[37m[39;49;00m$
    95	[37m                [39;49;00m([31mdo-quit[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m enough[39;49;00m[33m}[39;49;00m)))[37m[39;49;00m$
    96	[37m        [39;49;00m([34mtrue[39;49;00m[37m [39;49;00m$
    97	[37m            [39;49;00m([34mif[39;49;00m[37m [39;49;00m([34mnil[39;49;00m[33m?[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)[37m[39;49;00m$
    98	[37m                [39;49;00m[37m; say to all channels[39;49;00m[37m[39;49;00m$
    99	[37m                [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mc[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
   100	[37m                        [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PRIVMSG %s :%s\r\n"[39;49;00m[37m [39;49;00m[33mc[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)))[37m[39;49;00m$
   101	[37m                [39;49;00m[37m; say to specified channel[39;49;00m[37m[39;49;00m$
   102	[37m                [39;49;00m([34mif[39;49;00m[37m [39;49;00m([34mfind[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
   103	[37m                    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PRIVMSG %s :%s\r\n"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))))[37m[39;49;00m$
   104	[37m    [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"send-to-server"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))[37m[39;49;00m$
   105	[37m[39;49;00m$
   106	([34mdefine[39;49;00m[37m [39;49;00m([34mprocess[39;49;00m[34m-[39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33mtext[39;49;00m)[37m[39;49;00m$
   107	[37m    [39;49;00m([34mcond[39;49;00m[37m[39;49;00m$
   108	[37m        [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33m"PING"[39;49;00m)[37m[39;49;00m$
   109	[37m            [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PONG %s\r\n"[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m)))[37m[39;49;00m$
   110	[37m        [39;49;00m(([34mor[39;49;00m[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m"NOTICE"[39;49;00m)[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m"PRIVMSG"[39;49;00m))[37m[39;49;00m$
   111	[37m            [39;49;00m([34mprocess[39;49;00m[34m-[39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33mtext[39;49;00m))[37m[39;49;00m$
   112	[37m        [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m"JOIN"[39;49;00m)[37m[39;49;00m$
   113	[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33musername[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m!|:[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m))))[37m[39;49;00m$
   114	[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mchannel[39;49;00m[37m  [39;49;00m([34mlast[39;49;00m[37m  [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m!|:[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m))))[37m[39;49;00m$
   115	[37m            [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33musername [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m joined [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)[37m[39;49;00m$
   116	[37m            [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"join"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m))))[37m[39;49;00m$
   117	[37m        [39;49;00m([34mtrue[39;49;00m[37m[39;49;00m$
   118	[37m            [39;49;00m[34mnil[39;49;00m)))[37m[39;49;00m$
   119	[37m[39;49;00m$
   120	([34mdefine[39;49;00m[37m [39;49;00m([34mprocess[39;49;00m[34m-[39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33mtext[39;49;00m)[37m[39;49;00m$
   121	[37m    [39;49;00m([34mlet[39;49;00m[37m [39;49;00m(([31musername[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m))[37m[39;49;00m$
   122	[37m        [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33musername[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m!|:[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m))))[37m[39;49;00m$
   123	[37m        [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mtarget[39;49;00m[37m   [39;49;00m([34mtrim[39;49;00m[37m  [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33mtext[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m!|:[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m)))))[37m[39;49;00m$
   124	[37m        [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mmessage[39;49;00m[37m  [39;49;00m([34mslice[39;49;00m[37m [39;49;00m[33mtext[39;49;00m[37m [39;49;00m([31m+[39;49;00m[37m [39;49;00m([34mfind[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m:[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mtext[39;49;00m)[37m [39;49;00m[33m1[39;49;00m)))[37m[39;49;00m$
   125	[37m        [39;49;00m([34mcond[39;49;00m[37m [39;49;00m$
   126	[37m            [39;49;00m(([34mstarts-with[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m"\001"[39;49;00m)[37m[39;49;00m$
   127	[37m                [39;49;00m([34mprocess[39;49;00m[34m-[39;49;00m[33mctcp[39;49;00m[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))[37m[39;49;00m$
   128	[37m            [39;49;00m(([34mfind[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
   129	[37m                [39;49;00m([34mcond[39;49;00m[37m [39;49;00m$
   130	[37m                    [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mPRIVMSG[39;49;00m[33m}[39;49;00m)[37m[39;49;00m$
   131	[37m                        [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"channel-message"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))[37m[39;49;00m$
   132	[37m                    [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mNOTICE[39;49;00m[33m}[39;49;00m)[37m[39;49;00m$
   133	[37m                        [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"channel-notice"[39;49;00m[37m  [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))))[37m[39;49;00m$
   134	[37m            [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m)[37m[39;49;00m$
   135	[37m                [39;49;00m([34mcond[39;49;00m[37m [39;49;00m$
   136	[37m                    [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mPRIVMSG[39;49;00m[33m}[39;49;00m)[37m[39;49;00m$
   137	[37m                        [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"private-message"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))[37m[39;49;00m$
   138	[37m                    [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mNOTICE[39;49;00m[33m}[39;49;00m)[37m[39;49;00m$
   139	[37m                        [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"private-notice"[39;49;00m[37m  [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))))[37m[39;49;00m$
   140	[37m            [39;49;00m([34mtrue[39;49;00m[37m                [39;49;00m$
   141	[37m                [39;49;00m[34mnil[39;49;00m))))[37m[39;49;00m$
   142	[37m  [39;49;00m$
   143	([34mdefine[39;49;00m[37m [39;49;00m([34mprocess[39;49;00m[34m-[39;49;00m[33mctcp[39;49;00m[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)[37m[39;49;00m$
   144	[37m    [39;49;00m([34mcond[39;49;00m[37m[39;49;00m$
   145	[37m        [39;49;00m(([34mstarts-with[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m"\001VERSION\001"[39;49;00m)[37m[39;49;00m$
   146	[37m            [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"NOTICE %s :\001VERSION %s\001\r\n"[39;49;00m[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m[33mversion[39;49;00m)))[37m[39;49;00m$
   147	[37m        [39;49;00m(([34mstarts-with[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m"\001PING"[39;49;00m)[37m[39;49;00m$
   148	[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mdata[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mrest[39;49;00m[37m [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m)))))[37m[39;49;00m$
   149	[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mdata[39;49;00m[37m [39;49;00m([34mtrim[39;49;00m[37m [39;49;00m[33mdata[39;49;00m[37m [39;49;00m[33m"\001"[39;49;00m[37m [39;49;00m[33m"\001"[39;49;00m))[37m[39;49;00m$
   150	[37m            [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m  [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"NOTICE %s :\001PING %s\001\r\n"[39;49;00m[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m[33mdata[39;49;00m)))[37m[39;49;00m$
   151	[37m        [39;49;00m(([34mstarts-with[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m"\001ACTION"[39;49;00m)[37m[39;49;00m$
   152	[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mdata[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mrest[39;49;00m[37m [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m)))))[37m[39;49;00m$
   153	[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mdata[39;49;00m[37m [39;49;00m([34mjoin[39;49;00m[37m [39;49;00m[33mdata[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m [39;49;00m[33m}[39;49;00m))[37m[39;49;00m$
   154	[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mdata[39;49;00m[37m [39;49;00m([34mtrim[39;49;00m[37m [39;49;00m[33mdata[39;49;00m[37m [39;49;00m[33m"\001"[39;49;00m[37m [39;49;00m[33m"\001"[39;49;00m))[37m[39;49;00m$
   155	[37m            [39;49;00m([34mif[39;49;00m[37m [39;49;00m([34mfind[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
   156	[37m                [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"channel-action"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))[37m[39;49;00m$
   157	[37m            [39;49;00m([34mif[39;49;00m[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m)[37m[39;49;00m$
   158	[37m                [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"private-action"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)))))[37m[39;49;00m$
   159	[37m        [39;49;00m(([34mstarts-with[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m"\001TIME\001"[39;49;00m)[37m[39;49;00m$
   160	[37m            [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"NOTICE %s:\001TIME :%s\001\r\n"[39;49;00m[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m([34mdate[39;49;00m))))))[37m[39;49;00m$
   161	[37m[39;49;00m$
   162	([34mdefine[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[34m-[39;49;00m[33mbuffer[39;49;00m[37m [39;49;00m[33mraw-buffer[39;49;00m)[37m[39;49;00m$
   163	[37m    [39;49;00m([34mlet[39;49;00m[37m [39;49;00m(([31mmessages[39;49;00m[37m [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33mraw-buffer[39;49;00m[37m [39;49;00m[33m"\r\n"[39;49;00m[37m [39;49;00m[33m0[39;49;00m)))[37m[39;49;00m$
   164	[37m          [39;49;00m([31msender[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mtext[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m))[37m[39;49;00m$
   165	[37m        [39;49;00m[37m; check for elapsed time since last activity    [39;49;00m[37m[39;49;00m$
   166	[37m        [39;49;00m([34mwhen[39;49;00m[37m [39;49;00m([31m>[39;49;00m[37m [39;49;00m([34msub[39;49;00m[37m [39;49;00m([34mtime-of-day[39;49;00m)[37m [39;49;00m[33mItime-stamp[39;49;00m)[37m [39;49;00m([34mmul[39;49;00m[37m [39;49;00m[33mIdle-time[39;49;00m[37m [39;49;00m[33m1000[39;49;00m))[37m[39;49;00m$
   167	[37m              [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"idle-event"[39;49;00m)[37m[39;49;00m$
   168	[37m              [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mItime-stamp[39;49;00m[37m [39;49;00m([34mtime-of-day[39;49;00m)))[37m[39;49;00m$
   169	[37m        [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mmessage[39;49;00m[37m [39;49;00m[33mmessages[39;49;00m)[37m[39;49;00m$
   170	[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mmessage-parts[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m [39;49;00m[33m}[39;49;00m))[37m           [39;49;00m$
   171	[37m            [39;49;00m([34munless[39;49;00m[37m [39;49;00m([31mempty?[39;49;00m[37m [39;49;00m[33mmessage-parts[39;49;00m)[37m[39;49;00m$
   172	[37m                [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33msender[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m[33mmessage-parts[39;49;00m))[37m[39;49;00m$
   173	[37m                [39;49;00m([34mcatch[39;49;00m[37m [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mcommand[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mrest[39;49;00m[37m [39;49;00m[33mmessage-parts[39;49;00m)))[37m [39;49;00m'[33merror[39;49;00m)[37m[39;49;00m$
   174	[37m                [39;49;00m([34mcatch[39;49;00m[37m [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mtext[39;49;00m[37m [39;49;00m([34mjoin[39;49;00m[37m [39;49;00m([34mrest[39;49;00m[37m [39;49;00m([34mrest[39;49;00m[37m [39;49;00m[33mmessage-parts[39;49;00m))[37m [39;49;00m[33m{[39;49;00m[33m [39;49;00m[33m}[39;49;00m))[37m [39;49;00m'[33merror[39;49;00m))[37m[39;49;00m$
   175	[37m            [39;49;00m([34mprocess[39;49;00m[34m-[39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33mtext[39;49;00m))))[37m[39;49;00m$
   176	[37m[39;49;00m$
   177	([34mdefine[39;49;00m[37m [39;49;00m([34mread[39;49;00m[34m-[39;49;00m[33mirc[39;49;00m)[37m[39;49;00m$
   178	[37m    [39;49;00m([34mlet[39;49;00m[37m [39;49;00m(([31mbuffer[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m))[37m[39;49;00m$
   179	[37m        [39;49;00m([34mwhen[39;49;00m[37m [39;49;00m([31m!=[39;49;00m[37m [39;49;00m([34mnet-peek[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m)[37m [39;49;00m[33m0[39;49;00m)[37m [39;49;00m$
   180	[37m              [39;49;00m([34mnet-receive[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m[33mbuffer[39;49;00m[37m [39;49;00m[33m8192[39;49;00m[37m [39;49;00m[33m"\n"[39;49;00m)[37m[39;49;00m$
   181	[37m              [39;49;00m([34munless[39;49;00m[37m [39;49;00m([31mempty?[39;49;00m[37m [39;49;00m[33mbuffer[39;49;00m)[37m[39;49;00m$
   182	[37m                [39;49;00m([34mparse[39;49;00m[34m-[39;49;00m[33mbuffer[39;49;00m[37m [39;49;00m[33mbuffer[39;49;00m)))))[37m[39;49;00m$
   183	[37m[39;49;00m$
   184	([34mdefine[39;49;00m[37m [39;49;00m([34mread[39;49;00m[34m-[39;49;00m[33mirc-loop[39;49;00m)[37m [39;49;00m[37m; monitoring[39;49;00m[37m[39;49;00m$
   185	[37m    [39;49;00m([34mlet[39;49;00m[37m [39;49;00m(([31mbuffer[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m))[37m       [39;49;00m$
   186	[37m        [39;49;00m([34mwhile[39;49;00m[37m [39;49;00m[33mIconnected[39;49;00m[37m    [39;49;00m$
   187	[37m            [39;49;00m([34mread[39;49;00m[34m-[39;49;00m[33mirc[39;49;00m)[37m[39;49;00m$
   188	[37m            [39;49;00m([34msleep[39;49;00m[37m [39;49;00m[33m1000[39;49;00m))))[37m[39;49;00m$
   189	[37m[39;49;00m$
   190	([34mdefine[39;49;00m[37m [39;49;00m([34mprint[39;49;00m[34m-[39;49;00m[33mraw-message[39;49;00m[37m [39;49;00m[33mdata[39;49;00m)[37m [39;49;00m[37m; example of using a callback[39;49;00m[37m[39;49;00m$
   191	[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mraw-data[39;49;00m[37m [39;49;00m([34mlookup[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mdata[39;49;00m))[37m[39;49;00m$
   192	[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mchannel[39;49;00m[37m  [39;49;00m([34mlookup[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mdata[39;49;00m))[37m[39;49;00m$
   193	[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mmessage-text[39;49;00m[37m [39;49;00m[33mraw-data[39;49;00m)[37m[39;49;00m$
   194	[37m    [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m([34mdate[39;49;00m[37m [39;49;00m([34mdate-value[39;49;00m)[37m [39;49;00m[33m0[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m%H:%M:%S [39;49;00m[33m}[39;49;00m)[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m> [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mmessage-text[39;49;00m))[37m[39;49;00m$
   195	[37m[39;49;00m$
   196	([34mdefine[39;49;00m[37m [39;49;00m([34mprint[39;49;00m[34m-[39;49;00m[33moutgoing-message[39;49;00m[37m [39;49;00m[33mdata[39;49;00m)[37m[39;49;00m$
   197	[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mraw-data[39;49;00m[37m [39;49;00m([34mlookup[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mdata[39;49;00m))[37m[39;49;00m$
   198	[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mchannel[39;49;00m[37m  [39;49;00m([34mlookup[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mdata[39;49;00m))[37m[39;49;00m$
   199	[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mmessage-text[39;49;00m[37m [39;49;00m[33mraw-data[39;49;00m)[37m[39;49;00m$
   200	[37m    [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m([34mdate[39;49;00m[37m [39;49;00m([34mdate-value[39;49;00m)[37m [39;49;00m[33m0[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m%H:%M:%S [39;49;00m[33m}[39;49;00m)[37m [39;49;00m[33mInickname[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m> [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mmessage-text[39;49;00m))[37m[39;49;00m$
   201	[37m[39;49;00m$
   202	([34mdefine[39;49;00m[37m [39;49;00m([31msession[39;49;00m)[37m; interactive terminal[39;49;00m[37m[39;49;00m$
   203	[37m    [39;49;00m[37m; must add callbacks to display messages[39;49;00m[37m[39;49;00m$
   204	[37m    [39;49;00m([31mregister-callback[39;49;00m[37m [39;49;00m[33m"channel-message"[39;49;00m[37m [39;49;00m'[34mprint[39;49;00m[34m-[39;49;00m[33mraw-message[39;49;00m)[37m[39;49;00m$
   205	[37m    [39;49;00m([31mregister-callback[39;49;00m[37m [39;49;00m[33m"send-to-server"[39;49;00m[37m  [39;49;00m'[34mprint[39;49;00m[34m-[39;49;00m[33moutgoing-message[39;49;00m)[37m[39;49;00m$
   206	[37m    [39;49;00m([34mwhile[39;49;00m[37m [39;49;00m[33mIconnected[39;49;00m[37m[39;49;00m$
   207	[37m        [39;49;00m([34mwhile[39;49;00m[37m [39;49;00m([31mzero?[39;49;00m[37m [39;49;00m([34mpeek[39;49;00m[37m [39;49;00m[33m0[39;49;00m))[37m[39;49;00m$
   208	[37m            [39;49;00m([34mread[39;49;00m[34m-[39;49;00m[33mirc[39;49;00m))[37m[39;49;00m$
   209	[37m        [39;49;00m([34msend[39;49;00m[34m-[39;49;00m[33mto-server[39;49;00m[37m [39;49;00m([34mstring[39;49;00m[37m [39;49;00m([34mread-line[39;49;00m[37m [39;49;00m[33m0[39;49;00m))))[37m[39;49;00m$
   210	[37m    [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mfinished session [39;49;00m[33m}[39;49;00m[37m [39;49;00m([34mdate[39;49;00m))[37m[39;49;00m$
   211	[37m    [39;49;00m([34mexit[39;49;00m))[37m[39;49;00m$
   212	[37m[39;49;00m$
   213	[37m; end of IRC code[39;49;00m$
