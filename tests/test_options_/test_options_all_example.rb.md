     1^I[34mmodule[39;49;00m [04m[36mCodeRay[39;49;00m$
     2^I^I[34mmodule[39;49;00m [04m[36mScanners[39;49;00m$
     3^I$
     4^I[34mclass[39;49;00m [04m[32mRuby[39;49;00m < [31mScanner[39;49;00m$
     5^I$
     6^I^I[31mRESERVED_WORDS[39;49;00m = [$
     7^I^I^I[33m'[39;49;00m[33mand[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mdef[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mend[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33min[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mor[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33munless[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mbegin[39;49;00m[33m'[39;49;00m,$
     8^I^I^I[33m'[39;49;00m[33mdefined?[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mensure[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mmodule[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mredo[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33msuper[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33muntil[39;49;00m[33m'[39;49;00m,$
     9^I^I^I[33m'[39;49;00m[33mBEGIN[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mbreak[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mdo[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mnext[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mrescue[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mthen[39;49;00m[33m'[39;49;00m,$
    10^I^I^I[33m'[39;49;00m[33mwhen[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mEND[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mcase[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33melse[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mfor[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mretry[39;49;00m[33m'[39;49;00m,$
    11^I^I^I[33m'[39;49;00m[33mwhile[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33malias[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mclass[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33melsif[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mif[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mnot[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mreturn[39;49;00m[33m'[39;49;00m,$
    12^I^I^I[33m'[39;49;00m[33mundef[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33myield[39;49;00m[33m'[39;49;00m,$
    13^I^I]$
    14^I$
    15^I^I[31mDEF_KEYWORDS[39;49;00m = [[33m'[39;49;00m[33mdef[39;49;00m[33m'[39;49;00m]$
    16^I^I[31mMODULE_KEYWORDS[39;49;00m = [[33m'[39;49;00m[33mclass[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mmodule[39;49;00m[33m'[39;49;00m]$
    17^I^I[31mDEF_NEW_STATE[39;49;00m = [31mWordList[39;49;00m.new([33m:initial[39;49;00m).$
    18^I^I^Iadd([31mDEF_KEYWORDS[39;49;00m, [33m:def_expected[39;49;00m).$
    19^I^I^Iadd([31mMODULE_KEYWORDS[39;49;00m, [33m:module_expected[39;49;00m)$
    20^I$
    21^I^I[31mWORDS_ALLOWING_REGEXP[39;49;00m = [$
    22^I^I^I[33m'[39;49;00m[33mand[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mor[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mnot[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mwhile[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33muntil[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33munless[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mif[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33melsif[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mwhen[39;49;00m[33m'[39;49;00m$
    23^I^I]$
    24^I^I[31mREGEXP_ALLOWED[39;49;00m = [31mWordList[39;49;00m.new([34mfalse[39;49;00m).$
    25^I^I^Iadd([31mWORDS_ALLOWING_REGEXP[39;49;00m, [33m:set[39;49;00m)$
    26^I$
    27^I^I[31mPREDEFINED_CONSTANTS[39;49;00m = [$
    28^I^I^I[33m'[39;49;00m[33mnil[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mtrue[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mfalse[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mself[39;49;00m[33m'[39;49;00m,$
    29^I^I^I[33m'[39;49;00m[33mDATA[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mARGV[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mARGF[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33m__FILE__[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33m__LINE__[39;49;00m[33m'[39;49;00m,$
    30^I^I]$
    31^I$
    32^I^I[31mIDENT_KIND[39;49;00m = [31mWordList[39;49;00m.new([33m:ident[39;49;00m).$
    33^I^I^Iadd([31mRESERVED_WORDS[39;49;00m, [33m:reserved[39;49;00m).$
    34^I^I^Iadd([31mPREDEFINED_CONSTANTS[39;49;00m, [33m:pre_constant[39;49;00m)$
    35^I$
    36^I^I[31mMETHOD_NAME[39;49;00m = [33m/[39;49;00m[33m [39;49;00m[33m#{[39;49;00m[31mIDENT[39;49;00m[33m}[39;49;00m[33m [?!]? [39;49;00m[33m/xo[39;49;00m$
    37^I^I[31mMETHOD_NAME_EX[39;49;00m = [33m/[39;49;00m[33m[39;49;00m$
    38^I[33m^I [39;49;00m[33m#{[39;49;00m[31mMETHOD_NAME[39;49;00m[33m}[39;49;00m[33m  [39;49;00m[33m#[39;49;00m[33m common methods: split, foo=, empty?, gsub![39;49;00m$
    39^I[33m^I | [39;49;00m[33m\[39;49;00m[33m*[39;49;00m[33m\[39;49;00m[33m*?         [39;49;00m[33m#[39;49;00m[33m multiplication and power[39;49;00m$
    40^I[33m^I | [-+~]@?       [39;49;00m[33m#[39;49;00m[33m plus, minus[39;49;00m$
    41^I[33m^I | [[39;49;00m[33m\/[39;49;00m[33m%&|^`]     [39;49;00m[33m#[39;49;00m[33m division, modulo or format strings, &and, |or, ^xor, `system`[39;49;00m$
    42^I[33m^I | [39;49;00m[33m\[39;49;00m[33m[[39;49;00m[33m\[39;49;00m[33m]=?        [39;49;00m[33m#[39;49;00m[33m array getter and setter[39;49;00m$
    43^I[33m^I | <=?>? | >=?   [39;49;00m[33m#[39;49;00m[33m comparison, rocket operator[39;49;00m$
    44^I[33m^I | << | >>       [39;49;00m[33m#[39;49;00m[33m append or shift left, shift right[39;49;00m$
    45^I[33m^I | ===?          [39;49;00m[33m#[39;49;00m[33m simple equality and case equality[39;49;00m$
    46^I[33m^I[39;49;00m[33m/ox[39;49;00m$
    47^I^I[31mGLOBAL_VARIABLE[39;49;00m = [33m/[39;49;00m[33m [39;49;00m[33m\[39;49;00m[33m$ (?: [39;49;00m[33m#{[39;49;00m[31mIDENT[39;49;00m[33m}[39;49;00m[33m | [39;49;00m[33m\[39;49;00m[33md+ | [~&+`'=[39;49;00m[33m\/[39;49;00m[33m,;_.<>!@0$?*":F[39;49;00m[33m\\[39;49;00m[33m] | -[a-zA-Z_0-9] ) [39;49;00m[33m/ox[39;49;00m$
    48^I$
    49^I^I[31mDOUBLEQ[39;49;00m = [33m/[39;49;00m[33m "  [^"[39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m]*  (?: (?: [39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m} | [39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m(?:$")?  | [39;49;00m[33m\\[39;49;00m[33m. ) [^"[39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m]*  )* "?  [39;49;00m[33m/ox[39;49;00m$
    50^I^I[31mSINGLEQ[39;49;00m = [33m/[39;49;00m[33m '  [^'[39;49;00m[33m\\[39;49;00m[33m]*    (?:                              [39;49;00m[33m\\[39;49;00m[33m.   [^'[39;49;00m[33m\\[39;49;00m[33m]*    )* '?  [39;49;00m[33m/ox[39;49;00m$
    51^I^I[31mSTRING[39;49;00m  = [33m/[39;49;00m[33m [39;49;00m[33m#{[39;49;00m[31mSINGLEQ[39;49;00m[33m}[39;49;00m[33m | [39;49;00m[33m#{[39;49;00m[31mDOUBLEQ[39;49;00m[33m}[39;49;00m[33m [39;49;00m[33m/ox[39;49;00m$
    52^I^I[31mSHELL[39;49;00m   = [33m/[39;49;00m[33m `  [^`[39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m]*  (?: (?: [39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m} | [39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m(?:$`)?  | [39;49;00m[33m\\[39;49;00m[33m. ) [^`[39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m]*  )* `?  [39;49;00m[33m/ox[39;49;00m$
    53^I^I[31mREGEXP[39;49;00m  = [33m/[39;49;00m[33m [39;49;00m[33m\/[39;49;00m[33m [^[39;49;00m[33m\/[39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m]* (?: (?: [39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m} | [39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m(?:$[39;49;00m[33m\/[39;49;00m[33m)? | [39;49;00m[33m\\[39;49;00m[33m. ) [^[39;49;00m[33m\/[39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m]* )* [39;49;00m[33m\/[39;49;00m[33m? [39;49;00m[33m/ox[39;49;00m$
    54^I$
    55^I^I[31mDECIMAL[39;49;00m = [33m/[39;49;00m[33m\[39;49;00m[33md+(?:_[39;49;00m[33m\[39;49;00m[33md+)*[39;49;00m[33m/[39;49;00m  [37m# doesn't recognize 09 as octal error[39;49;00m$
    56^I^I[31mOCTAL[39;49;00m = [33m/[39;49;00m[33m0_?[0-7]+(?:_[0-7]+)*[39;49;00m[33m/[39;49;00m$
    57^I^I[31mHEXADECIMAL[39;49;00m = [33m/[39;49;00m[33m0x[0-9A-Fa-f]+(?:_[0-9A-Fa-f]+)*[39;49;00m[33m/[39;49;00m$
    58^I^I[31mBINARY[39;49;00m = [33m/[39;49;00m[33m0b[01]+(?:_[01]+)*[39;49;00m[33m/[39;49;00m$
    59^I$
    60^I^I[31mEXPONENT[39;49;00m = [33m/[39;49;00m[33m [eE] [+-]? [39;49;00m[33m#{[39;49;00m[31mDECIMAL[39;49;00m[33m}[39;49;00m[33m [39;49;00m[33m/ox[39;49;00m$
    61^I^I[31mFLOAT[39;49;00m = [33m/[39;49;00m[33m [39;49;00m[33m#{[39;49;00m[31mDECIMAL[39;49;00m[33m}[39;49;00m[33m (?: [39;49;00m[33m#{[39;49;00m[31mEXPONENT[39;49;00m[33m}[39;49;00m[33m | [39;49;00m[33m\[39;49;00m[33m. [39;49;00m[33m#{[39;49;00m[31mDECIMAL[39;49;00m[33m}[39;49;00m[33m [39;49;00m[33m#{[39;49;00m[31mEXPONENT[39;49;00m[33m}[39;49;00m[33m? ) [39;49;00m[33m/[39;49;00m$
    62^I^I[31mINTEGER[39;49;00m = [33m/[39;49;00m[33m#{[39;49;00m[31mOCTAL[39;49;00m[33m}[39;49;00m[33m|[39;49;00m[33m#{[39;49;00m[31mHEXADECIMAL[39;49;00m[33m}[39;49;00m[33m|[39;49;00m[33m#{[39;49;00m[31mBINARY[39;49;00m[33m}[39;49;00m[33m|[39;49;00m[33m#{[39;49;00m[31mDECIMAL[39;49;00m[33m}[39;49;00m[33m/[39;49;00m$
    63^I$
    64^I^I[34mdef[39;49;00m [32mreset[39;49;00m$
    65^I^I^I[34msuper[39;49;00m$
    66^I^I^I[31m@regexp_allowed[39;49;00m = [34mfalse[39;49;00m$
    67^I^I[34mend[39;49;00m$
    68^I$
    69^I^I[34mdef[39;49;00m [32mnext_token[39;49;00m$
    70^I^I^I[34mreturn[39;49;00m [34mif[39;49;00m [31m@scanner[39;49;00m.eos?$
    71^I$
    72^I^I^Ikind = [33m:error[39;49;00m$
    73^I^I^I[34mif[39;49;00m [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m\[39;49;00m[33ms+[39;49;00m[33m/[39;49;00m)  [37m# in every state[39;49;00m$
    74^I^I^I^Ikind = [33m:space[39;49;00m$
    75^I^I^I^I[31m@regexp_allowed[39;49;00m = [33m:set[39;49;00m [34mif[39;49;00m [31m@regexp_allowed[39;49;00m [35mor[39;49;00m [31m@scanner[39;49;00m.matched.index([33m?\n[39;49;00m)  [37m# delayed flag setting[39;49;00m$
    76^I$
    77^I^I^I[34melsif[39;49;00m [31m@state[39;49;00m == [33m:def_expected[39;49;00m$
    78^I^I^I^I[34mif[39;49;00m [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m (?: (?:[39;49;00m[33m#{[39;49;00m[31mIDENT[39;49;00m[33m}[39;49;00m[33m(?:[39;49;00m[33m\[39;49;00m[33m.|::))* | (?:@@?|$)? [39;49;00m[33m#{[39;49;00m[31mIDENT[39;49;00m[33m}[39;49;00m[33m(?:[39;49;00m[33m\[39;49;00m[33m.|::) ) [39;49;00m[33m#{[39;49;00m[31mMETHOD_NAME_EX[39;49;00m[33m}[39;49;00m[33m [39;49;00m[33m/ox[39;49;00m)$
    79^I^I^I^I^Ikind = [33m:method[39;49;00m$
    80^I^I^I^I^I[31m@state[39;49;00m = [33m:initial[39;49;00m$
    81^I^I^I^I[34melse[39;49;00m$
    82^I^I^I^I^I[31m@scanner[39;49;00m.getch$
    83^I^I^I^I[34mend[39;49;00m$
    84^I^I^I^I[31m@state[39;49;00m = [33m:initial[39;49;00m$
    85^I$
    86^I^I^I[34melsif[39;49;00m [31m@state[39;49;00m == [33m:module_expected[39;49;00m$
    87^I^I^I^I[34mif[39;49;00m [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m<<[39;49;00m[33m/[39;49;00m)$
    88^I^I^I^I^Ikind = [33m:operator[39;49;00m$
    89^I^I^I^I[34melse[39;49;00m$
    90^I^I^I^I^I[34mif[39;49;00m [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m (?: [39;49;00m[33m#{[39;49;00m[31mIDENT[39;49;00m[33m}[39;49;00m[33m (?:[39;49;00m[33m\[39;49;00m[33m.|::))* [39;49;00m[33m#{[39;49;00m[31mIDENT[39;49;00m[33m}[39;49;00m[33m [39;49;00m[33m/ox[39;49;00m)$
    91^I^I^I^I^I^Ikind = [33m:method[39;49;00m$
    92^I^I^I^I^I[34melse[39;49;00m$
    93^I^I^I^I^I^I[31m@scanner[39;49;00m.getch$
    94^I^I^I^I^I[34mend[39;49;00m$
    95^I^I^I^I^I[31m@state[39;49;00m = [33m:initial[39;49;00m$
    96^I^I^I^I[34mend[39;49;00m$
    97^I$
    98^I^I^I[34melsif[39;49;00m [37m# state == :initial[39;49;00m$
    99^I^I^I^I[37m# IDENTIFIERS, KEYWORDS[39;49;00m$
   100^I^I^I^I[34mif[39;49;00m [31m@scanner[39;49;00m.scan([31mGLOBAL_VARIABLE[39;49;00m)$
   101^I^I^I^I^Ikind = [33m:global_variable[39;49;00m$
   102^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m @@ [39;49;00m[33m#{[39;49;00m[31mIDENT[39;49;00m[33m}[39;49;00m[33m [39;49;00m[33m/ox[39;49;00m)$
   103^I^I^I^I^Ikind = [33m:class_variable[39;49;00m$
   104^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m @ [39;49;00m[33m#{[39;49;00m[31mIDENT[39;49;00m[33m}[39;49;00m[33m [39;49;00m[33m/ox[39;49;00m)$
   105^I^I^I^I^Ikind = [33m:instance_variable[39;49;00m$
   106^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m __END__[39;49;00m[33m\[39;49;00m[33mn ( (?![39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33mCODE[39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m) .* )? | [39;49;00m[33m\[39;49;00m[33m#[39;49;00m[33m[^[39;49;00m[33m\[39;49;00m[33mn]* | =begin(?=[39;49;00m[33m\[39;49;00m[33ms).*? [39;49;00m[33m\[39;49;00m[33mn=end(?=[39;49;00m[33m\[39;49;00m[33ms|[39;49;00m[33m\[39;49;00m[33mz)(?:[^[39;49;00m[33m\[39;49;00m[33mn]*)? [39;49;00m[33m/mx[39;49;00m)$
   107^I^I^I^I^Ikind = [33m:comment[39;49;00m$
   108^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([31mMETHOD_NAME[39;49;00m)$
   109^I^I^I^I^I[34mif[39;49;00m [31m@last_token_dot[39;49;00m$
   110^I^I^I^I^I^Ikind = [33m:ident[39;49;00m$
   111^I^I^I^I^I[34melse[39;49;00m$
   112^I^I^I^I^I^Imatched = [31m@scanner[39;49;00m.matched$
   113^I^I^I^I^I^Ikind = [31mIDENT_KIND[39;49;00m[matched]$
   114^I^I^I^I^I^I[34mif[39;49;00m kind == [33m:ident[39;49;00m [35mand[39;49;00m matched =~ [33m/[39;49;00m[33m^[A-Z][39;49;00m[33m/[39;49;00m$
   115^I^I^I^I^I^I^Ikind = [33m:constant[39;49;00m$
   116^I^I^I^I^I^I[34melsif[39;49;00m kind == [33m:reserved[39;49;00m$
   117^I^I^I^I^I^I^I[31m@state[39;49;00m = [31mDEF_NEW_STATE[39;49;00m[matched]$
   118^I^I^I^I^I^I^I[31m@regexp_allowed[39;49;00m = [31mREGEXP_ALLOWED[39;49;00m[matched]$
   119^I^I^I^I^I^I[34mend[39;49;00m$
   120^I^I^I^I^I[34mend[39;49;00m$
   121^I$
   122^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([31mSTRING[39;49;00m)$
   123^I^I^I^I^Ikind = [33m:string[39;49;00m$
   124^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([31mSHELL[39;49;00m)$
   125^I^I^I^I^Ikind = [33m:shell[39;49;00m$
   126^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m<<[39;49;00m$
   127^I[33m^I^I^I^I(?:[39;49;00m$
   128^I[33m^I^I^I^I^I([a-zA-Z_0-9]+)[39;49;00m$
   129^I[33m^I^I^I^I^I^I(?: .*? ^[39;49;00m[33m\[39;49;00m[33m1$ | .* )[39;49;00m$
   130^I[33m^I^I^I^I|[39;49;00m$
   131^I[33m^I^I^I^I^I-([a-zA-Z_0-9]+)[39;49;00m$
   132^I[33m^I^I^I^I^I^I(?: .*? ^[39;49;00m[33m\[39;49;00m[33ms*[39;49;00m[33m\[39;49;00m[33m2$ | .* )[39;49;00m$
   133^I[33m^I^I^I^I|[39;49;00m$
   134^I[33m^I^I^I^I^I(["[39;49;00m[33m\[39;49;00m[33m'`]) (.+?) [39;49;00m[33m\[39;49;00m[33m3[39;49;00m$
   135^I[33m^I^I^I^I^I^I(?: .*? ^[39;49;00m[33m\[39;49;00m[33m4$ | .* )[39;49;00m$
   136^I[33m^I^I^I^I|[39;49;00m$
   137^I[33m^I^I^I^I^I- (["[39;49;00m[33m\[39;49;00m[33m'`]) (.+?) [39;49;00m[33m\[39;49;00m[33m5[39;49;00m$
   138^I[33m^I^I^I^I^I^I(?: .*? ^[39;49;00m[33m\[39;49;00m[33ms*[39;49;00m[33m\[39;49;00m[33m6$ | .* )[39;49;00m$
   139^I[33m^I^I^I^I)[39;49;00m$
   140^I[33m^I^I^I[39;49;00m[33m/mxo[39;49;00m)$
   141^I^I^I^I^Ikind = [33m:string[39;49;00m$
   142^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m\/[39;49;00m[33m/[39;49;00m) [35mand[39;49;00m [31m@regexp_allowed[39;49;00m$
   143^I^I^I^I^I[31m@scanner[39;49;00m.unscan$
   144^I^I^I^I^I[31m@scanner[39;49;00m.scan([31mREGEXP[39;49;00m)$
   145^I^I^I^I^Ikind = [33m:regexp[39;49;00m$
   146^I[33m/[39;49;00m[33m%(?:[Qqxrw](?:[39;49;00m[33m\[39;49;00m[33m([^)[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*(?:(?:[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m}|[39;49;00m[33m#[39;49;00m[33m|[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m.)[^)[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*)*[39;49;00m[33m\[39;49;00m[33m)?|[39;49;00m[33m\[39;49;00m[33m[[^[39;49;00m[33m\[39;49;00m[33m][39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*(?:(?:[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m}|[39;49;00m[33m#[39;49;00m[33m|[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m.)[^[39;49;00m[33m\[39;49;00m[33m][39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*)*[39;49;00m[33m\[39;49;00m[33m]?|[39;49;00m[33m\[39;49;00m[33m{[^}[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*(?:(?:[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m}|[39;49;00m[33m#[39;49;00m[33m|[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m.)[^}[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*)*[39;49;00m[33m\[39;49;00m[33m}?|<[^>[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*(?:(?:[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m}|[39;49;00m[33m#[39;49;00m[33m|[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m.)[^>[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*)*>?|([^a-zA-Z[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m])(?:(?![39;49;00m[33m\[39;49;00m[33m1)[^[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m])*(?:(?:[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m}|[39;49;00m[33m#[39;49;00m[33m|[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m.)(?:(?![39;49;00m[33m\[39;49;00m[33m1)[^[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m])*)*[39;49;00m[33m\[39;49;00m[33m1?)|[39;49;00m[33m\[39;49;00m[33m([^)[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*(?:(?:[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m}|[39;49;00m[33m#[39;49;00m[33m|[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m.)[^)[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*)*[39;49;00m[33m\[39;49;00m[33m)?|[39;49;00m[33m\[39;49;00m[33m[[^[39;49;00m[33m\[39;49;00m[33m][39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*(?:(?:[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m}|[39;49;00m[33m#[39;49;00m[33m|[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m.)[^[39;49;00m[33m\[39;49;00m[33m][39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*)*[39;49;00m[33m\[39;49;00m[33m]?|[39;49;00m[33m\[39;49;00m[33m{[^}[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*(?:(?:[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m}|[39;49;00m[33m#[39;49;00m[33m|[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m.)[^}[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*)*[39;49;00m[33m\[39;49;00m[33m}?|<[^>[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*(?:(?:[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m}|[39;49;00m[33m#[39;49;00m[33m|[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m.)[^>[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*)*>?|([^a-zA-Z[39;49;00m[33m\[39;49;00m[33ms[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m])(?:(?![39;49;00m[33m\[39;49;00m[33m2)[^[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m])*(?:(?:[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m}|[39;49;00m[33m#[39;49;00m[33m|[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m.)(?:(?![39;49;00m[33m\[39;49;00m[33m2)[^[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m])*)*[39;49;00m[33m\[39;49;00m[33m2?|[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m[^[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*(?:(?:[39;49;00m[33m#[39;49;00m[33m\[39;49;00m[33m{.*?[39;49;00m[33m\[39;49;00m[33m}|[39;49;00m[33m#[39;49;00m[33m)[^[39;49;00m[33m#[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m]*)*[39;49;00m[33m\\[39;49;00m[33m\\[39;49;00m[33m?)[39;49;00m[33m/[39;49;00m$
   147^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m:(?:[39;49;00m[33m#{[39;49;00m[31mGLOBAL_VARIABLE[39;49;00m[33m}[39;49;00m[33m|[39;49;00m[33m#{[39;49;00m[31mMETHOD_NAME_EX[39;49;00m[33m}[39;49;00m[33m|[39;49;00m[33m#{[39;49;00m[31mSTRING[39;49;00m[33m}[39;49;00m[33m)[39;49;00m[33m/ox[39;49;00m)$
   148^I^I^I^I^Ikind = [33m:symbol[39;49;00m$
   149^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m[39;49;00m$
   150^I[33m^I^I^I^I[39;49;00m[33m\[39;49;00m[33m? (?:[39;49;00m$
   151^I[33m^I^I^I^I^I[^[39;49;00m[33m\[39;49;00m[33ms[39;49;00m[33m\\[39;49;00m[33m][39;49;00m$
   152^I[33m^I^I^I^I|[39;49;00m$
   153^I[33m^I^I^I^I^I[39;49;00m[33m\\[39;49;00m[33m (?:M-[39;49;00m[33m\\[39;49;00m[33mC-|C-[39;49;00m[33m\\[39;49;00m[33mM-|M-[39;49;00m[33m\\[39;49;00m[33mc|c[39;49;00m[33m\\[39;49;00m[33mM-|c|C-|M-))? (?: [39;49;00m[33m\\[39;49;00m[33m (?: . | [0-7]{3} | x[0-9A-Fa-f][0-9A-Fa-f] )[39;49;00m$
   154^I[33m^I^I^I^I)[39;49;00m$
   155^I[33m^I^I^I[39;49;00m[33m/mox[39;49;00m)$
   156^I^I^I^I^Ikind = [33m:integer[39;49;00m$
   157^I$
   158^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m [-+*[39;49;00m[33m\/[39;49;00m[33m%=<>;,|&!()[39;49;00m[33m\[39;49;00m[33m[[39;49;00m[33m\[39;49;00m[33m]{}~?] | [39;49;00m[33m\[39;49;00m[33m.[39;49;00m[33m\[39;49;00m[33m.?[39;49;00m[33m\[39;49;00m[33m.? | ::? [39;49;00m[33m/x[39;49;00m)$
   159^I^I^I^I^Ikind = [33m:operator[39;49;00m$
   160^I^I^I^I^I[31m@regexp_allowed[39;49;00m = [33m:set[39;49;00m [34mif[39;49;00m [31m@scanner[39;49;00m.matched[-[34m1[39;49;00m,[34m1[39;49;00m] =~ [33m/[39;49;00m[33m[~=!<>|&^,[39;49;00m[33m\[39;49;00m[33m([39;49;00m[33m\[39;49;00m[33m[+[39;49;00m[33m\[39;49;00m[33m-[39;49;00m[33m\/[39;49;00m[33m\[39;49;00m[33m*%][39;49;00m[33m\[39;49;00m[33mz[39;49;00m[33m/[39;49;00m$
   161^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([31mFLOAT[39;49;00m)$
   162^I^I^I^I^Ikind = [33m:float[39;49;00m$
   163^I^I^I^I[34melsif[39;49;00m [31m@scanner[39;49;00m.scan([31mINTEGER[39;49;00m)$
   164^I^I^I^I^Ikind = [33m:integer[39;49;00m$
   165^I^I^I^I[34melse[39;49;00m$
   166^I^I^I^I^I[31m@scanner[39;49;00m.getch$
   167^I^I^I^I[34mend[39;49;00m$
   168^I^I^I[34mend[39;49;00m$
   169^I$
   170^I^I^Itoken = [31mToken[39;49;00m.new [31m@scanner[39;49;00m.matched, kind$
   171^I$
   172^I^I^I[34mif[39;49;00m kind == [33m:regexp[39;49;00m$
   173^I^I^I^Itoken.text << [31m@scanner[39;49;00m.scan([33m/[39;49;00m[33m[eimnosux]*[39;49;00m[33m/[39;49;00m)$
   174^I^I^I[34mend[39;49;00m$
   175^I$
   176^I^I^I[31m@regexp_allowed[39;49;00m = ([31m@regexp_allowed[39;49;00m == [33m:set[39;49;00m)  [37m# delayed flag setting[39;49;00m$
   177^I$
   178^I^I^Itoken$
   179^I^I[34mend[39;49;00m$
   180^I[34mend[39;49;00m$
   181^I$
   182^Iregister [31mRuby[39;49;00m, [33m'[39;49;00m[33mruby[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mrb[39;49;00m[33m'[39;49;00m$
   183^I$
   184^I^I[34mend[39;49;00m$
   185^I[34mend[39;49;00m$
   186^I[34mclass[39;49;00m [04m[32mSet[39;49;00m$
   187^I  [34minclude[39;49;00m [31mEnumerable[39;49;00m$
   188^I$
   189^I  [37m# Creates a new set containing the given objects.[39;49;00m$
   190^I  [34mdef[39;49;00m [04m[32mself[39;49;00m.[32m[][39;49;00m(*ary)$
   191^I    [34mnew[39;49;00m(ary)$
   192^I  [34mend[39;49;00m$
   193^I$
   194^I  [37m# Creates a new set containing the elements of the given enumerable[39;49;00m$
   195^I  [37m# object.[39;49;00m$
   196^I  [37m#[39;49;00m$
   197^I  [37m# If a block is given, the elements of enum are preprocessed by the[39;49;00m$
   198^I  [37m# given block.[39;49;00m$
   199^I  [34mdef[39;49;00m [32minitialize[39;49;00m(enum = [34mnil[39;49;00m, &block) [37m# :yields: o[39;49;00m$
   200^I    [31m@hash[39;49;00m ||= [31mHash[39;49;00m.new$
   201^I$
   202^I    enum.nil? [35mand[39;49;00m [34mreturn[39;49;00m$
   203^I$
   204^I    [34mif[39;49;00m block$
   205^I      enum.each { |o| add(block[o]) }$
   206^I    [34melse[39;49;00m$
   207^I      merge(enum)$
   208^I    [34mend[39;49;00m$
   209^I  [34mend[39;49;00m$
   210^I$
   211^I  [37m# Copy internal hash.[39;49;00m$
   212^I  [34mdef[39;49;00m [32minitialize_copy[39;49;00m(orig)$
   213^I    [31m@hash[39;49;00m = orig.instance_eval{[31m@hash[39;49;00m}.dup$
   214^I  [34mend[39;49;00m$
   215^I$
   216^I  [37m# Returns the number of elements.[39;49;00m$
   217^I  [34mdef[39;49;00m [32msize[39;49;00m$
   218^I    [31m@hash[39;49;00m.size$
   219^I  [34mend[39;49;00m$
   220^I  [34malias[39;49;00m length size$
   221^I$
   222^I  [37m# Returns true if the set contains no elements.[39;49;00m$
   223^I  [34mdef[39;49;00m [32mempty?[39;49;00m$
   224^I    [31m@hash[39;49;00m.empty?$
   225^I  [34mend[39;49;00m$
   226^I$
   227^I  [37m# Removes all elements and returns self.[39;49;00m$
   228^I  [34mdef[39;49;00m [32mclear[39;49;00m$
   229^I    [31m@hash[39;49;00m.clear$
   230^I    [36mself[39;49;00m$
   231^I  [34mend[39;49;00m$
   232^I$
   233^I  [37m# Replaces the contents of the set with the contents of the given[39;49;00m$
   234^I  [37m# enumerable object and returns self.[39;49;00m$
   235^I  [34mdef[39;49;00m [32mreplace[39;49;00m(enum)$
   236^I    [34mif[39;49;00m enum.class == [36mself[39;49;00m.class$
   237^I      [31m@hash[39;49;00m.replace(enum.instance_eval { [31m@hash[39;49;00m })$
   238^I    [34melse[39;49;00m$
   239^I      enum.is_a?([31mEnumerable[39;49;00m) [35mor[39;49;00m [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mvalue must be enumerable[39;49;00m[33m"[39;49;00m$
   240^I      clear$
   241^I      enum.each { |o| add(o) }$
   242^I    [34mend[39;49;00m$
   243^I$
   244^I    [36mself[39;49;00m$
   245^I  [34mend[39;49;00m$
   246^I$
   247^I  [37m# Converts the set to an array.  The order of elements is uncertain.[39;49;00m$
   248^I  [34mdef[39;49;00m [32mto_a[39;49;00m$
   249^I    [31m@hash[39;49;00m.keys$
   250^I  [34mend[39;49;00m$
   251^I$
   252^I  [34mdef[39;49;00m [32mflatten_merge[39;49;00m(set, seen = [31mSet[39;49;00m.new)$
   253^I    set.each { |e|$
   254^I      [34mif[39;49;00m e.is_a?([31mSet[39;49;00m)$
   255^I^I[34mif[39;49;00m seen.include?(e_id = e.object_id)$
   256^I^I  [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mtried to flatten recursive Set[39;49;00m[33m"[39;49;00m$
   257^I^I[34mend[39;49;00m$
   258^I$
   259^I^Iseen.add(e_id)$
   260^I^Iflatten_merge(e, seen)$
   261^I^Iseen.delete(e_id)$
   262^I      [34melse[39;49;00m$
   263^I^Iadd(e)$
   264^I      [34mend[39;49;00m$
   265^I    }$
   266^I$
   267^I    [36mself[39;49;00m$
   268^I  [34mend[39;49;00m$
   269^I  [34mprotected[39;49;00m [33m:flatten_merge[39;49;00m$
   270^I$
   271^I  [37m# Returns a new set that is a copy of the set, flattening each[39;49;00m$
   272^I  [37m# containing set recursively.[39;49;00m$
   273^I  [34mdef[39;49;00m [32mflatten[39;49;00m$
   274^I    [36mself[39;49;00m.class.new.flatten_merge([36mself[39;49;00m)$
   275^I  [34mend[39;49;00m$
   276^I$
   277^I  [37m# Equivalent to Set#flatten, but replaces the receiver with the[39;49;00m$
   278^I  [37m# result in place.  Returns nil if no modifications were made.[39;49;00m$
   279^I  [34mdef[39;49;00m [32mflatten![39;49;00m$
   280^I    [34mif[39;49;00m detect { |e| e.is_a?([31mSet[39;49;00m) }$
   281^I      replace(flatten())$
   282^I    [34melse[39;49;00m$
   283^I      [34mnil[39;49;00m$
   284^I    [34mend[39;49;00m$
   285^I  [34mend[39;49;00m$
   286^I$
   287^I  [37m# Returns true if the set contains the given object.[39;49;00m$
   288^I  [34mdef[39;49;00m [32minclude?[39;49;00m(o)$
   289^I    [31m@hash[39;49;00m.include?(o)$
   290^I  [34mend[39;49;00m$
   291^I  [34malias[39;49;00m member? [34minclude[39;49;00m?$
   292^I$
   293^I  [37m# Returns true if the set is a superset of the given set.[39;49;00m$
   294^I  [34mdef[39;49;00m [32msuperset?[39;49;00m(set)$
   295^I    set.is_a?([31mSet[39;49;00m) [35mor[39;49;00m [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mvalue must be a set[39;49;00m[33m"[39;49;00m$
   296^I    [34mreturn[39;49;00m [34mfalse[39;49;00m [34mif[39;49;00m size < set.size$
   297^I    set.all? { |o| [34minclude[39;49;00m?(o) }$
   298^I  [34mend[39;49;00m$
   299^I$
   300^I  [37m# Returns true if the set is a proper superset of the given set.[39;49;00m$
   301^I  [34mdef[39;49;00m [32mproper_superset?[39;49;00m(set)$
   302^I    set.is_a?([31mSet[39;49;00m) [35mor[39;49;00m [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mvalue must be a set[39;49;00m[33m"[39;49;00m$
   303^I    [34mreturn[39;49;00m [34mfalse[39;49;00m [34mif[39;49;00m size <= set.size$
   304^I    set.all? { |o| [34minclude[39;49;00m?(o) }$
   305^I  [34mend[39;49;00m$
   306^I$
   307^I  [37m# Returns true if the set is a subset of the given set.[39;49;00m$
   308^I  [34mdef[39;49;00m [32msubset?[39;49;00m(set)$
   309^I    set.is_a?([31mSet[39;49;00m) [35mor[39;49;00m [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mvalue must be a set[39;49;00m[33m"[39;49;00m$
   310^I    [34mreturn[39;49;00m [34mfalse[39;49;00m [34mif[39;49;00m set.size < size$
   311^I    all? { |o| set.include?(o) }$
   312^I  [34mend[39;49;00m$
   313^I$
   314^I  [37m# Returns true if the set is a proper subset of the given set.[39;49;00m$
   315^I  [34mdef[39;49;00m [32mproper_subset?[39;49;00m(set)$
   316^I    set.is_a?([31mSet[39;49;00m) [35mor[39;49;00m [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mvalue must be a set[39;49;00m[33m"[39;49;00m$
   317^I    [34mreturn[39;49;00m [34mfalse[39;49;00m [34mif[39;49;00m set.size <= size$
   318^I    all? { |o| set.include?(o) }$
   319^I  [34mend[39;49;00m$
   320^I$
   321^I  [37m# Calls the given block once for each element in the set, passing[39;49;00m$
   322^I  [37m# the element as parameter.[39;49;00m$
   323^I  [34mdef[39;49;00m [32meach[39;49;00m$
   324^I    [31m@hash[39;49;00m.each_key { |o| [34myield[39;49;00m(o) }$
   325^I    [36mself[39;49;00m$
   326^I  [34mend[39;49;00m$
   327^I$
   328^I  [37m# Adds the given object to the set and returns self.  Use +merge+ to[39;49;00m$
   329^I  [37m# add several elements at once.[39;49;00m$
   330^I  [34mdef[39;49;00m [32madd[39;49;00m(o)$
   331^I    [31m@hash[39;49;00m[o] = [34mtrue[39;49;00m$
   332^I    [36mself[39;49;00m$
   333^I  [34mend[39;49;00m$
   334^I  [34malias[39;49;00m << add$
   335^I$
   336^I  [37m# Adds the given object to the set and returns self.  If the[39;49;00m$
   337^I  [37m# object is already in the set, returns nil.[39;49;00m$
   338^I  [34mdef[39;49;00m [32madd?[39;49;00m(o)$
   339^I    [34mif[39;49;00m [34minclude[39;49;00m?(o)$
   340^I      [34mnil[39;49;00m$
   341^I    [34melse[39;49;00m$
   342^I      add(o)$
   343^I    [34mend[39;49;00m$
   344^I  [34mend[39;49;00m$
   345^I$
   346^I  [37m# Deletes the given object from the set and returns self.  Use +subtract+ to[39;49;00m$
   347^I  [37m# delete several items at once.[39;49;00m$
   348^I  [34mdef[39;49;00m [32mdelete[39;49;00m(o)$
   349^I    [31m@hash[39;49;00m.delete(o)$
   350^I    [36mself[39;49;00m$
   351^I  [34mend[39;49;00m$
   352^I$
   353^I  [37m# Deletes the given object from the set and returns self.  If the[39;49;00m$
   354^I  [37m# object is not in the set, returns nil.[39;49;00m$
   355^I  [34mdef[39;49;00m [32mdelete?[39;49;00m(o)$
   356^I    [34mif[39;49;00m [34minclude[39;49;00m?(o)$
   357^I      delete(o)$
   358^I    [34melse[39;49;00m$
   359^I      [34mnil[39;49;00m$
   360^I    [34mend[39;49;00m$
   361^I  [34mend[39;49;00m$
   362^I$
   363^I  [37m# Deletes every element of the set for which block evaluates to[39;49;00m$
   364^I  [37m# true, and returns self.[39;49;00m$
   365^I  [34mdef[39;49;00m [32mdelete_if[39;49;00m$
   366^I    [31m@hash[39;49;00m.delete_if { |o,| [34myield[39;49;00m(o) }$
   367^I    [36mself[39;49;00m$
   368^I  [34mend[39;49;00m$
   369^I$
   370^I  [37m# Do collect() destructively.[39;49;00m$
   371^I  [34mdef[39;49;00m [32mcollect![39;49;00m$
   372^I    set = [36mself[39;49;00m.class.new$
   373^I    each { |o| set << [34myield[39;49;00m(o) }$
   374^I    replace(set)$
   375^I  [34mend[39;49;00m$
   376^I  [34malias[39;49;00m map! collect!$
   377^I$
   378^I  [37m# Equivalent to Set#delete_if, but returns nil if no changes were[39;49;00m$
   379^I  [37m# made.[39;49;00m$
   380^I  [34mdef[39;49;00m [32mreject![39;49;00m$
   381^I    n = size$
   382^I    delete_if { |o| [34myield[39;49;00m(o) }$
   383^I    size == n ? [34mnil[39;49;00m : [36mself[39;49;00m$
   384^I  [34mend[39;49;00m$
   385^I$
   386^I  [37m# Merges the elements of the given enumerable object to the set and[39;49;00m$
   387^I  [37m# returns self.[39;49;00m$
   388^I  [34mdef[39;49;00m [32mmerge[39;49;00m(enum)$
   389^I    [34mif[39;49;00m enum.is_a?([31mSet[39;49;00m)$
   390^I      [31m@hash[39;49;00m.update(enum.instance_eval { [31m@hash[39;49;00m })$
   391^I    [34melse[39;49;00m$
   392^I      enum.is_a?([31mEnumerable[39;49;00m) [35mor[39;49;00m [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mvalue must be enumerable[39;49;00m[33m"[39;49;00m$
   393^I      enum.each { |o| add(o) }$
   394^I    [34mend[39;49;00m$
   395^I$
   396^I    [36mself[39;49;00m$
   397^I  [34mend[39;49;00m$
   398^I$
   399^I  [37m# Deletes every element that appears in the given enumerable object[39;49;00m$
   400^I  [37m# and returns self.[39;49;00m$
   401^I  [34mdef[39;49;00m [32msubtract[39;49;00m(enum)$
   402^I    enum.is_a?([31mEnumerable[39;49;00m) [35mor[39;49;00m [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mvalue must be enumerable[39;49;00m[33m"[39;49;00m$
   403^I    enum.each { |o| delete(o) }$
   404^I    [36mself[39;49;00m$
   405^I  [34mend[39;49;00m$
   406^I$
   407^I  [37m# Returns a new set built by merging the set and the elements of the[39;49;00m$
   408^I  [37m# given enumerable object.[39;49;00m$
   409^I  [34mdef[39;49;00m [32m|[39;49;00m(enum)$
   410^I    enum.is_a?([31mEnumerable[39;49;00m) [35mor[39;49;00m [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mvalue must be enumerable[39;49;00m[33m"[39;49;00m$
   411^I    [36mdup[39;49;00m.merge(enum)$
   412^I  [34mend[39;49;00m$
   413^I  [34malias[39;49;00m + |^I^I[37m##[39;49;00m$
   414^I  [34malias[39;49;00m union |^I^I[37m##[39;49;00m$
   415^I$
   416^I  [37m# Returns a new set built by duplicating the set, removing every[39;49;00m$
   417^I  [37m# element that appears in the given enumerable object.[39;49;00m$
   418^I  [34mdef[39;49;00m [32m-[39;49;00m(enum)$
   419^I    enum.is_a?([31mEnumerable[39;49;00m) [35mor[39;49;00m [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mvalue must be enumerable[39;49;00m[33m"[39;49;00m$
   420^I    [36mdup[39;49;00m.subtract(enum)$
   421^I  [34mend[39;49;00m$
   422^I  [34malias[39;49;00m difference -^I[37m##[39;49;00m$
   423^I$
   424^I  [37m# Returns a new array containing elements common to the set and the[39;49;00m$
   425^I  [37m# given enumerable object.[39;49;00m$
   426^I  [34mdef[39;49;00m [32m&[39;49;00m(enum)$
   427^I    enum.is_a?([31mEnumerable[39;49;00m) [35mor[39;49;00m [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mvalue must be enumerable[39;49;00m[33m"[39;49;00m$
   428^I    n = [36mself[39;49;00m.class.new$
   429^I    enum.each { |o| n.add(o) [34mif[39;49;00m [34minclude[39;49;00m?(o) }$
   430^I    n$
   431^I  [34mend[39;49;00m$
   432^I  [34malias[39;49;00m intersection &^I[37m##[39;49;00m$
   433^I$
   434^I  [37m# Returns a new array containing elements exclusive between the set[39;49;00m$
   435^I  [37m# and the given enumerable object.  (set ^ enum) is equivalent to[39;49;00m$
   436^I  [37m# ((set | enum) - (set & enum)).[39;49;00m$
   437^I  [34mdef[39;49;00m [32m^[39;49;00m(enum)$
   438^I    enum.is_a?([31mEnumerable[39;49;00m) [35mor[39;49;00m [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mvalue must be enumerable[39;49;00m[33m"[39;49;00m$
   439^I    n = [36mdup[39;49;00m$
   440^I    enum.each { |o| [34mif[39;49;00m n.include?(o) [34mthen[39;49;00m n.delete(o) [34melse[39;49;00m n.add(o) [34mend[39;49;00m }$
   441^I    n$
   442^I  [34mend[39;49;00m$
   443^I$
   444^I  [37m# Returns true if two sets are equal.  The equality of each couple[39;49;00m$
   445^I  [37m# of elements is defined according to Object#eql?.[39;49;00m$
   446^I  [34mdef[39;49;00m [32m==[39;49;00m(set)$
   447^I    [36mequal?[39;49;00m(set) [35mand[39;49;00m [34mreturn[39;49;00m [34mtrue[39;49;00m$
   448^I$
   449^I    set.is_a?([31mSet[39;49;00m) && size == set.size [35mor[39;49;00m [34mreturn[39;49;00m [34mfalse[39;49;00m$
   450^I$
   451^I    [36mhash[39;49;00m = [31m@hash[39;49;00m.dup$
   452^I    set.all? { |o| [36mhash[39;49;00m.include?(o) }$
   453^I  [34mend[39;49;00m$
   454^I$
   455^I  [34mdef[39;49;00m [32mhash[39;49;00m^I[37m# :nodoc:[39;49;00m$
   456^I    [31m@hash[39;49;00m.hash$
   457^I  [34mend[39;49;00m$
   458^I$
   459^I  [34mdef[39;49;00m [32meql?[39;49;00m(o)^I[37m# :nodoc:[39;49;00m$
   460^I    [34mreturn[39;49;00m [34mfalse[39;49;00m [34munless[39;49;00m o.is_a?([31mSet[39;49;00m)$
   461^I    [31m@hash[39;49;00m.eql?(o.instance_eval{[31m@hash[39;49;00m})$
   462^I  [34mend[39;49;00m$
   463^I$
   464^I  [37m# Classifies the set by the return value of the given block and[39;49;00m$
   465^I  [37m# returns a hash of {value => set of elements} pairs.  The block is[39;49;00m$
   466^I  [37m# called once for each element of the set, passing the element as[39;49;00m$
   467^I  [37m# parameter.[39;49;00m$
   468^I  [37m#[39;49;00m$
   469^I  [37m# e.g.:[39;49;00m$
   470^I  [37m#[39;49;00m$
   471^I  [37m#   require 'set'[39;49;00m$
   472^I  [37m#   files = Set.new(Dir.glob("*.rb"))[39;49;00m$
   473^I  [37m#   hash = files.classify { |f| File.mtime(f).year }[39;49;00m$
   474^I  [37m#   p hash    # => {2000=>#<Set: {"a.rb", "b.rb"}>,[39;49;00m$
   475^I  [37m#             #     2001=>#<Set: {"c.rb", "d.rb", "e.rb"}>,[39;49;00m$
   476^I  [37m#             #     2002=>#<Set: {"f.rb"}>}[39;49;00m$
   477^I  [34mdef[39;49;00m [32mclassify[39;49;00m [37m# :yields: o[39;49;00m$
   478^I    h = {}$
   479^I$
   480^I    each { |i|$
   481^I      x = [34myield[39;49;00m(i)$
   482^I      (h[x] ||= [36mself[39;49;00m.class.new).add(i)$
   483^I    }$
   484^I$
   485^I    h$
   486^I  [34mend[39;49;00m$
   487^I$
   488^I  [37m# Divides the set into a set of subsets according to the commonality[39;49;00m$
   489^I  [37m# defined by the given block.[39;49;00m$
   490^I  [37m#[39;49;00m$
   491^I  [37m# If the arity of the block is 2, elements o1 and o2 are in common[39;49;00m$
   492^I  [37m# if block.call(o1, o2) is true.  Otherwise, elements o1 and o2 are[39;49;00m$
   493^I  [37m# in common if block.call(o1) == block.call(o2).[39;49;00m$
   494^I  [37m#[39;49;00m$
   495^I  [37m# e.g.:[39;49;00m$
   496^I  [37m#[39;49;00m$
   497^I  [37m#   require 'set'[39;49;00m$
   498^I  [37m#   numbers = Set[1, 3, 4, 6, 9, 10, 11][39;49;00m$
   499^I  [37m#   set = numbers.divide { |i,j| (i - j).abs == 1 }[39;49;00m$
   500^I  [37m#   p set     # => #<Set: {#<Set: {1}>,[39;49;00m$
   501^I  [37m#             #            #<Set: {11, 9, 10}>,[39;49;00m$
   502^I  [37m#             #            #<Set: {3, 4}>,[39;49;00m$
   503^I  [37m#             #            #<Set: {6}>}>[39;49;00m$
   504^I  [34mdef[39;49;00m [32mdivide[39;49;00m(&func)$
   505^I    [34mif[39;49;00m func.arity == [34m2[39;49;00m$
   506^I      [36mrequire[39;49;00m [33m'[39;49;00m[33mtsort[39;49;00m[33m'[39;49;00m$
   507^I$
   508^I      [34mclass[39;49;00m << dig = {}^I^I[37m# :nodoc:[39;49;00m$
   509^I^I[34minclude[39;49;00m [31mTSort[39;49;00m$
   510^I$
   511^I^I[34malias[39;49;00m tsort_each_node each_key$
   512^I^I[34mdef[39;49;00m [32mtsort_each_child[39;49;00m(node, &block)$
   513^I^I  fetch(node).each(&block)$
   514^I^I[34mend[39;49;00m$
   515^I      [34mend[39;49;00m$
   516^I$
   517^I      each { |u|$
   518^I^Idig[u] = a = []$
   519^I^Ieach{ |v| func.call(u, v) [35mand[39;49;00m a << v }$
   520^I      }$
   521^I$
   522^I      set = [31mSet[39;49;00m.new()$
   523^I      dig.each_strongly_connected_component { |css|$
   524^I^Iset.add([36mself[39;49;00m.class.new(css))$
   525^I      }$
   526^I      set$
   527^I    [34melse[39;49;00m$
   528^I      [31mSet[39;49;00m.new(classify(&func).values)$
   529^I    [34mend[39;49;00m$
   530^I  [34mend[39;49;00m$
   531^I$
   532^I  [31mInspectKey[39;49;00m = [33m:__inspect_key__[39;49;00m         [37m# :nodoc:[39;49;00m$
   533^I$
   534^I  [37m# Returns a string containing a human-readable representation of the[39;49;00m$
   535^I  [37m# set. ("#<Set: {element1, element2, ...}>")[39;49;00m$
   536^I  [34mdef[39;49;00m [32minspect[39;49;00m$
   537^I    ids = ([31mThread[39;49;00m.current[[31mInspectKey[39;49;00m] ||= [])$
   538^I$
   539^I    [34mif[39;49;00m ids.include?([36mobject_id[39;49;00m)$
   540^I      [34mreturn[39;49;00m [36msprintf[39;49;00m([33m'[39;49;00m[33m#[39;49;00m[33m<%s: {...}>[39;49;00m[33m'[39;49;00m, [36mself[39;49;00m.class.name)$
   541^I    [34mend[39;49;00m$
   542^I$
   543^I    [34mbegin[39;49;00m$
   544^I      ids << [36mobject_id[39;49;00m$
   545^I      [34mreturn[39;49;00m [36msprintf[39;49;00m([33m'[39;49;00m[33m#[39;49;00m[33m<%s: {%s}>[39;49;00m[33m'[39;49;00m, [36mself[39;49;00m.class, [36mto_a[39;49;00m.inspect[[34m1[39;49;00m..-[34m2[39;49;00m])$
   546^I    [34mensure[39;49;00m$
   547^I      ids.pop$
   548^I    [34mend[39;49;00m$
   549^I  [34mend[39;49;00m$
   550^I$
   551^I  [34mdef[39;49;00m [32mpretty_print[39;49;00m(pp)^I[37m# :nodoc:[39;49;00m$
   552^I    pp.text [36msprintf[39;49;00m([33m'[39;49;00m[33m#[39;49;00m[33m<%s: {[39;49;00m[33m'[39;49;00m, [36mself[39;49;00m.class.name)$
   553^I    pp.nest([34m1[39;49;00m) {$
   554^I      pp.seplist([36mself[39;49;00m) { |o|$
   555^I^Ipp.pp o$
   556^I      }$
   557^I    }$
   558^I    pp.text [33m"[39;49;00m[33m}>[39;49;00m[33m"[39;49;00m$
   559^I  [34mend[39;49;00m$
   560^I$
   561^I  [34mdef[39;49;00m [32mpretty_print_cycle[39;49;00m(pp)^I[37m# :nodoc:[39;49;00m$
   562^I    pp.text [36msprintf[39;49;00m([33m'[39;49;00m[33m#[39;49;00m[33m<%s: {%s}>[39;49;00m[33m'[39;49;00m, [36mself[39;49;00m.class.name, empty? ? [33m'[39;49;00m[33m'[39;49;00m : [33m'[39;49;00m[33m...[39;49;00m[33m'[39;49;00m)$
   563^I  [34mend[39;49;00m$
   564^I[34mend[39;49;00m$
   565^I$
   566^I[37m# SortedSet implements a set which elements are sorted in order.  See Set.[39;49;00m$
   567^I[34mclass[39;49;00m [04m[32mSortedSet[39;49;00m < [31mSet[39;49;00m$
   568^I  [31m@@setup[39;49;00m = [34mfalse[39;49;00m$
   569^I$
   570^I  [34mclass[39;49;00m << [36mself[39;49;00m$
   571^I    [34mdef[39;49;00m [32m[][39;49;00m(*ary)^I[37m# :nodoc:[39;49;00m$
   572^I      [34mnew[39;49;00m(ary)$
   573^I    [34mend[39;49;00m$
   574^I$
   575^I    [34mdef[39;49;00m [32msetup[39;49;00m^I[37m# :nodoc:[39;49;00m$
   576^I      [31m@@setup[39;49;00m [35mand[39;49;00m [34mreturn[39;49;00m$
   577^I$
   578^I      [34mbegin[39;49;00m$
   579^I^I[36mrequire[39;49;00m [33m'[39;49;00m[33mrbtree[39;49;00m[33m'[39;49;00m$
   580^I$
   581^I^I[36mmodule_eval[39;49;00m [33m%{[39;49;00m[33m[39;49;00m$
   582^I[33m^I  def initialize(*args, &block)[39;49;00m$
   583^I[33m^I    @hash = RBTree.new[39;49;00m$
   584^I[33m^I    super[39;49;00m$
   585^I[33m^I  end[39;49;00m$
   586^I[33m^I[39;49;00m[33m}[39;49;00m$
   587^I      [34mrescue[39;49;00m [31mLoadError[39;49;00m$
   588^I^I[36mmodule_eval[39;49;00m [33m%{[39;49;00m[33m[39;49;00m$
   589^I[33m^I  def initialize(*args, &block)[39;49;00m$
   590^I[33m^I    @keys = nil[39;49;00m$
   591^I[33m^I    super[39;49;00m$
   592^I[33m^I  end[39;49;00m$
   593^I[33m[39;49;00m$
   594^I[33m^I  def clear[39;49;00m$
   595^I[33m^I    @keys = nil[39;49;00m$
   596^I[33m^I    super[39;49;00m$
   597^I[33m^I  end[39;49;00m$
   598^I[33m[39;49;00m$
   599^I[33m^I  def replace(enum)[39;49;00m$
   600^I[33m^I    @keys = nil[39;49;00m$
   601^I[33m^I    super[39;49;00m$
   602^I[33m^I  end[39;49;00m$
   603^I[33m[39;49;00m$
   604^I[33m^I  def add(o)[39;49;00m$
   605^I[33m^I    @keys = nil[39;49;00m$
   606^I[33m^I    @hash[o] = true[39;49;00m$
   607^I[33m^I    self[39;49;00m$
   608^I[33m^I  end[39;49;00m$
   609^I[33m^I  alias << add[39;49;00m$
   610^I[33m[39;49;00m$
   611^I[33m^I  def delete(o)[39;49;00m$
   612^I[33m^I    @keys = nil[39;49;00m$
   613^I[33m^I    @hash.delete(o)[39;49;00m$
   614^I[33m^I    self[39;49;00m$
   615^I[33m^I  end[39;49;00m$
   616^I[33m[39;49;00m$
   617^I[33m^I  def delete_if[39;49;00m$
   618^I[33m^I    n = @hash.size[39;49;00m$
   619^I[33m^I    @hash.delete_if [39;49;00m[33m{[39;49;00m[33m |o,| yield(o) [39;49;00m[33m}[39;49;00m[33m[39;49;00m$
   620^I[33m^I    @keys = nil if @hash.size != n[39;49;00m$
   621^I[33m^I    self[39;49;00m$
   622^I[33m^I  end[39;49;00m$
   623^I[33m[39;49;00m$
   624^I[33m^I  def merge(enum)[39;49;00m$
   625^I[33m^I    @keys = nil[39;49;00m$
   626^I[33m^I    super[39;49;00m$
   627^I[33m^I  end[39;49;00m$
   628^I[33m[39;49;00m$
   629^I[33m^I  def each[39;49;00m$
   630^I[33m^I    to_a.each [39;49;00m[33m{[39;49;00m[33m |o| yield(o) [39;49;00m[33m}[39;49;00m[33m[39;49;00m$
   631^I[33m^I  end[39;49;00m$
   632^I[33m[39;49;00m$
   633^I[33m^I  def to_a[39;49;00m$
   634^I[33m^I    (@keys = @hash.keys).sort! unless @keys[39;49;00m$
   635^I[33m^I    @keys[39;49;00m$
   636^I[33m^I  end[39;49;00m$
   637^I[33m^I[39;49;00m[33m}[39;49;00m$
   638^I      [34mend[39;49;00m$
   639^I$
   640^I      [31m@@setup[39;49;00m = [34mtrue[39;49;00m$
   641^I    [34mend[39;49;00m$
   642^I  [34mend[39;49;00m$
   643^I$
   644^I  [34mdef[39;49;00m [32minitialize[39;49;00m(*args, &block)^I[37m# :nodoc:[39;49;00m$
   645^I    [31mSortedSet[39;49;00m.setup$
   646^I    [34minitialize[39;49;00m(*args, &block)$
   647^I  [34mend[39;49;00m$
   648^I[34mend[39;49;00m$
   649^I$
   650^I[34mmodule[39;49;00m [04m[36mEnumerable[39;49;00m$
   651^I  [37m# Makes a set from the enumerable object with given arguments.[39;49;00m$
   652^I  [34mdef[39;49;00m [32mto_set[39;49;00m(klass = [31mSet[39;49;00m, *args, &block)$
   653^I    klass.new([36mself[39;49;00m, *args, &block)$
   654^I  [34mend[39;49;00m$
   655^I[34mend[39;49;00m$
   656^I$
   657^I[37m# =begin[39;49;00m$
   658^I[37m# == RestricedSet class[39;49;00m$
   659^I[37m# RestricedSet implements a set with restrictions defined by a given[39;49;00m$
   660^I[37m# block.[39;49;00m$
   661^I[37m#[39;49;00m$
   662^I[37m# === Super class[39;49;00m$
   663^I[37m#     Set[39;49;00m$
   664^I[37m#[39;49;00m$
   665^I[37m# === Class Methods[39;49;00m$
   666^I[37m# --- RestricedSet::new(enum = nil) { |o| ... }[39;49;00m$
   667^I[37m# --- RestricedSet::new(enum = nil) { |rset, o| ... }[39;49;00m$
   668^I[37m#     Creates a new restricted set containing the elements of the given[39;49;00m$
   669^I[37m#     enumerable object.  Restrictions are defined by the given block.[39;49;00m$
   670^I[37m#[39;49;00m$
   671^I[37m#     If the block's arity is 2, it is called with the RestrictedSet[39;49;00m$
   672^I[37m#     itself and an object to see if the object is allowed to be put in[39;49;00m$
   673^I[37m#     the set.[39;49;00m$
   674^I[37m#[39;49;00m$
   675^I[37m#     Otherwise, the block is called with an object to see if the object[39;49;00m$
   676^I[37m#     is allowed to be put in the set.[39;49;00m$
   677^I[37m#[39;49;00m$
   678^I[37m# === Instance Methods[39;49;00m$
   679^I[37m# --- restriction_proc[39;49;00m$
   680^I[37m#     Returns the restriction procedure of the set.[39;49;00m$
   681^I[37m#[39;49;00m$
   682^I[37m# =end[39;49;00m$
   683^I[37m#[39;49;00m$
   684^I[37m# class RestricedSet < Set[39;49;00m$
   685^I[37m#   def initialize(*args, &block)[39;49;00m$
   686^I[37m#     @proc = block or raise ArgumentError, "missing a block"[39;49;00m$
   687^I[37m#[39;49;00m$
   688^I[37m#     if @proc.arity == 2[39;49;00m$
   689^I[37m#       instance_eval %{[39;49;00m$
   690^I[37m# ^Idef add(o)[39;49;00m$
   691^I[37m# ^I  @hash[o] = true if @proc.call(self, o)[39;49;00m$
   692^I[37m# ^I  self[39;49;00m$
   693^I[37m# ^Iend[39;49;00m$
   694^I[37m# ^Ialias << add[39;49;00m$
   695^I[37m#[39;49;00m$
   696^I[37m# ^Idef add?(o)[39;49;00m$
   697^I[37m# ^I  if include?(o) || !@proc.call(self, o)[39;49;00m$
   698^I[37m# ^I    nil[39;49;00m$
   699^I[37m# ^I  else[39;49;00m$
   700^I[37m# ^I    @hash[o] = true[39;49;00m$
   701^I[37m# ^I    self[39;49;00m$
   702^I[37m# ^I  end[39;49;00m$
   703^I[37m# ^Iend[39;49;00m$
   704^I[37m#[39;49;00m$
   705^I[37m# ^Idef replace(enum)[39;49;00m$
   706^I[37m# ^I  enum.is_a?(Enumerable) or raise ArgumentError, "value must be enumerable"[39;49;00m$
   707^I[37m# ^I  clear[39;49;00m$
   708^I[37m# ^I  enum.each { |o| add(o) }[39;49;00m$
   709^I[37m#[39;49;00m$
   710^I[37m# ^I  self[39;49;00m$
   711^I[37m# ^Iend[39;49;00m$
   712^I[37m#[39;49;00m$
   713^I[37m# ^Idef merge(enum)[39;49;00m$
   714^I[37m# ^I  enum.is_a?(Enumerable) or raise ArgumentError, "value must be enumerable"[39;49;00m$
   715^I[37m# ^I  enum.each { |o| add(o) }[39;49;00m$
   716^I[37m#[39;49;00m$
   717^I[37m# ^I  self[39;49;00m$
   718^I[37m# ^Iend[39;49;00m$
   719^I[37m#       }[39;49;00m$
   720^I[37m#     else[39;49;00m$
   721^I[37m#       instance_eval %{[39;49;00m$
   722^I[37m# ^Idef add(o)[39;49;00m$
   723^I[37m#         if @proc.call(o)[39;49;00m$
   724^I[37m# ^I    @hash[o] = true[39;49;00m$
   725^I[37m#         end[39;49;00m$
   726^I[37m# ^I  self[39;49;00m$
   727^I[37m# ^Iend[39;49;00m$
   728^I[37m# ^Ialias << add[39;49;00m$
   729^I[37m#[39;49;00m$
   730^I[37m# ^Idef add?(o)[39;49;00m$
   731^I[37m# ^I  if include?(o) || !@proc.call(o)[39;49;00m$
   732^I[37m# ^I    nil[39;49;00m$
   733^I[37m# ^I  else[39;49;00m$
   734^I[37m# ^I    @hash[o] = true[39;49;00m$
   735^I[37m# ^I    self[39;49;00m$
   736^I[37m# ^I  end[39;49;00m$
   737^I[37m# ^Iend[39;49;00m$
   738^I[37m#       }[39;49;00m$
   739^I[37m#     end[39;49;00m$
   740^I[37m#[39;49;00m$
   741^I[37m#     super(*args)[39;49;00m$
   742^I[37m#   end[39;49;00m$
   743^I[37m#[39;49;00m$
   744^I[37m#   def restriction_proc[39;49;00m$
   745^I[37m#     @proc[39;49;00m$
   746^I[37m#   end[39;49;00m$
   747^I[37m# end[39;49;00m$
   748^I$
   749^I[34mif[39;49;00m [31m$0[39;49;00m == [36m__FILE__[39;49;00m$
   750^I  [36meval[39;49;00m [31mDATA[39;49;00m.read, [34mnil[39;49;00m, [31m$0[39;49;00m, [36m__LINE__[39;49;00m+[34m4[39;49;00m$
   751^I[34mend[39;49;00m$
   752^I$
   753^I[37m# = rweb - CGI Support Library[39;49;00m$
   754^I[37m#[39;49;00m$
   755^I[37m# Author:: Johannes Barre (mailto:rweb@igels.net)[39;49;00m$
   756^I[37m# Copyright:: Copyright (c) 2003, 04 by Johannes Barre[39;49;00m$
   757^I[37m# License:: GNU Lesser General Public License (COPYING, http://www.gnu.org/copyleft/lesser.html)[39;49;00m$
   758^I[37m# Version:: 0.1.0[39;49;00m$
   759^I[37m# CVS-ID:: $Id: example.rb 39 2005-11-05 03:33:55Z murphy $[39;49;00m$
   760^I[37m#[39;49;00m$
   761^I[37m# == What is Rweb?[39;49;00m$
   762^I[37m# Rweb is a replacement for the cgi class included in the ruby distribution.[39;49;00m$
   763^I[37m#[39;49;00m$
   764^I[37m# == How to use[39;49;00m$
   765^I[37m#[39;49;00m$
   766^I[37m# === Basics[39;49;00m$
   767^I[37m#[39;49;00m$
   768^I[37m# This class is made to be as easy as possible to use. An example:[39;49;00m$
   769^I[37m#[39;49;00m$
   770^I[37m# ^Irequire "rweb"[39;49;00m$
   771^I[37m#[39;49;00m$
   772^I[37m# ^Iweb = Rweb.new[39;49;00m$
   773^I[37m# ^Iweb.out do[39;49;00m$
   774^I[37m# ^I^Iweb.puts "Hello world!"[39;49;00m$
   775^I[37m# ^Iend[39;49;00m$
   776^I[37m#[39;49;00m$
   777^I[37m# The visitor will get a simple "Hello World!" in his browser. Please notice,[39;49;00m$
   778^I[37m# that won't set html-tags for you, so you should better do something like this:[39;49;00m$
   779^I[37m#[39;49;00m$
   780^I[37m# ^Irequire "rweb"[39;49;00m$
   781^I[37m#[39;49;00m$
   782^I[37m# ^Iweb = Rweb.new[39;49;00m$
   783^I[37m# ^Iweb.out do[39;49;00m$
   784^I[37m# ^I^Iweb.puts "<html><body>Hello world!</body></html>"[39;49;00m$
   785^I[37m# ^Iend[39;49;00m$
   786^I[37m#[39;49;00m$
   787^I[37m# === Set headers[39;49;00m$
   788^I[37m# Of course, it's also possible to tell the browser, that the content of this[39;49;00m$
   789^I[37m# page is plain text instead of html code:[39;49;00m$
   790^I[37m#[39;49;00m$
   791^I[37m# ^Irequire "rweb"[39;49;00m$
   792^I[37m#[39;49;00m$
   793^I[37m# ^Iweb = Rweb.new[39;49;00m$
   794^I[37m# ^Iweb.out do[39;49;00m$
   795^I[37m# ^I^Iweb.header("content-type: text/plain")[39;49;00m$
   796^I[37m# ^I^Iweb.puts "Hello plain world!"[39;49;00m$
   797^I[37m# ^Iend[39;49;00m$
   798^I[37m#[39;49;00m$
   799^I[37m# Please remember, headers can't be set after the page content has been send.[39;49;00m$
   800^I[37m# You have to set all nessessary headers before the first puts oder print. It's[39;49;00m$
   801^I[37m# possible to cache the content until everything is complete. Doing it this[39;49;00m$
   802^I[37m# way, you can set headers everywhere.[39;49;00m$
   803^I[37m#[39;49;00m$
   804^I[37m# If you set a header twice, the second header will replace the first one. The[39;49;00m$
   805^I[37m# header name is not casesensitive, it will allways converted in to the[39;49;00m$
   806^I[37m# capitalised form suggested by the w3c (http://w3.org)[39;49;00m$
   807^I[37m#[39;49;00m$
   808^I[37m# === Set cookies[39;49;00m$
   809^I[37m# Setting cookies is quite easy:[39;49;00m$
   810^I[37m# ^Iinclude 'rweb'[39;49;00m$
   811^I[37m#[39;49;00m$
   812^I[37m# ^Iweb = Rweb.new[39;49;00m$
   813^I[37m# ^ICookie.new("Visits", web.cookies['visits'].to_i +1)[39;49;00m$
   814^I[37m# ^Iweb.out do[39;49;00m$
   815^I[37m# ^I^Iweb.puts "Welcome back! You visited this page #{web.cookies['visits'].to_i +1} times"[39;49;00m$
   816^I[37m# ^Iend[39;49;00m$
   817^I[37m#[39;49;00m$
   818^I[37m# See the class Cookie for more details.[39;49;00m$
   819^I[37m#[39;49;00m$
   820^I[37m# === Get form and cookie values[39;49;00m$
   821^I[37m# There are four ways to submit data from the browser to the server and your[39;49;00m$
   822^I[37m# ruby script: via GET, POST, cookies and file upload. Rweb doesn't support[39;49;00m$
   823^I[37m# file upload by now.[39;49;00m$
   824^I[37m#[39;49;00m$
   825^I[37m# ^Iinclude 'rweb'[39;49;00m$
   826^I[37m#[39;49;00m$
   827^I[37m# ^Iweb = Rweb.new[39;49;00m$
   828^I[37m# ^Iweb.out do[39;49;00m$
   829^I[37m# ^I^Iweb.print "action: #{web.get['action']} "[39;49;00m$
   830^I[37m# ^I^Iweb.puts "The value of the cookie 'visits' is #{web.cookies['visits']}"[39;49;00m$
   831^I[37m# ^I^Iweb.puts "The post parameter 'test['x']' is #{web.post['test']['x']}"[39;49;00m$
   832^I[37m# ^Iend[39;49;00m$
   833^I$
   834^I[31mRWEB_VERSION[39;49;00m = [33m"[39;49;00m[33m0.1.0[39;49;00m[33m"[39;49;00m$
   835^I[31mRWEB[39;49;00m = [33m"[39;49;00m[33mrweb/[39;49;00m[33m#{[39;49;00m[31mRWEB_VERSION[39;49;00m[33m}[39;49;00m[33m"[39;49;00m$
   836^I$
   837^I[37m#require 'rwebcookie' -> edit by bunny :-)[39;49;00m$
   838^I$
   839^I[34mclass[39;49;00m [04m[32mRweb[39;49;00m$
   840^I    [37m# All parameter submitted via the GET method are available in attribute[39;49;00m$
   841^I^I^I[37m# get. This is Hash, where every parameter is available as a key-value[39;49;00m$
   842^I^I^I[37m# pair.[39;49;00m$
   843^I^I^I[37m#[39;49;00m$
   844^I^I^I[37m# If your input tag has a name like this one, it's value will be available[39;49;00m$
   845^I^I^I[37m# as web.get["fieldname"][39;49;00m$
   846^I^I^I[37m#  <input name="fieldname">[39;49;00m$
   847^I^I^I[37m# You can submit values as a Hash[39;49;00m$
   848^I^I^I[37m#  <input name="text['index']">[39;49;00m$
   849^I^I^I[37m#  <input name="text['index2']">[39;49;00m$
   850^I^I^I[37m# will be available as[39;49;00m$
   851^I^I^I[37m#  web.get["text"]["index"][39;49;00m$
   852^I^I^I[37m#  web.get["text"]["index2"][39;49;00m$
   853^I^I^I[37m# Integers are also possible[39;49;00m$
   854^I^I^I[37m#  <input name="int[2]">[39;49;00m$
   855^I^I^I[37m#  <input name="int[3]['hi']>[39;49;00m$
   856^I^I^I[37m# will be available as[39;49;00m$
   857^I^I^I[37m#  web.get["int"][2][39;49;00m$
   858^I^I^I[37m#  web.get["int"][3]["hi"][39;49;00m$
   859^I^I^I[37m# If you specify no index, the lowest unused index will be used:[39;49;00m$
   860^I^I^I[37m#  <input name="int[]"><!-- First Field -->[39;49;00m$
   861^I^I^I[37m#  <input name="int[]"><!-- Second one -->[39;49;00m$
   862^I^I^I[37m# will be available as[39;49;00m$
   863^I^I^I[37m#  web.get["int"][0] # First Field[39;49;00m$
   864^I^I^I[37m#  web.get["int"][1] # Second one[39;49;00m$
   865^I^I^I[37m# Please notice, this doesn'd work like you might expect:[39;49;00m$
   866^I^I^I[37m#  <input name="text[index]">[39;49;00m$
   867^I^I^I[37m# It will not be available as web.get["text"]["index"] but[39;49;00m$
   868^I^I^I[37m#  web.get["text[index]"][39;49;00m$
   869^I    [34mattr_reader[39;49;00m [33m:get[39;49;00m$
   870^I$
   871^I    [37m# All parameters submitted via POST are available in the attribute post. It[39;49;00m$
   872^I^I^I[37m# works like the get attribute.[39;49;00m$
   873^I^I^I[37m#  <input name="text[0]">[39;49;00m$
   874^I^I^I[37m# will be available as[39;49;00m$
   875^I^I^I[37m#  web.post["text"][0][39;49;00m$
   876^I^I^I[34mattr_reader[39;49;00m [33m:post[39;49;00m$
   877^I$
   878^I    [37m# All cookies submitted by the browser are available in cookies. This is a[39;49;00m$
   879^I^I^I[37m# Hash, where every cookie is a key-value pair.[39;49;00m$
   880^I^I^I[34mattr_reader[39;49;00m [33m:cookies[39;49;00m$
   881^I$
   882^I    [37m# The name of the browser identification is submitted as USER_AGENT and[39;49;00m$
   883^I^I^I[37m# available in this attribute.[39;49;00m$
   884^I^I^I[34mattr_reader[39;49;00m [33m:user_agent[39;49;00m$
   885^I$
   886^I    [37m# The IP address of the client.[39;49;00m$
   887^I^I^I[34mattr_reader[39;49;00m [33m:remote_addr[39;49;00m$
   888^I$
   889^I    [37m# Creates a new Rweb object. This should only done once. You can set various[39;49;00m$
   890^I    [37m# options via the settings hash.[39;49;00m$
   891^I    [37m#[39;49;00m$
   892^I    [37m# "cache" => true: Everything you script send to the client will be cached[39;49;00m$
   893^I    [37m# until the end of the out block or until flush is called. This way, you[39;49;00m$
   894^I    [37m# can modify headers and cookies even after printing something to the client.[39;49;00m$
   895^I    [37m#[39;49;00m$
   896^I    [37m# "safe" => level: Changes the $SAFE attribute. By default, $SAFE will be set[39;49;00m$
   897^I    [37m# to 1. If $SAFE is already higher than this value, it won't be changed.[39;49;00m$
   898^I    [37m#[39;49;00m$
   899^I    [37m# "silend" => true: Normaly, Rweb adds automaticly a header like this[39;49;00m$
   900^I    [37m# "X-Powered-By: Rweb/x.x.x (Ruby/y.y.y)". With the silend option you can[39;49;00m$
   901^I    [37m# suppress this.[39;49;00m$
   902^I    [34mdef[39;49;00m [32minitialize[39;49;00m (settings = {})$
   903^I        [37m# {{{[39;49;00m$
   904^I        [31m@header[39;49;00m = {}$
   905^I        [31m@cookies[39;49;00m = {}$
   906^I        [31m@get[39;49;00m = {}$
   907^I        [31m@post[39;49;00m = {}$
   908^I$
   909^I        [37m# Internal attributes[39;49;00m$
   910^I        [31m@status[39;49;00m = [34mnil[39;49;00m$
   911^I        [31m@reasonPhrase[39;49;00m = [34mnil[39;49;00m$
   912^I        [31m@setcookies[39;49;00m = []$
   913^I        [31m@output_started[39;49;00m = [34mfalse[39;49;00m;$
   914^I        [31m@output_allowed[39;49;00m = [34mfalse[39;49;00m;$
   915^I$
   916^I        [31m@mod_ruby[39;49;00m = [34mfalse[39;49;00m$
   917^I        [31m@env[39;49;00m = [31mENV[39;49;00m.to_hash$
   918^I$
   919^I        [34mif[39;49;00m defined?([31mMOD_RUBY[39;49;00m)$
   920^I            [31m@output_method[39;49;00m = [33m"[39;49;00m[33mmod_ruby[39;49;00m[33m"[39;49;00m$
   921^I            [31m@mod_ruby[39;49;00m = [34mtrue[39;49;00m$
   922^I        [34melsif[39;49;00m [31m@env[39;49;00m[[33m'[39;49;00m[33mSERVER_SOFTWARE[39;49;00m[33m'[39;49;00m] =~ [33m/[39;49;00m[33m^Microsoft-IIS[39;49;00m[33m/i[39;49;00m$
   923^I            [31m@output_method[39;49;00m = [33m"[39;49;00m[33mnph[39;49;00m[33m"[39;49;00m$
   924^I        [34melse[39;49;00m$
   925^I            [31m@output_method[39;49;00m = [33m"[39;49;00m[33mph[39;49;00m[33m"[39;49;00m$
   926^I        [34mend[39;49;00m$
   927^I$
   928^I        [34munless[39;49;00m settings.is_a?([31mHash[39;49;00m)$
   929^I            [34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33msettings must be a Hash[39;49;00m[33m"[39;49;00m$
   930^I        [34mend[39;49;00m$
   931^I        [31m@settings[39;49;00m = settings$
   932^I$
   933^I        [34munless[39;49;00m [31m@settings[39;49;00m.has_key?([33m"[39;49;00m[33msafe[39;49;00m[33m"[39;49;00m)$
   934^I            [31m@settings[39;49;00m[[33m"[39;49;00m[33msafe[39;49;00m[33m"[39;49;00m] = [34m1[39;49;00m$
   935^I        [34mend[39;49;00m$
   936^I$
   937^I        [34mif[39;49;00m [31m$SAFE[39;49;00m < [31m@settings[39;49;00m[[33m"[39;49;00m[33msafe[39;49;00m[33m"[39;49;00m]$
   938^I            [31m$SAFE[39;49;00m = [31m@settings[39;49;00m[[33m"[39;49;00m[33msafe[39;49;00m[33m"[39;49;00m]$
   939^I        [34mend[39;49;00m$
   940^I$
   941^I        [34munless[39;49;00m [31m@settings[39;49;00m.has_key?([33m"[39;49;00m[33mcache[39;49;00m[33m"[39;49;00m)$
   942^I            [31m@settings[39;49;00m[[33m"[39;49;00m[33mcache[39;49;00m[33m"[39;49;00m] = [34mfalse[39;49;00m$
   943^I        [34mend[39;49;00m$
   944^I$
   945^I        [37m# mod_ruby sets no QUERY_STRING variable, if no GET-Parameters are given[39;49;00m$
   946^I        [34munless[39;49;00m [31m@env[39;49;00m.has_key?([33m"[39;49;00m[33mQUERY_STRING[39;49;00m[33m"[39;49;00m)$
   947^I            [31m@env[39;49;00m[[33m"[39;49;00m[33mQUERY_STRING[39;49;00m[33m"[39;49;00m] = [33m"[39;49;00m[33m"[39;49;00m$
   948^I        [34mend[39;49;00m$
   949^I$
   950^I        [37m# Now we split the QUERY_STRING by the seperators & and ; or, if[39;49;00m$
   951^I        [37m# specified, settings['get seperator'][39;49;00m$
   952^I        [34munless[39;49;00m [31m@settings[39;49;00m.has_key?([33m"[39;49;00m[33mget seperator[39;49;00m[33m"[39;49;00m)$
   953^I            get_args = [31m@env[39;49;00m[[33m'[39;49;00m[33mQUERY_STRING[39;49;00m[33m'[39;49;00m].split([33m/[39;49;00m[33m[&;][39;49;00m[33m/[39;49;00m)$
   954^I        [34melse[39;49;00m$
   955^I            get_args = [31m@env[39;49;00m[[33m'[39;49;00m[33mQUERY_STRING[39;49;00m[33m'[39;49;00m].split([31m@settings[39;49;00m[[33m'[39;49;00m[33mget seperator[39;49;00m[33m'[39;49;00m])$
   956^I        [34mend[39;49;00m$
   957^I$
   958^I        get_args.each [34mdo[39;49;00m | arg |$
   959^I            arg_key, arg_val = arg.split([33m/[39;49;00m[33m=[39;49;00m[33m/[39;49;00m, [34m2[39;49;00m)$
   960^I            arg_key = [31mRweb[39;49;00m::unescape(arg_key)$
   961^I            arg_val = [31mRweb[39;49;00m::unescape(arg_val)$
   962^I$
   963^I            [37m# Parse names like name[0], name['text'] or name[][39;49;00m$
   964^I            pattern = [33m/[39;49;00m[33m^(.+)[39;49;00m[33m\[39;49;00m[33m[("[^[39;49;00m[33m\[39;49;00m[33m]]*"|'[^[39;49;00m[33m\[39;49;00m[33m]]*'|[0-9]*)[39;49;00m[33m\[39;49;00m[33m]$[39;49;00m[33m/[39;49;00m$
   965^I            keys = []$
   966^I            [34mwhile[39;49;00m match = pattern.match(arg_key)$
   967^I                arg_key = match[[34m1[39;49;00m]$
   968^I                keys = [match[[34m2[39;49;00m]] + keys$
   969^I            [34mend[39;49;00m$
   970^I            keys = [arg_key] + keys$
   971^I$
   972^I            akt = [31m@get[39;49;00m$
   973^I            last = [34mnil[39;49;00m$
   974^I            lastkey = [34mnil[39;49;00m$
   975^I            keys.each [34mdo[39;49;00m |key|$
   976^I                [34mif[39;49;00m key == [33m"[39;49;00m[33m"[39;49;00m$
   977^I                    [37m# No key specified (like in "test[]"), so we use the[39;49;00m$
   978^I                    [37m# lowerst unused Integer as key[39;49;00m$
   979^I                    key = [34m0[39;49;00m$
   980^I                    [34mwhile[39;49;00m akt.has_key?(key)$
   981^I                        key += [34m1[39;49;00m$
   982^I                    [34mend[39;49;00m$
   983^I                [34melsif[39;49;00m [33m/[39;49;00m[33m^[0-9]*$[39;49;00m[33m/[39;49;00m =~ key$
   984^I                    [37m# If the index is numerical convert it to an Integer[39;49;00m$
   985^I                    key = key.to_i$
   986^I                [34melsif[39;49;00m key[[34m0[39;49;00m].chr == [33m"[39;49;00m[33m'[39;49;00m[33m"[39;49;00m || key[[34m0[39;49;00m].chr == [33m'[39;49;00m[33m"[39;49;00m[33m'[39;49;00m$
   987^I                    key = key[[34m1[39;49;00m, key.length() -[34m2[39;49;00m]$
   988^I                [34mend[39;49;00m$
   989^I                [34mif[39;49;00m !akt.has_key?(key) || !akt[key].class == [31mHash[39;49;00m$
   990^I                    [37m# create an empty Hash if there isn't already one[39;49;00m$
   991^I                    akt[key] = {}$
   992^I                [34mend[39;49;00m$
   993^I                last = akt$
   994^I                lastkey = key$
   995^I                akt = akt[key]$
   996^I            [34mend[39;49;00m$
   997^I            last[lastkey] = arg_val$
   998^I        [34mend[39;49;00m$
   999^I$
  1000^I        [34mif[39;49;00m [31m@env[39;49;00m[[33m'[39;49;00m[33mREQUEST_METHOD[39;49;00m[33m'[39;49;00m] == [33m"[39;49;00m[33mPOST[39;49;00m[33m"[39;49;00m$
  1001^I            [34mif[39;49;00m [31m@env[39;49;00m.has_key?([33m"[39;49;00m[33mCONTENT_TYPE[39;49;00m[33m"[39;49;00m) && [31m@env[39;49;00m[[33m'[39;49;00m[33mCONTENT_TYPE[39;49;00m[33m'[39;49;00m] == [33m"[39;49;00m[33mapplication/x-www-form-urlencoded[39;49;00m[33m"[39;49;00m && [31m@env[39;49;00m.has_key?([33m'[39;49;00m[33mCONTENT_LENGTH[39;49;00m[33m'[39;49;00m)$
  1002^I                [34munless[39;49;00m [31m@settings[39;49;00m.has_key?([33m"[39;49;00m[33mpost seperator[39;49;00m[33m"[39;49;00m)$
  1003^I                    post_args = [31m$stdin[39;49;00m.read([31m@env[39;49;00m[[33m'[39;49;00m[33mCONTENT_LENGTH[39;49;00m[33m'[39;49;00m].to_i).split([33m/[39;49;00m[33m[&;][39;49;00m[33m/[39;49;00m)$
  1004^I                [34melse[39;49;00m$
  1005^I                    post_args = [31m$stdin[39;49;00m.read([31m@env[39;49;00m[[33m'[39;49;00m[33mCONTENT_LENGTH[39;49;00m[33m'[39;49;00m].to_i).split([31m@settings[39;49;00m[[33m'[39;49;00m[33mpost seperator[39;49;00m[33m'[39;49;00m])$
  1006^I                [34mend[39;49;00m$
  1007^I                post_args.each [34mdo[39;49;00m | arg |$
  1008^I                    arg_key, arg_val = arg.split([33m/[39;49;00m[33m=[39;49;00m[33m/[39;49;00m, [34m2[39;49;00m)$
  1009^I                    arg_key = [31mRweb[39;49;00m::unescape(arg_key)$
  1010^I                    arg_val = [31mRweb[39;49;00m::unescape(arg_val)$
  1011^I$
  1012^I                    [37m# Parse names like name[0], name['text'] or name[][39;49;00m$
  1013^I                    pattern = [33m/[39;49;00m[33m^(.+)[39;49;00m[33m\[39;49;00m[33m[("[^[39;49;00m[33m\[39;49;00m[33m]]*"|'[^[39;49;00m[33m\[39;49;00m[33m]]*'|[0-9]*)[39;49;00m[33m\[39;49;00m[33m]$[39;49;00m[33m/[39;49;00m$
  1014^I                    keys = []$
  1015^I                    [34mwhile[39;49;00m match = pattern.match(arg_key)$
  1016^I                        arg_key = match[[34m1[39;49;00m]$
  1017^I                        keys = [match[[34m2[39;49;00m]] + keys$
  1018^I                    [34mend[39;49;00m$
  1019^I                    keys = [arg_key] + keys$
  1020^I$
  1021^I                    akt = [31m@post[39;49;00m$
  1022^I                    last = [34mnil[39;49;00m$
  1023^I                    lastkey = [34mnil[39;49;00m$
  1024^I                    keys.each [34mdo[39;49;00m |key|$
  1025^I                        [34mif[39;49;00m key == [33m"[39;49;00m[33m"[39;49;00m$
  1026^I                            [37m# No key specified (like in "test[]"), so we use[39;49;00m$
  1027^I                            [37m# the lowerst unused Integer as key[39;49;00m$
  1028^I                            key = [34m0[39;49;00m$
  1029^I                            [34mwhile[39;49;00m akt.has_key?(key)$
  1030^I                                key += [34m1[39;49;00m$
  1031^I                            [34mend[39;49;00m$
  1032^I                        [34melsif[39;49;00m [33m/[39;49;00m[33m^[0-9]*$[39;49;00m[33m/[39;49;00m =~ key$
  1033^I                            [37m# If the index is numerical convert it to an Integer[39;49;00m$
  1034^I                            key = key.to_i$
  1035^I                        [34melsif[39;49;00m key[[34m0[39;49;00m].chr == [33m"[39;49;00m[33m'[39;49;00m[33m"[39;49;00m || key[[34m0[39;49;00m].chr == [33m'[39;49;00m[33m"[39;49;00m[33m'[39;49;00m$
  1036^I                            key = key[[34m1[39;49;00m, key.length() -[34m2[39;49;00m]$
  1037^I                        [34mend[39;49;00m$
  1038^I                        [34mif[39;49;00m !akt.has_key?(key) || !akt[key].class == [31mHash[39;49;00m$
  1039^I                            [37m# create an empty Hash if there isn't already one[39;49;00m$
  1040^I                            akt[key] = {}$
  1041^I                        [34mend[39;49;00m$
  1042^I                        last = akt$
  1043^I                        lastkey = key$
  1044^I                        akt = akt[key]$
  1045^I                    [34mend[39;49;00m$
  1046^I                    last[lastkey] = arg_val$
  1047^I                [34mend[39;49;00m$
  1048^I            [34melse[39;49;00m$
  1049^I                [37m# Maybe we should print a warning here?[39;49;00m$
  1050^I                [31m$stderr[39;49;00m.print([33m"[39;49;00m[33mUnidentified form data recived and discarded.[39;49;00m[33m"[39;49;00m)$
  1051^I            [34mend[39;49;00m$
  1052^I        [34mend[39;49;00m$
  1053^I$
  1054^I        [34mif[39;49;00m [31m@env[39;49;00m.has_key?([33m"[39;49;00m[33mHTTP_COOKIE[39;49;00m[33m"[39;49;00m)$
  1055^I            cookie = [31m@env[39;49;00m[[33m'[39;49;00m[33mHTTP_COOKIE[39;49;00m[33m'[39;49;00m].split([33m/[39;49;00m[33m; ?[39;49;00m[33m/[39;49;00m)$
  1056^I            cookie.each [34mdo[39;49;00m | c |$
  1057^I                cookie_key, cookie_val = c.split([33m/[39;49;00m[33m=[39;49;00m[33m/[39;49;00m, [34m2[39;49;00m)$
  1058^I$
  1059^I                [31m@cookies[39;49;00m [[31mRweb[39;49;00m::unescape(cookie_key)] = [31mRweb[39;49;00m::unescape(cookie_val)$
  1060^I            [34mend[39;49;00m$
  1061^I        [34mend[39;49;00m$
  1062^I$
  1063^I        [34mif[39;49;00m defined?([31m@env[39;49;00m[[33m'[39;49;00m[33mHTTP_USER_AGENT[39;49;00m[33m'[39;49;00m])$
  1064^I            [31m@user_agent[39;49;00m = [31m@env[39;49;00m[[33m'[39;49;00m[33mHTTP_USER_AGENT[39;49;00m[33m'[39;49;00m]$
  1065^I        [34melse[39;49;00m$
  1066^I            [31m@user_agent[39;49;00m = [34mnil[39;49;00m;$
  1067^I        [34mend[39;49;00m$
  1068^I$
  1069^I        [34mif[39;49;00m defined?([31m@env[39;49;00m[[33m'[39;49;00m[33mREMOTE_ADDR[39;49;00m[33m'[39;49;00m])$
  1070^I            [31m@remote_addr[39;49;00m = [31m@env[39;49;00m[[33m'[39;49;00m[33mREMOTE_ADDR[39;49;00m[33m'[39;49;00m]$
  1071^I        [34melse[39;49;00m$
  1072^I            [31m@remote_addr[39;49;00m = [34mnil[39;49;00m$
  1073^I        [34mend[39;49;00m$
  1074^I        [37m# }}}[39;49;00m$
  1075^I    [34mend[39;49;00m$
  1076^I$
  1077^I    [37m# Prints a String to the client. If caching is enabled, the String will[39;49;00m$
  1078^I    [37m# buffered until the end of the out block ends.[39;49;00m$
  1079^I    [34mdef[39;49;00m [32mprint[39;49;00m(str = [33m"[39;49;00m[33m"[39;49;00m)$
  1080^I        [37m# {{{[39;49;00m$
  1081^I        [34munless[39;49;00m [31m@output_allowed[39;49;00m$
  1082^I            [34mraise[39;49;00m [33m"[39;49;00m[33mYou just can write to output inside of a Rweb::out-block[39;49;00m[33m"[39;49;00m$
  1083^I        [34mend[39;49;00m$
  1084^I$
  1085^I        [34mif[39;49;00m [31m@settings[39;49;00m[[33m"[39;49;00m[33mcache[39;49;00m[33m"[39;49;00m]$
  1086^I            [31m@buffer[39;49;00m += [str.to_s]$
  1087^I        [34melse[39;49;00m$
  1088^I            [34munless[39;49;00m [31m@output_started[39;49;00m$
  1089^I                sendHeaders$
  1090^I            [34mend[39;49;00m$
  1091^I            [31m$stdout[39;49;00m.print(str)$
  1092^I        [34mend[39;49;00m$
  1093^I        [34mnil[39;49;00m$
  1094^I        [37m# }}}[39;49;00m$
  1095^I    [34mend[39;49;00m$
  1096^I$
  1097^I    [37m# Prints a String to the client and adds a line break at the end. Please[39;49;00m$
  1098^I^I^I[37m# remember, that a line break is not visible in HTML, use the <br> HTML-Tag[39;49;00m$
  1099^I^I^I[37m# for this. If caching is enabled, the String will buffered until the end[39;49;00m$
  1100^I^I^I[37m# of the out block ends.[39;49;00m$
  1101^I    [34mdef[39;49;00m [32mputs[39;49;00m(str = [33m"[39;49;00m[33m"[39;49;00m)$
  1102^I        [37m# {{{[39;49;00m$
  1103^I        [36mself[39;49;00m.print(str + [33m"[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m)$
  1104^I        [37m# }}}[39;49;00m$
  1105^I    [34mend[39;49;00m$
  1106^I$
  1107^I^I^I[37m# Alias to print.[39;49;00m$
  1108^I    [34mdef[39;49;00m [32mwrite[39;49;00m(str = [33m"[39;49;00m[33m"[39;49;00m)$
  1109^I        [37m# {{{[39;49;00m$
  1110^I        [36mself[39;49;00m.print(str)$
  1111^I        [37m# }}}[39;49;00m$
  1112^I    [34mend[39;49;00m$
  1113^I$
  1114^I    [37m# If caching is enabled, all cached data are send to the cliend and the[39;49;00m$
  1115^I^I^I[37m# cache emptied.[39;49;00m$
  1116^I    [34mdef[39;49;00m [32mflush[39;49;00m$
  1117^I        [37m# {{{[39;49;00m$
  1118^I        [34munless[39;49;00m [31m@output_allowed[39;49;00m$
  1119^I            [34mraise[39;49;00m [33m"[39;49;00m[33mYou can't use flush outside of a Rweb::out-block[39;49;00m[33m"[39;49;00m$
  1120^I        [34mend[39;49;00m$
  1121^I        buffer = [31m@buffer[39;49;00m.join$
  1122^I$
  1123^I        [34munless[39;49;00m [31m@output_started[39;49;00m$
  1124^I            sendHeaders$
  1125^I        [34mend[39;49;00m$
  1126^I        [31m$stdout[39;49;00m.print(buffer)$
  1127^I$
  1128^I        [31m@buffer[39;49;00m = []$
  1129^I        [37m# }}}[39;49;00m$
  1130^I    [34mend[39;49;00m$
  1131^I$
  1132^I    [37m# Sends one or more header to the client. All headers are cached just[39;49;00m$
  1133^I^I^I[37m# before body data are send to the client. If the same header are set[39;49;00m$
  1134^I^I^I[37m# twice, only the last value is send.[39;49;00m$
  1135^I^I^I[37m#[39;49;00m$
  1136^I^I^I[37m# Example:[39;49;00m$
  1137^I^I^I[37m#  web.header("Last-Modified: Mon, 16 Feb 2004 20:15:41 GMT")[39;49;00m$
  1138^I^I^I[37m#  web.header("Location: http://www.ruby-lang.org")[39;49;00m$
  1139^I^I^I[37m#[39;49;00m$
  1140^I^I^I[37m# You can specify more than one header at the time by doing something like[39;49;00m$
  1141^I^I^I[37m# this:[39;49;00m$
  1142^I^I^I[37m#  web.header("Content-Type: text/plain\nContent-Length: 383")[39;49;00m$
  1143^I^I^I[37m# or[39;49;00m$
  1144^I^I^I[37m#  web.header(["Content-Type: text/plain", "Content-Length: 383"])[39;49;00m$
  1145^I    [34mdef[39;49;00m [32mheader[39;49;00m(str)$
  1146^I        [37m# {{{[39;49;00m$
  1147^I        [34mif[39;49;00m [31m@output_started[39;49;00m$
  1148^I            [34mraise[39;49;00m [33m"[39;49;00m[33mHTTP-Headers are already send. You can't change them after output has started![39;49;00m[33m"[39;49;00m$
  1149^I        [34mend[39;49;00m$
  1150^I        [34munless[39;49;00m [31m@output_allowed[39;49;00m$
  1151^I            [34mraise[39;49;00m [33m"[39;49;00m[33mYou just can set headers inside of a Rweb::out-block[39;49;00m[33m"[39;49;00m$
  1152^I        [34mend[39;49;00m$
  1153^I        [34mif[39;49;00m str.is_a?[36mArray[39;49;00m$
  1154^I            str.each [34mdo[39;49;00m | value |$
  1155^I                [36mself[39;49;00m.header(value)$
  1156^I            [34mend[39;49;00m$
  1157^I$
  1158^I        [34melsif[39;49;00m str.split([33m/[39;49;00m[33m\[39;49;00m[33mn[39;49;00m[33m/[39;49;00m).length > [34m1[39;49;00m$
  1159^I            str.split([33m/[39;49;00m[33m\[39;49;00m[33mn[39;49;00m[33m/[39;49;00m).each [34mdo[39;49;00m | value |$
  1160^I                [36mself[39;49;00m.header(value)$
  1161^I            [34mend[39;49;00m$
  1162^I$
  1163^I        [34melsif[39;49;00m str.is_a? [36mString[39;49;00m$
  1164^I            str.gsub!([33m/[39;49;00m[33m\[39;49;00m[33mr[39;49;00m[33m/[39;49;00m, [33m"[39;49;00m[33m"[39;49;00m)$
  1165^I$
  1166^I            [34mif[39;49;00m (str =~ [33m/[39;49;00m[33m^HTTP[39;49;00m[33m\/[39;49;00m[33m1[39;49;00m[33m\[39;49;00m[33m.[01] [0-9]{3} ?.*$[39;49;00m[33m/[39;49;00m) == [34m0[39;49;00m$
  1167^I                pattern = [33m/[39;49;00m[33m^HTTP[39;49;00m[33m\/[39;49;00m[33m1.[01] ([0-9]{3}) ?(.*)$[39;49;00m[33m/[39;49;00m$
  1168^I$
  1169^I                result = pattern.match(str)$
  1170^I                [36mself[39;49;00m.setstatus(result[[34m0[39;49;00m], result[[34m1[39;49;00m])$
  1171^I            [34melsif[39;49;00m (str =~ [33m/[39;49;00m[33m^status: [0-9]{3} ?.*$[39;49;00m[33m/i[39;49;00m) == [34m0[39;49;00m$
  1172^I                pattern = [33m/[39;49;00m[33m^status: ([0-9]{3}) ?(.*)$[39;49;00m[33m/i[39;49;00m$
  1173^I$
  1174^I                result = pattern.match(str)$
  1175^I                [36mself[39;49;00m.setstatus(result[[34m0[39;49;00m], result[[34m1[39;49;00m])$
  1176^I            [34melse[39;49;00m$
  1177^I                a = str.split([33m/[39;49;00m[33m: ?[39;49;00m[33m/[39;49;00m, [34m2[39;49;00m)$
  1178^I$
  1179^I                [31m@header[39;49;00m[a[[34m0[39;49;00m].downcase] = a[[34m1[39;49;00m]$
  1180^I            [34mend[39;49;00m$
  1181^I        [34mend[39;49;00m$
  1182^I        [37m# }}}[39;49;00m$
  1183^I    [34mend[39;49;00m$
  1184^I$
  1185^I    [37m# Changes the status of this page. There are several codes like "200 OK",[39;49;00m$
  1186^I^I^I[37m# "302 Found", "404 Not Found" or "500 Internal Server Error". A list of[39;49;00m$
  1187^I^I^I[37m# all codes is available at[39;49;00m$
  1188^I^I^I[37m# http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10[39;49;00m$
  1189^I^I^I[37m#[39;49;00m$
  1190^I^I^I[37m# You can just send the code number, the reason phrase will be added[39;49;00m$
  1191^I^I^I[37m# automaticly with the recommendations from the w3c if not specified. If[39;49;00m$
  1192^I^I^I[37m# you set the status twice or more, only the last status will be send.[39;49;00m$
  1193^I^I^I[37m# Examples:[39;49;00m$
  1194^I^I^I[37m#  web.status("401 Unauthorized")[39;49;00m$
  1195^I^I^I[37m#  web.status("410 Sad but true, this lonely page is gone :(")[39;49;00m$
  1196^I^I^I[37m#  web.status(206)[39;49;00m$
  1197^I^I^I[37m#  web.status("400")[39;49;00m$
  1198^I^I^I[37m#[39;49;00m$
  1199^I^I^I[37m# The default status is "200 OK". If a "Location" header is set, the[39;49;00m$
  1200^I^I^I[37m# default status is "302 Found".[39;49;00m$
  1201^I    [34mdef[39;49;00m [32mstatus[39;49;00m(str)$
  1202^I        [37m# {{{[39;49;00m$
  1203^I        [34mif[39;49;00m [31m@output_started[39;49;00m$
  1204^I            [34mraise[39;49;00m [33m"[39;49;00m[33mHTTP-Headers are already send. You can't change them after output has started![39;49;00m[33m"[39;49;00m$
  1205^I        [34mend[39;49;00m$
  1206^I        [34munless[39;49;00m [31m@output_allowed[39;49;00m$
  1207^I            [34mraise[39;49;00m [33m"[39;49;00m[33mYou just can set headers inside of a Rweb::out-block[39;49;00m[33m"[39;49;00m$
  1208^I        [34mend[39;49;00m$
  1209^I        [34mif[39;49;00m str.is_a?[36mInteger[39;49;00m$
  1210^I            [31m@status[39;49;00m = str$
  1211^I        [34melsif[39;49;00m str.is_a?[36mString[39;49;00m$
  1212^I            p1 = [33m/[39;49;00m[33m^([0-9]{3}) ?(.*)$[39;49;00m[33m/[39;49;00m$
  1213^I            p2 = [33m/[39;49;00m[33m^HTTP[39;49;00m[33m\/[39;49;00m[33m1[39;49;00m[33m\[39;49;00m[33m.[01] ([0-9]{3}) ?(.*)$[39;49;00m[33m/[39;49;00m$
  1214^I            p3 = [33m/[39;49;00m[33m^status: ([0-9]{3}) ?(.*)$[39;49;00m[33m/i[39;49;00m$
  1215^I$
  1216^I            [34mif[39;49;00m (a = p1.match(str)) == [34mnil[39;49;00m$
  1217^I                [34mif[39;49;00m (a = p2.match(str)) == [34mnil[39;49;00m$
  1218^I                    [34mif[39;49;00m (a = p3.match(str)) == [34mnil[39;49;00m$
  1219^I                        [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mInvalid argument[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1220^I                    [34mend[39;49;00m$
  1221^I                [34mend[39;49;00m$
  1222^I            [34mend[39;49;00m$
  1223^I            [31m@status[39;49;00m = a[[34m1[39;49;00m].to_i$
  1224^I            [34mif[39;49;00m a[[34m2[39;49;00m] != [33m"[39;49;00m[33m"[39;49;00m$
  1225^I                [31m@reasonPhrase[39;49;00m = a[[34m2[39;49;00m]$
  1226^I            [34melse[39;49;00m$
  1227^I                [31m@reasonPhrase[39;49;00m = getReasonPhrase([31m@status[39;49;00m)$
  1228^I            [34mend[39;49;00m$
  1229^I        [34melse[39;49;00m$
  1230^I            [34mraise[39;49;00m [31mArgumentError[39;49;00m, [33m"[39;49;00m[33mArgument of setstatus must be integer or string[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1231^I        [34mend[39;49;00m$
  1232^I        [37m# }}}[39;49;00m$
  1233^I    [34mend[39;49;00m$
  1234^I$
  1235^I    [37m# Handles the output of your content and rescues all exceptions. Send all[39;49;00m$
  1236^I^I^I[37m# data in the block to this method. For example:[39;49;00m$
  1237^I^I^I[37m#  web.out do[39;49;00m$
  1238^I^I^I[37m#      web.header("Content-Type: text/plain")[39;49;00m$
  1239^I^I^I[37m#      web.puts("Hello, plain world!")[39;49;00m$
  1240^I^I^I[37m#  end[39;49;00m$
  1241^I    [34mdef[39;49;00m [32mout[39;49;00m$
  1242^I        [37m# {{{[39;49;00m$
  1243^I        [31m@output_allowed[39;49;00m = [34mtrue[39;49;00m$
  1244^I        [31m@buffer[39;49;00m = []; [37m# We use an array as buffer, because it's more performant :)[39;49;00m$
  1245^I$
  1246^I        [34mbegin[39;49;00m$
  1247^I            [34myield[39;49;00m$
  1248^I        [34mrescue[39;49;00m [31mException[39;49;00m => exception$
  1249^I            [31m$stderr[39;49;00m.puts [33m"[39;49;00m[33mRuby exception rescued ([39;49;00m[33m#{[39;49;00mexception.class[33m}[39;49;00m[33m): [39;49;00m[33m#{[39;49;00mexception.message[33m}[39;49;00m[33m"[39;49;00m$
  1250^I            [31m$stderr[39;49;00m.puts exception.backtrace.join([33m"[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m)$
  1251^I$
  1252^I            [34munless[39;49;00m [31m@output_started[39;49;00m$
  1253^I                [36mself[39;49;00m.setstatus([34m500[39;49;00m)$
  1254^I                [31m@header[39;49;00m = {}$
  1255^I            [34mend[39;49;00m$
  1256^I$
  1257^I            [34munless[39;49;00m ([31m@settings[39;49;00m.has_key?([33m"[39;49;00m[33mhide errors[39;49;00m[33m"[39;49;00m) [35mand[39;49;00m [31m@settings[39;49;00m[[33m"[39;49;00m[33mhide errors[39;49;00m[33m"[39;49;00m] == [34mtrue[39;49;00m)$
  1258^I                [34munless[39;49;00m [31m@output_started[39;49;00m$
  1259^I                    [36mself[39;49;00m.header([33m"[39;49;00m[33mContent-Type: text/html[39;49;00m[33m"[39;49;00m)$
  1260^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m<!DOCTYPE HTML PUBLIC [39;49;00m[33m\"[39;49;00m[33m-//W3C//DTD HTML 4.01 Strict//EN[39;49;00m[33m\"[39;49;00m[33m [39;49;00m[33m\"[39;49;00m[33mhttp://www.w3.org/TR/html4/strict.dtd[39;49;00m[33m\"[39;49;00m[33m>[39;49;00m[33m"[39;49;00m$
  1261^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m<html>[39;49;00m[33m"[39;49;00m$
  1262^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m<head>[39;49;00m[33m"[39;49;00m$
  1263^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m<title>500 Internal Server Error</title>[39;49;00m[33m"[39;49;00m$
  1264^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m</head>[39;49;00m[33m"[39;49;00m$
  1265^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m<body>[39;49;00m[33m"[39;49;00m$
  1266^I                [34mend[39;49;00m$
  1267^I                [34mif[39;49;00m [31m@header[39;49;00m.has_key?([33m"[39;49;00m[33mcontent-type[39;49;00m[33m"[39;49;00m) [35mand[39;49;00m ([31m@header[39;49;00m[[33m"[39;49;00m[33mcontent-type[39;49;00m[33m"[39;49;00m] =~ [33m/[39;49;00m[33m^text[39;49;00m[33m\/[39;49;00m[33mhtml[39;49;00m[33m/i[39;49;00m) == [34m0[39;49;00m$
  1268^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m<h1>Internal Server Error</h1>[39;49;00m[33m"[39;49;00m$
  1269^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m<p>The server encountered an exception and was unable to complete your request.</p>[39;49;00m[33m"[39;49;00m$
  1270^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m<p>The exception has provided the following information:</p>[39;49;00m[33m"[39;49;00m$
  1271^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m<pre style=[39;49;00m[33m\"[39;49;00m[33mbackground: [39;49;00m[33m#[39;49;00m[33mFFCCCC; border: black solid 2px; margin-left: 2cm; margin-right: 2cm; padding: 2mm;[39;49;00m[33m\"[39;49;00m[33m><b>[39;49;00m[33m#{[39;49;00mexception.class[33m}[39;49;00m[33m</b>: [39;49;00m[33m#{[39;49;00mexception.message[33m}[39;49;00m[33m <b>on</b>[39;49;00m[33m"[39;49;00m$
  1272^I                    [36mself[39;49;00m.puts$
  1273^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m#{[39;49;00mexception.backtrace.join([33m"[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m)[33m}[39;49;00m[33m</pre>[39;49;00m[33m"[39;49;00m$
  1274^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m</body>[39;49;00m[33m"[39;49;00m$
  1275^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m</html>[39;49;00m[33m"[39;49;00m$
  1276^I                [34melse[39;49;00m$
  1277^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33mThe server encountered an exception and was unable to complete your request[39;49;00m[33m"[39;49;00m$
  1278^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33mThe exception has provided the following information:[39;49;00m[33m"[39;49;00m$
  1279^I                    [36mself[39;49;00m.puts [33m"[39;49;00m[33m#{[39;49;00mexception.class[33m}[39;49;00m[33m: [39;49;00m[33m#{[39;49;00mexception.message[33m}[39;49;00m[33m"[39;49;00m$
  1280^I                    [36mself[39;49;00m.puts$
  1281^I                    [36mself[39;49;00m.puts exception.backtrace.join([33m"[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m)$
  1282^I                [34mend[39;49;00m$
  1283^I            [34mend[39;49;00m$
  1284^I        [34mend[39;49;00m$
  1285^I$
  1286^I        [34mif[39;49;00m [31m@settings[39;49;00m[[33m"[39;49;00m[33mcache[39;49;00m[33m"[39;49;00m]$
  1287^I            buffer = [31m@buffer[39;49;00m.join$
  1288^I$
  1289^I            [34munless[39;49;00m [31m@output_started[39;49;00m$
  1290^I                [34munless[39;49;00m [31m@header[39;49;00m.has_key?([33m"[39;49;00m[33mcontent-length[39;49;00m[33m"[39;49;00m)$
  1291^I                    [36mself[39;49;00m.header([33m"[39;49;00m[33mcontent-length: [39;49;00m[33m#{[39;49;00mbuffer.length[33m}[39;49;00m[33m"[39;49;00m)$
  1292^I                [34mend[39;49;00m$
  1293^I$
  1294^I                sendHeaders$
  1295^I            [34mend[39;49;00m$
  1296^I            [31m$stdout[39;49;00m.print(buffer)$
  1297^I        [34melsif[39;49;00m ![31m@output_started[39;49;00m$
  1298^I            sendHeaders$
  1299^I        [34mend[39;49;00m$
  1300^I        [31m@output_allowed[39;49;00m = [34mfalse[39;49;00m;$
  1301^I        [37m# }}}[39;49;00m$
  1302^I    [34mend[39;49;00m$
  1303^I$
  1304^I    [37m# Decodes URL encoded data, %20 for example stands for a space.[39;49;00m$
  1305^I    [34mdef[39;49;00m [04m[32mRweb[39;49;00m.[32munescape[39;49;00m(str)$
  1306^I        [37m# {{{[39;49;00m$
  1307^I        [34mif[39;49;00m defined? str [35mand[39;49;00m str.is_a? [36mString[39;49;00m$
  1308^I            str.gsub!([33m/[39;49;00m[33m\[39;49;00m[33m+[39;49;00m[33m/[39;49;00m, [33m"[39;49;00m[33m [39;49;00m[33m"[39;49;00m)$
  1309^I            str.gsub([33m/[39;49;00m[33m%.{2}[39;49;00m[33m/[39;49;00m) [34mdo[39;49;00m | s |$
  1310^I                s[[34m1[39;49;00m,[34m2[39;49;00m].hex.chr$
  1311^I            [34mend[39;49;00m$
  1312^I        [34mend[39;49;00m$
  1313^I        [37m# }}}[39;49;00m$
  1314^I    [34mend[39;49;00m$
  1315^I$
  1316^I    [34mprotected[39;49;00m$
  1317^I    [34mdef[39;49;00m [32msendHeaders[39;49;00m$
  1318^I        [37m# {{{[39;49;00m$
  1319^I$
  1320^I        [31mCookie[39;49;00m.disallow [37m# no more cookies can be set or modified[39;49;00m$
  1321^I        [34mif[39;49;00m !([31m@settings[39;49;00m.has_key?([33m"[39;49;00m[33msilent[39;49;00m[33m"[39;49;00m) [35mand[39;49;00m [31m@settings[39;49;00m[[33m"[39;49;00m[33msilent[39;49;00m[33m"[39;49;00m] == [34mtrue[39;49;00m) [35mand[39;49;00m ![31m@header[39;49;00m.has_key?([33m"[39;49;00m[33mx-powered-by[39;49;00m[33m"[39;49;00m)$
  1322^I            [34mif[39;49;00m [31m@mod_ruby[39;49;00m$
  1323^I                header([33m"[39;49;00m[33mx-powered-by: [39;49;00m[33m#{[39;49;00m[31mRWEB[39;49;00m[33m}[39;49;00m[33m (Ruby/[39;49;00m[33m#{[39;49;00m[31mRUBY_VERSION[39;49;00m[33m}[39;49;00m[33m, [39;49;00m[33m#{[39;49;00m[31mMOD_RUBY[39;49;00m[33m}[39;49;00m[33m)[39;49;00m[33m"[39;49;00m);$
  1324^I            [34melse[39;49;00m$
  1325^I                header([33m"[39;49;00m[33mx-powered-by: [39;49;00m[33m#{[39;49;00m[31mRWEB[39;49;00m[33m}[39;49;00m[33m (Ruby/[39;49;00m[33m#{[39;49;00m[31mRUBY_VERSION[39;49;00m[33m}[39;49;00m[33m)[39;49;00m[33m"[39;49;00m);$
  1326^I            [34mend[39;49;00m$
  1327^I        [34mend[39;49;00m$
  1328^I$
  1329^I        [34mif[39;49;00m [31m@output_method[39;49;00m == [33m"[39;49;00m[33mph[39;49;00m[33m"[39;49;00m$
  1330^I            [34mif[39;49;00m (([31m@status[39;49;00m == [34mnil[39;49;00m [35mor[39;49;00m [31m@status[39;49;00m == [34m200[39;49;00m) [35mand[39;49;00m ![31m@header[39;49;00m.has_key?([33m"[39;49;00m[33mcontent-type[39;49;00m[33m"[39;49;00m) [35mand[39;49;00m ![31m@header[39;49;00m.has_key?([33m"[39;49;00m[33mlocation[39;49;00m[33m"[39;49;00m))$
  1331^I                header([33m"[39;49;00m[33mcontent-type: text/html[39;49;00m[33m"[39;49;00m)$
  1332^I            [34mend[39;49;00m$
  1333^I$
  1334^I            [34mif[39;49;00m [31m@status[39;49;00m != [34mnil[39;49;00m$
  1335^I                [31m$stdout[39;49;00m.print [33m"[39;49;00m[33mStatus: [39;49;00m[33m#{[39;49;00m[31m@status[39;49;00m[33m}[39;49;00m[33m [39;49;00m[33m#{[39;49;00m[31m@reasonPhrase[39;49;00m[33m}[39;49;00m[33m\r[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m$
  1336^I            [34mend[39;49;00m$
  1337^I$
  1338^I            [31m@header[39;49;00m.each [34mdo[39;49;00m |key, value|$
  1339^I                key = key *[34m1[39;49;00m [37m# "unfreeze" key :)[39;49;00m$
  1340^I                key[[34m0[39;49;00m] = key[[34m0[39;49;00m,[34m1[39;49;00m].upcase![[34m0[39;49;00m]$
  1341^I$
  1342^I                key = key.gsub([33m/[39;49;00m[33m-[a-z][39;49;00m[33m/[39;49;00m) [34mdo[39;49;00m |char|$
  1343^I                    [33m"[39;49;00m[33m-[39;49;00m[33m"[39;49;00m + char[[34m1[39;49;00m,[34m1[39;49;00m].upcase$
  1344^I                [34mend[39;49;00m$
  1345^I$
  1346^I                [31m$stdout[39;49;00m.print [33m"[39;49;00m[33m#{[39;49;00mkey[33m}[39;49;00m[33m: [39;49;00m[33m#{[39;49;00mvalue[33m}[39;49;00m[33m\r[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m$
  1347^I            [34mend[39;49;00m$
  1348^I            cookies = [31mCookie[39;49;00m.getHttpHeader [37m# Get all cookies as an HTTP Header[39;49;00m$
  1349^I            [34mif[39;49;00m cookies$
  1350^I                [31m$stdout[39;49;00m.print cookies$
  1351^I            [34mend[39;49;00m$
  1352^I$
  1353^I            [31m$stdout[39;49;00m.print [33m"[39;49;00m[33m\r[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m$
  1354^I$
  1355^I        [34melsif[39;49;00m [31m@output_method[39;49;00m == [33m"[39;49;00m[33mnph[39;49;00m[33m"[39;49;00m$
  1356^I        [34melsif[39;49;00m [31m@output_method[39;49;00m == [33m"[39;49;00m[33mmod_ruby[39;49;00m[33m"[39;49;00m$
  1357^I            r = [31mApache[39;49;00m.request$
  1358^I$
  1359^I            [34mif[39;49;00m (([31m@status[39;49;00m == [34mnil[39;49;00m [35mor[39;49;00m [31m@status[39;49;00m == [34m200[39;49;00m) [35mand[39;49;00m ![31m@header[39;49;00m.has_key?([33m"[39;49;00m[33mcontent-type[39;49;00m[33m"[39;49;00m) [35mand[39;49;00m ![31m@header[39;49;00m.has_key?([33m"[39;49;00m[33mlocation[39;49;00m[33m"[39;49;00m))$
  1360^I                header([33m"[39;49;00m[33mtext/html[39;49;00m[33m"[39;49;00m)$
  1361^I            [34mend[39;49;00m$
  1362^I$
  1363^I            [34mif[39;49;00m [31m@status[39;49;00m != [34mnil[39;49;00m$
  1364^I                r.status_line = [33m"[39;49;00m[33m#{[39;49;00m[31m@status[39;49;00m[33m}[39;49;00m[33m [39;49;00m[33m#{[39;49;00m[31m@reasonPhrase[39;49;00m[33m}[39;49;00m[33m"[39;49;00m$
  1365^I            [34mend[39;49;00m$
  1366^I$
  1367^I            r.send_http_header$
  1368^I            [31m@header[39;49;00m.each [34mdo[39;49;00m |key, value|$
  1369^I                key = key *[34m1[39;49;00m [37m# "unfreeze" key :)[39;49;00m$
  1370^I$
  1371^I                key[[34m0[39;49;00m] = key[[34m0[39;49;00m,[34m1[39;49;00m].upcase![[34m0[39;49;00m]$
  1372^I                key = key.gsub([33m/[39;49;00m[33m-[a-z][39;49;00m[33m/[39;49;00m) [34mdo[39;49;00m |char|$
  1373^I                    [33m"[39;49;00m[33m-[39;49;00m[33m"[39;49;00m + char[[34m1[39;49;00m,[34m1[39;49;00m].upcase$
  1374^I                [34mend[39;49;00m$
  1375^I                [36mputs[39;49;00m [33m"[39;49;00m[33m#{[39;49;00mkey[33m}[39;49;00m[33m: [39;49;00m[33m#{[39;49;00mvalue.class[33m}[39;49;00m[33m"[39;49;00m$
  1376^I                [37m#r.headers_out[key] = value[39;49;00m$
  1377^I            [34mend[39;49;00m$
  1378^I        [34mend[39;49;00m$
  1379^I        [31m@output_started[39;49;00m = [34mtrue[39;49;00m$
  1380^I        [37m# }}}[39;49;00m$
  1381^I    [34mend[39;49;00m$
  1382^I$
  1383^I    [34mdef[39;49;00m [32mgetReasonPhrase[39;49;00m (status)$
  1384^I        [37m# {{{[39;49;00m$
  1385^I        [34mif[39;49;00m status == [34m100[39;49;00m$
  1386^I            [33m"[39;49;00m[33mContinue[39;49;00m[33m"[39;49;00m$
  1387^I        [34melsif[39;49;00m status == [34m101[39;49;00m$
  1388^I            [33m"[39;49;00m[33mSwitching Protocols[39;49;00m[33m"[39;49;00m$
  1389^I        [34melsif[39;49;00m status == [34m200[39;49;00m$
  1390^I            [33m"[39;49;00m[33mOK[39;49;00m[33m"[39;49;00m$
  1391^I        [34melsif[39;49;00m status == [34m201[39;49;00m$
  1392^I            [33m"[39;49;00m[33mCreated[39;49;00m[33m"[39;49;00m$
  1393^I        [34melsif[39;49;00m status == [34m202[39;49;00m$
  1394^I            [33m"[39;49;00m[33mAccepted[39;49;00m[33m"[39;49;00m$
  1395^I        [34melsif[39;49;00m status == [34m203[39;49;00m$
  1396^I            [33m"[39;49;00m[33mNon-Authoritative Information[39;49;00m[33m"[39;49;00m$
  1397^I        [34melsif[39;49;00m status == [34m204[39;49;00m$
  1398^I            [33m"[39;49;00m[33mNo Content[39;49;00m[33m"[39;49;00m$
  1399^I        [34melsif[39;49;00m status == [34m205[39;49;00m$
  1400^I            [33m"[39;49;00m[33mReset Content[39;49;00m[33m"[39;49;00m$
  1401^I        [34melsif[39;49;00m status == [34m206[39;49;00m$
  1402^I            [33m"[39;49;00m[33mPartial Content[39;49;00m[33m"[39;49;00m$
  1403^I        [34melsif[39;49;00m status == [34m300[39;49;00m$
  1404^I            [33m"[39;49;00m[33mMultiple Choices[39;49;00m[33m"[39;49;00m$
  1405^I        [34melsif[39;49;00m status == [34m301[39;49;00m$
  1406^I            [33m"[39;49;00m[33mMoved Permanently[39;49;00m[33m"[39;49;00m$
  1407^I        [34melsif[39;49;00m status == [34m302[39;49;00m$
  1408^I            [33m"[39;49;00m[33mFound[39;49;00m[33m"[39;49;00m$
  1409^I        [34melsif[39;49;00m status == [34m303[39;49;00m$
  1410^I            [33m"[39;49;00m[33mSee Other[39;49;00m[33m"[39;49;00m$
  1411^I        [34melsif[39;49;00m status == [34m304[39;49;00m$
  1412^I            [33m"[39;49;00m[33mNot Modified[39;49;00m[33m"[39;49;00m$
  1413^I        [34melsif[39;49;00m status == [34m305[39;49;00m$
  1414^I            [33m"[39;49;00m[33mUse Proxy[39;49;00m[33m"[39;49;00m$
  1415^I        [34melsif[39;49;00m status == [34m307[39;49;00m$
  1416^I            [33m"[39;49;00m[33mTemporary Redirect[39;49;00m[33m"[39;49;00m$
  1417^I        [34melsif[39;49;00m status == [34m400[39;49;00m$
  1418^I            [33m"[39;49;00m[33mBad Request[39;49;00m[33m"[39;49;00m$
  1419^I        [34melsif[39;49;00m status == [34m401[39;49;00m$
  1420^I            [33m"[39;49;00m[33mUnauthorized[39;49;00m[33m"[39;49;00m$
  1421^I        [34melsif[39;49;00m status == [34m402[39;49;00m$
  1422^I            [33m"[39;49;00m[33mPayment Required[39;49;00m[33m"[39;49;00m$
  1423^I        [34melsif[39;49;00m status == [34m403[39;49;00m$
  1424^I            [33m"[39;49;00m[33mForbidden[39;49;00m[33m"[39;49;00m$
  1425^I        [34melsif[39;49;00m status == [34m404[39;49;00m$
  1426^I            [33m"[39;49;00m[33mNot Found[39;49;00m[33m"[39;49;00m$
  1427^I        [34melsif[39;49;00m status == [34m405[39;49;00m$
  1428^I            [33m"[39;49;00m[33mMethod Not Allowed[39;49;00m[33m"[39;49;00m$
  1429^I        [34melsif[39;49;00m status == [34m406[39;49;00m$
  1430^I            [33m"[39;49;00m[33mNot Acceptable[39;49;00m[33m"[39;49;00m$
  1431^I        [34melsif[39;49;00m status == [34m407[39;49;00m$
  1432^I            [33m"[39;49;00m[33mProxy Authentication Required[39;49;00m[33m"[39;49;00m$
  1433^I        [34melsif[39;49;00m status == [34m408[39;49;00m$
  1434^I            [33m"[39;49;00m[33mRequest Time-out[39;49;00m[33m"[39;49;00m$
  1435^I        [34melsif[39;49;00m status == [34m409[39;49;00m$
  1436^I            [33m"[39;49;00m[33mConflict[39;49;00m[33m"[39;49;00m$
  1437^I        [34melsif[39;49;00m status == [34m410[39;49;00m$
  1438^I            [33m"[39;49;00m[33mGone[39;49;00m[33m"[39;49;00m$
  1439^I        [34melsif[39;49;00m status == [34m411[39;49;00m$
  1440^I            [33m"[39;49;00m[33mLength Required[39;49;00m[33m"[39;49;00m$
  1441^I        [34melsif[39;49;00m status == [34m412[39;49;00m$
  1442^I            [33m"[39;49;00m[33mPrecondition Failed[39;49;00m[33m"[39;49;00m$
  1443^I        [34melsif[39;49;00m status == [34m413[39;49;00m$
  1444^I            [33m"[39;49;00m[33mRequest Entity Too Large[39;49;00m[33m"[39;49;00m$
  1445^I        [34melsif[39;49;00m status == [34m414[39;49;00m$
  1446^I            [33m"[39;49;00m[33mRequest-URI Too Large[39;49;00m[33m"[39;49;00m$
  1447^I        [34melsif[39;49;00m status == [34m415[39;49;00m$
  1448^I            [33m"[39;49;00m[33mUnsupported Media Type[39;49;00m[33m"[39;49;00m$
  1449^I        [34melsif[39;49;00m status == [34m416[39;49;00m$
  1450^I            [33m"[39;49;00m[33mRequested range not satisfiable[39;49;00m[33m"[39;49;00m$
  1451^I        [34melsif[39;49;00m status == [34m417[39;49;00m$
  1452^I            [33m"[39;49;00m[33mExpectation Failed[39;49;00m[33m"[39;49;00m$
  1453^I        [34melsif[39;49;00m status == [34m500[39;49;00m$
  1454^I            [33m"[39;49;00m[33mInternal Server Error[39;49;00m[33m"[39;49;00m$
  1455^I        [34melsif[39;49;00m status == [34m501[39;49;00m$
  1456^I            [33m"[39;49;00m[33mNot Implemented[39;49;00m[33m"[39;49;00m$
  1457^I        [34melsif[39;49;00m status == [34m502[39;49;00m$
  1458^I            [33m"[39;49;00m[33mBad Gateway[39;49;00m[33m"[39;49;00m$
  1459^I        [34melsif[39;49;00m status == [34m503[39;49;00m$
  1460^I            [33m"[39;49;00m[33mService Unavailable[39;49;00m[33m"[39;49;00m$
  1461^I        [34melsif[39;49;00m status == [34m504[39;49;00m$
  1462^I            [33m"[39;49;00m[33mGateway Time-out[39;49;00m[33m"[39;49;00m$
  1463^I        [34melsif[39;49;00m status == [34m505[39;49;00m$
  1464^I            [33m"[39;49;00m[33mHTTP Version not supported[39;49;00m[33m"[39;49;00m$
  1465^I        [34melse[39;49;00m$
  1466^I            [34mraise[39;49;00m [33m"[39;49;00m[33mUnknown Statuscode. See http://www.w3.org/Protocols/rfc2616/rfc2616-sec6.html[39;49;00m[33m#[39;49;00m[33msec6.1 for more information.[39;49;00m[33m"[39;49;00m$
  1467^I        [34mend[39;49;00m$
  1468^I        [37m# }}}[39;49;00m$
  1469^I    [34mend[39;49;00m$
  1470^I[34mend[39;49;00m$
  1471^I$
  1472^I[34mclass[39;49;00m [04m[32mCookie[39;49;00m$
  1473^I^I[34mattr_reader[39;49;00m [33m:name[39;49;00m, [33m:value[39;49;00m, [33m:maxage[39;49;00m, [33m:path[39;49;00m, [33m:domain[39;49;00m, [33m:secure[39;49;00m, [33m:comment[39;49;00m$
  1474^I$
  1475^I^I[37m# Sets a cookie. Please see below for details of the attributes.[39;49;00m$
  1476^I^I[34mdef[39;49;00m [32minitialize[39;49;00m ([36mname[39;49;00m, value = [34mnil[39;49;00m, maxage = [34mnil[39;49;00m, path = [34mnil[39;49;00m, domain = [34mnil[39;49;00m, secure = [34mfalse[39;49;00m)$
  1477^I^I^I[37m# {{{[39;49;00m$
  1478^I^I^I[37m# HTTP headers (Cookies are a HTTP header) can only set, while no content[39;49;00m$
  1479^I^I^I[37m# is send. So an exception will be raised, when @@allowed is set to false[39;49;00m$
  1480^I^I^I[37m# and a new cookie has set.[39;49;00m$
  1481^I^I^I[34munless[39;49;00m defined?([31m@@allowed[39;49;00m)$
  1482^I^I^I^I[31m@@allowed[39;49;00m = [34mtrue[39;49;00m$
  1483^I^I^I[34mend[39;49;00m$
  1484^I^I^I[34munless[39;49;00m [31m@@allowed[39;49;00m$
  1485^I^I^I^I[34mraise[39;49;00m [33m"[39;49;00m[33mYou can't set cookies after the HTTP headers are send.[39;49;00m[33m"[39;49;00m$
  1486^I^I^I[34mend[39;49;00m$
  1487^I$
  1488^I^I^I[34munless[39;49;00m defined?([31m@@list[39;49;00m)$
  1489^I^I^I^I[31m@@list[39;49;00m = []$
  1490^I^I^I[34mend[39;49;00m$
  1491^I^I^I[31m@@list[39;49;00m += [[36mself[39;49;00m]$
  1492^I$
  1493^I^I^I[34munless[39;49;00m defined?([31m@@type[39;49;00m)$
  1494^I^I^I^I[31m@@type[39;49;00m = [33m"[39;49;00m[33mnetscape[39;49;00m[33m"[39;49;00m$
  1495^I^I^I[34mend[39;49;00m$
  1496^I$
  1497^I^I^I[34munless[39;49;00m [36mname[39;49;00m.class == [36mString[39;49;00m$
  1498^I^I^I^I[34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33mThe name of a cookie must be a string[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1499^I^I^I[34mend[39;49;00m$
  1500^I^I^I[34mif[39;49;00m value.class.superclass == [36mInteger[39;49;00m || value.class == [36mFloat[39;49;00m$
  1501^I^I^I^Ivalue = value.to_s$
  1502^I^I^I[34melsif[39;49;00m value.class != [36mString[39;49;00m && value != [34mnil[39;49;00m$
  1503^I^I^I^I[34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33mThe value of a cookie must be a string, integer, float or nil[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1504^I^I^I[34mend[39;49;00m$
  1505^I^I^I[34mif[39;49;00m maxage.class == [31mTime[39;49;00m$
  1506^I^I^I^Imaxage = maxage - [31mTime[39;49;00m.now$
  1507^I^I^I[34melsif[39;49;00m !maxage.class.superclass == [36mInteger[39;49;00m  || !maxage == [34mnil[39;49;00m$
  1508^I^I^I^I[34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33mThe maxage date of a cookie must be an Integer or Time object or nil.[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1509^I^I^I[34mend[39;49;00m$
  1510^I^I^I[34munless[39;49;00m path.class == [36mString[39;49;00m  || path == [34mnil[39;49;00m$
  1511^I^I^I^I[34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33mThe path of a cookie must be nil or a string[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1512^I^I^I[34mend[39;49;00m$
  1513^I^I^I[34munless[39;49;00m domain.class == [36mString[39;49;00m  || domain == [34mnil[39;49;00m$
  1514^I^I^I^I[34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33mThe value of a cookie must be nil or a string[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1515^I^I^I[34mend[39;49;00m$
  1516^I^I^I[34munless[39;49;00m secure == [34mtrue[39;49;00m  || secure == [34mfalse[39;49;00m$
  1517^I^I^I^I[34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33mThe secure field of a cookie must be true or false[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1518^I^I^I[34mend[39;49;00m$
  1519^I$
  1520^I^I^I[31m@name[39;49;00m, [31m@value[39;49;00m, [31m@maxage[39;49;00m, [31m@path[39;49;00m, [31m@domain[39;49;00m, [31m@secure[39;49;00m = [36mname[39;49;00m, value, maxage, path, domain, secure$
  1521^I^I^I[31m@comment[39;49;00m = [34mnil[39;49;00m$
  1522^I^I^I[37m# }}}[39;49;00m$
  1523^I^I[34mend[39;49;00m$
  1524^I$
  1525^I^I[37m# Modifies the value of this cookie. The information you want to store. If the[39;49;00m$
  1526^I^I[37m# value is nil, the cookie will be deleted by the client.[39;49;00m$
  1527^I^I[37m#[39;49;00m$
  1528^I^I[37m# This attribute can be a String, Integer or Float object or nil.[39;49;00m$
  1529^I^I[34mdef[39;49;00m [32mvalue=[39;49;00m(value)$
  1530^I^I^I[37m# {{{[39;49;00m$
  1531^I^I^I[34mif[39;49;00m value.class.superclass == [36mInteger[39;49;00m || value.class == [36mFloat[39;49;00m$
  1532^I^I^I^Ivalue = value.to_s$
  1533^I^I^I[34melsif[39;49;00m value.class != [36mString[39;49;00m && value != [34mnil[39;49;00m$
  1534^I^I^I^I[34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33mThe value of a cookie must be a string, integer, float or nil[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1535^I^I^I[34mend[39;49;00m$
  1536^I^I^I[31m@value[39;49;00m = value$
  1537^I^I^I[37m# }}}[39;49;00m$
  1538^I^I[34mend[39;49;00m$
  1539^I$
  1540^I^I[37m# Modifies the maxage of this cookie. This attribute defines the lifetime of[39;49;00m$
  1541^I^I[37m# the cookie, in seconds. A value of 0 means the cookie should be discarded[39;49;00m$
  1542^I^I[37m# imediatly. If it set to nil, the cookie will be deleted when the browser[39;49;00m$
  1543^I^I[37m# will be closed.[39;49;00m$
  1544^I^I[37m#[39;49;00m$
  1545^I^I[37m# Attention: This is different from other implementations like PHP, where you[39;49;00m$
  1546^I^I[37m# gives the seconds since 1/1/1970 0:00:00 GMT.[39;49;00m$
  1547^I^I[37m#[39;49;00m$
  1548^I^I[37m# This attribute must be an Integer or Time object or nil.[39;49;00m$
  1549^I^I[34mdef[39;49;00m [32mmaxage=[39;49;00m(maxage)$
  1550^I^I^I[37m# {{{[39;49;00m$
  1551^I^I^I[34mif[39;49;00m maxage.class == [31mTime[39;49;00m$
  1552^I^I^I^Imaxage = maxage - [31mTime[39;49;00m.now$
  1553^I^I^I[34melsif[39;49;00m maxage.class.superclass == [36mInteger[39;49;00m  || !maxage == [34mnil[39;49;00m$
  1554^I^I^I^I[34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33mThe maxage of a cookie must be an Interger or Time object or nil.[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1555^I^I^I[34mend[39;49;00m$
  1556^I^I^I[31m@maxage[39;49;00m = maxage$
  1557^I^I^I[37m# }}}[39;49;00m$
  1558^I^I[34mend[39;49;00m$
  1559^I$
  1560^I^I[37m# Modifies the path value of this cookie. The client will send this cookie[39;49;00m$
  1561^I^I[37m# only, if the requested document is this directory or a subdirectory of it.[39;49;00m$
  1562^I^I[37m#[39;49;00m$
  1563^I^I[37m# The value of the attribute must be a String object or nil.[39;49;00m$
  1564^I^I[34mdef[39;49;00m [32mpath=[39;49;00m(path)$
  1565^I^I^I[37m# {{{[39;49;00m$
  1566^I^I^I[34munless[39;49;00m path.class == [36mString[39;49;00m  || path == [34mnil[39;49;00m$
  1567^I^I^I^I[34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33mThe path of a cookie must be nil or a string[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1568^I^I^I[34mend[39;49;00m$
  1569^I^I^I[31m@path[39;49;00m = path$
  1570^I^I^I[37m# }}}[39;49;00m$
  1571^I^I[34mend[39;49;00m$
  1572^I$
  1573^I^I[37m# Modifies the domain value of this cookie. The client will send this cookie[39;49;00m$
  1574^I^I[37m# only if it's connected with this domain (or a subdomain, if the first[39;49;00m$
  1575^I^I[37m# character is a dot like in ".ruby-lang.org")[39;49;00m$
  1576^I^I[37m#[39;49;00m$
  1577^I^I[37m# The value of this attribute must be a String or nil.[39;49;00m$
  1578^I^I[34mdef[39;49;00m [32mdomain=[39;49;00m(domain)$
  1579^I^I^I[37m# {{{[39;49;00m$
  1580^I^I^I[34munless[39;49;00m domain.class == [36mString[39;49;00m  || domain == [34mnil[39;49;00m$
  1581^I^I^I^I[34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33mThe domain of a cookie must be a String or nil.[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1582^I^I^I[34mend[39;49;00m$
  1583^I^I^I[31m@domain[39;49;00m = domain$
  1584^I^I^I[37m# }}}[39;49;00m$
  1585^I^I[34mend[39;49;00m$
  1586^I$
  1587^I^I[37m# Modifies the secure flag of this cookie. If it's true, the client will only[39;49;00m$
  1588^I^I[37m# send this cookie if it is secured connected with us.[39;49;00m$
  1589^I^I[37m#[39;49;00m$
  1590^I^I[37m# The value od this attribute has to be true or false.[39;49;00m$
  1591^I^I[34mdef[39;49;00m [32msecure=[39;49;00m(secure)$
  1592^I^I^I[37m# {{{[39;49;00m$
  1593^I^I^I[34munless[39;49;00m secure == [34mtrue[39;49;00m  || secure == [34mfalse[39;49;00m$
  1594^I^I^I^I[34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33mThe secure field of a cookie must be true or false[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1595^I^I^I[34mend[39;49;00m$
  1596^I^I^I[31m@secure[39;49;00m = secure$
  1597^I^I^I[37m# }}}[39;49;00m$
  1598^I^I[34mend[39;49;00m$
  1599^I$
  1600^I^I[37m# Modifies the comment value of this cookie. The comment won't be send, if[39;49;00m$
  1601^I^I[37m# type is "netscape".[39;49;00m$
  1602^I^I[34mdef[39;49;00m [32mcomment=[39;49;00m(comment)$
  1603^I^I^I[37m# {{{[39;49;00m$
  1604^I^I^I[34munless[39;49;00m comment.class == [36mString[39;49;00m || comment == [34mnil[39;49;00m$
  1605^I^I^I^I[34mraise[39;49;00m [31mTypeError[39;49;00m, [33m"[39;49;00m[33mThe comment of a cookie must be a string or nil[39;49;00m[33m"[39;49;00m, [36mcaller[39;49;00m$
  1606^I^I^I[34mend[39;49;00m$
  1607^I^I^I[31m@comment[39;49;00m = comment$
  1608^I^I^I[37m# }}}[39;49;00m$
  1609^I^I[34mend[39;49;00m$
  1610^I$
  1611^I^I[37m# Changes the type of all cookies.[39;49;00m$
  1612^I^I[37m# Allowed values are RFC2109 and netscape (default).[39;49;00m$
  1613^I^I[34mdef[39;49;00m [04m[32mCookie[39;49;00m.[32mtype=[39;49;00m(type)$
  1614^I^I^I[37m# {{{[39;49;00m$
  1615^I^I^I[34munless[39;49;00m [31m@@allowed[39;49;00m$
  1616^I^I^I^I[34mraise[39;49;00m [33m"[39;49;00m[33mThe cookies are allready send, so you can't change the type anymore.[39;49;00m[33m"[39;49;00m$
  1617^I^I^I[34mend[39;49;00m$
  1618^I^I^I[34munless[39;49;00m type.downcase == [33m"[39;49;00m[33mrfc2109[39;49;00m[33m"[39;49;00m && type.downcase == [33m"[39;49;00m[33mnetscape[39;49;00m[33m"[39;49;00m$
  1619^I^I^I^I[34mraise[39;49;00m [33m"[39;49;00m[33mThe type of the cookies must be [39;49;00m[33m\"[39;49;00m[33mRFC2109[39;49;00m[33m\"[39;49;00m[33m or [39;49;00m[33m\"[39;49;00m[33mnetscape[39;49;00m[33m\"[39;49;00m[33m.[39;49;00m[33m"[39;49;00m$
  1620^I^I^I[34mend[39;49;00m$
  1621^I^I^I[31m@@type[39;49;00m = type;$
  1622^I^I^I[37m# }}}[39;49;00m$
  1623^I^I[34mend[39;49;00m$
  1624^I$
  1625^I^I[37m# After sending this message, no cookies can be set or modified. Use it, when[39;49;00m$
  1626^I^I[37m# HTTP-Headers are send. Rweb does this for you.[39;49;00m$
  1627^I^I[34mdef[39;49;00m [04m[32mCookie[39;49;00m.[32mdisallow[39;49;00m$
  1628^I^I^I[37m# {{{[39;49;00m$
  1629^I^I^I[31m@@allowed[39;49;00m = [34mfalse[39;49;00m$
  1630^I^I^I[34mtrue[39;49;00m$
  1631^I^I^I[37m# }}}[39;49;00m$
  1632^I^I[34mend[39;49;00m$
  1633^I$
  1634^I^I[37m# Returns a HTTP header (type String) with all cookies. Rweb does this for[39;49;00m$
  1635^I^I[37m# you.[39;49;00m$
  1636^I^I[34mdef[39;49;00m [04m[32mCookie[39;49;00m.[32mgetHttpHeader[39;49;00m$
  1637^I^I^I[37m# {{{[39;49;00m$
  1638^I^I^I[34mif[39;49;00m defined?([31m@@list[39;49;00m)$
  1639^I^I^I^I[34mif[39;49;00m [31m@@type[39;49;00m == [33m"[39;49;00m[33mnetscape[39;49;00m[33m"[39;49;00m$
  1640^I^I^I^I^Istr = [33m"[39;49;00m[33m"[39;49;00m$
  1641^I^I^I^I^I[31m@@list[39;49;00m.each [34mdo[39;49;00m |cookie|$
  1642^I^I^I^I^I^I[34mif[39;49;00m cookie.value == [34mnil[39;49;00m$
  1643^I^I^I^I^I^I^Icookie.maxage = [34m0[39;49;00m$
  1644^I^I^I^I^I^I^Icookie.value = [33m"[39;49;00m[33m"[39;49;00m$
  1645^I^I^I^I^I^I[34mend[39;49;00m$
  1646^I^I^I^I^I^I[37m# TODO: Name and value should be escaped![39;49;00m$
  1647^I^I^I^I^I^Istr += [33m"[39;49;00m[33mSet-Cookie: [39;49;00m[33m#{[39;49;00mcookie.name[33m}[39;49;00m[33m=[39;49;00m[33m#{[39;49;00mcookie.value[33m}[39;49;00m[33m"[39;49;00m$
  1648^I^I^I^I^I^I[34munless[39;49;00m cookie.maxage == [34mnil[39;49;00m$
  1649^I^I^I^I^I^I^Iexpire = [31mTime[39;49;00m.now + cookie.maxage$
  1650^I^I^I^I^I^I^Iexpire.gmtime$
  1651^I^I^I^I^I^I^Istr += [33m"[39;49;00m[33m; Expire=[39;49;00m[33m#{[39;49;00mexpire.strftime([33m"[39;49;00m[33m%a, %d-%b-%Y %H:%M:%S %Z[39;49;00m[33m"[39;49;00m)[33m}[39;49;00m[33m"[39;49;00m$
  1652^I^I^I^I^I^I[34mend[39;49;00m$
  1653^I^I^I^I^I^I[34munless[39;49;00m cookie.domain == [34mnil[39;49;00m$
  1654^I^I^I^I^I^I^Istr += [33m"[39;49;00m[33m; Domain=[39;49;00m[33m#{[39;49;00mcookie.domain[33m}[39;49;00m[33m"[39;49;00m$
  1655^I^I^I^I^I^I[34mend[39;49;00m$
  1656^I^I^I^I^I^I[34munless[39;49;00m cookie.path == [34mnil[39;49;00m$
  1657^I^I^I^I^I^I^Istr += [33m"[39;49;00m[33m; Path=[39;49;00m[33m#{[39;49;00mcookie.path[33m}[39;49;00m[33m"[39;49;00m$
  1658^I^I^I^I^I^I[34mend[39;49;00m$
  1659^I^I^I^I^I^I[34mif[39;49;00m cookie.secure$
  1660^I^I^I^I^I^I^Istr += [33m"[39;49;00m[33m; Secure[39;49;00m[33m"[39;49;00m$
  1661^I^I^I^I^I^I[34mend[39;49;00m$
  1662^I^I^I^I^I^Istr += [33m"[39;49;00m[33m\r[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m$
  1663^I^I^I^I^I[34mend[39;49;00m$
  1664^I^I^I^I^I[34mreturn[39;49;00m str$
  1665^I^I^I^I[34melse[39;49;00m [37m# type == "RFC2109"[39;49;00m$
  1666^I^I^I^I^Istr = [33m"[39;49;00m[33mSet-Cookie: [39;49;00m[33m"[39;49;00m$
  1667^I^I^I^I^Icomma = [34mfalse[39;49;00m;$
  1668^I$
  1669^I^I^I^I^I[31m@@list[39;49;00m.each [34mdo[39;49;00m |cookie|$
  1670^I^I^I^I^I^I[34mif[39;49;00m cookie.value == [34mnil[39;49;00m$
  1671^I^I^I^I^I^I^Icookie.maxage = [34m0[39;49;00m$
  1672^I^I^I^I^I^I^Icookie.value = [33m"[39;49;00m[33m"[39;49;00m$
  1673^I^I^I^I^I^I[34mend[39;49;00m$
  1674^I^I^I^I^I^I[34mif[39;49;00m comma$
  1675^I^I^I^I^I^I^Istr += [33m"[39;49;00m[33m,[39;49;00m[33m"[39;49;00m$
  1676^I^I^I^I^I^I[34mend[39;49;00m$
  1677^I^I^I^I^I^Icomma = [34mtrue[39;49;00m$
  1678^I$
  1679^I^I^I^I^I^Istr += [33m"[39;49;00m[33m#{[39;49;00mcookie.name[33m}[39;49;00m[33m=[39;49;00m[33m\"[39;49;00m[33m#{[39;49;00mcookie.value[33m}[39;49;00m[33m\"[39;49;00m[33m"[39;49;00m$
  1680^I^I^I^I^I^I[34munless[39;49;00m cookie.maxage == [34mnil[39;49;00m$
  1681^I^I^I^I^I^I^Istr += [33m"[39;49;00m[33m; Max-Age=[39;49;00m[33m\"[39;49;00m[33m#{[39;49;00mcookie.maxage[33m}[39;49;00m[33m\"[39;49;00m[33m"[39;49;00m$
  1682^I^I^I^I^I^I[34mend[39;49;00m$
  1683^I^I^I^I^I^I[34munless[39;49;00m cookie.domain == [34mnil[39;49;00m$
  1684^I^I^I^I^I^I^Istr += [33m"[39;49;00m[33m; Domain=[39;49;00m[33m\"[39;49;00m[33m#{[39;49;00mcookie.domain[33m}[39;49;00m[33m\"[39;49;00m[33m"[39;49;00m$
  1685^I^I^I^I^I^I[34mend[39;49;00m$
  1686^I^I^I^I^I^I[34munless[39;49;00m cookie.path == [34mnil[39;49;00m$
  1687^I^I^I^I^I^I^Istr += [33m"[39;49;00m[33m; Path=[39;49;00m[33m\"[39;49;00m[33m#{[39;49;00mcookie.path[33m}[39;49;00m[33m\"[39;49;00m[33m"[39;49;00m$
  1688^I^I^I^I^I^I[34mend[39;49;00m$
  1689^I^I^I^I^I^I[34mif[39;49;00m cookie.secure$
  1690^I^I^I^I^I^I^Istr += [33m"[39;49;00m[33m; Secure[39;49;00m[33m"[39;49;00m$
  1691^I^I^I^I^I^I[34mend[39;49;00m$
  1692^I^I^I^I^I^I[34munless[39;49;00m cookie.comment == [34mnil[39;49;00m$
  1693^I^I^I^I^I^I^Istr += [33m"[39;49;00m[33m; Comment=[39;49;00m[33m\"[39;49;00m[33m#{[39;49;00mcookie.comment[33m}[39;49;00m[33m\"[39;49;00m[33m"[39;49;00m$
  1694^I^I^I^I^I^I[34mend[39;49;00m$
  1695^I^I^I^I^I^Istr += [33m"[39;49;00m[33m; Version=[39;49;00m[33m\"[39;49;00m[33m1[39;49;00m[33m\"[39;49;00m[33m"[39;49;00m$
  1696^I^I^I^I^I[34mend[39;49;00m$
  1697^I^I^I^I^Istr$
  1698^I^I^I^I[34mend[39;49;00m$
  1699^I^I^I[34melse[39;49;00m$
  1700^I^I^I^I[34mfalse[39;49;00m$
  1701^I^I^I[34mend[39;49;00m$
  1702^I^I^I[37m# }}}[39;49;00m$
  1703^I^I[34mend[39;49;00m$
  1704^I[34mend[39;49;00m$
  1705^I$
  1706^I[36mrequire[39;49;00m [33m'[39;49;00m[33mstrscan[39;49;00m[33m'[39;49;00m$
  1707^I$
  1708^I[34mmodule[39;49;00m [04m[36mBBCode[39;49;00m$
  1709^I^I[31mDEBUG[39;49;00m = [34mtrue[39;49;00m$
  1710^I$
  1711^I^Iuse [33m'[39;49;00m[33mencoder[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mtags[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33mtagstack[39;49;00m[33m'[39;49;00m, [33m'[39;49;00m[33msmileys[39;49;00m[33m'[39;49;00m$
  1712^I$
  1713^I[37m=begin[39;49;00m$
  1714^I[37m^IThe Parser class takes care of the encoding.[39;49;00m$
  1715^I[37m^IIt scans the given BBCode (as plain text), finds tags[39;49;00m$
  1716^I[37m^Iand smilies and also makes links of urls in text.[39;49;00m$
  1717^I[37m[39;49;00m$
  1718^I[37m^INormal text is send directly to the encoder.[39;49;00m$
  1719^I[37m[39;49;00m$
  1720^I[37m^IIf a tag was found, an instance of a Tag subclass is created[39;49;00m$
  1721^I[37m^Ito handle the case.[39;49;00m$
  1722^I[37m[39;49;00m$
  1723^I[37m^IThe @tagstack manages tag nesting and ensures valid HTML.[39;49;00m$
  1724^I[37m=end[39;49;00m$
  1725^I$
  1726^I^I[34mclass[39;49;00m [04m[32mParser[39;49;00m$
  1727^I^I^I[34mclass[39;49;00m [04m[32mAttribute[39;49;00m$
  1728^I^I^I^I[37m# flatten and use only one empty_arg[39;49;00m$
  1729^I^I^I^I[34mdef[39;49;00m [04m[32mself[39;49;00m.[32mcreate[39;49;00m [34mattr[39;49;00m$
  1730^I^I^I^I^I[34mattr[39;49;00m = flatten [34mattr[39;49;00m$
  1731^I^I^I^I^I[34mreturn[39;49;00m [31m@@empty_attr[39;49;00m [34mif[39;49;00m [34mattr[39;49;00m.empty?$
  1732^I^I^I^I^I[34mnew[39;49;00m [34mattr[39;49;00m$
  1733^I^I^I^I[34mend[39;49;00m$
  1734^I$
  1735^I^I^I^I[36mprivate_class_method[39;49;00m [33m:new[39;49;00m$
  1736^I$
  1737^I^I^I^I[37m# remove leading and trailing whitespace; concat lines[39;49;00m$
  1738^I^I^I^I[34mdef[39;49;00m [04m[32mself[39;49;00m.[32mflatten[39;49;00m [34mattr[39;49;00m$
  1739^I^I^I^I^I[34mattr[39;49;00m.strip.gsub([33m/[39;49;00m[33m\[39;49;00m[33mn[39;49;00m[33m/[39;49;00m, [33m'[39;49;00m[33m [39;49;00m[33m'[39;49;00m)$
  1740^I^I^I^I^I[37m# -> ^ and $ can only match at begin and end now[39;49;00m$
  1741^I^I^I^I[34mend[39;49;00m$
  1742^I$
  1743^I^I^I^I[31mATTRIBUTE_SCAN[39;49;00m = [33m/[39;49;00m[33m[39;49;00m$
  1744^I[33m^I^I^I^I(?!$)  [39;49;00m[33m#[39;49;00m[33m don't match at end[39;49;00m$
  1745^I[33m^I^I^I^I[39;49;00m[33m\[39;49;00m[33ms*[39;49;00m$
  1746^I[33m^I^I^I^I( [39;49;00m[33m#[39;49;00m[33m $1 = key[39;49;00m$
  1747^I[33m^I^I^I^I^I[^=[39;49;00m[33m\[39;49;00m[33ms[39;49;00m[33m\[39;49;00m[33m]"[39;49;00m[33m\\[39;49;00m[33m]*[39;49;00m$
  1748^I[33m^I^I^I^I^I(?:[39;49;00m$
  1749^I[33m^I^I^I^I^I^I(?: [39;49;00m[33m\\[39;49;00m[33m. | "[^"[39;49;00m[33m\\[39;49;00m[33m]*(?:[39;49;00m[33m\\[39;49;00m[33m.[^"[39;49;00m[33m\\[39;49;00m[33m]*)*"? )[39;49;00m$
  1750^I[33m^I^I^I^I^I^I[^=[39;49;00m[33m\[39;49;00m[33ms[39;49;00m[33m\[39;49;00m[33m]"[39;49;00m[33m\\[39;49;00m[33m]*[39;49;00m$
  1751^I[33m^I^I^I^I^I)*[39;49;00m$
  1752^I[33m^I^I^I^I)[39;49;00m$
  1753^I[33m^I^I^I^I(?:[39;49;00m$
  1754^I[33m^I^I^I^I^I=[39;49;00m$
  1755^I[33m^I^I^I^I^I( [39;49;00m[33m#[39;49;00m[33m $2 = value[39;49;00m$
  1756^I[33m^I^I^I^I^I^I[^[39;49;00m[33m\[39;49;00m[33ms[39;49;00m[33m\[39;49;00m[33m]"[39;49;00m[33m\\[39;49;00m[33m]*[39;49;00m$
  1757^I[33m^I^I^I^I^I^I(?:[39;49;00m$
  1758^I[33m^I^I^I^I^I^I^I(?: [39;49;00m[33m\\[39;49;00m[33m. | "[^"[39;49;00m[33m\\[39;49;00m[33m]*(?:[39;49;00m[33m\\[39;49;00m[33m.[^"[39;49;00m[33m\\[39;49;00m[33m]*)*"? )[39;49;00m$
  1759^I[33m^I^I^I^I^I^I^I[^[39;49;00m[33m\[39;49;00m[33ms[39;49;00m[33m\[39;49;00m[33m]"[39;49;00m[33m\\[39;49;00m[33m]*[39;49;00m$
  1760^I[33m^I^I^I^I^I^I)*[39;49;00m$
  1761^I[33m^I^I^I^I^I)?[39;49;00m$
  1762^I[33m^I^I^I^I)?[39;49;00m$
  1763^I[33m^I^I^I^I[39;49;00m[33m\[39;49;00m[33ms*[39;49;00m$
  1764^I[33m^I^I^I[39;49;00m[33m/x[39;49;00m$
  1765^I$
  1766^I^I^I^I[34mdef[39;49;00m [04m[32mself[39;49;00m.[32mparse[39;49;00m source$
  1767^I^I^I^I^Isource = source.dup$
  1768^I^I^I^I^I[37m# empty_tag: the tag looks like [... /][39;49;00m$
  1769^I^I^I^I^I[37m# slice!: this deletes the \s*/] at the end[39;49;00m$
  1770^I^I^I^I^I[37m# \s+ because [url=http://rubybb.org/forum/] is NOT an empty tag.[39;49;00m$
  1771^I^I^I^I^I[37m# In RubyBBCode, you can use [url=http://rubybb.org/forum/ /], and this has to be[39;49;00m$
  1772^I^I^I^I^I[37m# interpreted correctly.[39;49;00m$
  1773^I^I^I^I^Iempty_tag = source.sub!([33m/[39;49;00m[33m^:[39;49;00m[33m/[39;49;00m, [33m'[39;49;00m[33m=[39;49;00m[33m'[39;49;00m) [35mor[39;49;00m source.slice!([33m/[39;49;00m[33m\/[39;49;00m[33m$[39;49;00m[33m/[39;49;00m)$
  1774^I^I^I^I^Idebug [33m'[39;49;00m[33mPARSE: [39;49;00m[33m'[39;49;00m + source.inspect + [33m'[39;49;00m[33m => [39;49;00m[33m'[39;49;00m + empty_tag.inspect$
  1775^I^I^I^I^I[37m#-> we have now an attr that's EITHER empty OR begins and ends with non-whitespace.[39;49;00m$
  1776^I$
  1777^I^I^I^I^I[34mattr[39;49;00m = [31mHash[39;49;00m.new$
  1778^I^I^I^I^I[34mattr[39;49;00m[[33m:flags[39;49;00m] = []$
  1779^I^I^I^I^Isource.scan([31mATTRIBUTE_SCAN[39;49;00m) { |key, value|$
  1780^I^I^I^I^I^I[34mif[39;49;00m [35mnot[39;49;00m value$
  1781^I^I^I^I^I^I^I[34mattr[39;49;00m[[33m:flags[39;49;00m] << unescape(key)$
  1782^I^I^I^I^I^I[34melse[39;49;00m$
  1783^I^I^I^I^I^I^I[34mnext[39;49;00m [34mif[39;49;00m value.empty? [35mand[39;49;00m key.empty?$
  1784^I^I^I^I^I^I^I[34mattr[39;49;00m[unescape(key)] = unescape(value)$
  1785^I^I^I^I^I^I[34mend[39;49;00m$
  1786^I^I^I^I^I}$
  1787^I^I^I^I^Idebug [34mattr[39;49;00m.inspect$
  1788^I$
  1789^I^I^I^I^I[34mreturn[39;49;00m empty_tag, [34mattr[39;49;00m$
  1790^I^I^I^I[34mend[39;49;00m$
  1791^I$
  1792^I^I^I^I[34mdef[39;49;00m [04m[32mself[39;49;00m.[32munescape_char[39;49;00m esc$
  1793^I^I^I^I^Iesc[[34m1[39;49;00m]$
  1794^I^I^I^I[34mend[39;49;00m$
  1795^I$
  1796^I^I^I^I[34mdef[39;49;00m [04m[32mself[39;49;00m.[32munquote[39;49;00m qt$
  1797^I^I^I^I^Iqt[[34m1[39;49;00m..-[34m1[39;49;00m].chomp([33m'[39;49;00m[33m"[39;49;00m[33m'[39;49;00m).gsub([33m/[39;49;00m[33m\\[39;49;00m[33m.[39;49;00m[33m/[39;49;00m) { |esc| unescape_char esc }$
  1798^I^I^I^I[34mend[39;49;00m$
  1799^I$
  1800^I^I^I^I[34mdef[39;49;00m [04m[32mself[39;49;00m.[32munescape[39;49;00m str$
  1801^I^I^I^I^Istr.gsub([33m/[39;49;00m[33m ([39;49;00m[33m\\[39;49;00m[33m.) | (" [^"[39;49;00m[33m\\[39;49;00m[33m]* (?:[39;49;00m[33m\\[39;49;00m[33m.[^"[39;49;00m[33m\\[39;49;00m[33m]*)* "?) [39;49;00m[33m/x[39;49;00m) {$
  1802^I^I^I^I^I^I[34mif[39;49;00m [31m$1[39;49;00m$
  1803^I^I^I^I^I^I^Iunescape_char [31m$1[39;49;00m$
  1804^I^I^I^I^I^I[34melse[39;49;00m$
  1805^I^I^I^I^I^I^Iunquote [31m$2[39;49;00m$
  1806^I^I^I^I^I^I[34mend[39;49;00m$
  1807^I^I^I^I^I}$
  1808^I^I^I^I[34mend[39;49;00m$
  1809^I$
  1810^I^I^I^I[34minclude[39;49;00m [31mEnumerable[39;49;00m$
  1811^I^I^I^I[34mdef[39;49;00m [32meach[39;49;00m &block$
  1812^I^I^I^I^I[31m@args[39;49;00m.each(&block)$
  1813^I^I^I^I[34mend[39;49;00m$
  1814^I$
  1815^I^I^I^I[34mattr_reader[39;49;00m [33m:source[39;49;00m, [33m:args[39;49;00m, [33m:value[39;49;00m$
  1816^I$
  1817^I^I^I^I[34mdef[39;49;00m [32minitialize[39;49;00m source$
  1818^I^I^I^I^I[31m@source[39;49;00m = source$
  1819^I^I^I^I^Idebug [33m'[39;49;00m[33mAttribute[39;49;00m[33m#[39;49;00m[33mnew(%p)[39;49;00m[33m'[39;49;00m % source$
  1820^I^I^I^I^I[31m@empty_tag[39;49;00m, [31m@attr[39;49;00m = [31mAttribute[39;49;00m.parse source$
  1821^I^I^I^I^I[31m@value[39;49;00m = [31m@attr[39;49;00m[[33m'[39;49;00m[33m'[39;49;00m].to_s$
  1822^I^I^I^I[34mend[39;49;00m$
  1823^I$
  1824^I^I^I^I[34mdef[39;49;00m [32mempty?[39;49;00m$
  1825^I^I^I^I^I[36mself[39;49;00m == [31m@@empty_attr[39;49;00m$
  1826^I^I^I^I[34mend[39;49;00m$
  1827^I$
  1828^I^I^I^I[34mdef[39;49;00m [32mempty_tag?[39;49;00m$
  1829^I^I^I^I^I[31m@empty_tag[39;49;00m$
  1830^I^I^I^I[34mend[39;49;00m$
  1831^I$
  1832^I^I^I^I[34mdef[39;49;00m [32m[][39;49;00m *keys$
  1833^I^I^I^I^Ires = [31m@attr[39;49;00m[*keys]$
  1834^I^I^I^I[34mend[39;49;00m$
  1835^I$
  1836^I^I^I^I[34mdef[39;49;00m [32mflags[39;49;00m$
  1837^I^I^I^I^I[34mattr[39;49;00m[[33m:flags[39;49;00m]$
  1838^I^I^I^I[34mend[39;49;00m$
  1839^I$
  1840^I^I^I^I[34mdef[39;49;00m [32mto_s[39;49;00m$
  1841^I^I^I^I^I[31m@attr[39;49;00m$
  1842^I^I^I^I[34mend[39;49;00m$
  1843^I$
  1844^I^I^I^I[34mdef[39;49;00m [32minspect[39;49;00m$
  1845^I^I^I^I^I[33m'[39;49;00m[33mATTR[[39;49;00m[33m'[39;49;00m + [31m@attr[39;49;00m.inspect + ([31m@empty_tag[39;49;00m ? [33m'[39;49;00m[33m | empty tag[39;49;00m[33m'[39;49;00m : [33m'[39;49;00m[33m'[39;49;00m) + [33m'[39;49;00m[33m][39;49;00m[33m'[39;49;00m$
  1846^I^I^I^I[34mend[39;49;00m$
  1847^I^I^I[34mend[39;49;00m$
  1848^I^I^I[34mclass[39;49;00m [04m[32mAttribute[39;49;00m$
  1849^I^I^I^I[31m@@empty_attr[39;49;00m = [34mnew[39;49;00m [33m'[39;49;00m[33m'[39;49;00m$
  1850^I^I^I[34mend[39;49;00m$
  1851^I^I[34mend[39;49;00m$
