Using lexer <pygments.lexers.HaskellLexer with {'ensurenl': False, 'tabsize': 0}>
[37m{-[39;49;00m[37m# LANGUAGE DeriveDataTypeable, FlexibleContexts, GeneralizedNewtypeDeriving[39;49;00m
[37m  , MultiParamTypeClasses, OverloadedStrings, ScopedTypeVariables, TemplateHaskell[39;49;00m
[37m  , TypeFamilies, FlexibleInstances #[39;49;00m[37m-}[39;49;00m[37m[39;49;00m
[34mmodule[39;49;00m[37m [39;49;00m[04m[36mMain[39;49;00m[37m [39;49;00m[34mwhere[39;49;00m[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mControl.Applicative[39;49;00m[37m  [39;49;00m([36mApplicative[39;49;00m,[37m [39;49;00m[36mAlternative[39;49;00m,[37m [39;49;00m(<$>))[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mControl.Exception.Lifted[39;49;00m[37m    [39;49;00m([32mbracket[39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mControl.Monad.Trans.Control[39;49;00m[37m [39;49;00m([36mMonadBaseControl[39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mControl.Monad[39;49;00m[37m        [39;49;00m([36mMonadPlus[39;49;00m,[37m [39;49;00m[32mmplus[39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mControl.Monad.Reader[39;49;00m[37m [39;49;00m([36mMonadReader[39;49;00m,[37m [39;49;00m[36mReaderT[39;49;00m(..),[37m [39;49;00m[32mask[39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mControl.Monad.Trans[39;49;00m[37m  [39;49;00m([36mMonadIO[39;49;00m(..))[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mData.Acid[39;49;00m[37m            [39;49;00m([37m [39;49;00m[36mAcidState[39;49;00m(..),[37m [39;49;00m[36mEventState[39;49;00m(..),[37m [39;49;00m[36mEventResult[39;49;00m(..)[37m[39;49;00m
[37m                            [39;49;00m,[37m [39;49;00m[36mQuery[39;49;00m(..),[37m [39;49;00m[36mQueryEvent[39;49;00m(..),[37m [39;49;00m[36mUpdate[39;49;00m(..),[37m [39;49;00m[36mUpdateEvent[39;49;00m(..)[37m[39;49;00m
[37m                            [39;49;00m,[37m [39;49;00m[36mIsAcidic[39;49;00m(..),[37m [39;49;00m[32mmakeAcidic[39;49;00m,[37m [39;49;00m[32mopenLocalState[39;49;00m[37m[39;49;00m
[37m                            [39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mData.Acid.Local[39;49;00m[37m      [39;49;00m([37m [39;49;00m[32mcreateCheckpointAndClose[39;49;00m[37m[39;49;00m
[37m                            [39;49;00m,[37m [39;49;00m[32mopenLocalStateFrom[39;49;00m[37m[39;49;00m
[37m                            [39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mData.Acid.Advanced[39;49;00m[37m   [39;49;00m([32mquery'[39;49;00m,[37m [39;49;00m[32mupdate'[39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mData.Maybe[39;49;00m[37m           [39;49;00m([32mfromMaybe[39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mData.SafeCopy[39;49;00m[37m        [39;49;00m([36mSafeCopy[39;49;00m,[37m [39;49;00m[32mbase[39;49;00m,[37m [39;49;00m[32mderiveSafeCopy[39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mData.Data[39;49;00m[37m            [39;49;00m([36mData[39;49;00m,[37m [39;49;00m[36mTypeable[39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mData.Lens[39;49;00m[37m            [39;49;00m((%=),[37m [39;49;00m(!=))[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mData.Lens.Template[39;49;00m[37m   [39;49;00m([32mmakeLens[39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mData.Text.Lazy[39;49;00m[37m       [39;49;00m([36mText[39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mHappstack.Server[39;49;00m[37m     [39;49;00m([37m [39;49;00m[36mHappstack[39;49;00m,[37m [39;49;00m[36mHasRqData[39;49;00m,[37m [39;49;00m[36mMethod[39;49;00m([36mGET[39;49;00m,[37m [39;49;00m[36mPOST[39;49;00m),[37m [39;49;00m[36mRequest[39;49;00m([32mrqMethod[39;49;00m)[37m[39;49;00m
[37m                            [39;49;00m,[37m [39;49;00m[36mResponse[39;49;00m[37m[39;49;00m
[37m                            [39;49;00m,[37m [39;49;00m[36mServerPartT[39;49;00m(..),[37m [39;49;00m[36mWebMonad[39;49;00m,[37m [39;49;00m[36mFilterMonad[39;49;00m,[37m [39;49;00m[36mServerMonad[39;49;00m[37m[39;49;00m
[37m                            [39;49;00m,[37m [39;49;00m[32maskRq[39;49;00m,[37m [39;49;00m[32mdecodeBody[39;49;00m,[37m [39;49;00m[32mdir[39;49;00m,[37m [39;49;00m[32mdefaultBodyPolicy[39;49;00m,[37m [39;49;00m[32mlookText[39;49;00m[37m[39;49;00m
[37m                            [39;49;00m,[37m [39;49;00m[32mmapServerPartT[39;49;00m,[37m [39;49;00m[32mnullConf[39;49;00m,[37m [39;49;00m[32mnullDir[39;49;00m,[37m [39;49;00m[32mok[39;49;00m,[37m [39;49;00m[32msimpleHTTP[39;49;00m[37m[39;49;00m
[37m                            [39;49;00m,[37m [39;49;00m[32mtoResponse[39;49;00m[37m[39;49;00m
[37m                            [39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mPrelude[39;49;00m[37m [39;49;00m[34mhiding[39;49;00m[37m       [39;49;00m([32mhead[39;49;00m,[37m [39;49;00m[32mid[39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mSystem.FilePath[39;49;00m[37m      [39;49;00m((</>))[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mText.Blaze[39;49;00m[37m           [39;49;00m((!))[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mText.Blaze.Html4.Strict[39;49;00m[37m [39;49;00m([32mbody[39;49;00m,[37m [39;49;00m[32mhead[39;49;00m,[37m [39;49;00m[32mhtml[39;49;00m,[37m [39;49;00m[32minput[39;49;00m,[37m [39;49;00m[32mform[39;49;00m,[37m [39;49;00m[32mlabel[39;49;00m,[37m [39;49;00m[32mp[39;49;00m,[37m [39;49;00m[32mtitle[39;49;00m,[37m [39;49;00m[32mtoHtml[39;49;00m)[37m[39;49;00m
[34mimport[39;49;00m[37m [39;49;00m[04m[36mText.Blaze.Html4.Strict.Attributes[39;49;00m[37m [39;49;00m([32maction[39;49;00m,[37m [39;49;00m[32menctype[39;49;00m,[37m [39;49;00m[32mfor[39;49;00m,[37m [39;49;00m[32mid[39;49;00m,[37m [39;49;00m[32mmethod[39;49;00m,[37m [39;49;00m[32mname[39;49;00m,[37m [39;49;00m[32mtype_[39;49;00m,[37m [39;49;00m[32mvalue[39;49;00m)[37m[39;49;00m
[34mclass[39;49;00m[37m [39;49;00m[36mHasAcidState[39;49;00m[37m [39;49;00mm[37m [39;49;00mst[37m [39;49;00m[34mwhere[39;49;00m[37m[39;49;00m
[37m   [39;49;00mgetAcidState[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00mm[37m [39;49;00m([36mAcidState[39;49;00m[37m [39;49;00mst)[37m[39;49;00m
[32mquery[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00mforall[37m [39;49;00mevent[37m [39;49;00mm.[37m [39;49;00m
[37m         [39;49;00m([37m [39;49;00m[36mFunctor[39;49;00m[37m [39;49;00mm[37m[39;49;00m
[37m         [39;49;00m,[37m [39;49;00m[36mMonadIO[39;49;00m[37m [39;49;00mm[37m[39;49;00m
[37m         [39;49;00m,[37m [39;49;00m[36mQueryEvent[39;49;00m[37m [39;49;00mevent[37m[39;49;00m
[37m         [39;49;00m,[37m [39;49;00m[36mHasAcidState[39;49;00m[37m [39;49;00mm[37m [39;49;00m([36mEventState[39;49;00m[37m [39;49;00mevent)[37m[39;49;00m
[37m         [39;49;00m)[37m [39;49;00m[35m=>[39;49;00m[37m [39;49;00m
[37m         [39;49;00mevent[37m[39;49;00m
[37m      [39;49;00m[35m->[39;49;00m[37m [39;49;00mm[37m [39;49;00m([36mEventResult[39;49;00m[37m [39;49;00mevent)[37m[39;49;00m
[32mquery[39;49;00m[37m [39;49;00mevent[37m [39;49;00m[35m=[39;49;00m[37m[39;49;00m
[37m    [39;49;00m[34mdo[39;49;00m[37m [39;49;00mas[37m [39;49;00m[35m<-[39;49;00m[37m [39;49;00mgetAcidState[37m[39;49;00m
[37m       [39;49;00mquery'[37m [39;49;00m(as[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mAcidState[39;49;00m[37m [39;49;00m([36mEventState[39;49;00m[37m [39;49;00mevent))[37m [39;49;00mevent[37m[39;49;00m
[32mupdate[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00mforall[37m [39;49;00mevent[37m [39;49;00mm.[37m [39;49;00m
[37m          [39;49;00m([37m [39;49;00m[36mFunctor[39;49;00m[37m [39;49;00mm[37m[39;49;00m
[37m          [39;49;00m,[37m [39;49;00m[36mMonadIO[39;49;00m[37m [39;49;00mm[37m[39;49;00m
[37m          [39;49;00m,[37m [39;49;00m[36mUpdateEvent[39;49;00m[37m [39;49;00mevent[37m[39;49;00m
[37m          [39;49;00m,[37m [39;49;00m[36mHasAcidState[39;49;00m[37m [39;49;00mm[37m [39;49;00m([36mEventState[39;49;00m[37m [39;49;00mevent)[37m[39;49;00m
[37m          [39;49;00m)[37m [39;49;00m[35m=>[39;49;00m[37m [39;49;00m
[37m          [39;49;00mevent[37m [39;49;00m
[37m       [39;49;00m[35m->[39;49;00m[37m [39;49;00mm[37m [39;49;00m([36mEventResult[39;49;00m[37m [39;49;00mevent)[37m[39;49;00m
[32mupdate[39;49;00m[37m [39;49;00mevent[37m [39;49;00m[35m=[39;49;00m[37m[39;49;00m
[37m    [39;49;00m[34mdo[39;49;00m[37m [39;49;00mas[37m [39;49;00m[35m<-[39;49;00m[37m [39;49;00mgetAcidState[37m[39;49;00m
[37m       [39;49;00mupdate'[37m [39;49;00m(as[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mAcidState[39;49;00m[37m [39;49;00m([36mEventState[39;49;00m[37m [39;49;00mevent))[37m [39;49;00mevent[37m[39;49;00m
[37m-- | bracket the opening and close of the `AcidState` handle. [39;49;00m[37m[39;49;00m
[37m[39;49;00m
[37m-- automatically creates a checkpoint on close[39;49;00m[37m[39;49;00m
[32mwithLocalState[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m([36mMonadBaseControl[39;49;00m[37m [39;49;00m[36mIO[39;49;00m[37m [39;49;00mm,[37m [39;49;00m[36mMonadIO[39;49;00m[37m [39;49;00mm,[37m [39;49;00m[36mIsAcidic[39;49;00m[37m [39;49;00mst,[37m [39;49;00m[36mTypeable[39;49;00m[37m [39;49;00mst)[37m [39;49;00m[35m=>[39;49;00m[37m [39;49;00m
[37m                  [39;49;00m[36mMaybe[39;49;00m[37m [39;49;00m[36mFilePath[39;49;00m[37m           [39;49;00m[37m-- ^ path to state directory[39;49;00m[37m[39;49;00m
[37m                 [39;49;00m[35m->[39;49;00m[37m [39;49;00mst[37m                     [39;49;00m[37m-- ^ initial state value[39;49;00m[37m[39;49;00m
[37m                 [39;49;00m[35m->[39;49;00m[37m [39;49;00m([36mAcidState[39;49;00m[37m [39;49;00mst[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00mm[37m [39;49;00ma)[37m [39;49;00m[37m-- ^ function which uses the `AcidState` handle[39;49;00m[37m[39;49;00m
[37m                 [39;49;00m[35m->[39;49;00m[37m [39;49;00mm[37m [39;49;00ma[37m[39;49;00m
[32mwithLocalState[39;49;00m[37m [39;49;00mmPath[37m [39;49;00minitialState[37m [39;49;00m[35m=[39;49;00m[37m[39;49;00m
[37m    [39;49;00mbracket[37m [39;49;00m(liftIO[37m [39;49;00m$[37m [39;49;00m(maybe[37m [39;49;00mopenLocalState[37m [39;49;00mopenLocalStateFrom[37m [39;49;00mmPath)[37m [39;49;00minitialState)[37m[39;49;00m
[37m            [39;49;00m(liftIO[37m [39;49;00m.[37m [39;49;00mcreateCheckpointAndClose)[37m[39;49;00m
[37m-- State that stores a hit count[39;49;00m[37m[39;49;00m
[37m[39;49;00m
[34mdata[39;49;00m[37m [39;49;00m[36mCountState[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[36mCountState[39;49;00m[37m [39;49;00m{[37m [39;49;00m_count[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mInteger[39;49;00m[37m [39;49;00m}[37m[39;49;00m
[37m                [39;49;00m[34mderiving[39;49;00m[37m [39;49;00m([36mEq[39;49;00m,[37m [39;49;00m[36mOrd[39;49;00m,[37m [39;49;00m[36mData[39;49;00m,[37m [39;49;00m[36mTypeable[39;49;00m,[37m [39;49;00m[36mShow[39;49;00m)[37m[39;49;00m
[37m[39;49;00m
$(deriveSafeCopy[37m [39;49;00m[34m0[39;49;00m[37m [39;49;00m'base[37m [39;49;00m[36m''CountState[39;49;00m)[37m[39;49;00m
$(makeLens[37m [39;49;00m[36m''CountState[39;49;00m)[37m[39;49;00m
[37m[39;49;00m
[32minitialCountState[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mCountState[39;49;00m[37m[39;49;00m
[32minitialCountState[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[36mCountState[39;49;00m[37m [39;49;00m{[37m [39;49;00m_count[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[34m0[39;49;00m[37m [39;49;00m}[37m[39;49;00m
[37m[39;49;00m
[32mincCount[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mUpdate[39;49;00m[37m [39;49;00m[36mCountState[39;49;00m[37m [39;49;00m[36mInteger[39;49;00m[37m[39;49;00m
[32mincCount[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00mcount[37m [39;49;00m%=[37m [39;49;00msucc[37m[39;49;00m
[37m[39;49;00m
$(makeAcidic[37m [39;49;00m[36m''CountState[39;49;00m[37m [39;49;00m['incCount])[37m[39;49;00m
[37m-- State that stores a greeting[39;49;00m[37m[39;49;00m
[34mdata[39;49;00m[37m [39;49;00m[36mGreetingState[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[36mGreetingState[39;49;00m[37m [39;49;00m{[37m  [39;49;00m_greeting[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mText[39;49;00m[37m [39;49;00m}[37m[39;49;00m
[37m                [39;49;00m[34mderiving[39;49;00m[37m [39;49;00m([36mEq[39;49;00m,[37m [39;49;00m[36mOrd[39;49;00m,[37m [39;49;00m[36mData[39;49;00m,[37m [39;49;00m[36mTypeable[39;49;00m,[37m [39;49;00m[36mShow[39;49;00m)[37m[39;49;00m
[37m[39;49;00m
$(deriveSafeCopy[37m [39;49;00m[34m0[39;49;00m[37m [39;49;00m'base[37m [39;49;00m[36m''GreetingState[39;49;00m)[37m[39;49;00m
$(makeLens[37m [39;49;00m[36m''GreetingState[39;49;00m)[37m[39;49;00m
[37m[39;49;00m
[32minitialGreetingState[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mGreetingState[39;49;00m[37m[39;49;00m
[32minitialGreetingState[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[36mGreetingState[39;49;00m[37m [39;49;00m{[37m [39;49;00m_greeting[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[33m"[39;49;00m[33mHello[39;49;00m[33m"[39;49;00m[37m [39;49;00m}[37m[39;49;00m
[37m[39;49;00m
[32mgetGreeting[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mQuery[39;49;00m[37m [39;49;00m[36mGreetingState[39;49;00m[37m [39;49;00m[36mText[39;49;00m[37m[39;49;00m
[32mgetGreeting[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m_greeting[37m [39;49;00m<$>[37m [39;49;00mask[37m[39;49;00m
[37m[39;49;00m
[32msetGreeting[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mText[39;49;00m[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00m[36mUpdate[39;49;00m[37m [39;49;00m[36mGreetingState[39;49;00m[37m [39;49;00m[36mText[39;49;00m[37m[39;49;00m
[32msetGreeting[39;49;00m[37m [39;49;00mtxt[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00mgreeting[37m [39;49;00m!=[37m [39;49;00mtxt[37m[39;49;00m
[37m[39;49;00m
$(makeAcidic[37m [39;49;00m[36m''GreetingState[39;49;00m[37m [39;49;00m['getGreeting,[37m [39;49;00m'setGreeting])[37m[39;49;00m
[34mdata[39;49;00m[37m [39;49;00m[36mAcid[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[36mAcid[39;49;00m[37m [39;49;00m{[37m [39;49;00macidCountState[37m    [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mAcidState[39;49;00m[37m [39;49;00m[36mCountState[39;49;00m[37m[39;49;00m
[37m                 [39;49;00m,[37m [39;49;00macidGreetingState[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mAcidState[39;49;00m[37m [39;49;00m[36mGreetingState[39;49;00m[37m[39;49;00m
[37m                 [39;49;00m}[37m[39;49;00m
[37m[39;49;00m
[32mwithAcid[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mMaybe[39;49;00m[37m [39;49;00m[36mFilePath[39;49;00m[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00m([36mAcid[39;49;00m[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00m[36mIO[39;49;00m[37m [39;49;00ma)[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00m[36mIO[39;49;00m[37m [39;49;00ma[37m[39;49;00m
[32mwithAcid[39;49;00m[37m [39;49;00mmBasePath[37m [39;49;00maction[37m [39;49;00m[35m=[39;49;00m[37m[39;49;00m
[37m    [39;49;00m[34mlet[39;49;00m[37m [39;49;00mbasePath[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00mfromMaybe[37m [39;49;00m[33m"[39;49;00m[33m_state[39;49;00m[33m"[39;49;00m[37m [39;49;00mmBasePath[37m[39;49;00m
[37m    [39;49;00m[34min[39;49;00m[37m [39;49;00mwithLocalState[37m [39;49;00m([36mJust[39;49;00m[37m [39;49;00m$[37m [39;49;00mbasePath[37m [39;49;00m</>[37m [39;49;00m[33m"[39;49;00m[33mcount[39;49;00m[33m"[39;49;00m)[37m    [39;49;00minitialCountState[37m    [39;49;00m$[37m [39;49;00m[32m\[39;49;00mc[37m [39;49;00m[35m->[39;49;00m[37m[39;49;00m
[37m       [39;49;00mwithLocalState[37m [39;49;00m([36mJust[39;49;00m[37m [39;49;00m$[37m [39;49;00mbasePath[37m [39;49;00m</>[37m [39;49;00m[33m"[39;49;00m[33mgreeting[39;49;00m[33m"[39;49;00m)[37m [39;49;00minitialGreetingState[37m [39;49;00m$[37m [39;49;00m[32m\[39;49;00mg[37m [39;49;00m[35m->[39;49;00m[37m[39;49;00m
[37m           [39;49;00maction[37m [39;49;00m([36mAcid[39;49;00m[37m [39;49;00mc[37m [39;49;00mg)[37m[39;49;00m
[34mnewtype[39;49;00m[37m [39;49;00m[36mApp[39;49;00m[37m [39;49;00ma[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[36mApp[39;49;00m[37m [39;49;00m{[37m [39;49;00munApp[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mServerPartT[39;49;00m[37m [39;49;00m([36mReaderT[39;49;00m[37m [39;49;00m[36mAcid[39;49;00m[37m [39;49;00m[36mIO[39;49;00m)[37m [39;49;00ma[37m [39;49;00m}[37m[39;49;00m
[37m    [39;49;00m[34mderiving[39;49;00m[37m [39;49;00m([37m [39;49;00m[36mFunctor[39;49;00m,[37m [39;49;00m[36mAlternative[39;49;00m,[37m [39;49;00m[36mApplicative[39;49;00m,[37m [39;49;00m[36mMonad[39;49;00m,[37m [39;49;00m[36mMonadPlus[39;49;00m,[37m [39;49;00m[36mMonadIO[39;49;00m[37m[39;49;00m
[37m               [39;49;00m,[37m [39;49;00m[36mHasRqData[39;49;00m,[37m [39;49;00m[36mServerMonad[39;49;00m[37m [39;49;00m,[36mWebMonad[39;49;00m[37m [39;49;00m[36mResponse[39;49;00m,[37m [39;49;00m[36mFilterMonad[39;49;00m[37m [39;49;00m[36mResponse[39;49;00m[37m[39;49;00m
[37m               [39;49;00m,[37m [39;49;00m[36mHappstack[39;49;00m,[37m [39;49;00m[36mMonadReader[39;49;00m[37m [39;49;00m[36mAcid[39;49;00m)[37m[39;49;00m
[37m[39;49;00m
[32mrunApp[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mAcid[39;49;00m[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00m[36mApp[39;49;00m[37m [39;49;00ma[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00m[36mServerPartT[39;49;00m[37m [39;49;00m[36mIO[39;49;00m[37m [39;49;00ma[37m[39;49;00m
[32mrunApp[39;49;00m[37m [39;49;00macid[37m [39;49;00m([36mApp[39;49;00m[37m [39;49;00msp)[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00mmapServerPartT[37m [39;49;00m(flip[37m [39;49;00mrunReaderT[37m [39;49;00macid)[37m [39;49;00msp[37m[39;49;00m
[34minstance[39;49;00m[37m [39;49;00m[36mHasAcidState[39;49;00m[37m [39;49;00m[36mApp[39;49;00m[37m [39;49;00m[36mCountState[39;49;00m[37m [39;49;00m[34mwhere[39;49;00m[37m[39;49;00m
[37m    [39;49;00mgetAcidState[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00macidCountState[37m    [39;49;00m<$>[37m [39;49;00mask[37m [39;49;00m
[37m[39;49;00m
[34minstance[39;49;00m[37m [39;49;00m[36mHasAcidState[39;49;00m[37m [39;49;00m[36mApp[39;49;00m[37m [39;49;00m[36mGreetingState[39;49;00m[37m [39;49;00m[34mwhere[39;49;00m[37m[39;49;00m
[37m    [39;49;00mgetAcidState[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00macidGreetingState[37m [39;49;00m<$>[37m [39;49;00mask[37m[39;49;00m
[32mpage[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mApp[39;49;00m[37m [39;49;00m[36mResponse[39;49;00m[37m[39;49;00m
[32mpage[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m[39;49;00m
[37m    [39;49;00m[34mdo[39;49;00m[37m [39;49;00mnullDir[37m[39;49;00m
[37m       [39;49;00mg[37m [39;49;00m[35m<-[39;49;00m[37m [39;49;00mgreet[37m[39;49;00m
[37m       [39;49;00mc[37m [39;49;00m[35m<-[39;49;00m[37m [39;49;00mupdate[37m [39;49;00m[36mIncCount[39;49;00m[37m [39;49;00m[37m-- ^ a CountState event[39;49;00m[37m[39;49;00m
[37m       [39;49;00mok[37m [39;49;00m$[37m [39;49;00mtoResponse[37m [39;49;00m$[37m[39;49;00m
[37m          [39;49;00mhtml[37m [39;49;00m$[37m [39;49;00m[34mdo[39;49;00m[37m[39;49;00m
[37m            [39;49;00mhead[37m [39;49;00m$[37m [39;49;00m[34mdo[39;49;00m[37m[39;49;00m
[37m              [39;49;00mtitle[37m [39;49;00m[33m"[39;49;00m[33macid-state demo[39;49;00m[33m"[39;49;00m[37m[39;49;00m
[37m            [39;49;00mbody[37m [39;49;00m$[37m [39;49;00m[34mdo[39;49;00m[37m[39;49;00m
[37m              [39;49;00mform[37m [39;49;00m![37m [39;49;00maction[37m [39;49;00m[33m"[39;49;00m[33m/[39;49;00m[33m"[39;49;00m[37m [39;49;00m![37m [39;49;00mmethod[37m [39;49;00m[33m"[39;49;00m[33mPOST[39;49;00m[33m"[39;49;00m[37m [39;49;00m![37m [39;49;00menctype[37m [39;49;00m[33m"[39;49;00m[33mmultipart/form-data[39;49;00m[33m"[39;49;00m[37m [39;49;00m$[37m [39;49;00m[34mdo[39;49;00m[37m[39;49;00m
[37m                [39;49;00mlabel[37m [39;49;00m[33m"[39;49;00m[33mnew message: [39;49;00m[33m"[39;49;00m[37m [39;49;00m![37m [39;49;00mfor[37m [39;49;00m[33m"[39;49;00m[33mmsg[39;49;00m[33m"[39;49;00m[37m[39;49;00m
[37m                [39;49;00minput[37m [39;49;00m![37m [39;49;00mtype_[37m [39;49;00m[33m"[39;49;00m[33mtext[39;49;00m[33m"[39;49;00m[37m [39;49;00m![37m [39;49;00mid[37m [39;49;00m[33m"[39;49;00m[33mmsg[39;49;00m[33m"[39;49;00m[37m [39;49;00m![37m [39;49;00mname[37m [39;49;00m[33m"[39;49;00m[33mgreeting[39;49;00m[33m"[39;49;00m[37m[39;49;00m
[37m                [39;49;00minput[37m [39;49;00m![37m [39;49;00mtype_[37m [39;49;00m[33m"[39;49;00m[33msubmit[39;49;00m[33m"[39;49;00m[37m [39;49;00m![37m [39;49;00mvalue[37m [39;49;00m[33m"[39;49;00m[33mupdate message[39;49;00m[33m"[39;49;00m[37m[39;49;00m
[37m              [39;49;00mp[37m [39;49;00m$[37m [39;49;00mtoHtml[37m [39;49;00mg[37m[39;49;00m
[37m              [39;49;00mp[37m [39;49;00m$[37m [39;49;00m[34mdo[39;49;00m[37m [39;49;00m[33m"[39;49;00m[33mThis page has been loaded [39;49;00m[33m"[39;49;00m[37m [39;49;00m
[37m                     [39;49;00mtoHtml[37m [39;49;00mc[37m[39;49;00m
[37m                     [39;49;00m[33m"[39;49;00m[33m time(s).[39;49;00m[33m"[39;49;00m[37m[39;49;00m
[37m    [39;49;00m[34mwhere[39;49;00m[37m[39;49;00m
[37m    [39;49;00mgreet[37m [39;49;00m[35m=[39;49;00m[37m[39;49;00m
[37m        [39;49;00m[34mdo[39;49;00m[37m [39;49;00mm[37m [39;49;00m[35m<-[39;49;00m[37m [39;49;00mrqMethod[37m [39;49;00m<$>[37m [39;49;00maskRq[37m[39;49;00m
[37m           [39;49;00m[34mcase[39;49;00m[37m [39;49;00mm[37m [39;49;00m[34mof[39;49;00m[37m[39;49;00m
[37m             [39;49;00m[36mPOST[39;49;00m[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00m
[37m                 [39;49;00m[34mdo[39;49;00m[37m [39;49;00mdecodeBody[37m [39;49;00m(defaultBodyPolicy[37m [39;49;00m[33m"[39;49;00m[33m/tmp/[39;49;00m[33m"[39;49;00m[37m [39;49;00m[34m0[39;49;00m[37m [39;49;00m[34m1000[39;49;00m[37m [39;49;00m[34m1000[39;49;00m)[37m[39;49;00m
[37m                    [39;49;00mnewGreeting[37m [39;49;00m[35m<-[39;49;00m[37m [39;49;00mlookText[37m [39;49;00m[33m"[39;49;00m[33mgreeting[39;49;00m[33m"[39;49;00m[37m[39;49;00m
[37m                    [39;49;00mupdate[37m [39;49;00m([36mSetGreeting[39;49;00m[37m [39;49;00mnewGreeting)[37m   [39;49;00m[37m-- ^ a GreetingState event[39;49;00m[37m[39;49;00m
[37m                    [39;49;00mreturn[37m [39;49;00mnewGreeting[37m[39;49;00m
[37m             [39;49;00m[36mGET[39;49;00m[37m  [39;49;00m[35m->[39;49;00m[37m [39;49;00m
[37m                 [39;49;00m[34mdo[39;49;00m[37m [39;49;00mquery[37m [39;49;00m[36mGetGreeting[39;49;00m[37m                  [39;49;00m[37m-- ^ a GreetingState event[39;49;00m[37m[39;49;00m
[32mmain[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mIO[39;49;00m[37m [39;49;00m[36m()[39;49;00m[37m[39;49;00m
[32mmain[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m[39;49;00m
[37m    [39;49;00mwithAcid[37m [39;49;00m[36mNothing[39;49;00m[37m [39;49;00m$[37m [39;49;00m[32m\[39;49;00macid[37m [39;49;00m[35m->[39;49;00m[37m[39;49;00m
[37m        [39;49;00msimpleHTTP[37m [39;49;00mnullConf[37m [39;49;00m$[37m [39;49;00mrunApp[37m [39;49;00macid[37m [39;49;00mpage[37m[39;49;00m
[34mnewtype[39;49;00m[37m [39;49;00m[36mFooState[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[36mFooState[39;49;00m[37m [39;49;00m{[37m [39;49;00mfoo[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mText[39;49;00m[37m [39;49;00m}[37m[39;49;00m
[37m    [39;49;00m[34mderiving[39;49;00m[37m [39;49;00m([36mEq[39;49;00m,[37m [39;49;00m[36mOrd[39;49;00m,[37m [39;49;00m[36mData[39;49;00m,[37m [39;49;00m[36mTypeable[39;49;00m,[37m [39;49;00m[36mSafeCopy[39;49;00m)[37m[39;49;00m
[37m[39;49;00m
[32minitialFooState[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mFooState[39;49;00m[37m[39;49;00m
[32minitialFooState[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[36mFooState[39;49;00m[37m [39;49;00m{[37m [39;49;00mfoo[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[33m"[39;49;00m[33mfoo[39;49;00m[33m"[39;49;00m[37m [39;49;00m}[37m[39;49;00m
[37m[39;49;00m
[32maskFoo[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mQuery[39;49;00m[37m [39;49;00m[36mFooState[39;49;00m[37m [39;49;00m[36mText[39;49;00m[37m[39;49;00m
[32maskFoo[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00mfoo[37m [39;49;00m<$>[37m [39;49;00mask[37m[39;49;00m
[37m[39;49;00m
$(makeAcidic[37m [39;49;00m[36m''FooState[39;49;00m[37m [39;49;00m['askFoo])[37m[39;49;00m
[32mfooPlugin[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m([36mHappstack[39;49;00m[37m [39;49;00mm,[37m [39;49;00m[36mHasAcidState[39;49;00m[37m [39;49;00mm[37m [39;49;00m[36mFooState[39;49;00m)[37m [39;49;00m[35m=>[39;49;00m[37m [39;49;00mm[37m [39;49;00m[36mResponse[39;49;00m[37m[39;49;00m
[32mfooPlugin[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m[39;49;00m
[37m    [39;49;00mdir[37m [39;49;00m[33m"[39;49;00m[33mfoo[39;49;00m[33m"[39;49;00m[37m [39;49;00m$[37m [39;49;00m[34mdo[39;49;00m[37m[39;49;00m
[37m       [39;49;00mtxt[37m [39;49;00m[35m<-[39;49;00m[37m [39;49;00mquery[37m [39;49;00m[36mAskFoo[39;49;00m[37m[39;49;00m
[37m       [39;49;00mok[37m [39;49;00m$[37m [39;49;00mtoResponse[37m [39;49;00mtxt[37m[39;49;00m
[34mdata[39;49;00m[37m [39;49;00m[36mAcid'[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[36mAcid'[39;49;00m[37m [39;49;00m{[37m [39;49;00macidCountState'[37m    [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mAcidState[39;49;00m[37m [39;49;00m[36mCountState[39;49;00m[37m[39;49;00m
[37m                   [39;49;00m,[37m [39;49;00macidGreetingState'[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mAcidState[39;49;00m[37m [39;49;00m[36mGreetingState[39;49;00m[37m[39;49;00m
[37m                   [39;49;00m,[37m [39;49;00macidFooState'[37m      [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mAcidState[39;49;00m[37m [39;49;00m[36mFooState[39;49;00m[37m[39;49;00m
[37m                   [39;49;00m}[37m[39;49;00m
[32mwithAcid'[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mMaybe[39;49;00m[37m [39;49;00m[36mFilePath[39;49;00m[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00m([36mAcid'[39;49;00m[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00m[36mIO[39;49;00m[37m [39;49;00ma)[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00m[36mIO[39;49;00m[37m [39;49;00ma[37m[39;49;00m
[32mwithAcid'[39;49;00m[37m [39;49;00mmBasePath[37m [39;49;00maction[37m [39;49;00m[35m=[39;49;00m[37m[39;49;00m
[37m    [39;49;00m[34mlet[39;49;00m[37m [39;49;00mbasePath[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00mfromMaybe[37m [39;49;00m[33m"[39;49;00m[33m_state[39;49;00m[33m"[39;49;00m[37m [39;49;00mmBasePath[37m[39;49;00m
[37m    [39;49;00m[34min[39;49;00m[37m [39;49;00mwithLocalState[37m [39;49;00m([36mJust[39;49;00m[37m [39;49;00m$[37m [39;49;00mbasePath[37m [39;49;00m</>[37m [39;49;00m[33m"[39;49;00m[33mcount[39;49;00m[33m"[39;49;00m)[37m    [39;49;00minitialCountState[37m    [39;49;00m$[37m [39;49;00m[32m\[39;49;00mc[37m [39;49;00m[35m->[39;49;00m[37m[39;49;00m
[37m       [39;49;00mwithLocalState[37m [39;49;00m([36mJust[39;49;00m[37m [39;49;00m$[37m [39;49;00mbasePath[37m [39;49;00m</>[37m [39;49;00m[33m"[39;49;00m[33mgreeting[39;49;00m[33m"[39;49;00m)[37m [39;49;00minitialGreetingState[37m [39;49;00m$[37m [39;49;00m[32m\[39;49;00mg[37m [39;49;00m[35m->[39;49;00m[37m[39;49;00m
[37m       [39;49;00mwithLocalState[37m [39;49;00m([36mJust[39;49;00m[37m [39;49;00m$[37m [39;49;00mbasePath[37m [39;49;00m</>[37m [39;49;00m[33m"[39;49;00m[33mfoo[39;49;00m[33m"[39;49;00m)[37m      [39;49;00minitialFooState[37m      [39;49;00m$[37m [39;49;00m[32m\[39;49;00mf[37m [39;49;00m[35m->[39;49;00m[37m[39;49;00m
[37m           [39;49;00maction[37m [39;49;00m([36mAcid'[39;49;00m[37m [39;49;00mc[37m [39;49;00mg[37m [39;49;00mf)[37m[39;49;00m
[34mnewtype[39;49;00m[37m [39;49;00m[36mApp'[39;49;00m[37m [39;49;00ma[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m[36mApp'[39;49;00m[37m [39;49;00m{[37m [39;49;00munApp'[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mServerPartT[39;49;00m[37m [39;49;00m([36mReaderT[39;49;00m[37m [39;49;00m[36mAcid'[39;49;00m[37m [39;49;00m[36mIO[39;49;00m)[37m [39;49;00ma[37m [39;49;00m}[37m[39;49;00m
[37m    [39;49;00m[34mderiving[39;49;00m[37m [39;49;00m([37m [39;49;00m[36mFunctor[39;49;00m,[37m [39;49;00m[36mAlternative[39;49;00m,[37m [39;49;00m[36mApplicative[39;49;00m,[37m [39;49;00m[36mMonad[39;49;00m,[37m [39;49;00m[36mMonadPlus[39;49;00m,[37m [39;49;00m[36mMonadIO[39;49;00m[37m[39;49;00m
[37m               [39;49;00m,[37m [39;49;00m[36mHasRqData[39;49;00m,[37m [39;49;00m[36mServerMonad[39;49;00m[37m [39;49;00m,[36mWebMonad[39;49;00m[37m [39;49;00m[36mResponse[39;49;00m,[37m [39;49;00m[36mFilterMonad[39;49;00m[37m [39;49;00m[36mResponse[39;49;00m[37m[39;49;00m
[37m               [39;49;00m,[37m [39;49;00m[36mHappstack[39;49;00m,[37m [39;49;00m[36mMonadReader[39;49;00m[37m [39;49;00m[36mAcid'[39;49;00m)[37m[39;49;00m
[37m[39;49;00m
[34minstance[39;49;00m[37m [39;49;00m[36mHasAcidState[39;49;00m[37m [39;49;00m[36mApp'[39;49;00m[37m [39;49;00m[36mFooState[39;49;00m[37m [39;49;00m[34mwhere[39;49;00m[37m[39;49;00m
[37m    [39;49;00mgetAcidState[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00macidFooState'[37m [39;49;00m<$>[37m [39;49;00mask[37m[39;49;00m
[32mfooAppPlugin[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mApp'[39;49;00m[37m [39;49;00m[36mResponse[39;49;00m[37m[39;49;00m
[32mfooAppPlugin[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00mfooPlugin[37m[39;49;00m
[32mfooReaderPlugin[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mReaderT[39;49;00m[37m [39;49;00m([36mAcidState[39;49;00m[37m [39;49;00m[36mFooState[39;49;00m)[37m [39;49;00m([36mServerPartT[39;49;00m[37m [39;49;00m[36mIO[39;49;00m)[37m [39;49;00m[36mResponse[39;49;00m[37m[39;49;00m
[32mfooReaderPlugin[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00mfooPlugin[37m[39;49;00m
[34minstance[39;49;00m[37m [39;49;00m[36mHasAcidState[39;49;00m[37m [39;49;00m([36mReaderT[39;49;00m[37m [39;49;00m([36mAcidState[39;49;00m[37m [39;49;00m[36mFooState[39;49;00m)[37m [39;49;00m([36mServerPartT[39;49;00m[37m [39;49;00m[36mIO[39;49;00m))[37m [39;49;00m[36mFooState[39;49;00m[37m [39;49;00m[34mwhere[39;49;00m[37m[39;49;00m
[37m    [39;49;00mgetAcidState[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00mask[37m[39;49;00m
[32mwithFooPlugin[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m([36mMonadIO[39;49;00m[37m [39;49;00mm,[37m [39;49;00m[36mMonadBaseControl[39;49;00m[37m [39;49;00m[36mIO[39;49;00m[37m [39;49;00mm)[37m [39;49;00m[35m=>[39;49;00m[37m [39;49;00m
[37m                 [39;49;00m[36mFilePath[39;49;00m[37m                          [39;49;00m[37m-- ^ path to state directory[39;49;00m[37m[39;49;00m
[37m              [39;49;00m[35m->[39;49;00m[37m [39;49;00m([36mServerPartT[39;49;00m[37m [39;49;00m[36mIO[39;49;00m[37m [39;49;00m[36mResponse[39;49;00m[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00mm[37m [39;49;00ma)[37m  [39;49;00m[37m-- ^ function that uses fooPlugin[39;49;00m[37m[39;49;00m
[37m              [39;49;00m[35m->[39;49;00m[37m [39;49;00mm[37m [39;49;00ma[37m[39;49;00m
[32mwithFooPlugin[39;49;00m[37m [39;49;00mbasePath[37m [39;49;00mf[37m [39;49;00m[35m=[39;49;00m[37m[39;49;00m
[37m       [39;49;00m[34mdo[39;49;00m[37m [39;49;00mwithLocalState[37m [39;49;00m([36mJust[39;49;00m[37m [39;49;00m$[37m [39;49;00mbasePath[37m [39;49;00m</>[37m [39;49;00m[33m"[39;49;00m[33mfoo[39;49;00m[33m"[39;49;00m)[37m [39;49;00minitialFooState[37m [39;49;00m$[37m [39;49;00m[32m\[39;49;00mfooState[37m [39;49;00m[35m->[39;49;00m[37m [39;49;00m
[37m              [39;49;00mf[37m [39;49;00m$[37m [39;49;00mrunReaderT[37m [39;49;00mfooReaderPlugin[37m [39;49;00mfooState[37m[39;49;00m
[32mmain'[39;49;00m[37m [39;49;00m[35m::[39;49;00m[37m [39;49;00m[36mIO[39;49;00m[37m [39;49;00m[36m()[39;49;00m[37m[39;49;00m
[32mmain'[39;49;00m[37m [39;49;00m[35m=[39;49;00m[37m [39;49;00m
[37m    [39;49;00mwithFooPlugin[37m [39;49;00m[33m"[39;49;00m[33m_state[39;49;00m[33m"[39;49;00m[37m [39;49;00m$[37m [39;49;00m[32m\[39;49;00mfooPlugin'[37m [39;49;00m[35m->[39;49;00m[37m[39;49;00m
[37m        [39;49;00mwithAcid[37m [39;49;00m[36mNothing[39;49;00m[37m [39;49;00m$[37m [39;49;00m[32m\[39;49;00macid[37m [39;49;00m[35m->[39;49;00m[37m[39;49;00m
[37m            [39;49;00msimpleHTTP[37m [39;49;00mnullConf[37m [39;49;00m$[37m [39;49;00mfooPlugin'[37m [39;49;00m`mplus`[37m [39;49;00mrunApp[37m [39;49;00macid[37m [39;49;00mpage
