     1	[36m#[39;49;00m[36mpike __REAL_VERSION__[39;49;00m[36m[39;49;00m
     2	[37m[39;49;00m
     3	[37m//! A string wrapper that pretends to be a @[Stdio.File] object[39;49;00m
     4	[37m//! in addition to some features of a @[Stdio.FILE] object.[39;49;00m
     5	[37m[39;49;00m
     6	[37m[39;49;00m
     7	[37m//! This constant can be used to distinguish a FakeFile object[39;49;00m
     8	[37m//! from a real @[Stdio.File] object.[39;49;00m
     9	[34mconstant[39;49;00m[37m [39;49;00mis_fake_file[37m [39;49;00m=[37m [39;49;00m[34m1[39;49;00m;[37m[39;49;00m
    10	[37m[39;49;00m
    11	[34mprotected[39;49;00m[37m [39;49;00m[36mstring[39;49;00m[37m [39;49;00mdata;[37m[39;49;00m
    12	[34mprotected[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mptr;[37m[39;49;00m
    13	[34mprotected[39;49;00m[37m [39;49;00m[36mint[39;49;00m([34m0.[39;49;00m[34m.1[39;49;00m)[37m [39;49;00mr;[37m[39;49;00m
    14	[34mprotected[39;49;00m[37m [39;49;00m[36mint[39;49;00m([34m0.[39;49;00m[34m.1[39;49;00m)[37m [39;49;00mw;[37m[39;49;00m
    15	[34mprotected[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmtime;[37m[39;49;00m
    16	[37m[39;49;00m
    17	[34mprotected[39;49;00m[37m [39;49;00m[36mfunction[39;49;00m[37m [39;49;00mread_cb;[37m[39;49;00m
    18	[34mprotected[39;49;00m[37m [39;49;00m[36mfunction[39;49;00m[37m [39;49;00mread_oob_cb;[37m[39;49;00m
    19	[34mprotected[39;49;00m[37m [39;49;00m[36mfunction[39;49;00m[37m [39;49;00mwrite_cb;[37m[39;49;00m
    20	[34mprotected[39;49;00m[37m [39;49;00m[36mfunction[39;49;00m[37m [39;49;00mwrite_oob_cb;[37m[39;49;00m
    21	[34mprotected[39;49;00m[37m [39;49;00m[36mfunction[39;49;00m[37m [39;49;00mclose_cb;[37m[39;49;00m
    22	[37m[39;49;00m
    23	[37m//! @seealso[39;49;00m
    24	[37m//!   @[Stdio.File()->close()][39;49;00m
    25	[36mint[39;49;00m[37m [39;49;00m[32mclose[39;49;00m([36mvoid[39;49;00m|[36mstring[39;49;00m[37m [39;49;00mdirection)[37m [39;49;00m{[37m[39;49;00m
    26	[37m  [39;49;00mdirection[37m [39;49;00m=[37m [39;49;00mlower_case(direction||[33m"[39;49;00m[33mrw[39;49;00m[33m"[39;49;00m);[37m[39;49;00m
    27	[37m  [39;49;00m[36mint[39;49;00m[37m [39;49;00mcr[37m [39;49;00m=[37m [39;49;00mhas_value(direction,[37m [39;49;00m[33m"[39;49;00m[33mr[39;49;00m[33m"[39;49;00m);[37m[39;49;00m
    28	[37m  [39;49;00m[36mint[39;49;00m[37m [39;49;00mcw[37m [39;49;00m=[37m [39;49;00mhas_value(direction,[37m [39;49;00m[33m"[39;49;00m[33mw[39;49;00m[33m"[39;49;00m);[37m[39;49;00m
    29	[37m[39;49;00m
    30	[37m  [39;49;00m[34mif[39;49;00m(cr)[37m [39;49;00m{[37m[39;49;00m
    31	[37m    [39;49;00mr[37m [39;49;00m=[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
    32	[37m  [39;49;00m}[37m[39;49;00m
    33	[37m[39;49;00m
    34	[37m  [39;49;00m[34mif[39;49;00m(cw)[37m [39;49;00m{[37m[39;49;00m
    35	[37m    [39;49;00mw[37m [39;49;00m=[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
    36	[37m  [39;49;00m}[37m[39;49;00m
    37	[37m[39;49;00m
    38	[37m  [39;49;00m[37m// FIXME: Close callback[39;49;00m
    39	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34m1[39;49;00m;[37m[39;49;00m
    40	}[37m[39;49;00m
    41	[37m[39;49;00m
    42	[37m//! @decl void create(string data, void|string type, void|int pointer)[39;49;00m
    43	[37m//! @seealso[39;49;00m
    44	[37m//!   @[Stdio.File()->create()][39;49;00m
    45	[36mvoid[39;49;00m[37m [39;49;00m[32mcreate[39;49;00m([36mstring[39;49;00m[37m [39;49;00m_data,[37m [39;49;00m[36mvoid[39;49;00m|[36mstring[39;49;00m[37m [39;49;00mtype,[37m [39;49;00m[36mint[39;49;00m|[36mvoid[39;49;00m[37m [39;49;00m_ptr)[37m [39;49;00m{[37m[39;49;00m
    46	[37m  [39;49;00m[34mif[39;49;00m(!_data)[37m [39;49;00merror([33m"[39;49;00m[33mNo data string given to FakeFile.[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m);[37m[39;49;00m
    47	[37m  [39;49;00mdata[37m [39;49;00m=[37m [39;49;00m_data;[37m[39;49;00m
    48	[37m  [39;49;00mptr[37m [39;49;00m=[37m [39;49;00m_ptr;[37m[39;49;00m
    49	[37m  [39;49;00mmtime[37m [39;49;00m=[37m [39;49;00mtime();[37m[39;49;00m
    50	[37m  [39;49;00m[34mif[39;49;00m(type)[37m [39;49;00m{[37m[39;49;00m
    51	[37m    [39;49;00mtype[37m [39;49;00m=[37m [39;49;00mlower_case(type);[37m[39;49;00m
    52	[37m    [39;49;00m[34mif[39;49;00m(has_value(type,[37m [39;49;00m[33m"[39;49;00m[33mr[39;49;00m[33m"[39;49;00m))[37m[39;49;00m
    53	[37m      [39;49;00mr[37m [39;49;00m=[37m [39;49;00m[34m1[39;49;00m;[37m[39;49;00m
    54	[37m    [39;49;00m[34mif[39;49;00m(has_value(type,[37m [39;49;00m[33m"[39;49;00m[33mw[39;49;00m[33m"[39;49;00m))[37m[39;49;00m
    55	[37m      [39;49;00mw[37m [39;49;00m=[37m [39;49;00m[34m1[39;49;00m;[37m[39;49;00m
    56	[37m  [39;49;00m}[37m[39;49;00m
    57	[37m  [39;49;00m[34melse[39;49;00m[37m[39;49;00m
    58	[37m    [39;49;00mr[37m [39;49;00m=[37m [39;49;00mw[37m [39;49;00m=[37m [39;49;00m[34m1[39;49;00m;[37m[39;49;00m
    59	}[37m[39;49;00m
    60	[37m[39;49;00m
    61	[34mprotected[39;49;00m[37m [39;49;00m[36mstring[39;49;00m[37m [39;49;00m[32mmake_type_str[39;49;00m()[37m [39;49;00m{[37m[39;49;00m
    62	[37m  [39;49;00m[36mstring[39;49;00m[37m [39;49;00mtype[37m [39;49;00m=[37m [39;49;00m[33m"[39;49;00m[33m"[39;49;00m;[37m[39;49;00m
    63	[37m  [39;49;00m[34mif[39;49;00m(r)[37m [39;49;00mtype[37m [39;49;00m+=[37m [39;49;00m[33m"[39;49;00m[33mr[39;49;00m[33m"[39;49;00m;[37m[39;49;00m
    64	[37m  [39;49;00m[34mif[39;49;00m(w)[37m [39;49;00mtype[37m [39;49;00m+=[37m [39;49;00m[33m"[39;49;00m[33mw[39;49;00m[33m"[39;49;00m;[37m[39;49;00m
    65	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mtype;[37m[39;49;00m
    66	}[37m[39;49;00m
    67	[37m[39;49;00m
    68	[37m//! @seealso[39;49;00m
    69	[37m//!   @[Stdio.File()->dup()][39;49;00m
    70	this_program[37m [39;49;00m[32mdup[39;49;00m()[37m [39;49;00m{[37m[39;49;00m
    71	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mthis_program(data,[37m [39;49;00mmake_type_str(),[37m [39;49;00mptr);[37m[39;49;00m
    72	}[37m[39;49;00m
    73	[37m[39;49;00m
    74	[37m//! Always returns 0.[39;49;00m
    75	[37m//! @seealso[39;49;00m
    76	[37m//!   @[Stdio.File()->errno()][39;49;00m
    77	[36mint[39;49;00m[37m [39;49;00m[32merrno[39;49;00m()[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34m0[39;49;00m;[37m [39;49;00m}[37m[39;49;00m
    78	[37m[39;49;00m
    79	[37m//! Returns size and the creation time of the string.[39;49;00m
    80	Stdio.Stat[37m [39;49;00mstat()[37m [39;49;00m{[37m[39;49;00m
    81	[37m  [39;49;00mStdio.Stat[37m [39;49;00mst[37m [39;49;00m=[37m [39;49;00mStdio.Stat();[37m[39;49;00m
    82	[37m  [39;49;00mst->size[37m [39;49;00m=[37m [39;49;00m[34msizeof[39;49;00m(data);[37m[39;49;00m
    83	[37m  [39;49;00mst->mtime=st->ctime=mtime;[37m[39;49;00m
    84	[37m  [39;49;00mst->atime=time();[37m[39;49;00m
    85	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mst;[37m[39;49;00m
    86	}[37m[39;49;00m
    87	[37m[39;49;00m
    88	[37m//! @seealso[39;49;00m
    89	[37m//!   @[Stdio.File()->line_iterator()][39;49;00m
    90	String.SplitIterator[37m [39;49;00mline_iterator([36mint[39;49;00m|[36mvoid[39;49;00m[37m [39;49;00mtrim)[37m [39;49;00m{[37m[39;49;00m
    91	[37m  [39;49;00m[34mif[39;49;00m(trim)[37m[39;49;00m
    92	[37m    [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mString.SplitIterator([37m [39;49;00mdata-[33m"[39;49;00m[33m\r[39;49;00m[33m"[39;49;00m,[37m [39;49;00m[33m'[39;49;00m[33m\n[39;49;00m[33m'[39;49;00m[37m [39;49;00m);[37m[39;49;00m
    93	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mString.SplitIterator([37m [39;49;00mdata,[37m [39;49;00m[33m'[39;49;00m[33m\n[39;49;00m[33m'[39;49;00m[37m [39;49;00m);[37m[39;49;00m
    94	}[37m[39;49;00m
    95	[37m[39;49;00m
    96	[34mprotected[39;49;00m[37m [39;49;00m[36mmixed[39;49;00m[37m [39;49;00mid;[37m[39;49;00m
    97	[37m[39;49;00m
    98	[37m//! @seealso[39;49;00m
    99	[37m//!   @[Stdio.File()->query_id()][39;49;00m
   100	[36mmixed[39;49;00m[37m [39;49;00m[32mquery_id[39;49;00m()[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mid;[37m [39;49;00m}[37m[39;49;00m
   101	[37m[39;49;00m
   102	[37m//! @seealso[39;49;00m
   103	[37m//!   @[Stdio.File()->set_id()][39;49;00m
   104	[36mvoid[39;49;00m[37m [39;49;00m[32mset_id[39;49;00m([36mmixed[39;49;00m[37m [39;49;00m_id)[37m [39;49;00m{[37m [39;49;00mid[37m [39;49;00m=[37m [39;49;00m_id;[37m [39;49;00m}[37m[39;49;00m
   105	[37m[39;49;00m
   106	[37m//! @seealso[39;49;00m
   107	[37m//!   @[Stdio.File()->read_function()][39;49;00m
   108	[36mfunction[39;49;00m(:[36mstring[39;49;00m)[37m [39;49;00mread_function([36mint[39;49;00m[37m [39;49;00mnbytes)[37m [39;49;00m{[37m[39;49;00m
   109	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[36mlambda[39;49;00m()[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mread(nbytes);[37m [39;49;00m};[37m[39;49;00m
   110	}[37m[39;49;00m
   111	[37m[39;49;00m
   112	[37m//! @seealso[39;49;00m
   113	[37m//!   @[Stdio.File()->peek()][39;49;00m
   114	[36mint[39;49;00m(-[34m1.[39;49;00m[34m.1[39;49;00m)[37m [39;49;00mpeek([36mint[39;49;00m|[36mfloat[39;49;00m|[36mvoid[39;49;00m[37m [39;49;00mtimeout)[37m [39;49;00m{[37m[39;49;00m
   115	[37m  [39;49;00m[34mif[39;49;00m(!r)[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m-[34m1[39;49;00m;[37m[39;49;00m
   116	[37m  [39;49;00m[34mif[39;49;00m(ptr[37m [39;49;00m>=[37m [39;49;00m[34msizeof[39;49;00m(data))[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
   117	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34m1[39;49;00m;[37m[39;49;00m
   118	}[37m[39;49;00m
   119	[37m[39;49;00m
   120	[37m//! Always returns 0.[39;49;00m
   121	[37m//! @seealso[39;49;00m
   122	[37m//!   @[Stdio.File()->query_address()][39;49;00m
   123	[36mstring[39;49;00m[37m [39;49;00mquery_address([36mvoid[39;49;00m|[36mint[39;49;00m([34m0.[39;49;00m[34m.1[39;49;00m)[37m [39;49;00mis_local)[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34m0[39;49;00m;[37m [39;49;00m}[37m[39;49;00m
   124	[37m[39;49;00m
   125	[37m//! @seealso[39;49;00m
   126	[37m//!   @[Stdio.File()->read()][39;49;00m
   127	[36mstring[39;49;00m[37m [39;49;00mread([36mvoid[39;49;00m|[36mint[39;49;00m([34m0.[39;49;00m.)[37m [39;49;00mlen,[37m [39;49;00m[36mvoid[39;49;00m|[36mint[39;49;00m([34m0.[39;49;00m[34m.1[39;49;00m)[37m [39;49;00mnot_all)[37m [39;49;00m{[37m[39;49;00m
   128	[37m  [39;49;00m[34mif[39;49;00m(!r)[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
   129	[37m  [39;49;00m[34mif[39;49;00m[37m [39;49;00m(len[37m [39;49;00m<[37m [39;49;00m[34m0[39;49;00m)[37m [39;49;00merror([33m"[39;49;00m[33mCannot read negative number of characters.[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m);[37m[39;49;00m
   130	[37m  [39;49;00m[36mint[39;49;00m[37m [39;49;00mstart=ptr;[37m[39;49;00m
   131	[37m  [39;49;00mptr[37m [39;49;00m+=[37m [39;49;00mlen;[37m[39;49;00m
   132	[37m  [39;49;00m[34mif[39;49;00m(zero_type(len)[37m [39;49;00m||[37m [39;49;00mptr>[34msizeof[39;49;00m(data))[37m[39;49;00m
   133	[37m    [39;49;00mptr[37m [39;49;00m=[37m [39;49;00m[34msizeof[39;49;00m(data);[37m[39;49;00m
   134	[37m[39;49;00m
   135	[37m  [39;49;00m[37m// FIXME: read callback[39;49;00m
   136	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mdata[start..ptr-[34m1[39;49;00m];[37m[39;49;00m
   137	}[37m[39;49;00m
   138	[37m[39;49;00m
   139	[37m//! @seealso[39;49;00m
   140	[37m//!   @[Stdio.FILE()->gets()][39;49;00m
   141	[36mstring[39;49;00m[37m [39;49;00mgets()[37m [39;49;00m{[37m[39;49;00m
   142	[37m  [39;49;00m[34mif[39;49;00m(!r)[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
   143	[37m  [39;49;00m[36mstring[39;49;00m[37m [39;49;00mret;[37m[39;49;00m
   144	[37m  [39;49;00m[34msscanf[39;49;00m(data,[33m"[39;49;00m[33m%*[39;49;00m[33m"[39;49;00m+([36mstring[39;49;00m)ptr+[33m"[39;49;00m[33ms%[^[39;49;00m[33m\n[39;49;00m[33m][39;49;00m[33m"[39;49;00m,ret);[37m[39;49;00m
   145	[37m  [39;49;00m[34mif[39;49;00m(ret)[37m[39;49;00m
   146	[37m  [39;49;00m{[37m[39;49;00m
   147	[37m    [39;49;00mptr+=[34msizeof[39;49;00m(ret)+[34m1[39;49;00m;[37m[39;49;00m
   148	[37m    [39;49;00m[34mif[39;49;00m(ptr>[34msizeof[39;49;00m(data))[37m[39;49;00m
   149	[37m    [39;49;00m{[37m[39;49;00m
   150	[37m      [39;49;00mptr=[34msizeof[39;49;00m(data);[37m[39;49;00m
   151	[37m      [39;49;00m[34mif[39;49;00m(![34msizeof[39;49;00m(ret))[37m[39;49;00m
   152	[37m	[39;49;00mret[37m [39;49;00m=[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
   153	[37m    [39;49;00m}[37m[39;49;00m
   154	[37m  [39;49;00m}[37m[39;49;00m
   155	[37m[39;49;00m
   156	[37m  [39;49;00m[37m// FIXME: read callback[39;49;00m
   157	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mret;[37m[39;49;00m
   158	}[37m[39;49;00m
   159	[37m[39;49;00m
   160	[37m//! @seealso[39;49;00m
   161	[37m//!   @[Stdio.FILE()->getchar()][39;49;00m
   162	[36mint[39;49;00m[37m [39;49;00mgetchar()[37m [39;49;00m{[37m[39;49;00m
   163	[37m  [39;49;00m[34mif[39;49;00m(!r)[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
   164	[37m  [39;49;00m[36mint[39;49;00m[37m [39;49;00mc;[37m[39;49;00m
   165	[37m  [39;49;00m[34mif[39;49;00m([34mcatch[39;49;00m(c=data[ptr]))[37m[39;49;00m
   166	[37m    [39;49;00mc=-[34m1[39;49;00m;[37m[39;49;00m
   167	[37m  [39;49;00m[34melse[39;49;00m[37m[39;49;00m
   168	[37m    [39;49;00mptr++;[37m[39;49;00m
   169	[37m[39;49;00m
   170	[37m  [39;49;00m[37m// FIXME: read callback[39;49;00m
   171	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mc;[37m[39;49;00m
   172	}[37m[39;49;00m
   173	[37m[39;49;00m
   174	[37m//! @seealso[39;49;00m
   175	[37m//!   @[Stdio.FILE()->unread()][39;49;00m
   176	[36mvoid[39;49;00m[37m [39;49;00munread([36mstring[39;49;00m[37m [39;49;00ms)[37m [39;49;00m{[37m[39;49;00m
   177	[37m  [39;49;00m[34mif[39;49;00m(!r)[37m [39;49;00m[34mreturn[39;49;00m;[37m[39;49;00m
   178	[37m  [39;49;00m[34mif[39;49;00m(data[ptr-[34msizeof[39;49;00m(s)..ptr-[34m1[39;49;00m]==s)[37m[39;49;00m
   179	[37m    [39;49;00mptr-=[34msizeof[39;49;00m(s);[37m[39;49;00m
   180	[37m  [39;49;00m[34melse[39;49;00m[37m[39;49;00m
   181	[37m  [39;49;00m{[37m[39;49;00m
   182	[37m    [39;49;00mdata=s+data[ptr..];[37m[39;49;00m
   183	[37m    [39;49;00mptr=[34m0[39;49;00m;[37m[39;49;00m
   184	[37m  [39;49;00m}[37m[39;49;00m
   185	}[37m[39;49;00m
   186	[37m[39;49;00m
   187	[37m//! @seealso[39;49;00m
   188	[37m//!   @[Stdio.File()->seek()][39;49;00m
   189	[36mint[39;49;00m[37m [39;49;00mseek([36mint[39;49;00m[37m [39;49;00mpos,[37m [39;49;00m[36mvoid[39;49;00m|[36mint[39;49;00m[37m [39;49;00mmult,[37m [39;49;00m[36mvoid[39;49;00m|[36mint[39;49;00m[37m [39;49;00madd)[37m [39;49;00m{[37m[39;49;00m
   190	[37m  [39;49;00m[34mif[39;49;00m(mult)[37m[39;49;00m
   191	[37m    [39;49;00mpos[37m [39;49;00m=[37m [39;49;00mpos*mult+add;[37m[39;49;00m
   192	[37m  [39;49;00m[34mif[39;49;00m(pos<[34m0[39;49;00m)[37m[39;49;00m
   193	[37m  [39;49;00m{[37m[39;49;00m
   194	[37m    [39;49;00mpos[37m [39;49;00m=[37m [39;49;00m[34msizeof[39;49;00m(data)+pos;[37m[39;49;00m
   195	[37m    [39;49;00m[34mif[39;49;00m([37m [39;49;00mpos[37m [39;49;00m<[37m [39;49;00m[34m0[39;49;00m[37m [39;49;00m)[37m[39;49;00m
   196	[37m	[39;49;00mpos[37m [39;49;00m=[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
   197	[37m  [39;49;00m}[37m[39;49;00m
   198	[37m  [39;49;00mptr[37m [39;49;00m=[37m [39;49;00mpos;[37m[39;49;00m
   199	[37m  [39;49;00m[34mif[39;49;00m([37m [39;49;00mptr[37m [39;49;00m>[37m [39;49;00mstrlen([37m [39;49;00mdata[37m [39;49;00m)[37m [39;49;00m)[37m[39;49;00m
   200	[37m      [39;49;00mptr[37m [39;49;00m=[37m [39;49;00mstrlen(data);[37m[39;49;00m
   201	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mptr;[37m[39;49;00m
   202	}[37m[39;49;00m
   203	[37m[39;49;00m
   204	[37m//! Always returns 1.[39;49;00m
   205	[37m//! @seealso[39;49;00m
   206	[37m//!   @[Stdio.File()->sync()][39;49;00m
   207	[36mint[39;49;00m([34m1.[39;49;00m[34m.1[39;49;00m)[37m [39;49;00msync()[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34m1[39;49;00m;[37m [39;49;00m}[37m[39;49;00m
   208	[37m[39;49;00m
   209	[37m//! @seealso[39;49;00m
   210	[37m//!   @[Stdio.File()->tell()][39;49;00m
   211	[36mint[39;49;00m[37m [39;49;00mtell()[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mptr;[37m [39;49;00m}[37m[39;49;00m
   212	[37m[39;49;00m
   213	[37m//! @seealso[39;49;00m
   214	[37m//!   @[Stdio.File()->truncate()][39;49;00m
   215	[36mint[39;49;00m([34m0.[39;49;00m[34m.1[39;49;00m)[37m [39;49;00mtruncate([36mint[39;49;00m[37m [39;49;00mlength)[37m [39;49;00m{[37m[39;49;00m
   216	[37m  [39;49;00mdata[37m [39;49;00m=[37m [39;49;00mdata[..length-[34m1[39;49;00m];[37m[39;49;00m
   217	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34msizeof[39;49;00m(data)==length;[37m[39;49;00m
   218	}[37m[39;49;00m
   219	[37m[39;49;00m
   220	[37m//! @seealso[39;49;00m
   221	[37m//!   @[Stdio.File()->write()][39;49;00m
   222	[36mint[39;49;00m(-[34m1.[39;49;00m.)[37m [39;49;00mwrite([36mstring[39;49;00m|[36marray[39;49;00m([36mstring[39;49;00m)[37m [39;49;00mstr,[37m [39;49;00m[36mmixed[39;49;00m[37m [39;49;00m...[37m [39;49;00mextra)[37m [39;49;00m{[37m[39;49;00m
   223	[37m  [39;49;00m[34mif[39;49;00m(!w)[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m-[34m1[39;49;00m;[37m[39;49;00m
   224	[37m  [39;49;00m[34mif[39;49;00m(arrayp(str))[37m [39;49;00mstr=str*[33m"[39;49;00m[33m"[39;49;00m;[37m[39;49;00m
   225	[37m  [39;49;00m[34mif[39;49;00m([34msizeof[39;49;00m(extra))[37m [39;49;00mstr=sprintf(str,[37m [39;49;00m@extra);[37m[39;49;00m
   226	[37m[39;49;00m
   227	[37m  [39;49;00m[34mif[39;49;00m(ptr==[34msizeof[39;49;00m(data))[37m [39;49;00m{[37m[39;49;00m
   228	[37m    [39;49;00mdata[37m [39;49;00m+=[37m [39;49;00mstr;[37m[39;49;00m
   229	[37m    [39;49;00mptr[37m [39;49;00m=[37m [39;49;00m[34msizeof[39;49;00m(data);[37m[39;49;00m
   230	[37m  [39;49;00m}[37m[39;49;00m
   231	[37m  [39;49;00m[34melse[39;49;00m[37m [39;49;00m[34mif[39;49;00m([34msizeof[39;49;00m(str)==[34m1[39;49;00m)[37m[39;49;00m
   232	[37m    [39;49;00mdata[ptr++][37m [39;49;00m=[37m [39;49;00mstr[[34m0[39;49;00m];[37m[39;49;00m
   233	[37m  [39;49;00m[34melse[39;49;00m[37m [39;49;00m{[37m[39;49;00m
   234	[37m    [39;49;00mdata[37m [39;49;00m=[37m [39;49;00mdata[..ptr-[34m1[39;49;00m][37m [39;49;00m+[37m [39;49;00mstr[37m [39;49;00m+[37m [39;49;00mdata[ptr+[34msizeof[39;49;00m(str)..];[37m[39;49;00m
   235	[37m    [39;49;00mptr[37m [39;49;00m+=[37m [39;49;00m[34msizeof[39;49;00m(str);[37m[39;49;00m
   236	[37m  [39;49;00m}[37m[39;49;00m
   237	[37m[39;49;00m
   238	[37m  [39;49;00m[37m// FIXME: write callback[39;49;00m
   239	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34msizeof[39;49;00m(str);[37m[39;49;00m
   240	}[37m[39;49;00m
   241	[37m[39;49;00m
   242	[37m//! @seealso[39;49;00m
   243	[37m//!   @[Stdio.File()->set_blocking][39;49;00m
   244	[36mvoid[39;49;00m[37m [39;49;00mset_blocking()[37m [39;49;00m{[37m[39;49;00m
   245	[37m  [39;49;00mclose_cb[37m [39;49;00m=[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
   246	[37m  [39;49;00mread_cb[37m [39;49;00m=[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
   247	[37m  [39;49;00mread_oob_cb[37m [39;49;00m=[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
   248	[37m  [39;49;00mwrite_cb[37m [39;49;00m=[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
   249	[37m  [39;49;00mwrite_oob_cb[37m [39;49;00m=[37m [39;49;00m[34m0[39;49;00m;[37m[39;49;00m
   250	}[37m[39;49;00m
   251	[37m[39;49;00m
   252	[37m//! @seealso[39;49;00m
   253	[37m//!   @[Stdio.File()->set_blocking_keep_callbacks][39;49;00m
   254	[36mvoid[39;49;00m[37m [39;49;00mset_blocking_keep_callbacks()[37m [39;49;00m{[37m [39;49;00m}[37m[39;49;00m
   255	[37m[39;49;00m
   256	[37m//! @seealso[39;49;00m
   257	[37m//!   @[Stdio.File()->set_blocking][39;49;00m
   258	[36mvoid[39;49;00m[37m [39;49;00mset_nonblocking([36mfunction[39;49;00m[37m [39;49;00mrcb,[37m [39;49;00m[36mfunction[39;49;00m[37m [39;49;00mwcb,[37m [39;49;00m[36mfunction[39;49;00m[37m [39;49;00mccb,[37m[39;49;00m
   259	[37m		     [39;49;00m[36mfunction[39;49;00m[37m [39;49;00mrocb,[37m [39;49;00m[36mfunction[39;49;00m[37m [39;49;00mwocb)[37m [39;49;00m{[37m[39;49;00m
   260	[37m  [39;49;00mread_cb[37m [39;49;00m=[37m [39;49;00mrcb;[37m[39;49;00m
   261	[37m  [39;49;00mwrite_cb[37m [39;49;00m=[37m [39;49;00mwcb;[37m[39;49;00m
   262	[37m  [39;49;00mclose_cb[37m [39;49;00m=[37m [39;49;00mccb;[37m[39;49;00m
   263	[37m  [39;49;00mread_oob_cb[37m [39;49;00m=[37m [39;49;00mrocb;[37m[39;49;00m
   264	[37m  [39;49;00mwrite_oob_cb[37m [39;49;00m=[37m [39;49;00mwocb;[37m[39;49;00m
   265	}[37m[39;49;00m
   266	[37m[39;49;00m
   267	[37m//! @seealso[39;49;00m
   268	[37m//!   @[Stdio.File()->set_blocking_keep_callbacks][39;49;00m
   269	[36mvoid[39;49;00m[37m [39;49;00mset_nonblocking_keep_callbacks()[37m [39;49;00m{[37m [39;49;00m}[37m[39;49;00m
   270	[37m[39;49;00m
   271	[37m[39;49;00m
   272	[37m//! @seealso[39;49;00m
   273	[37m//!   @[Stdio.File()->set_close_callback][39;49;00m
   274	[36mvoid[39;49;00m[37m [39;49;00mset_close_callback([36mfunction[39;49;00m[37m [39;49;00mcb)[37m [39;49;00m{[37m [39;49;00mclose_cb[37m [39;49;00m=[37m [39;49;00mcb;[37m [39;49;00m}[37m[39;49;00m
   275	[37m[39;49;00m
   276	[37m//! @seealso[39;49;00m
   277	[37m//!   @[Stdio.File()->set_read_callback][39;49;00m
   278	[36mvoid[39;49;00m[37m [39;49;00mset_read_callback([36mfunction[39;49;00m[37m [39;49;00mcb)[37m [39;49;00m{[37m [39;49;00mread_cb[37m [39;49;00m=[37m [39;49;00mcb;[37m [39;49;00m}[37m[39;49;00m
   279	[37m[39;49;00m
   280	[37m//! @seealso[39;49;00m
   281	[37m//!   @[Stdio.File()->set_read_oob_callback][39;49;00m
   282	[36mvoid[39;49;00m[37m [39;49;00mset_read_oob_callback([36mfunction[39;49;00m[37m [39;49;00mcb)[37m [39;49;00m{[37m [39;49;00mread_oob_cb[37m [39;49;00m=[37m [39;49;00mcb;[37m [39;49;00m}[37m[39;49;00m
   283	[37m[39;49;00m
   284	[37m//! @seealso[39;49;00m
   285	[37m//!   @[Stdio.File()->set_write_callback][39;49;00m
   286	[36mvoid[39;49;00m[37m [39;49;00mset_write_callback([36mfunction[39;49;00m[37m [39;49;00mcb)[37m [39;49;00m{[37m [39;49;00mwrite_cb[37m [39;49;00m=[37m [39;49;00mcb;[37m [39;49;00m}[37m[39;49;00m
   287	[37m[39;49;00m
   288	[37m//! @seealso[39;49;00m
   289	[37m//!   @[Stdio.File()->set_write_oob_callback][39;49;00m
   290	[36mvoid[39;49;00m[37m [39;49;00mset_write_oob_callback([36mfunction[39;49;00m[37m [39;49;00mcb)[37m [39;49;00m{[37m [39;49;00mwrite_oob_cb[37m [39;49;00m=[37m [39;49;00mcb;[37m [39;49;00m}[37m[39;49;00m
   291	[37m[39;49;00m
   292	[37m[39;49;00m
   293	[37m//! @seealso[39;49;00m
   294	[37m//!   @[Stdio.File()->query_close_callback][39;49;00m
   295	[36mfunction[39;49;00m[37m [39;49;00mquery_close_callback()[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mclose_cb;[37m [39;49;00m}[37m[39;49;00m
   296	[37m[39;49;00m
   297	[37m//! @seealso[39;49;00m
   298	[37m//!   @[Stdio.File()->query_read_callback][39;49;00m
   299	[36mfunction[39;49;00m[37m [39;49;00mquery_read_callback()[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mread_cb;[37m [39;49;00m}[37m[39;49;00m
   300	[37m[39;49;00m
   301	[37m//! @seealso[39;49;00m
   302	[37m//!   @[Stdio.File()->query_read_oob_callback][39;49;00m
   303	[36mfunction[39;49;00m[37m [39;49;00mquery_read_oob_callback()[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mread_oob_cb;[37m [39;49;00m}[37m[39;49;00m
   304	[37m[39;49;00m
   305	[37m//! @seealso[39;49;00m
   306	[37m//!   @[Stdio.File()->query_write_callback][39;49;00m
   307	[36mfunction[39;49;00m[37m [39;49;00mquery_write_callback()[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mwrite_cb;[37m [39;49;00m}[37m[39;49;00m
   308	[37m[39;49;00m
   309	[37m//! @seealso[39;49;00m
   310	[37m//!   @[Stdio.File()->query_write_oob_callback][39;49;00m
   311	[36mfunction[39;49;00m[37m [39;49;00mquery_write_oob_callback()[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mwrite_oob_cb;[37m [39;49;00m}[37m[39;49;00m
   312	[37m[39;49;00m
   313	[36mstring[39;49;00m[37m [39;49;00m_sprintf([36mint[39;49;00m[37m [39;49;00mt)[37m [39;49;00m{[37m[39;49;00m
   314	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mt==[33m'[39;49;00m[33mO[39;49;00m[33m'[39;49;00m[37m [39;49;00m&&[37m [39;49;00msprintf([33m"[39;49;00m[33m%O(%d,%O)[39;49;00m[33m"[39;49;00m,[37m [39;49;00mthis_program,[37m [39;49;00m[34msizeof[39;49;00m(data),[37m[39;49;00m
   315	[37m			   [39;49;00mmake_type_str());[37m[39;49;00m
   316	}[37m[39;49;00m
   317	[37m[39;49;00m
   318	[37m[39;49;00m
   319	[37m// FakeFile specials.[39;49;00m
   320	[37m[39;49;00m
   321	[37m//! A FakeFile can be casted to a string.[39;49;00m
   322	[36mmixed[39;49;00m[37m [39;49;00mcast([36mstring[39;49;00m[37m [39;49;00mto)[37m [39;49;00m{[37m[39;49;00m
   323	[37m  [39;49;00m[34mswitch[39;49;00m(to)[37m [39;49;00m{[37m[39;49;00m
   324	[37m  [39;49;00m[34mcase[39;49;00m[37m [39;49;00m[33m"[39;49;00m[33mstring[39;49;00m[33m"[39;49;00m:[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00mdata;[37m[39;49;00m
   325	[37m  [39;49;00m[34mcase[39;49;00m[37m [39;49;00m[33m"[39;49;00m[33mobject[39;49;00m[33m"[39;49;00m:[37m [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34mthis[39;49;00m;[37m[39;49;00m
   326	[37m  [39;49;00m}[37m[39;49;00m
   327	[37m  [39;49;00merror([33m"[39;49;00m[33mCan not cast object to %O.[39;49;00m[33m\n[39;49;00m[33m"[39;49;00m,[37m [39;49;00mto);[37m[39;49;00m
   328	}[37m[39;49;00m
   329	[37m[39;49;00m
   330	[37m//! Sizeof on a FakeFile returns the size of its contents.[39;49;00m
   331	[36mint[39;49;00m([34m0.[39;49;00m.)[37m [39;49;00m_sizeof()[37m [39;49;00m{[37m[39;49;00m
   332	[37m  [39;49;00m[34mreturn[39;49;00m[37m [39;49;00m[34msizeof[39;49;00m(data);[37m[39;49;00m
   333	}[37m[39;49;00m
   334	[37m[39;49;00m
   335	[37m//! @ignore[39;49;00m
   336	[37m[39;49;00m
   337	[36m#[39;49;00m[36mdefine NOPE(X) mixed X (mixed ... args) { error("This is a FakeFile. %s is not available.\n", #X); }[39;49;00m[36m[39;49;00m
   338	NOPE(assign);[37m[39;49;00m
   339	NOPE(async_connect);[37m[39;49;00m
   340	NOPE(connect);[37m[39;49;00m
   341	NOPE(connect_unix);[37m[39;49;00m
   342	NOPE(open);[37m[39;49;00m
   343	NOPE(open_socket);[37m[39;49;00m
   344	NOPE(pipe);[37m[39;49;00m
   345	NOPE(tcgetattr);[37m[39;49;00m
   346	NOPE(tcsetattr);[37m[39;49;00m
   347	[37m[39;49;00m
   348	[37m// Stdio.Fd[39;49;00m
   349	NOPE(dup2);[37m[39;49;00m
   350	NOPE(lock);[37m [39;49;00m[37m// We could implement this[39;49;00m
   351	NOPE(mode);[37m [39;49;00m[37m// We could implement this[39;49;00m
   352	NOPE(proxy);[37m [39;49;00m[37m// We could implement this[39;49;00m
   353	NOPE(query_fd);[37m[39;49;00m
   354	NOPE(read_oob);[37m[39;49;00m
   355	NOPE(set_close_on_exec);[37m[39;49;00m
   356	NOPE(set_keepalive);[37m[39;49;00m
   357	NOPE(trylock);[37m [39;49;00m[37m// We could implement this[39;49;00m
   358	NOPE(write_oob);[37m[39;49;00m
   359	[37m[39;49;00m
   360	//![37m [39;49;00m@endignore
