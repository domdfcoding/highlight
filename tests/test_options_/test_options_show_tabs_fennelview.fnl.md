[37m;; A pretty-printer that outputs tables in Fennel syntax.[39;49;00m[37m[39;49;00m
[37m;; Loosely based on inspect.lua: http://github.com/kikito/inspect.lua[39;49;00m[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mview-quote[39;49;00m[37m [39;49;00m[[31mstr[39;49;00m][37m [39;49;00m([34m.. [39;49;00m[33m"\""[39;49;00m[37m [39;49;00m([34m: [39;49;00m[31mstr[39;49;00m[37m [39;49;00m[33m:gsub[39;49;00m[37m [39;49;00m[33m"\""[39;49;00m[37m [39;49;00m[33m"\\\""[39;49;00m)[37m [39;49;00m[33m"\""[39;49;00m))[37m[39;49;00m
[37m[39;49;00m
([34mlocal [39;49;00m[31mshort-control-char-escapes[39;49;00m[37m[39;49;00m
[37m       [39;49;00m{[33m"\a"[39;49;00m[37m [39;49;00m[33m"\\a"[39;49;00m[37m [39;49;00m[33m"\b"[39;49;00m[37m [39;49;00m[33m"\\b"[39;49;00m[37m [39;49;00m[33m"\f"[39;49;00m[37m [39;49;00m[33m"\\f"[39;49;00m[37m [39;49;00m[33m"\n"[39;49;00m[37m [39;49;00m[33m"\\n"[39;49;00m[37m[39;49;00m
[37m        [39;49;00m[33m"\r"[39;49;00m[37m [39;49;00m[33m"\\r"[39;49;00m[37m [39;49;00m[33m"\t"[39;49;00m[37m [39;49;00m[33m"\\t"[39;49;00m[37m [39;49;00m[33m"\v"[39;49;00m[37m [39;49;00m[33m"\\v"[39;49;00m})[37m[39;49;00m
[37m[39;49;00m
([34mlocal [39;49;00m[31mlong-control-char-escapes[39;49;00m[37m[39;49;00m
[37m       [39;49;00m([34mlet [39;49;00m[[31mlong[39;49;00m[37m [39;49;00m{}][37m[39;49;00m
[37m         [39;49;00m([34mfor [39;49;00m[[31mi[39;49;00m[37m [39;49;00m[34m0[39;49;00m[37m [39;49;00m[34m31[39;49;00m][37m[39;49;00m
[37m           [39;49;00m([34mlet [39;49;00m[[31mch[39;49;00m[37m [39;49;00m([31mstring.char[39;49;00m[37m [39;49;00m[31mi[39;49;00m)][37m[39;49;00m
[37m             [39;49;00m([34mwhen [39;49;00m([34mnot [39;49;00m([34m. [39;49;00m[31mshort-control-char-escapes[39;49;00m[37m [39;49;00m[31mch[39;49;00m))[37m[39;49;00m
[37m               [39;49;00m([34mtset [39;49;00m[31mshort-control-char-escapes[39;49;00m[37m [39;49;00m[31mch[39;49;00m[37m [39;49;00m([34m.. [39;49;00m[33m"\\"[39;49;00m[37m [39;49;00m[31mi[39;49;00m))[37m[39;49;00m
[37m               [39;49;00m([34mtset [39;49;00m[31mlong[39;49;00m[37m [39;49;00m[31mch[39;49;00m[37m [39;49;00m([34m: [39;49;00m[33m"\\%03d"[39;49;00m[37m [39;49;00m[33m:format[39;49;00m[37m [39;49;00m[31mi[39;49;00m)))))[37m[39;49;00m
[37m         [39;49;00m[31mlong[39;49;00m))[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mescape[39;49;00m[37m [39;49;00m[[31mstr[39;49;00m][37m[39;49;00m
[37m  [39;49;00m([34m-> [39;49;00m[31mstr[39;49;00m[37m[39;49;00m
[37m      [39;49;00m([34m: [39;49;00m[33m:gsub[39;49;00m[37m [39;49;00m[33m"\\"[39;49;00m[37m [39;49;00m[33m"\\\\"[39;49;00m)[37m[39;49;00m
[37m      [39;49;00m([34m: [39;49;00m[33m:gsub[39;49;00m[37m [39;49;00m[33m"(%c)%f[0-9]"[39;49;00m[37m [39;49;00m[31mlong-control-char-escapes[39;49;00m)[37m[39;49;00m
[37m      [39;49;00m([34m: [39;49;00m[33m:gsub[39;49;00m[37m [39;49;00m[33m"%c"[39;49;00m[37m [39;49;00m[31mshort-control-char-escapes[39;49;00m)))[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31msequence-key?[39;49;00m[37m [39;49;00m[[31mk[39;49;00m[37m [39;49;00m[31mlen[39;49;00m][37m[39;49;00m
[37m  [39;49;00m([34mand [39;49;00m([34m= [39;49;00m([36mtype [39;49;00m[31mk[39;49;00m)[37m [39;49;00m[33m"number"[39;49;00m)[37m[39;49;00m
[37m       [39;49;00m([34m<= [39;49;00m[34m1[39;49;00m[37m [39;49;00m[31mk[39;49;00m)[37m[39;49;00m
[37m       [39;49;00m([34m<= [39;49;00m[31mk[39;49;00m[37m [39;49;00m[31mlen[39;49;00m)[37m[39;49;00m
[37m       [39;49;00m([34m= [39;49;00m([31mmath.floor[39;49;00m[37m [39;49;00m[31mk[39;49;00m)[37m [39;49;00m[31mk[39;49;00m)))[37m[39;49;00m
[37m[39;49;00m
([34mlocal [39;49;00m[31mtype-order[39;49;00m[37m [39;49;00m{[33m:number[39;49;00m[37m [39;49;00m[34m1[39;49;00m[37m [39;49;00m[33m:boolean[39;49;00m[37m [39;49;00m[34m2[39;49;00m[37m [39;49;00m[33m:string[39;49;00m[37m [39;49;00m[34m3[39;49;00m[37m [39;49;00m[33m:table[39;49;00m[37m [39;49;00m[34m4[39;49;00m[37m[39;49;00m
[37m                   [39;49;00m[33m:function[39;49;00m[37m [39;49;00m[34m5[39;49;00m[37m [39;49;00m[33m:userdata[39;49;00m[37m [39;49;00m[34m6[39;49;00m[37m [39;49;00m[33m:thread[39;49;00m[37m [39;49;00m[34m7[39;49;00m})[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31msort-keys[39;49;00m[37m [39;49;00m[[31ma[39;49;00m[37m [39;49;00m[31mb[39;49;00m][37m[39;49;00m
[37m  [39;49;00m([34mlet [39;49;00m[[31mta[39;49;00m[37m [39;49;00m([36mtype [39;49;00m[31ma[39;49;00m)[37m [39;49;00m[31mtb[39;49;00m[37m [39;49;00m([36mtype [39;49;00m[31mb[39;49;00m)][37m[39;49;00m
[37m    [39;49;00m([34mif [39;49;00m([34mand [39;49;00m([34m= [39;49;00m[31mta[39;49;00m[37m [39;49;00m[31mtb[39;49;00m)[37m[39;49;00m
[37m             [39;49;00m([34mor [39;49;00m([34m= [39;49;00m[31mta[39;49;00m[37m [39;49;00m[33m"string"[39;49;00m)[37m [39;49;00m([34m= [39;49;00m[31mta[39;49;00m[37m [39;49;00m[33m"number"[39;49;00m)))[37m[39;49;00m
[37m        [39;49;00m([34m< [39;49;00m[31ma[39;49;00m[37m [39;49;00m[31mb[39;49;00m)[37m[39;49;00m
[37m        [39;49;00m([34mlet [39;49;00m[[31mdta[39;49;00m[37m [39;49;00m([34m. [39;49;00m[31mtype-order[39;49;00m[37m [39;49;00m[31ma[39;49;00m)[37m[39;49;00m
[37m              [39;49;00m[31mdtb[39;49;00m[37m [39;49;00m([34m. [39;49;00m[31mtype-order[39;49;00m[37m [39;49;00m[31mb[39;49;00m)][37m[39;49;00m
[37m          [39;49;00m([34mif [39;49;00m([34mand [39;49;00m[31mdta[39;49;00m[37m [39;49;00m[31mdtb[39;49;00m)[37m[39;49;00m
[37m              [39;49;00m([34m< [39;49;00m[31mdta[39;49;00m[37m [39;49;00m[31mdtb[39;49;00m)[37m[39;49;00m
[37m              [39;49;00m[31mdta[39;49;00m[37m [39;49;00m[31mtrue[39;49;00m[37m[39;49;00m
[37m              [39;49;00m[31mdtb[39;49;00m[37m [39;49;00m[31mfalse[39;49;00m[37m[39;49;00m
[37m              [39;49;00m[33m:else[39;49;00m[37m [39;49;00m([34m< [39;49;00m[31mta[39;49;00m[37m [39;49;00m[31mtb[39;49;00m))))))[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mget-sequence-length[39;49;00m[37m [39;49;00m[[31mt[39;49;00m][37m[39;49;00m
[37m  [39;49;00m([34mvar [39;49;00m[31mlen[39;49;00m[37m [39;49;00m[34m1[39;49;00m)[37m[39;49;00m
[37m  [39;49;00m([34meach [39;49;00m[[31mi[39;49;00m[37m [39;49;00m([36mipairs [39;49;00m[31mt[39;49;00m)][37m [39;49;00m([34mset [39;49;00m[31mlen[39;49;00m[37m [39;49;00m[31mi[39;49;00m))[37m[39;49;00m
[37m  [39;49;00m[31mlen[39;49;00m)[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mget-nonsequential-keys[39;49;00m[37m [39;49;00m[[31mt[39;49;00m][37m[39;49;00m
[37m  [39;49;00m([34mlet [39;49;00m[[31mkeys[39;49;00m[37m [39;49;00m{}[37m[39;49;00m
[37m        [39;49;00m[31msequence-length[39;49;00m[37m [39;49;00m([31mget-sequence-length[39;49;00m[37m [39;49;00m[31mt[39;49;00m)][37m[39;49;00m
[37m    [39;49;00m([34meach [39;49;00m[[31mk[39;49;00m[37m [39;49;00m([36mpairs [39;49;00m[31mt[39;49;00m)][37m[39;49;00m
[37m      [39;49;00m([34mwhen [39;49;00m([34mnot [39;49;00m([31msequence-key?[39;49;00m[37m [39;49;00m[31mk[39;49;00m[37m [39;49;00m[31msequence-length[39;49;00m))[37m[39;49;00m
[37m        [39;49;00m([31mtable.insert[39;49;00m[37m [39;49;00m[31mkeys[39;49;00m[37m [39;49;00m[31mk[39;49;00m)))[37m[39;49;00m
[37m    [39;49;00m([31mtable.sort[39;49;00m[37m [39;49;00m[31mkeys[39;49;00m[37m [39;49;00m[31msort-keys[39;49;00m)[37m[39;49;00m
[37m    [39;49;00m([34mvalues [39;49;00m[31mkeys[39;49;00m[37m [39;49;00m[31msequence-length[39;49;00m)))[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mcount-table-appearances[39;49;00m[37m [39;49;00m[[31mt[39;49;00m[37m [39;49;00m[31mappearances[39;49;00m][37m[39;49;00m
[37m  [39;49;00m([34mwhen [39;49;00m([34m= [39;49;00m([36mtype [39;49;00m[31mt[39;49;00m)[37m [39;49;00m[33m"table"[39;49;00m)[37m[39;49;00m
[37m    [39;49;00m([34mif [39;49;00m([34mnot [39;49;00m([34m. [39;49;00m[31mappearances[39;49;00m[37m [39;49;00m[31mt[39;49;00m))[37m[39;49;00m
[37m        [39;49;00m([34mdo [39;49;00m([34mtset [39;49;00m[31mappearances[39;49;00m[37m [39;49;00m[31mt[39;49;00m[37m [39;49;00m[34m1[39;49;00m)[37m[39;49;00m
[37m            [39;49;00m([34meach [39;49;00m[[31mk[39;49;00m[37m [39;49;00m[31mv[39;49;00m[37m [39;49;00m([36mpairs [39;49;00m[31mt[39;49;00m)][37m[39;49;00m
[37m              [39;49;00m([31mcount-table-appearances[39;49;00m[37m [39;49;00m[31mk[39;49;00m[37m [39;49;00m[31mappearances[39;49;00m)[37m[39;49;00m
[37m              [39;49;00m([31mcount-table-appearances[39;49;00m[37m [39;49;00m[31mv[39;49;00m[37m [39;49;00m[31mappearances[39;49;00m)))[37m[39;49;00m
[37m        [39;49;00m([34mtset [39;49;00m[31mappearances[39;49;00m[37m [39;49;00m[31mt[39;49;00m[37m [39;49;00m([34m+ [39;49;00m([34mor [39;49;00m([34m. [39;49;00m[31mappearances[39;49;00m[37m [39;49;00m[31mt[39;49;00m)[37m [39;49;00m[34m0[39;49;00m)[37m [39;49;00m[34m1[39;49;00m))))[37m[39;49;00m
[37m  [39;49;00m[31mappearances[39;49;00m)[37m[39;49;00m
[37m[39;49;00m
[37m[39;49;00m[37m[39;49;00m
[37m[39;49;00m
([34mvar [39;49;00m[31mput-value[39;49;00m[37m [39;49;00m[31mnil[39;49;00m)[37m [39;49;00m[37m; mutual recursion going on; defined below[39;49;00m[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mputs[39;49;00m[37m [39;49;00m[[31mself[39;49;00m[37m [39;49;00m[31m...[39;49;00m][37m[39;49;00m
[37m  [39;49;00m([34meach [39;49;00m[[31m_[39;49;00m[37m [39;49;00m[31mv[39;49;00m[37m [39;49;00m([36mipairs [39;49;00m[[31m...[39;49;00m])][37m[39;49;00m
[37m    [39;49;00m([31mtable.insert[39;49;00m[37m [39;49;00m[31mself.buffer[39;49;00m[37m [39;49;00m[31mv[39;49;00m)))[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mtabify[39;49;00m[37m [39;49;00m[[31mself[39;49;00m][37m [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m"\n"[39;49;00m[37m [39;49;00m([34m: [39;49;00m[31mself.indent[39;49;00m[37m [39;49;00m[33m:rep[39;49;00m[37m [39;49;00m[31mself.level[39;49;00m)))[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31malready-visited?[39;49;00m[37m [39;49;00m[[31mself[39;49;00m[37m [39;49;00m[31mv[39;49;00m][37m [39;49;00m([34mnot= [39;49;00m([34m. [39;49;00m[31mself.ids[39;49;00m[37m [39;49;00m[31mv[39;49;00m)[37m [39;49;00m[31mnil[39;49;00m))[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mget-id[39;49;00m[37m [39;49;00m[[31mself[39;49;00m[37m [39;49;00m[31mv[39;49;00m][37m[39;49;00m
[37m  [39;49;00m([34mvar [39;49;00m[31mid[39;49;00m[37m [39;49;00m([34m. [39;49;00m[31mself.ids[39;49;00m[37m [39;49;00m[31mv[39;49;00m))[37m[39;49;00m
[37m  [39;49;00m([34mwhen [39;49;00m([34mnot [39;49;00m[31mid[39;49;00m)[37m[39;49;00m
[37m    [39;49;00m([34mlet [39;49;00m[[31mtv[39;49;00m[37m [39;49;00m([36mtype [39;49;00m[31mv[39;49;00m)][37m[39;49;00m
[37m      [39;49;00m([34mset [39;49;00m[31mid[39;49;00m[37m [39;49;00m([34m+ [39;49;00m([34mor [39;49;00m([34m. [39;49;00m[31mself.max-ids[39;49;00m[37m [39;49;00m[31mtv[39;49;00m)[37m [39;49;00m[34m0[39;49;00m)[37m [39;49;00m[34m1[39;49;00m))[37m[39;49;00m
[37m      [39;49;00m([34mtset [39;49;00m[31mself.max-ids[39;49;00m[37m [39;49;00m[31mtv[39;49;00m[37m [39;49;00m[31mid[39;49;00m)[37m[39;49;00m
[37m      [39;49;00m([34mtset [39;49;00m[31mself.ids[39;49;00m[37m [39;49;00m[31mv[39;49;00m[37m [39;49;00m[31mid[39;49;00m)))[37m[39;49;00m
[37m  [39;49;00m([36mtostring [39;49;00m[31mid[39;49;00m))[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mput-sequential-table[39;49;00m[37m [39;49;00m[[31mself[39;49;00m[37m [39;49;00m[31mt[39;49;00m[37m [39;49;00m[31mlen[39;49;00m][37m[39;49;00m
[37m  [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m"["[39;49;00m)[37m[39;49;00m
[37m  [39;49;00m([34mset [39;49;00m[31mself.level[39;49;00m[37m [39;49;00m([34m+ [39;49;00m[31mself.level[39;49;00m[37m [39;49;00m[34m1[39;49;00m))[37m[39;49;00m
[37m  [39;49;00m([34mfor [39;49;00m[[31mi[39;49;00m[37m [39;49;00m[34m1[39;49;00m[37m [39;49;00m[31mlen[39;49;00m][37m[39;49;00m
[37m    [39;49;00m([34mwhen [39;49;00m([34m< [39;49;00m[34m1[39;49;00m[37m [39;49;00m[31mi[39;49;00m[37m [39;49;00m([34m+ [39;49;00m[34m1[39;49;00m[37m [39;49;00m[31mlen[39;49;00m))[37m[39;49;00m
[37m      [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m" "[39;49;00m))[37m[39;49;00m
[37m    [39;49;00m([31mput-value[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m([34m. [39;49;00m[31mt[39;49;00m[37m [39;49;00m[31mi[39;49;00m)))[37m[39;49;00m
[37m  [39;49;00m([34mset [39;49;00m[31mself.level[39;49;00m[37m [39;49;00m([34m- [39;49;00m[31mself.level[39;49;00m[37m [39;49;00m[34m1[39;49;00m))[37m[39;49;00m
[37m  [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m"]"[39;49;00m))[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mput-key[39;49;00m[37m [39;49;00m[[31mself[39;49;00m[37m [39;49;00m[31mk[39;49;00m][37m[39;49;00m
[37m  [39;49;00m([34mif [39;49;00m([34mand [39;49;00m([34m= [39;49;00m([36mtype [39;49;00m[31mk[39;49;00m)[37m [39;49;00m[33m"string"[39;49;00m)[37m[39;49;00m
[37m           [39;49;00m([34m: [39;49;00m[31mk[39;49;00m[37m [39;49;00m[33m:find[39;49;00m[37m [39;49;00m[33m"^[-%w?\\^_!$%&*+./@:|<=>]+$"[39;49;00m))[37m[39;49;00m
[37m      [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m":"[39;49;00m[37m [39;49;00m[31mk[39;49;00m)[37m[39;49;00m
[37m      [39;49;00m([31mput-value[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[31mk[39;49;00m)))[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mput-kv-table[39;49;00m[37m [39;49;00m[[31mself[39;49;00m[37m [39;49;00m[31mt[39;49;00m[37m [39;49;00m[31mordered-keys[39;49;00m][37m[39;49;00m
[37m  [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m"{"[39;49;00m)[37m[39;49;00m
[37m  [39;49;00m([34mset [39;49;00m[31mself.level[39;49;00m[37m [39;49;00m([34m+ [39;49;00m[31mself.level[39;49;00m[37m [39;49;00m[34m1[39;49;00m))[37m[39;49;00m
[37m  [39;49;00m[37m;; first, output sorted nonsequential keys[39;49;00m[37m[39;49;00m
[37m  [39;49;00m([34meach [39;49;00m[[31mi[39;49;00m[37m [39;49;00m[31mk[39;49;00m[37m [39;49;00m([36mipairs [39;49;00m[31mordered-keys[39;49;00m)][37m[39;49;00m
[37m    [39;49;00m([34mwhen [39;49;00m([34mor [39;49;00m[31mself.table-edges[39;49;00m[37m [39;49;00m([34mnot= [39;49;00m[31mi[39;49;00m[37m [39;49;00m[34m1[39;49;00m))[37m[39;49;00m
[37m      [39;49;00m([31mtabify[39;49;00m[37m [39;49;00m[31mself[39;49;00m))[37m[39;49;00m
[37m    [39;49;00m([31mput-key[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[31mk[39;49;00m)[37m[39;49;00m
[37m    [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m" "[39;49;00m)[37m[39;49;00m
[37m    [39;49;00m([31mput-value[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m([34m. [39;49;00m[31mt[39;49;00m[37m [39;49;00m[31mk[39;49;00m)))[37m[39;49;00m
[37m  [39;49;00m[37m;; next, output any sequential keys[39;49;00m[37m[39;49;00m
[37m  [39;49;00m([34meach [39;49;00m[[31mi[39;49;00m[37m [39;49;00m[31mv[39;49;00m[37m [39;49;00m([36mipairs [39;49;00m[31mt[39;49;00m)][37m[39;49;00m
[37m    [39;49;00m([31mtabify[39;49;00m[37m [39;49;00m[31mself[39;49;00m)[37m[39;49;00m
[37m    [39;49;00m([31mput-key[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[31mi[39;49;00m)[37m[39;49;00m
[37m    [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m" "[39;49;00m)[37m[39;49;00m
[37m    [39;49;00m([31mput-value[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[31mv[39;49;00m))[37m[39;49;00m
[37m  [39;49;00m([34mset [39;49;00m[31mself.level[39;49;00m[37m [39;49;00m([34m- [39;49;00m[31mself.level[39;49;00m[37m [39;49;00m[34m1[39;49;00m))[37m[39;49;00m
[37m  [39;49;00m([34mwhen [39;49;00m[31mself.table-edges[39;49;00m[37m[39;49;00m
[37m    [39;49;00m([31mtabify[39;49;00m[37m [39;49;00m[31mself[39;49;00m))[37m[39;49;00m
[37m  [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m"}"[39;49;00m))[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mput-table[39;49;00m[37m [39;49;00m[[31mself[39;49;00m[37m [39;49;00m[31mt[39;49;00m][37m[39;49;00m
[37m  [39;49;00m([34mlet [39;49;00m[[31mmetamethod[39;49;00m[37m [39;49;00m([34mand [39;49;00m[31mself.metamethod?[39;49;00m[37m [39;49;00m([34m-?> [39;49;00m[31mt[39;49;00m[37m [39;49;00m[36mgetmetatable [39;49;00m([34m. [39;49;00m[33m:__fennelview[39;49;00m)))][37m[39;49;00m
[37m    [39;49;00m([34mif [39;49;00m([34mand [39;49;00m([31malready-visited?[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[31mt[39;49;00m)[37m [39;49;00m[31mself.detect-cycles?[39;49;00m)[37m[39;49;00m
[37m        [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m"#<table @"[39;49;00m[37m [39;49;00m([31mget-id[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[31mt[39;49;00m)[37m [39;49;00m[33m">"[39;49;00m)[37m[39;49;00m
[37m        [39;49;00m([34m>= [39;49;00m[31mself.level[39;49;00m[37m [39;49;00m[31mself.depth[39;49;00m)[37m[39;49;00m
[37m        [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m"{...}"[39;49;00m)[37m[39;49;00m
[37m        [39;49;00m[31mmetamethod[39;49;00m[37m[39;49;00m
[37m        [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m([31mmetamethod[39;49;00m[37m [39;49;00m[31mt[39;49;00m[37m [39;49;00m[31mself.fennelview[39;49;00m))[37m[39;49;00m
[37m        [39;49;00m[33m:else[39;49;00m[37m[39;49;00m
[37m        [39;49;00m([34mlet [39;49;00m[([31mnon-seq-keys[39;49;00m[37m [39;49;00m[31mlen[39;49;00m)[37m [39;49;00m([31mget-nonsequential-keys[39;49;00m[37m [39;49;00m[31mt[39;49;00m)[37m[39;49;00m
[37m              [39;49;00m[31mid[39;49;00m[37m [39;49;00m([31mget-id[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[31mt[39;49;00m)][37m[39;49;00m
[37m          [39;49;00m[37m;; fancy metatable stuff can result in self.appearances not including[39;49;00m[37m[39;49;00m
[37m          [39;49;00m[37m;; a table, so if it's not found, assume we haven't seen it; we can't[39;49;00m[37m[39;49;00m
[37m          [39;49;00m[37m;; do cycle detection in that case.[39;49;00m[37m[39;49;00m
[37m          [39;49;00m([34mwhen [39;49;00m([34mand [39;49;00m([34m< [39;49;00m[34m1[39;49;00m[37m [39;49;00m([34mor [39;49;00m([34m. [39;49;00m[31mself.appearances[39;49;00m[37m [39;49;00m[31mt[39;49;00m)[37m [39;49;00m[34m0[39;49;00m))[37m [39;49;00m[31mself.detect-cycles?[39;49;00m)[37m[39;49;00m
[37m            [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m"@"[39;49;00m[37m [39;49;00m[31mid[39;49;00m))[37m[39;49;00m
[37m          [39;49;00m([34mif [39;49;00m([34mand [39;49;00m([34m= [39;49;00m([34mlength [39;49;00m[31mnon-seq-keys[39;49;00m)[37m [39;49;00m[34m0[39;49;00m)[37m [39;49;00m([34m= [39;49;00m([34mlength [39;49;00m[31mt[39;49;00m)[37m [39;49;00m[34m0[39;49;00m))[37m[39;49;00m
[37m              [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m([34mif [39;49;00m[31mself.empty-as-square[39;49;00m[37m [39;49;00m[33m"[]"[39;49;00m[37m [39;49;00m[33m"{}"[39;49;00m))[37m[39;49;00m
[37m              [39;49;00m([34m= [39;49;00m([34mlength [39;49;00m[31mnon-seq-keys[39;49;00m)[37m [39;49;00m[34m0[39;49;00m)[37m[39;49;00m
[37m              [39;49;00m([31mput-sequential-table[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[31mt[39;49;00m[37m [39;49;00m[31mlen[39;49;00m)[37m[39;49;00m
[37m              [39;49;00m[33m:else[39;49;00m[37m[39;49;00m
[37m              [39;49;00m([31mput-kv-table[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[31mt[39;49;00m[37m [39;49;00m[31mnon-seq-keys[39;49;00m))))))[37m[39;49;00m
[37m[39;49;00m
([34mset [39;49;00m[31mput-value[39;49;00m[37m [39;49;00m([34mfn [39;49;00m[[31mself[39;49;00m[37m [39;49;00m[31mv[39;49;00m][37m[39;49;00m
[37m                 [39;49;00m([34mlet [39;49;00m[[31mtv[39;49;00m[37m [39;49;00m([36mtype [39;49;00m[31mv[39;49;00m)][37m[39;49;00m
[37m                   [39;49;00m([34mif [39;49;00m([34m= [39;49;00m[31mtv[39;49;00m[37m [39;49;00m[33m"string"[39;49;00m)[37m[39;49;00m
[37m                       [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m([31mview-quote[39;49;00m[37m [39;49;00m([31mescape[39;49;00m[37m [39;49;00m[31mv[39;49;00m)))[37m[39;49;00m
[37m                       [39;49;00m([34mor [39;49;00m([34m= [39;49;00m[31mtv[39;49;00m[37m [39;49;00m[33m"number"[39;49;00m)[37m [39;49;00m([34m= [39;49;00m[31mtv[39;49;00m[37m [39;49;00m[33m"boolean"[39;49;00m)[37m [39;49;00m([34m= [39;49;00m[31mtv[39;49;00m[37m [39;49;00m[33m"nil"[39;49;00m))[37m[39;49;00m
[37m                       [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m([36mtostring [39;49;00m[31mv[39;49;00m))[37m[39;49;00m
[37m                       [39;49;00m([34m= [39;49;00m[31mtv[39;49;00m[37m [39;49;00m[33m"table"[39;49;00m)[37m[39;49;00m
[37m                       [39;49;00m([31mput-table[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[31mv[39;49;00m)[37m[39;49;00m
[37m                       [39;49;00m[33m:else[39;49;00m[37m[39;49;00m
[37m                       [39;49;00m([31mputs[39;49;00m[37m [39;49;00m[31mself[39;49;00m[37m [39;49;00m[33m"#<"[39;49;00m[37m [39;49;00m([36mtostring [39;49;00m[31mv[39;49;00m)[37m [39;49;00m[33m">"[39;49;00m)))))[37m[39;49;00m
[37m[39;49;00m
[37m[39;49;00m[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mone-line[39;49;00m[37m [39;49;00m[[31mstr[39;49;00m][37m[39;49;00m
[37m  [39;49;00m[37m;; save return value as local to ignore gsub's extra return value[39;49;00m[37m[39;49;00m
[37m  [39;49;00m([34mlet [39;49;00m[[31mret[39;49;00m[37m [39;49;00m([34m-> [39;49;00m[31mstr[39;49;00m[37m[39;49;00m
[37m                [39;49;00m([34m: [39;49;00m[33m:gsub[39;49;00m[37m [39;49;00m[33m"\n"[39;49;00m[37m [39;49;00m[33m" "[39;49;00m)[37m[39;49;00m
[37m                [39;49;00m([34m: [39;49;00m[33m:gsub[39;49;00m[37m [39;49;00m[33m"%[ "[39;49;00m[37m [39;49;00m[33m"["[39;49;00m)[37m [39;49;00m([34m: [39;49;00m[33m:gsub[39;49;00m[37m [39;49;00m[33m" %]"[39;49;00m[37m [39;49;00m[33m"]"[39;49;00m)[37m[39;49;00m
[37m                [39;49;00m([34m: [39;49;00m[33m:gsub[39;49;00m[37m [39;49;00m[33m"%{ "[39;49;00m[37m [39;49;00m[33m"{"[39;49;00m)[37m [39;49;00m([34m: [39;49;00m[33m:gsub[39;49;00m[37m [39;49;00m[33m" %}"[39;49;00m[37m [39;49;00m[33m"}"[39;49;00m)[37m[39;49;00m
[37m                [39;49;00m([34m: [39;49;00m[33m:gsub[39;49;00m[37m [39;49;00m[33m"%( "[39;49;00m[37m [39;49;00m[33m"("[39;49;00m)[37m [39;49;00m([34m: [39;49;00m[33m:gsub[39;49;00m[37m [39;49;00m[33m" %)"[39;49;00m[37m [39;49;00m[33m")"[39;49;00m))][37m[39;49;00m
[37m    [39;49;00m[31mret[39;49;00m))[37m[39;49;00m
[37m[39;49;00m
([34mfn [39;49;00m[31mfennelview[39;49;00m[37m [39;49;00m[[31mx[39;49;00m[37m [39;49;00m[31moptions[39;49;00m][37m[39;49;00m
[37m  [39;49;00m[33m"Return a string representation of x.[39;49;00m
[33m[39;49;00m
[33mCan take an options table with these keys:[39;49;00m
[33m* :one-line (boolean: default: false) keep the output string as a one-liner[39;49;00m
[33m* :depth (number, default: 128) limit how many levels to go (default: 128)[39;49;00m
[33m* :indent (string, default: \"  \") use this string to indent each level[39;49;00m
[33m* :detect-cycles? (boolean, default: true) don't try to traverse a looping table[39;49;00m
[33m* :metamethod? (boolean: default: true) use the __fennelview metamethod if found[39;49;00m
[33m* :table-edges (boolean: default: true) put {} table brackets on their own line[39;49;00m
[33m* :empty-as-square (boolean: default: false) render empty tables as [], not {}[39;49;00m
[33m[39;49;00m
[33mThe __fennelview metamethod should take the table being serialized as its first[39;49;00m
[33margument and a function as its second arg which can be used on table elements to[39;49;00m
[33mcontinue the fennelview process on them.[39;49;00m
[33m"[39;49;00m[37m[39;49;00m
[37m  [39;49;00m([34mlet [39;49;00m[[31moptions[39;49;00m[37m [39;49;00m([34mor [39;49;00m[31moptions[39;49;00m[37m [39;49;00m{})[37m[39;49;00m
[37m        [39;49;00m[31minspector[39;49;00m[37m [39;49;00m{[33m:appearances[39;49;00m[37m [39;49;00m([31mcount-table-appearances[39;49;00m[37m [39;49;00m[31mx[39;49;00m[37m [39;49;00m{})[37m[39;49;00m
[37m                   [39;49;00m[33m:depth[39;49;00m[37m [39;49;00m([34mor [39;49;00m[31moptions.depth[39;49;00m[37m [39;49;00m[34m128[39;49;00m)[37m[39;49;00m
[37m                   [39;49;00m[33m:level[39;49;00m[37m [39;49;00m[34m0[39;49;00m[37m [39;49;00m[33m:buffer[39;49;00m[37m [39;49;00m{}[37m [39;49;00m[33m:ids[39;49;00m[37m [39;49;00m{}[37m [39;49;00m[33m:max-ids[39;49;00m[37m [39;49;00m{}[37m[39;49;00m
[37m                   [39;49;00m[33m:indent[39;49;00m[37m [39;49;00m([34mor [39;49;00m[31moptions.indent[39;49;00m[37m [39;49;00m([34mif [39;49;00m[31moptions.one-line[39;49;00m[37m [39;49;00m[33m""[39;49;00m[37m [39;49;00m[33m"  "[39;49;00m))[37m[39;49;00m
[37m                   [39;49;00m[33m:detect-cycles?[39;49;00m[37m [39;49;00m([34mnot [39;49;00m([34m= [39;49;00m[31mfalse[39;49;00m[37m [39;49;00m[31moptions.detect-cycles?[39;49;00m))[37m[39;49;00m
[37m                   [39;49;00m[33m:metamethod?[39;49;00m[37m [39;49;00m([34mnot [39;49;00m([34m= [39;49;00m[31mfalse[39;49;00m[37m [39;49;00m[31moptions.metamethod?[39;49;00m))[37m[39;49;00m
[37m                   [39;49;00m[33m:fennelview[39;49;00m[37m [39;49;00m#([31mfennelview[39;49;00m[37m [39;49;00m[31m$1[39;49;00m[37m [39;49;00m[31moptions[39;49;00m)[37m[39;49;00m
[37m                   [39;49;00m[33m:table-edges[39;49;00m[37m [39;49;00m([34mnot= [39;49;00m[31moptions.table-edges[39;49;00m[37m [39;49;00m[31mfalse[39;49;00m)[37m[39;49;00m
[37m                   [39;49;00m[33m:empty-as-square[39;49;00m[37m [39;49;00m[31moptions.empty-as-square[39;49;00m}][37m[39;49;00m
[37m    [39;49;00m([31mput-value[39;49;00m[37m [39;49;00m[31minspector[39;49;00m[37m [39;49;00m[31mx[39;49;00m)[37m[39;49;00m
[37m    [39;49;00m([34mlet [39;49;00m[[31mstr[39;49;00m[37m [39;49;00m([31mtable.concat[39;49;00m[37m [39;49;00m[31minspector.buffer[39;49;00m)][37m[39;49;00m
[37m      [39;49;00m([34mif [39;49;00m[31moptions.one-line[39;49;00m[37m [39;49;00m([31mone-line[39;49;00m[37m [39;49;00m[31mstr[39;49;00m)[37m [39;49;00m[31mstr[39;49;00m))))
