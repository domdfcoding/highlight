[37m//+------------------------------------------------------------------+[39;49;00m
[37m//|                                                        Array.mqh |[39;49;00m
[37m//|                   Copyright 2009-2013, MetaQuotes Software Corp. |[39;49;00m
[37m//|                                              http://www.mql4.com |[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[36m#[39;49;00m[36minclude[39;49;00m[37m [39;49;00m[37m<Object.mqh>[39;49;00m[36m[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[37m//| Class CArray                                                     |[39;49;00m
[37m//| Purpose: Base class of dynamic arrays.                           |[39;49;00m
[37m//|          Derives from class CObject.                             |[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[34mclass[39;49;00m[37m [39;49;00m[04m[32mCArray[39;49;00m[37m [39;49;00m:[37m [39;49;00m[34mpublic[39;49;00m[37m [39;49;00mCObject[37m[39;49;00m
[37m  [39;49;00m{[37m[39;49;00m
[34mprotected[39;49;00m:[37m[39;49;00m
[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00mm_step_resize;[37m      [39;49;00m[37m// increment size of the array[39;49;00m
[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00mm_data_total;[37m       [39;49;00m[37m// number of elements[39;49;00m
[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00mm_data_max;[37m         [39;49;00m[37m// maximmum size of the array without memory reallocation[39;49;00m
[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00mm_sort_mode;[37m        [39;49;00m[37m// mode of array sorting[39;49;00m
[37m[39;49;00m
[34mpublic[39;49;00m:[37m[39;49;00m
[37m                     [39;49;00mCArray([36mvoid[39;49;00m);[37m[39;49;00m
[37m                    [39;49;00m~CArray([36mvoid[39;49;00m);[37m[39;49;00m
[37m   [39;49;00m[37m//--- methods of access to protected data[39;49;00m
[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mStep[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_step_resize);[37m [39;49;00m}[37m[39;49;00m
[37m   [39;49;00m[36mbool[39;49;00m[37m              [39;49;00m[32mStep[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mstep);[37m[39;49;00m
[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mTotal[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_data_total);[37m [39;49;00m}[37m[39;49;00m
[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mAvailable[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_data_max-m_data_total);[37m [39;49;00m}[37m[39;49;00m
[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mMax[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_data_max);[37m [39;49;00m}[37m[39;49;00m
[37m   [39;49;00m[36mbool[39;49;00m[37m              [39;49;00m[32mIsSorted[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmode=[34m0[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_sort_mode==mode);[37m [39;49;00m}[37m[39;49;00m
[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mSortMode[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_sort_mode);[37m [39;49;00m}[37m[39;49;00m
[37m   [39;49;00m[37m//--- cleaning method[39;49;00m
[37m   [39;49;00m[36mvoid[39;49;00m[37m              [39;49;00m[32mClear[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m{[37m [39;49;00mm_data_total=[34m0[39;49;00m;[37m [39;49;00m}[37m[39;49;00m
[37m   [39;49;00m[37m//--- methods for working with files[39;49;00m
[37m   [39;49;00m[34mvirtual[39;49;00m[37m [39;49;00m[36mbool[39;49;00m[37m      [39;49;00m[32mSave[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mfile_handle);[37m[39;49;00m
[37m   [39;49;00m[34mvirtual[39;49;00m[37m [39;49;00m[36mbool[39;49;00m[37m      [39;49;00m[32mLoad[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mfile_handle);[37m[39;49;00m
[37m   [39;49;00m[37m//--- sorting method[39;49;00m
[37m   [39;49;00m[36mvoid[39;49;00m[37m              [39;49;00m[32mSort[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmode=[34m0[39;49;00m);[37m[39;49;00m
[37m[39;49;00m
[34mprotected[39;49;00m:[37m[39;49;00m
[37m   [39;49;00m[34mvirtual[39;49;00m[37m [39;49;00m[36mvoid[39;49;00m[37m      [39;49;00mQuickSort([36mint[39;49;00m[37m [39;49;00mbeg,[36mint[39;49;00m[37m [39;49;00mend,[34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmode=[34m0[39;49;00m)[37m [39;49;00m{[37m [39;49;00m}[37m[39;49;00m
[37m  [39;49;00m};[37m[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[37m//| Constructor                                                      |[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
CArray::CArray([36mvoid[39;49;00m)[37m [39;49;00m:[37m [39;49;00mm_step_resize([34m16[39;49;00m),[37m[39;49;00m
[37m                       [39;49;00mm_data_total([34m0[39;49;00m),[37m[39;49;00m
[37m                       [39;49;00mm_data_max([34m0[39;49;00m),[37m[39;49;00m
[37m                       [39;49;00mm_sort_mode([34m-1[39;49;00m)[37m[39;49;00m
[37m  [39;49;00m{[37m[39;49;00m
[37m  [39;49;00m}[37m[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[37m//| Destructor                                                       |[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
CArray::~CArray([36mvoid[39;49;00m)[37m[39;49;00m
[37m  [39;49;00m{[37m[39;49;00m
[37m  [39;49;00m}[37m[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[37m//| Method Set for variable m_step_resize                            |[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[36mbool[39;49;00m[37m [39;49;00mCArray::Step([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mstep)[37m[39;49;00m
[37m  [39;49;00m{[37m[39;49;00m
[37m//--- check[39;49;00m
[37m   [39;49;00m[34mif[39;49;00m(step>[34m0[39;49;00m)[37m[39;49;00m
[37m     [39;49;00m{[37m[39;49;00m
[37m      [39;49;00mm_step_resize=step;[37m[39;49;00m
[37m      [39;49;00m[34mreturn[39;49;00m([36mtrue[39;49;00m);[37m[39;49;00m
[37m     [39;49;00m}[37m[39;49;00m
[37m//--- failure[39;49;00m
[37m   [39;49;00m[34mreturn[39;49;00m([36mfalse[39;49;00m);[37m[39;49;00m
[37m  [39;49;00m}[37m[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[37m//| Sorting an array in ascending order                              |[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[36mvoid[39;49;00m[37m [39;49;00mCArray::Sort([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmode)[37m[39;49;00m
[37m  [39;49;00m{[37m[39;49;00m
[37m//--- check[39;49;00m
[37m   [39;49;00m[34mif[39;49;00m(IsSorted(mode))[37m[39;49;00m
[37m      [39;49;00m[34mreturn[39;49;00m;[37m[39;49;00m
[37m   [39;49;00mm_sort_mode=mode;[37m[39;49;00m
[37m   [39;49;00m[34mif[39;49;00m(m_data_total<=[34m1[39;49;00m)[37m[39;49;00m
[37m      [39;49;00m[34mreturn[39;49;00m;[37m[39;49;00m
[37m//--- sort[39;49;00m
[37m   [39;49;00mQuickSort([34m0[39;49;00m,m_data_total[34m-1[39;49;00m,mode);[37m[39;49;00m
[37m  [39;49;00m}[37m[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[37m//| Writing header of array to file                                  |[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[36mbool[39;49;00m[37m [39;49;00mCArray::Save([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mfile_handle)[37m[39;49;00m
[37m  [39;49;00m{[37m[39;49;00m
[37m//--- check handle[39;49;00m
[37m   [39;49;00m[34mif[39;49;00m(file_handle!=[31mINVALID_HANDLE[39;49;00m)[37m[39;49;00m
[37m     [39;49;00m{[37m[39;49;00m
[37m      [39;49;00m[37m//--- write start marker - 0xFFFFFFFFFFFFFFFF[39;49;00m
[37m      [39;49;00m[34mif[39;49;00m([32mFileWriteLong[39;49;00m(file_handle,[34m-1[39;49;00m)==[34msizeof[39;49;00m([36mlong[39;49;00m))[37m[39;49;00m
[37m        [39;49;00m{[37m[39;49;00m
[37m         [39;49;00m[37m//--- write array type[39;49;00m
[37m         [39;49;00m[34mif[39;49;00m([32mFileWriteInteger[39;49;00m(file_handle,Type(),INT_VALUE)==INT_VALUE)[37m[39;49;00m
[37m            [39;49;00m[34mreturn[39;49;00m([36mtrue[39;49;00m);[37m[39;49;00m
[37m        [39;49;00m}[37m[39;49;00m
[37m     [39;49;00m}[37m[39;49;00m
[37m//--- failure[39;49;00m
[37m   [39;49;00m[34mreturn[39;49;00m([36mfalse[39;49;00m);[37m[39;49;00m
[37m  [39;49;00m}[37m[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[37m//| Reading header of array from file                                |[39;49;00m
[37m//+------------------------------------------------------------------+[39;49;00m
[36mbool[39;49;00m[37m [39;49;00mCArray::Load([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mfile_handle)[37m[39;49;00m
[37m  [39;49;00m{[37m[39;49;00m
[37m//--- check handle[39;49;00m
[37m   [39;49;00m[34mif[39;49;00m(file_handle!=[31mINVALID_HANDLE[39;49;00m)[37m[39;49;00m
[37m     [39;49;00m{[37m[39;49;00m
[37m      [39;49;00m[37m//--- read and check start marker - 0xFFFFFFFFFFFFFFFF[39;49;00m
[37m      [39;49;00m[34mif[39;49;00m([32mFileReadLong[39;49;00m(file_handle)==[34m-1[39;49;00m)[37m[39;49;00m
[37m        [39;49;00m{[37m[39;49;00m
[37m         [39;49;00m[37m//--- read and check array type[39;49;00m
[37m         [39;49;00m[34mif[39;49;00m([32mFileReadInteger[39;49;00m(file_handle,INT_VALUE)==Type())[37m[39;49;00m
[37m            [39;49;00m[34mreturn[39;49;00m([36mtrue[39;49;00m);[37m[39;49;00m
[37m        [39;49;00m}[37m[39;49;00m
[37m     [39;49;00m}[37m[39;49;00m
[37m//--- failure[39;49;00m
[37m   [39;49;00m[34mreturn[39;49;00m([36mfalse[39;49;00m);[37m[39;49;00m
[37m  [39;49;00m}[37m[39;49;00m
//+------------------------------------------------------------------+
