     1^I[37m-- transform.moon[39;49;00m[37m[39;49;00m$
     2^I[37m-- Leaf Corcoran (leafot@gmail.com) 2011[39;49;00m[37m[39;49;00m$
     3^I[37m--[39;49;00m[37m[39;49;00m$
     4^I[37m-- This is part of the MoonScript compiler. See <http://moonscript.org>[39;49;00m[37m[39;49;00m$
     5^I[37m-- MoonScript is licensed under the MIT License[39;49;00m[37m[39;49;00m$
     6^I[37m--[39;49;00m[37m[39;49;00m$
     7^I[37m[39;49;00m$
     8^Imodule [33m"[39;49;00m[33mmoonscript.transform[39;49;00m[33m"[39;49;00m, package.seeall[37m[39;49;00m$
     9^I[37m[39;49;00m$
    10^Itypes = [36mrequire[39;49;00m [33m"[39;49;00m[33mmoonscript.types[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
    11^Iutil = [36mrequire[39;49;00m [33m"[39;49;00m[33mmoonscript.util[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
    12^Idata = [36mrequire[39;49;00m [33m"[39;49;00m[33mmoonscript.data[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
    13^I[37m[39;49;00m$
    14^I[34mimport[39;49;00m reversed [34mfrom[39;49;00m util[37m[39;49;00m$
    15^I[34mimport[39;49;00m ntype, build, smart_node, is_slice [34mfrom[39;49;00m types[37m[39;49;00m$
    16^I[34mimport[39;49;00m insert [34mfrom[39;49;00m table[37m[39;49;00m$
    17^I[37m[39;49;00m$
    18^I[34mexport[39;49;00m [04m[32mStatement[39;49;00m, [04m[32mValue[39;49;00m, [04m[32mNameProxy[39;49;00m, [04m[32mLocalName[39;49;00m, [04m[32mRun[39;49;00m[37m[39;49;00m$
    19^I[37m[39;49;00m$
    20^I[37m-- always declares as local[39;49;00m[37m[39;49;00m$
    21^I[34mclass[39;49;00m [04m[32mLocalName[39;49;00m[37m[39;49;00m$
    22^I  [31mnew:[39;49;00m [36m([39;49;00m[31m@name[39;49;00m[36m)[39;49;00m [32m=>[39;49;00m [36mself[39;49;00m[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m = [33m"[39;49;00m[33mtemp_name[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
    23^I  [31mget_name:[39;49;00m [32m=>[39;49;00m [31m@name[39;49;00m[37m[39;49;00m$
    24^I[37m[39;49;00m$
    25^I[34mclass[39;49;00m [04m[32mNameProxy[39;49;00m[37m[39;49;00m$
    26^I  [31mnew:[39;49;00m [36m([39;49;00m[31m@prefix[39;49;00m[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
    27^I    [36mself[39;49;00m[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m = [33m"[39;49;00m[33mtemp_name[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
    28^I[37m[39;49;00m$
    29^I  [31mget_name:[39;49;00m [36m([39;49;00mscope[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
    30^I    [34mif[39;49;00m [34mnot[39;49;00m [31m@name[39;49;00m[37m[39;49;00m$
    31^I      [31m@name[39;49;00m = scope\free_name [31m@prefix[39;49;00m, [34mtrue[39;49;00m[37m[39;49;00m$
    32^I    [31m@name[39;49;00m[37m[39;49;00m$
    33^I[37m[39;49;00m$
    34^I  [31mchain:[39;49;00m [36m([39;49;00m...[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
    35^I    items = [36m{[39;49;00m...[36m}[39;49;00m [37m-- todo: fix ... propagation[39;49;00m[37m[39;49;00m$
    36^I    items = [34mfor[39;49;00m i [34min[39;49;00m *items[37m[39;49;00m$
    37^I      [34mif[39;49;00m [36mtype[39;49;00m[36m([39;49;00mi[36m)[39;49;00m == [33m"[39;49;00m[33mstring[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
    38^I        [36m{[39;49;00m[33m"[39;49;00m[33mdot[39;49;00m[33m"[39;49;00m, i[36m}[39;49;00m[37m[39;49;00m$
    39^I      [34melse[39;49;00m[37m[39;49;00m$
    40^I        i[37m[39;49;00m$
    41^I[37m[39;49;00m$
    42^I    build.chain [36m{[39;49;00m[37m[39;49;00m$
    43^I      [31mbase:[39;49;00m [36mself[39;49;00m[37m[39;49;00m$
    44^I      unpack items[37m[39;49;00m$
    45^I    [36m}[39;49;00m[37m[39;49;00m$
    46^I[37m[39;49;00m$
    47^I  [31mindex:[39;49;00m [36m([39;49;00mkey[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
    48^I    build.chain [36m{[39;49;00m[37m[39;49;00m$
    49^I      [31mbase:[39;49;00m [36mself[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33mindex[39;49;00m[33m"[39;49;00m, key[36m}[39;49;00m[37m[39;49;00m$
    50^I    [36m}[39;49;00m[37m[39;49;00m$
    51^I[37m[39;49;00m$
    52^I  [31m__tostring:[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
    53^I    [34mif[39;49;00m [31m@name[39;49;00m[37m[39;49;00m$
    54^I      [36m([39;49;00m[33m"[39;49;00m[33mname<%s>[39;49;00m[33m"[39;49;00m[36m)[39;49;00m\format [31m@name[39;49;00m[37m[39;49;00m$
    55^I    [34melse[39;49;00m[37m[39;49;00m$
    56^I      [36m([39;49;00m[33m"[39;49;00m[33mname<prefix(%s)>[39;49;00m[33m"[39;49;00m[36m)[39;49;00m\format [31m@prefix[39;49;00m[37m[39;49;00m$
    57^I[37m[39;49;00m$
    58^I[34mclass[39;49;00m [04m[32mRun[39;49;00m[37m[39;49;00m$
    59^I  [31mnew:[39;49;00m [36m([39;49;00m[31m@fn[39;49;00m[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
    60^I    [36mself[39;49;00m[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m = [33m"[39;49;00m[33mrun[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
    61^I[37m[39;49;00m$
    62^I  [31mcall:[39;49;00m [36m([39;49;00mstate[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
    63^I    [36mself[39;49;00m.fn state[37m[39;49;00m$
    64^I[37m[39;49;00m$
    65^I[37m-- transform the last stm is a list of stms[39;49;00m[37m[39;49;00m$
    66^I[37m-- will puke on group[39;49;00m[37m[39;49;00m$
    67^Iapply_to_last = [36m([39;49;00mstms, fn[36m)[39;49;00m [32m->[39;49;00m[37m[39;49;00m$
    68^I  [37m-- find last (real) exp[39;49;00m[37m[39;49;00m$
    69^I  last_exp_id = [34m0[39;49;00m[37m[39;49;00m$
    70^I  [34mfor[39;49;00m i = #stms, [34m1[39;49;00m, -[34m1[39;49;00m[37m[39;49;00m$
    71^I    stm = stms[36m[[39;49;00mi[36m][39;49;00m[37m[39;49;00m$
    72^I    [34mif[39;49;00m stm [34mand[39;49;00m util.moon.[36mtype[39;49;00m[36m([39;49;00mstm[36m)[39;49;00m != [04m[32mRun[39;49;00m[37m[39;49;00m$
    73^I      last_exp_id = i[37m[39;49;00m$
    74^I      [34mbreak[39;49;00m[37m[39;49;00m$
    75^I[37m[39;49;00m$
    76^I  [34mreturn[39;49;00m [34mfor[39;49;00m i, stm [34min[39;49;00m [36mipairs[39;49;00m stms[37m[39;49;00m$
    77^I    [34mif[39;49;00m i == last_exp_id[37m[39;49;00m$
    78^I      fn stm[37m[39;49;00m$
    79^I    [34melse[39;49;00m[37m[39;49;00m$
    80^I      stm[37m[39;49;00m$
    81^I[37m[39;49;00m$
    82^I[37m-- is a body a sindle expression/statement[39;49;00m[37m[39;49;00m$
    83^Iis_singular = [36m([39;49;00mbody[36m)[39;49;00m [32m->[39;49;00m[37m[39;49;00m$
    84^I  [34mreturn[39;49;00m [34mfalse[39;49;00m [34mif[39;49;00m #body != [34m1[39;49;00m[37m[39;49;00m$
    85^I  [34mif[39;49;00m [33m"[39;49;00m[33mgroup[39;49;00m[33m"[39;49;00m == ntype body[37m[39;49;00m$
    86^I    is_singular body[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m[37m[39;49;00m$
    87^I  [34melse[39;49;00m[37m[39;49;00m$
    88^I    [34mtrue[39;49;00m[37m[39;49;00m$
    89^I[37m[39;49;00m$
    90^Iconstructor_name = [33m"[39;49;00m[33mnew[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
    91^I[37m[39;49;00m$
    92^I[34mclass[39;49;00m [04m[32mTransformer[39;49;00m[37m[39;49;00m$
    93^I  [31mnew:[39;49;00m [36m([39;49;00m[31m@transformers[39;49;00m, [31m@scope[39;49;00m[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
    94^I    [31m@seen_nodes[39;49;00m = [36m{[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
    95^I[37m[39;49;00m$
    96^I  [31mtransform:[39;49;00m [36m([39;49;00mscope, node, ...[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
    97^I    [37m-- print scope, node, ...[39;49;00m[37m[39;49;00m$
    98^I    [34mreturn[39;49;00m node [34mif[39;49;00m [31m@seen_nodes[39;49;00m[36m[[39;49;00mnode[36m][39;49;00m[37m[39;49;00m$
    99^I    [31m@seen_nodes[39;49;00m[36m[[39;49;00mnode[36m][39;49;00m = [34mtrue[39;49;00m[37m[39;49;00m$
   100^I    [34mwhile[39;49;00m [34mtrue[39;49;00m[37m[39;49;00m$
   101^I      transformer = [31m@transformers[39;49;00m[36m[[39;49;00mntype node[36m][39;49;00m[37m[39;49;00m$
   102^I      res = [34mif[39;49;00m transformer[37m[39;49;00m$
   103^I        transformer[36m([39;49;00mscope, node, ...[36m)[39;49;00m [34mor[39;49;00m node[37m[39;49;00m$
   104^I      [34melse[39;49;00m[37m[39;49;00m$
   105^I        node[37m[39;49;00m$
   106^I      [34mreturn[39;49;00m node [34mif[39;49;00m res == node[37m[39;49;00m$
   107^I      node = res[37m[39;49;00m$
   108^I[37m[39;49;00m$
   109^I  [31m__call:[39;49;00m [36m([39;49;00mnode, ...[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   110^I    [31m@transform[39;49;00m [31m@scope[39;49;00m, node, ...[37m[39;49;00m$
   111^I[37m[39;49;00m$
   112^I  [31minstance:[39;49;00m [36m([39;49;00mscope[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   113^I    [04m[32mTransformer[39;49;00m [31m@transformers[39;49;00m, scope[37m[39;49;00m$
   114^I[37m[39;49;00m$
   115^I  [31mcan_transform:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   116^I    [31m@transformers[39;49;00m[36m[[39;49;00mntype node[36m][39;49;00m != [34mnil[39;49;00m[37m[39;49;00m$
   117^I[37m[39;49;00m$
   118^Iconstruct_comprehension = [36m([39;49;00minner, clauses[36m)[39;49;00m [32m->[39;49;00m[37m[39;49;00m$
   119^I  current_stms = inner[37m[39;49;00m$
   120^I  [34mfor[39;49;00m _, clause [34min[39;49;00m reversed clauses[37m[39;49;00m$
   121^I    t = clause[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   122^I    current_stms = [34mif[39;49;00m t == [33m"[39;49;00m[33mfor[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   123^I      _, names, iter = unpack clause[37m[39;49;00m$
   124^I      [36m{[39;49;00m[33m"[39;49;00m[33mforeach[39;49;00m[33m"[39;49;00m, names, iter, current_stms[36m}[39;49;00m[37m[39;49;00m$
   125^I    [34melseif[39;49;00m t == [33m"[39;49;00m[33mwhen[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   126^I      _, cond = unpack clause[37m[39;49;00m$
   127^I      [36m{[39;49;00m[33m"[39;49;00m[33mif[39;49;00m[33m"[39;49;00m, cond, current_stms[36m}[39;49;00m[37m[39;49;00m$
   128^I    [34melse[39;49;00m[37m[39;49;00m$
   129^I      [36merror[39;49;00m [33m"[39;49;00m[33mUnknown comprehension clause: [39;49;00m[33m"[39;49;00m..t[37m[39;49;00m$
   130^I    current_stms = [36m{[39;49;00mcurrent_stms[36m}[39;49;00m[37m[39;49;00m$
   131^I[37m[39;49;00m$
   132^I  current_stms[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   133^I[37m[39;49;00m$
   134^I[04m[32mStatement[39;49;00m = [04m[32mTransformer[39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   135^I  [31massign:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   136^I    _, names, values = unpack node[37m[39;49;00m$
   137^I    [37m-- bubble cascading assigns[39;49;00m[37m[39;49;00m$
   138^I    [34mif[39;49;00m #values == [34m1[39;49;00m [34mand[39;49;00m types.cascading[36m[[39;49;00mntype values[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m[36m][39;49;00m[37m[39;49;00m$
   139^I      values[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m = [31m@transform[39;49;00m.statement values[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m, [36m([39;49;00mstm[36m)[39;49;00m [32m->[39;49;00m[37m[39;49;00m$
   140^I        t = ntype stm[37m[39;49;00m$
   141^I        [34mif[39;49;00m types.is_value stm[37m[39;49;00m$
   142^I          [36m{[39;49;00m[33m"[39;49;00m[33massign[39;49;00m[33m"[39;49;00m, names, [36m{[39;49;00mstm[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   143^I        [34melse[39;49;00m[37m[39;49;00m$
   144^I          stm[37m[39;49;00m$
   145^I[37m[39;49;00m$
   146^I      build.group [36m{[39;49;00m[37m[39;49;00m$
   147^I        [36m{[39;49;00m[33m"[39;49;00m[33mdeclare[39;49;00m[33m"[39;49;00m, names[36m}[39;49;00m[37m[39;49;00m$
   148^I        values[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   149^I      [36m}[39;49;00m[37m[39;49;00m$
   150^I    [34melse[39;49;00m[37m[39;49;00m$
   151^I      node[37m[39;49;00m$
   152^I[37m[39;49;00m$
   153^I  [31mexport:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   154^I    [37m-- assign values if they are included[39;49;00m[37m[39;49;00m$
   155^I    [34mif[39;49;00m #node > [34m2[39;49;00m[37m[39;49;00m$
   156^I      [34mif[39;49;00m node[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m == [33m"[39;49;00m[33mclass[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   157^I        cls = smart_node node[36m[[39;49;00m[34m3[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   158^I        build.group [36m{[39;49;00m[37m[39;49;00m$
   159^I          [36m{[39;49;00m[33m"[39;49;00m[33mexport[39;49;00m[33m"[39;49;00m, [36m{[39;49;00mcls.name[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   160^I          cls[37m[39;49;00m$
   161^I        [36m}[39;49;00m[37m[39;49;00m$
   162^I      [34melse[39;49;00m[37m[39;49;00m$
   163^I        build.group [36m{[39;49;00m[37m[39;49;00m$
   164^I          node[37m[39;49;00m$
   165^I          build.assign [36m{[39;49;00m[37m[39;49;00m$
   166^I            [31mnames:[39;49;00m node[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   167^I            [31mvalues:[39;49;00m node[36m[[39;49;00m[34m3[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   168^I          [36m}[39;49;00m[37m[39;49;00m$
   169^I        [36m}[39;49;00m[37m[39;49;00m$
   170^I    [34melse[39;49;00m[37m[39;49;00m$
   171^I      [34mnil[39;49;00m[37m[39;49;00m$
   172^I[37m[39;49;00m$
   173^I  [31mupdate:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   174^I    _, name, op, exp = unpack node[37m[39;49;00m$
   175^I    op_final = op\match [33m"[39;49;00m[33m^(.+)=$[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   176^I    [36merror[39;49;00m [33m"[39;49;00m[33mUnknown op: [39;49;00m[33m"[39;49;00m..op [34mif[39;49;00m [34mnot[39;49;00m op_final[37m[39;49;00m$
   177^I    build.assign_one name, [36m{[39;49;00m[33m"[39;49;00m[33mexp[39;49;00m[33m"[39;49;00m, name, op_final, exp[36m}[39;49;00m[37m[39;49;00m$
   178^I[37m[39;49;00m$
   179^I  [31mimport:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   180^I    _, names, source = unpack node[37m[39;49;00m$
   181^I[37m[39;49;00m$
   182^I    stubs = [34mfor[39;49;00m name [34min[39;49;00m *names[37m[39;49;00m$
   183^I      [34mif[39;49;00m [36mtype[39;49;00m[36m([39;49;00mname[36m)[39;49;00m == [33m"[39;49;00m[33mtable[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   184^I        name[37m[39;49;00m$
   185^I      [34melse[39;49;00m[37m[39;49;00m$
   186^I        [36m{[39;49;00m[33m"[39;49;00m[33mdot[39;49;00m[33m"[39;49;00m, name[36m}[39;49;00m[37m[39;49;00m$
   187^I[37m[39;49;00m$
   188^I    real_names = [34mfor[39;49;00m name [34min[39;49;00m *names[37m[39;49;00m$
   189^I      [36mtype[39;49;00m[36m([39;49;00mname[36m)[39;49;00m == [33m"[39;49;00m[33mtable[39;49;00m[33m"[39;49;00m [34mand[39;49;00m name[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m [34mor[39;49;00m name[37m[39;49;00m$
   190^I[37m[39;49;00m$
   191^I    [34mif[39;49;00m [36mtype[39;49;00m[36m([39;49;00msource[36m)[39;49;00m == [33m"[39;49;00m[33mstring[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   192^I      build.assign [36m{[39;49;00m[37m[39;49;00m$
   193^I        [31mnames:[39;49;00m real_names[37m[39;49;00m$
   194^I        [31mvalues:[39;49;00m [36m[[39;49;00mbuild.chain [36m{[39;49;00m [31mbase:[39;49;00m source, stub[36m}[39;49;00m [34mfor[39;49;00m stub [34min[39;49;00m *stubs[36m][39;49;00m[37m[39;49;00m$
   195^I      [36m}[39;49;00m[37m[39;49;00m$
   196^I    [34melse[39;49;00m[37m[39;49;00m$
   197^I      source_name = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mtable[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   198^I      build.group [36m{[39;49;00m[37m[39;49;00m$
   199^I        [36m{[39;49;00m[33m"[39;49;00m[33mdeclare[39;49;00m[33m"[39;49;00m, real_names[36m}[39;49;00m[37m[39;49;00m$
   200^I        build[36m[[39;49;00m[33m"[39;49;00m[33mdo[39;49;00m[33m"[39;49;00m[36m][39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   201^I          build.assign_one source_name, source[37m[39;49;00m$
   202^I          build.assign [36m{[39;49;00m[37m[39;49;00m$
   203^I            [31mnames:[39;49;00m real_names[37m[39;49;00m$
   204^I            [31mvalues:[39;49;00m [36m[[39;49;00mbuild.chain [36m{[39;49;00m [31mbase:[39;49;00m source_name, stub[36m}[39;49;00m [34mfor[39;49;00m stub [34min[39;49;00m *stubs[36m][39;49;00m[37m[39;49;00m$
   205^I          [36m}[39;49;00m[37m[39;49;00m$
   206^I        [36m}[39;49;00m[37m[39;49;00m$
   207^I      [36m}[39;49;00m[37m[39;49;00m$
   208^I[37m[39;49;00m$
   209^I  [31mcomprehension:[39;49;00m [36m([39;49;00mnode, action[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   210^I    _, exp, clauses = unpack node[37m[39;49;00m$
   211^I[37m[39;49;00m$
   212^I    action = action [34mor[39;49;00m [36m([39;49;00mexp[36m)[39;49;00m [32m->[39;49;00m [36m{[39;49;00mexp[36m}[39;49;00m[37m[39;49;00m$
   213^I    construct_comprehension action[36m([39;49;00mexp[36m)[39;49;00m, clauses[37m[39;49;00m$
   214^I[37m[39;49;00m$
   215^I  [37m-- handle cascading return decorator[39;49;00m[37m[39;49;00m$
   216^I  [31mif:[39;49;00m [36m([39;49;00mnode, ret[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   217^I    [34mif[39;49;00m ret[37m[39;49;00m$
   218^I      smart_node node[37m[39;49;00m$
   219^I      [37m-- mutate all the bodies[39;49;00m[37m[39;49;00m$
   220^I      node[36m[[39;49;00m[33m'[39;49;00m[33mthen[39;49;00m[33m'[39;49;00m[36m][39;49;00m = apply_to_last node[36m[[39;49;00m[33m'[39;49;00m[33mthen[39;49;00m[33m'[39;49;00m[36m][39;49;00m, ret[37m[39;49;00m$
   221^I      [34mfor[39;49;00m i = [34m4[39;49;00m, #node[37m[39;49;00m$
   222^I        case = node[36m[[39;49;00mi[36m][39;49;00m[37m[39;49;00m$
   223^I        body_idx = #node[36m[[39;49;00mi[36m][39;49;00m[37m[39;49;00m$
   224^I        case[36m[[39;49;00mbody_idx[36m][39;49;00m = apply_to_last case[36m[[39;49;00mbody_idx[36m][39;49;00m, ret[37m[39;49;00m$
   225^I    node[37m[39;49;00m$
   226^I[37m[39;49;00m$
   227^I  [31mwith:[39;49;00m [36m([39;49;00mnode, ret[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   228^I    _, exp, block = unpack node[37m[39;49;00m$
   229^I    scope_name = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mwith[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   230^I    build[36m[[39;49;00m[33m"[39;49;00m[33mdo[39;49;00m[33m"[39;49;00m[36m][39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   231^I      build.assign_one scope_name, exp[37m[39;49;00m$
   232^I      [04m[32mRun[39;49;00m [32m=>[39;49;00m [31m@set[39;49;00m [33m"[39;49;00m[33mscope_var[39;49;00m[33m"[39;49;00m, scope_name[37m[39;49;00m$
   233^I      build.group block[37m[39;49;00m$
   234^I      [34mif[39;49;00m ret[37m[39;49;00m$
   235^I        ret scope_name[37m[39;49;00m$
   236^I    [36m}[39;49;00m[37m[39;49;00m$
   237^I[37m[39;49;00m$
   238^I  [31mforeach:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   239^I    smart_node node[37m[39;49;00m$
   240^I    [34mif[39;49;00m ntype[36m([39;49;00mnode.iter[36m)[39;49;00m == [33m"[39;49;00m[33munpack[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   241^I      list = node.iter[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   242^I[37m[39;49;00m$
   243^I      index_name = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mindex[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   244^I      list_name = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mlist[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   245^I[37m[39;49;00m$
   246^I      slice_var = [34mnil[39;49;00m[37m[39;49;00m$
   247^I      bounds = [34mif[39;49;00m is_slice list[37m[39;49;00m$
   248^I        slice = list[36m[[39;49;00m#list[36m][39;49;00m[37m[39;49;00m$
   249^I        [36mtable.remove[39;49;00m list[37m[39;49;00m$
   250^I        [36mtable.remove[39;49;00m slice, [34m1[39;49;00m[37m[39;49;00m$
   251^I[37m[39;49;00m$
   252^I        slice[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m = [34mif[39;49;00m slice[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m [34mand[39;49;00m slice[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m != [33m"[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   253^I          max_tmp_name = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mmax[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   254^I          slice_var = build.assign_one max_tmp_name, slice[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   255^I          [36m{[39;49;00m[33m"[39;49;00m[33mexp[39;49;00m[33m"[39;49;00m, max_tmp_name, [33m"[39;49;00m[33m<[39;49;00m[33m"[39;49;00m, [34m0[39;49;00m[37m[39;49;00m$
   256^I            [33m"[39;49;00m[33mand[39;49;00m[33m"[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33mlength[39;49;00m[33m"[39;49;00m, list_name[36m}[39;49;00m, [33m"[39;49;00m[33m+[39;49;00m[33m"[39;49;00m, max_tmp_name[37m[39;49;00m$
   257^I            [33m"[39;49;00m[33mor[39;49;00m[33m"[39;49;00m, max_tmp_name [36m}[39;49;00m[37m[39;49;00m$
   258^I        [34melse[39;49;00m[37m[39;49;00m$
   259^I          [36m{[39;49;00m[33m"[39;49;00m[33mlength[39;49;00m[33m"[39;49;00m, list_name[36m}[39;49;00m[37m[39;49;00m$
   260^I[37m[39;49;00m$
   261^I        slice[37m[39;49;00m$
   262^I      [34melse[39;49;00m[37m[39;49;00m$
   263^I        [36m{[39;49;00m[34m1[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33mlength[39;49;00m[33m"[39;49;00m, list_name[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   264^I[37m[39;49;00m$
   265^I      build.group [36m{[39;49;00m[37m[39;49;00m$
   266^I        build.assign_one list_name, list[37m[39;49;00m$
   267^I        slice_var[37m[39;49;00m$
   268^I        build[36m[[39;49;00m[33m"[39;49;00m[33mfor[39;49;00m[33m"[39;49;00m[36m][39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   269^I          [31mname:[39;49;00m index_name[37m[39;49;00m$
   270^I          [31mbounds:[39;49;00m bounds[37m[39;49;00m$
   271^I          [31mbody:[39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   272^I            [36m{[39;49;00m[33m"[39;49;00m[33massign[39;49;00m[33m"[39;49;00m, node.names, [36m{[39;49;00mlist_name\index index_name[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   273^I            build.group node.body[37m[39;49;00m$
   274^I          [36m}[39;49;00m[37m[39;49;00m$
   275^I        [36m}[39;49;00m[37m[39;49;00m$
   276^I      [36m}[39;49;00m[37m[39;49;00m$
   277^I[37m[39;49;00m$
   278^I  [31mswitch:[39;49;00m [36m([39;49;00mnode, ret[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   279^I    _, exp, conds = unpack node[37m[39;49;00m$
   280^I    exp_name = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mexp[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   281^I[37m[39;49;00m$
   282^I    [37m-- convert switch conds into if statment conds[39;49;00m[37m[39;49;00m$
   283^I    convert_cond = [36m([39;49;00mcond[36m)[39;49;00m [32m->[39;49;00m[37m[39;49;00m$
   284^I      t, case_exp, body = unpack cond[37m[39;49;00m$
   285^I      out = [36m{[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   286^I      insert out, t == [33m"[39;49;00m[33mcase[39;49;00m[33m"[39;49;00m [34mand[39;49;00m [33m"[39;49;00m[33melseif[39;49;00m[33m"[39;49;00m [34mor[39;49;00m [33m"[39;49;00m[33melse[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   287^I      [34mif[39;49;00m  t != [33m"[39;49;00m[33melse[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   288^I        insert out, [36m{[39;49;00m[33m"[39;49;00m[33mexp[39;49;00m[33m"[39;49;00m, case_exp, [33m"[39;49;00m[33m==[39;49;00m[33m"[39;49;00m, exp_name[36m}[39;49;00m [34mif[39;49;00m t != [33m"[39;49;00m[33melse[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   289^I      [34melse[39;49;00m[37m[39;49;00m$
   290^I        body = case_exp[37m[39;49;00m$
   291^I[37m[39;49;00m$
   292^I      [34mif[39;49;00m ret[37m[39;49;00m$
   293^I        body = apply_to_last body, ret[37m[39;49;00m$
   294^I[37m[39;49;00m$
   295^I      insert out, body[37m[39;49;00m$
   296^I[37m[39;49;00m$
   297^I      out[37m[39;49;00m$
   298^I[37m[39;49;00m$
   299^I    first = [34mtrue[39;49;00m[37m[39;49;00m$
   300^I    if_stm = [36m{[39;49;00m[33m"[39;49;00m[33mif[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   301^I    [34mfor[39;49;00m cond [34min[39;49;00m *conds[37m[39;49;00m$
   302^I      if_cond = convert_cond cond[37m[39;49;00m$
   303^I      [34mif[39;49;00m first[37m[39;49;00m$
   304^I        first = [34mfalse[39;49;00m[37m[39;49;00m$
   305^I        insert if_stm, if_cond[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   306^I        insert if_stm, if_cond[36m[[39;49;00m[34m3[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   307^I      [34melse[39;49;00m[37m[39;49;00m$
   308^I        insert if_stm, if_cond[37m[39;49;00m$
   309^I[37m[39;49;00m$
   310^I    build.group [36m{[39;49;00m[37m[39;49;00m$
   311^I      build.assign_one exp_name, exp[37m[39;49;00m$
   312^I      if_stm[37m[39;49;00m$
   313^I    [36m}[39;49;00m[37m[39;49;00m$
   314^I[37m[39;49;00m$
   315^I  [31mclass:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   316^I    _, name, parent_val, body = unpack node[37m[39;49;00m$
   317^I[37m[39;49;00m$
   318^I    [37m-- split apart properties and statements[39;49;00m[37m[39;49;00m$
   319^I    statements = [36m{[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   320^I    properties = [36m{[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   321^I    [34mfor[39;49;00m item [34min[39;49;00m *body[37m[39;49;00m$
   322^I      [34mswitch[39;49;00m item[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   323^I        [34mwhen[39;49;00m [33m"[39;49;00m[33mstm[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   324^I          insert statements, item[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   325^I        [34mwhen[39;49;00m [33m"[39;49;00m[33mprops[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   326^I          [34mfor[39;49;00m tuple [34min[39;49;00m *item[36m[[39;49;00m[34m2[39;49;00m,[36m][39;49;00m[37m[39;49;00m$
   327^I            insert properties, tuple[37m[39;49;00m$
   328^I[37m[39;49;00m$
   329^I    [37m-- find constructor[39;49;00m[37m[39;49;00m$
   330^I    constructor = [34mnil[39;49;00m[37m[39;49;00m$
   331^I    properties = [34mfor[39;49;00m tuple [34min[39;49;00m *properties[37m[39;49;00m$
   332^I      [34mif[39;49;00m tuple[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m == constructor_name[37m[39;49;00m$
   333^I        constructor = tuple[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   334^I        [34mnil[39;49;00m[37m[39;49;00m$
   335^I      [34melse[39;49;00m[37m[39;49;00m$
   336^I        tuple[37m[39;49;00m$
   337^I[37m[39;49;00m$
   338^I    parent_cls_name = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mparent[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   339^I    base_name = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mbase[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   340^I    self_name = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mself[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   341^I    cls_name = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mclass[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   342^I[37m[39;49;00m$
   343^I    [34mif[39;49;00m [34mnot[39;49;00m constructor[37m[39;49;00m$
   344^I      constructor = build.fndef [36m{[39;49;00m[37m[39;49;00m$
   345^I        [31margs:[39;49;00m [36m{[39;49;00m[36m{[39;49;00m[33m"[39;49;00m[33m...[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   346^I        [31marrow:[39;49;00m [33m"[39;49;00m[33mfat[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   347^I        [31mbody:[39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   348^I          build[36m[[39;49;00m[33m"[39;49;00m[33mif[39;49;00m[33m"[39;49;00m[36m][39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   349^I            [31mcond:[39;49;00m parent_cls_name[37m[39;49;00m$
   350^I            [31mthen:[39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   351^I              build.chain [36m{[39;49;00m [31mbase:[39;49;00m [33m"[39;49;00m[33msuper[39;49;00m[33m"[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33mcall[39;49;00m[33m"[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33m...[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[36m}[39;49;00m [36m}[39;49;00m[37m[39;49;00m$
   352^I            [36m}[39;49;00m[37m[39;49;00m$
   353^I          [36m}[39;49;00m[37m[39;49;00m$
   354^I        [36m}[39;49;00m[37m[39;49;00m$
   355^I      [36m}[39;49;00m[37m[39;49;00m$
   356^I    [34melse[39;49;00m[37m[39;49;00m$
   357^I      smart_node constructor[37m[39;49;00m$
   358^I      constructor.arrow = [33m"[39;49;00m[33mfat[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   359^I[37m[39;49;00m$
   360^I    cls = build.table [36m{[39;49;00m[37m[39;49;00m$
   361^I      [36m{[39;49;00m[33m"[39;49;00m[33m__init[39;49;00m[33m"[39;49;00m, constructor[36m}[39;49;00m[37m[39;49;00m$
   362^I      [36m{[39;49;00m[33m"[39;49;00m[33m__base[39;49;00m[33m"[39;49;00m, base_name[36m}[39;49;00m[37m[39;49;00m$
   363^I      [36m{[39;49;00m[33m"[39;49;00m[33m__name[39;49;00m[33m"[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33mstring[39;49;00m[33m"[39;49;00m, [33m'[39;49;00m[33m"[39;49;00m[33m'[39;49;00m, name[36m}[39;49;00m[36m}[39;49;00m [37m-- "quote the string"[39;49;00m[37m[39;49;00m$
   364^I      [36m{[39;49;00m[33m"[39;49;00m[33m__parent[39;49;00m[33m"[39;49;00m, parent_cls_name[36m}[39;49;00m[37m[39;49;00m$
   365^I    [36m}[39;49;00m[37m[39;49;00m$
   366^I[37m[39;49;00m$
   367^I    [37m-- look up a name in the class object[39;49;00m[37m[39;49;00m$
   368^I    class_lookup = build[36m[[39;49;00m[33m"[39;49;00m[33mif[39;49;00m[33m"[39;49;00m[36m][39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   369^I      [31mcond:[39;49;00m [36m{[39;49;00m[33m"[39;49;00m[33mexp[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mval[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33m==[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mnil[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mand[39;49;00m[33m"[39;49;00m, parent_cls_name[36m}[39;49;00m[37m[39;49;00m$
   370^I      [31mthen:[39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   371^I        parent_cls_name\index[33m"[39;49;00m[33mname[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   372^I      [36m}[39;49;00m[37m[39;49;00m$
   373^I    [36m}[39;49;00m[37m[39;49;00m$
   374^I    insert class_lookup, [36m{[39;49;00m[33m"[39;49;00m[33melse[39;49;00m[33m"[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33mval[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   375^I[37m[39;49;00m$
   376^I    cls_mt = build.table [36m{[39;49;00m[37m[39;49;00m$
   377^I      [36m{[39;49;00m[33m"[39;49;00m[33m__index[39;49;00m[33m"[39;49;00m, build.fndef [36m{[39;49;00m[37m[39;49;00m$
   378^I        [31margs:[39;49;00m [36m{[39;49;00m[36m{[39;49;00m[33m"[39;49;00m[33mcls[39;49;00m[33m"[39;49;00m[36m}[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33mname[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   379^I        [31mbody:[39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   380^I          build.assign_one [04m[32mLocalName[39;49;00m[33m"[39;49;00m[33mval[39;49;00m[33m"[39;49;00m, build.chain [36m{[39;49;00m[37m[39;49;00m$
   381^I            [31mbase:[39;49;00m [33m"[39;49;00m[33mrawget[39;49;00m[33m"[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33mcall[39;49;00m[33m"[39;49;00m, [36m{[39;49;00mbase_name, [33m"[39;49;00m[33mname[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   382^I          [36m}[39;49;00m[37m[39;49;00m$
   383^I          class_lookup[37m[39;49;00m$
   384^I        [36m}[39;49;00m[37m[39;49;00m$
   385^I      [36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   386^I      [36m{[39;49;00m[33m"[39;49;00m[33m__call[39;49;00m[33m"[39;49;00m, build.fndef [36m{[39;49;00m[37m[39;49;00m$
   387^I        [31margs:[39;49;00m [36m{[39;49;00m[36m{[39;49;00m[33m"[39;49;00m[33mcls[39;49;00m[33m"[39;49;00m[36m}[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33m...[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   388^I        [31mbody:[39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   389^I          build.assign_one self_name, build.chain [36m{[39;49;00m[37m[39;49;00m$
   390^I            [31mbase:[39;49;00m [33m"[39;49;00m[33msetmetatable[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   391^I            [36m{[39;49;00m[33m"[39;49;00m[33mcall[39;49;00m[33m"[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33m{}[39;49;00m[33m"[39;49;00m, base_name[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   392^I          [36m}[39;49;00m[37m[39;49;00m$
   393^I          build.chain [36m{[39;49;00m[37m[39;49;00m$
   394^I            [31mbase:[39;49;00m [33m"[39;49;00m[33mcls.__init[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   395^I            [36m{[39;49;00m[33m"[39;49;00m[33mcall[39;49;00m[33m"[39;49;00m, [36m{[39;49;00mself_name, [33m"[39;49;00m[33m...[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   396^I          [36m}[39;49;00m[37m[39;49;00m$
   397^I          self_name[37m[39;49;00m$
   398^I        [36m}[39;49;00m[37m[39;49;00m$
   399^I      [36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   400^I    [36m}[39;49;00m[37m[39;49;00m$
   401^I[37m[39;49;00m$
   402^I    cls = build.chain [36m{[39;49;00m[37m[39;49;00m$
   403^I      [31mbase:[39;49;00m [33m"[39;49;00m[33msetmetatable[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   404^I      [36m{[39;49;00m[33m"[39;49;00m[33mcall[39;49;00m[33m"[39;49;00m, [36m{[39;49;00mcls, cls_mt[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   405^I    [36m}[39;49;00m[37m[39;49;00m$
   406^I[37m[39;49;00m$
   407^I    value = [34mnil[39;49;00m[37m[39;49;00m$
   408^I    [34mwith[39;49;00m build[37m[39;49;00m$
   409^I      value = .block_exp [36m{[39;49;00m[37m[39;49;00m$
   410^I        [04m[32mRun[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   411^I          [31m@set[39;49;00m [33m"[39;49;00m[33msuper[39;49;00m[33m"[39;49;00m, [36m([39;49;00mblock, chain[36m)[39;49;00m [32m->[39;49;00m[37m[39;49;00m$
   412^I            [34mif[39;49;00m chain[37m[39;49;00m$
   413^I              slice = [36m[[39;49;00mitem [34mfor[39;49;00m item [34min[39;49;00m *chain[36m[[39;49;00m[34m3[39;49;00m,[36m][39;49;00m[36m][39;49;00m[37m[39;49;00m$
   414^I              new_chain = [36m{[39;49;00m[33m"[39;49;00m[33mchain[39;49;00m[33m"[39;49;00m, parent_cls_name[36m}[39;49;00m[37m[39;49;00m$
   415^I[37m[39;49;00m$
   416^I              head = slice[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   417^I[37m[39;49;00m$
   418^I              [34mif[39;49;00m head == [34mnil[39;49;00m[37m[39;49;00m$
   419^I                [34mreturn[39;49;00m parent_cls_name[37m[39;49;00m$
   420^I[37m[39;49;00m$
   421^I              [34mswitch[39;49;00m head[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   422^I                [37m-- calling super, inject calling name and self into chain[39;49;00m[37m[39;49;00m$
   423^I                [34mwhen[39;49;00m [33m"[39;49;00m[33mcall[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   424^I                  calling_name = block\get[33m"[39;49;00m[33mcurrent_block[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   425^I                  slice[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m = [36m{[39;49;00m[33m"[39;49;00m[33mcall[39;49;00m[33m"[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33mself[39;49;00m[33m"[39;49;00m, unpack head[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   426^I                  act = [34mif[39;49;00m ntype[36m([39;49;00mcalling_name[36m)[39;49;00m != [33m"[39;49;00m[33mvalue[39;49;00m[33m"[39;49;00m [34mthen[39;49;00m [33m"[39;49;00m[33mindex[39;49;00m[33m"[39;49;00m [34melse[39;49;00m [33m"[39;49;00m[33mdot[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   427^I                  insert new_chain, [36m{[39;49;00mact, calling_name[36m}[39;49;00m[37m[39;49;00m$
   428^I[37m[39;49;00m$
   429^I                [37m-- colon call on super, replace class with self as first arg[39;49;00m[37m[39;49;00m$
   430^I                [34mwhen[39;49;00m [33m"[39;49;00m[33mcolon[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   431^I                  call = head[36m[[39;49;00m[34m3[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   432^I                  insert new_chain, [36m{[39;49;00m[33m"[39;49;00m[33mdot[39;49;00m[33m"[39;49;00m, head[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   433^I                  slice[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m = [36m{[39;49;00m [33m"[39;49;00m[33mcall[39;49;00m[33m"[39;49;00m, [36m{[39;49;00m [33m"[39;49;00m[33mself[39;49;00m[33m"[39;49;00m, unpack call[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m [36m}[39;49;00m [36m}[39;49;00m[37m[39;49;00m$
   434^I[37m[39;49;00m$
   435^I              insert new_chain, item [34mfor[39;49;00m item [34min[39;49;00m *slice[37m[39;49;00m$
   436^I[37m[39;49;00m$
   437^I              new_chain[37m[39;49;00m$
   438^I            [34melse[39;49;00m[37m[39;49;00m$
   439^I              parent_cls_name[37m[39;49;00m$
   440^I[37m[39;49;00m$
   441^I        .assign_one parent_cls_name, parent_val == [33m"[39;49;00m[33m"[39;49;00m [34mand[39;49;00m [33m"[39;49;00m[33mnil[39;49;00m[33m"[39;49;00m [34mor[39;49;00m parent_val[37m[39;49;00m$
   442^I        .assign_one base_name, [36m{[39;49;00m[33m"[39;49;00m[33mtable[39;49;00m[33m"[39;49;00m, properties[36m}[39;49;00m[37m[39;49;00m$
   443^I        .assign_one base_name\chain[33m"[39;49;00m[33m__index[39;49;00m[33m"[39;49;00m, base_name[37m[39;49;00m$
   444^I[37m[39;49;00m$
   445^I        build[36m[[39;49;00m[33m"[39;49;00m[33mif[39;49;00m[33m"[39;49;00m[36m][39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   446^I          [31mcond:[39;49;00m parent_cls_name[37m[39;49;00m$
   447^I          [31mthen:[39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   448^I            .chain [36m{[39;49;00m[37m[39;49;00m$
   449^I              [31mbase:[39;49;00m [33m"[39;49;00m[33msetmetatable[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   450^I              [36m{[39;49;00m[33m"[39;49;00m[33mcall[39;49;00m[33m"[39;49;00m, [36m{[39;49;00m[37m[39;49;00m$
   451^I                base_name,[37m[39;49;00m$
   452^I                .chain [36m{[39;49;00m [31mbase:[39;49;00m parent_cls_name,  [36m{[39;49;00m[33m"[39;49;00m[33mdot[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33m__base[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   453^I              [36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   454^I            [36m}[39;49;00m[37m[39;49;00m$
   455^I          [36m}[39;49;00m[37m[39;49;00m$
   456^I        [36m}[39;49;00m[37m[39;49;00m$
   457^I[37m[39;49;00m$
   458^I        .assign_one cls_name, cls[37m[39;49;00m$
   459^I        .assign_one base_name\chain[33m"[39;49;00m[33m__class[39;49;00m[33m"[39;49;00m, cls_name[37m[39;49;00m$
   460^I[37m[39;49;00m$
   461^I        .group [34mif[39;49;00m #statements > [34m0[39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   462^I          .assign_one [04m[32mLocalName[39;49;00m[33m"[39;49;00m[33mself[39;49;00m[33m"[39;49;00m, cls_name[37m[39;49;00m$
   463^I          .group statements[37m[39;49;00m$
   464^I        [36m}[39;49;00m [34melse[39;49;00m [36m{[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   465^I[37m[39;49;00m$
   466^I        cls_name[37m[39;49;00m$
   467^I      [36m}[39;49;00m[37m[39;49;00m$
   468^I[37m[39;49;00m$
   469^I      value = .group [36m{[39;49;00m[37m[39;49;00m$
   470^I        .declare [31mnames:[39;49;00m [36m{[39;49;00mname[36m}[39;49;00m[37m[39;49;00m$
   471^I        .assign [36m{[39;49;00m[37m[39;49;00m$
   472^I          [31mnames:[39;49;00m [36m{[39;49;00mname[36m}[39;49;00m[37m[39;49;00m$
   473^I          [31mvalues:[39;49;00m [36m{[39;49;00mvalue[36m}[39;49;00m[37m[39;49;00m$
   474^I        [36m}[39;49;00m[37m[39;49;00m$
   475^I      [36m}[39;49;00m[37m[39;49;00m$
   476^I[37m[39;49;00m$
   477^I    value[37m[39;49;00m$
   478^I[36m}[39;49;00m[37m[39;49;00m$
   479^I[37m[39;49;00m$
   480^I[34mclass[39;49;00m [04m[32mAccumulator[39;49;00m[37m[39;49;00m$
   481^I  [31mbody_idx:[39;49;00m [36m{[39;49;00m [31mfor:[39;49;00m [34m4[39;49;00m, [31mwhile:[39;49;00m [34m3[39;49;00m, [31mforeach:[39;49;00m [34m4[39;49;00m [36m}[39;49;00m[37m[39;49;00m$
   482^I[37m[39;49;00m$
   483^I  [31mnew:[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   484^I    [31m@accum_name[39;49;00m = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33maccum[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   485^I    [31m@value_name[39;49;00m = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mvalue[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   486^I    [31m@len_name[39;49;00m = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mlen[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   487^I[37m[39;49;00m$
   488^I  [37m-- wraps node and mutates body[39;49;00m[37m[39;49;00m$
   489^I  [31mconvert:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   490^I    index = [31m@body_idx[39;49;00m[36m[[39;49;00mntype node[36m][39;49;00m[37m[39;49;00m$
   491^I    node[36m[[39;49;00mindex[36m][39;49;00m = [31m@mutate_body[39;49;00m node[36m[[39;49;00mindex[36m][39;49;00m[37m[39;49;00m$
   492^I    [31m@wrap[39;49;00m node[37m[39;49;00m$
   493^I[37m[39;49;00m$
   494^I  [37m-- wrap the node into a block_exp[39;49;00m[37m[39;49;00m$
   495^I  [31mwrap:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   496^I    build.block_exp [36m{[39;49;00m[37m[39;49;00m$
   497^I      build.assign_one [31m@accum_name[39;49;00m, build.table![37m[39;49;00m$
   498^I      build.assign_one [31m@len_name[39;49;00m, [34m0[39;49;00m[37m[39;49;00m$
   499^I      node[37m[39;49;00m$
   500^I      [31m@accum_name[39;49;00m[37m[39;49;00m$
   501^I    [36m}[39;49;00m[37m[39;49;00m$
   502^I[37m[39;49;00m$
   503^I  [37m-- mutates the body of a loop construct to save last value into accumulator[39;49;00m[37m[39;49;00m$
   504^I  [37m-- can optionally skip nil results[39;49;00m[37m[39;49;00m$
   505^I  [31mmutate_body:[39;49;00m [36m([39;49;00mbody, skip_nil=[34mtrue[39;49;00m[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   506^I    val = [34mif[39;49;00m [34mnot[39;49;00m skip_nil [34mand[39;49;00m is_singular body[37m[39;49;00m$
   507^I      [34mwith[39;49;00m body[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m[37m[39;49;00m$
   508^I        body = [36m{[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   509^I    [34melse[39;49;00m[37m[39;49;00m$
   510^I      body = apply_to_last body, [36m([39;49;00mn[36m)[39;49;00m [32m->[39;49;00m[37m[39;49;00m$
   511^I        build.assign_one [31m@value_name[39;49;00m, n[37m[39;49;00m$
   512^I      [31m@value_name[39;49;00m[37m[39;49;00m$
   513^I[37m[39;49;00m$
   514^I    update = [36m{[39;49;00m[37m[39;49;00m$
   515^I      [36m{[39;49;00m[33m"[39;49;00m[33mupdate[39;49;00m[33m"[39;49;00m, [31m@len_name[39;49;00m, [33m"[39;49;00m[33m+=[39;49;00m[33m"[39;49;00m, [34m1[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   516^I      build.assign_one [31m@accum_name[39;49;00m\index[36m([39;49;00m[31m@len_name[39;49;00m[36m)[39;49;00m, val[37m[39;49;00m$
   517^I    [36m}[39;49;00m[37m[39;49;00m$
   518^I[37m[39;49;00m$
   519^I    [34mif[39;49;00m skip_nil[37m[39;49;00m$
   520^I      [36mtable.insert[39;49;00m body, build[36m[[39;49;00m[33m"[39;49;00m[33mif[39;49;00m[33m"[39;49;00m[36m][39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   521^I        [31mcond:[39;49;00m [36m{[39;49;00m[33m"[39;49;00m[33mexp[39;49;00m[33m"[39;49;00m, [31m@value_name[39;49;00m, [33m"[39;49;00m[33m!=[39;49;00m[33m"[39;49;00m, [33m"[39;49;00m[33mnil[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   522^I        [31mthen:[39;49;00m update[37m[39;49;00m$
   523^I      [36m}[39;49;00m[37m[39;49;00m$
   524^I    [34melse[39;49;00m[37m[39;49;00m$
   525^I      [36mtable.insert[39;49;00m body, build.group update[37m[39;49;00m$
   526^I[37m[39;49;00m$
   527^I    body[37m[39;49;00m$
   528^I[37m[39;49;00m$
   529^Idefault_accumulator = [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   530^I  [04m[32mAccumulator[39;49;00m!\convert node[37m[39;49;00m$
   531^I[37m[39;49;00m$
   532^I[37m[39;49;00m$
   533^Iimplicitly_return = [36m([39;49;00mscope[36m)[39;49;00m [32m->[39;49;00m[37m[39;49;00m$
   534^I  fn = [36m([39;49;00mstm[36m)[39;49;00m [32m->[39;49;00m[37m[39;49;00m$
   535^I    t = ntype stm[37m[39;49;00m$
   536^I    [34mif[39;49;00m types.manual_return[36m[[39;49;00mt[36m][39;49;00m [34mor[39;49;00m [34mnot[39;49;00m types.is_value stm[37m[39;49;00m$
   537^I      stm[37m[39;49;00m$
   538^I    [34melseif[39;49;00m types.cascading[36m[[39;49;00mt[36m][39;49;00m[37m[39;49;00m$
   539^I      scope.transform.statement stm, fn[37m[39;49;00m$
   540^I    [34melse[39;49;00m[37m[39;49;00m$
   541^I      [34mif[39;49;00m t == [33m"[39;49;00m[33mcomprehension[39;49;00m[33m"[39;49;00m [34mand[39;49;00m [34mnot[39;49;00m types.comprehension_has_value stm[37m[39;49;00m$
   542^I        stm[37m[39;49;00m$
   543^I      [34melse[39;49;00m[37m[39;49;00m$
   544^I        [36m{[39;49;00m[33m"[39;49;00m[33mreturn[39;49;00m[33m"[39;49;00m, stm[36m}[39;49;00m[37m[39;49;00m$
   545^I[37m[39;49;00m$
   546^I  fn[37m[39;49;00m$
   547^I[37m[39;49;00m$
   548^I[04m[32mValue[39;49;00m = [04m[32mTransformer[39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   549^I  [31mfor:[39;49;00m default_accumulator[37m[39;49;00m$
   550^I  [31mwhile:[39;49;00m default_accumulator[37m[39;49;00m$
   551^I  [31mforeach:[39;49;00m default_accumulator[37m[39;49;00m$
   552^I[37m[39;49;00m$
   553^I  [31mcomprehension:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   554^I    a = [04m[32mAccumulator[39;49;00m![37m[39;49;00m$
   555^I    node = [31m@transform[39;49;00m.statement node, [36m([39;49;00mexp[36m)[39;49;00m [32m->[39;49;00m[37m[39;49;00m$
   556^I      a\mutate_body [36m{[39;49;00mexp[36m}[39;49;00m, [34mfalse[39;49;00m[37m[39;49;00m$
   557^I    a\wrap node[37m[39;49;00m$
   558^I[37m[39;49;00m$
   559^I  [31mtblcomprehension:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   560^I    _, key_exp, value_exp, clauses = unpack node[37m[39;49;00m$
   561^I[37m[39;49;00m$
   562^I    accum = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mtbl[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   563^I    dest = build.chain [36m{[39;49;00m [31mbase:[39;49;00m accum, [36m{[39;49;00m[33m"[39;49;00m[33mindex[39;49;00m[33m"[39;49;00m, key_exp[36m}[39;49;00m [36m}[39;49;00m[37m[39;49;00m$
   564^I    inner = build.assign_one dest, value_exp[37m[39;49;00m$
   565^I[37m[39;49;00m$
   566^I    build.block_exp [36m{[39;49;00m[37m[39;49;00m$
   567^I      build.assign_one accum, build.table![37m[39;49;00m$
   568^I      construct_comprehension [36m{[39;49;00minner[36m}[39;49;00m, clauses[37m[39;49;00m$
   569^I      accum[37m[39;49;00m$
   570^I    [36m}[39;49;00m[37m[39;49;00m$
   571^I[37m[39;49;00m$
   572^I  [31mfndef:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   573^I    smart_node node[37m[39;49;00m$
   574^I    node.body = apply_to_last node.body, implicitly_return [36mself[39;49;00m[37m[39;49;00m$
   575^I    node[37m[39;49;00m$
   576^I[37m[39;49;00m$
   577^I  [31mif:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m build.block_exp [36m{[39;49;00m node [36m}[39;49;00m[37m[39;49;00m$
   578^I  [31mwith:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m build.block_exp [36m{[39;49;00m node [36m}[39;49;00m[37m[39;49;00m$
   579^I  [31mswitch:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   580^I    build.block_exp [36m{[39;49;00m node [36m}[39;49;00m[37m[39;49;00m$
   581^I[37m[39;49;00m$
   582^I  [37m-- pull out colon chain[39;49;00m[37m[39;49;00m$
   583^I  [31mchain:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   584^I    stub = node[36m[[39;49;00m#node[36m][39;49;00m[37m[39;49;00m$
   585^I    [34mif[39;49;00m [36mtype[39;49;00m[36m([39;49;00mstub[36m)[39;49;00m == [33m"[39;49;00m[33mtable[39;49;00m[33m"[39;49;00m [34mand[39;49;00m stub[36m[[39;49;00m[34m1[39;49;00m[36m][39;49;00m == [33m"[39;49;00m[33mcolon_stub[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   586^I      [36mtable.remove[39;49;00m node, #node[37m[39;49;00m$
   587^I[37m[39;49;00m$
   588^I      base_name = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mbase[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   589^I      fn_name = [04m[32mNameProxy[39;49;00m [33m"[39;49;00m[33mfn[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   590^I[37m[39;49;00m$
   591^I      is_super = node[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m == [33m"[39;49;00m[33msuper[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   592^I      [31m@transform[39;49;00m.value build.block_exp [36m{[39;49;00m[37m[39;49;00m$
   593^I        build.assign [36m{[39;49;00m[37m[39;49;00m$
   594^I          [31mnames:[39;49;00m [36m{[39;49;00mbase_name[36m}[39;49;00m[37m[39;49;00m$
   595^I          [31mvalues:[39;49;00m [36m{[39;49;00mnode[36m}[39;49;00m[37m[39;49;00m$
   596^I        [36m}[39;49;00m[37m[39;49;00m$
   597^I[37m[39;49;00m$
   598^I        build.assign [36m{[39;49;00m[37m[39;49;00m$
   599^I          [31mnames:[39;49;00m [36m{[39;49;00mfn_name[36m}[39;49;00m[37m[39;49;00m$
   600^I          [31mvalues:[39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   601^I            build.chain [36m{[39;49;00m [31mbase:[39;49;00m base_name, [36m{[39;49;00m[33m"[39;49;00m[33mdot[39;49;00m[33m"[39;49;00m, stub[36m[[39;49;00m[34m2[39;49;00m[36m][39;49;00m[36m}[39;49;00m [36m}[39;49;00m[37m[39;49;00m$
   602^I          [36m}[39;49;00m[37m[39;49;00m$
   603^I        [36m}[39;49;00m[37m[39;49;00m$
   604^I[37m[39;49;00m$
   605^I        build.fndef [36m{[39;49;00m[37m[39;49;00m$
   606^I          [31margs:[39;49;00m [36m{[39;49;00m[36m{[39;49;00m[33m"[39;49;00m[33m...[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   607^I          [31mbody:[39;49;00m [36m{[39;49;00m[37m[39;49;00m$
   608^I            build.chain [36m{[39;49;00m[37m[39;49;00m$
   609^I              [31mbase:[39;49;00m fn_name, [36m{[39;49;00m[33m"[39;49;00m[33mcall[39;49;00m[33m"[39;49;00m, [36m{[39;49;00mis_super [34mand[39;49;00m [33m"[39;49;00m[33mself[39;49;00m[33m"[39;49;00m [34mor[39;49;00m base_name, [33m"[39;49;00m[33m...[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   610^I            [36m}[39;49;00m[37m[39;49;00m$
   611^I          [36m}[39;49;00m[37m[39;49;00m$
   612^I        [36m}[39;49;00m[37m[39;49;00m$
   613^I      [36m}[39;49;00m[37m[39;49;00m$
   614^I[37m[39;49;00m$
   615^I  [31mblock_exp:[39;49;00m [36m([39;49;00mnode[36m)[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   616^I    _, body = unpack node[37m[39;49;00m$
   617^I[37m[39;49;00m$
   618^I    fn = [34mnil[39;49;00m[37m[39;49;00m$
   619^I    arg_list = [36m{[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   620^I[37m[39;49;00m$
   621^I    insert body, [04m[32mRun[39;49;00m [32m=>[39;49;00m[37m[39;49;00m$
   622^I      [34mif[39;49;00m [31m@has_varargs[39;49;00m[37m[39;49;00m$
   623^I        insert arg_list, [33m"[39;49;00m[33m...[39;49;00m[33m"[39;49;00m[37m[39;49;00m$
   624^I        insert fn.args, [36m{[39;49;00m[33m"[39;49;00m[33m...[39;49;00m[33m"[39;49;00m[36m}[39;49;00m[37m[39;49;00m$
   625^I[37m[39;49;00m$
   626^I    fn = smart_node build.fndef [31mbody:[39;49;00m body[37m[39;49;00m$
   627^I    build.chain [36m{[39;49;00m [31mbase:[39;49;00m [36m{[39;49;00m[33m"[39;49;00m[33mparens[39;49;00m[33m"[39;49;00m, fn[36m}[39;49;00m, [36m{[39;49;00m[33m"[39;49;00m[33mcall[39;49;00m[33m"[39;49;00m, arg_list[36m}[39;49;00m [36m}[39;49;00m[37m[39;49;00m$
   628^I[36m}[39;49;00m$
