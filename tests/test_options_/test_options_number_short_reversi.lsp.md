     1	[36m#!/usr/bin/env newlisp[39;49;00m[37m[39;49;00m
     2	[37m;; @module reversi.lsp[39;49;00m[37m[39;49;00m
     3	[37m;; @description a simple version of Reversi: you as white against newLISP as black[39;49;00m[37m[39;49;00m
     4	[37m;; @version 0.1 alpha August 2007[39;49;00m[37m[39;49;00m
     5	[37m;; @author cormullion[39;49;00m[37m[39;49;00m
     6	[37m;;[39;49;00m[37m[39;49;00m
     7	[37m;; 2008-10-08 21:46:54[39;49;00m[37m[39;49;00m
     8	[37m;; updated for newLISP version 10. (changed nth-set to setf)[39;49;00m[37m[39;49;00m
     9	[37m;; this now does not work with newLISP version 9![39;49;00m[37m[39;49;00m
    10	[37m;;[39;49;00m[37m[39;49;00m
    11	[37m;; This is my first attempt at writing a simple application using newLISP-GS.[39;49;00m[37m[39;49;00m
    12	[37m;; The game algorithms are basically by [39;49;00m[37m[39;49;00m
    13	[37m;; Peter Norvig http://norvig.com/paip/othello.lisp[39;49;00m[37m[39;49;00m
    14	[37m;; and all I've done is translate to newLISP and add the interface...[39;49;00m[37m[39;49;00m
    15	[37m;;[39;49;00m[37m[39;49;00m
    16	[37m;; To-Do: work out how to handle the end of the game properly...[39;49;00m[37m[39;49;00m
    17	[37m;; To-Do: complete newlispdoc for the functions[39;49;00m[37m[39;49;00m
    18	[37m[39;49;00m
    19	([34mconstant[39;49;00m[37m [39;49;00m'[33mempty[39;49;00m[37m [39;49;00m[33m0[39;49;00m)[37m [39;49;00m
    20	([34mconstant[39;49;00m[37m [39;49;00m'[33mblack[39;49;00m[37m [39;49;00m[33m1[39;49;00m)[37m [39;49;00m
    21	([34mconstant[39;49;00m[37m [39;49;00m'[33mwhite[39;49;00m[37m [39;49;00m[33m2[39;49;00m)[37m[39;49;00m
    22	([34mconstant[39;49;00m[37m [39;49;00m'[33mouter[39;49;00m[37m [39;49;00m[33m3[39;49;00m)[37m [39;49;00m[37m; squares outside the 8x8 board[39;49;00m[37m[39;49;00m
    23	[37m[39;49;00m
    24	([34mset[39;49;00m[37m [39;49;00m'[34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m'())[37m [39;49;00m[37m; the master board is a 100 element list[39;49;00m[37m[39;49;00m
    25	([34mset[39;49;00m[37m [39;49;00m'[34m*[39;49;00m[33mmoves*[39;49;00m[37m [39;49;00m'())[37m [39;49;00m[37m; list of moves made[39;49;00m[37m[39;49;00m
    26	[37m[39;49;00m
    27	[37m; these are the 8 different directions from a square on the board[39;49;00m[37m[39;49;00m
    28	[37m[39;49;00m
    29	([34mset[39;49;00m[37m [39;49;00m'[33mall-directions[39;49;00m[37m [39;49;00m'([34m-[39;49;00m[33m11[39;49;00m[37m [39;49;00m[34m-[39;49;00m[33m10[39;49;00m[37m [39;49;00m[34m-[39;49;00m[33m9[39;49;00m[37m [39;49;00m[34m-[39;49;00m[33m1[39;49;00m[37m [39;49;00m[33m1[39;49;00m[37m [39;49;00m[33m9[39;49;00m[37m [39;49;00m[33m10[39;49;00m[37m [39;49;00m[33m11[39;49;00m))[37m[39;49;00m
    30	[37m[39;49;00m
    31	[37m; return a list of all the playable squares (the 8 by 8 grid inside the 10by10[39;49;00m[37m[39;49;00m
    32	[37m[39;49;00m
    33	([34mdefine[39;49;00m[37m [39;49;00m([31mall-squares[39;49;00m)[37m[39;49;00m
    34	[37m  [39;49;00m([34mlocal[39;49;00m[37m [39;49;00m([31mresult[39;49;00m)[37m[39;49;00m
    35	[37m     [39;49;00m([34mfor[39;49;00m[37m [39;49;00m([31msquare[39;49;00m[37m [39;49;00m[33m11[39;49;00m[37m [39;49;00m[33m88[39;49;00m)[37m[39;49;00m
    36	[37m        [39;49;00m([34mif[39;49;00m[37m [39;49;00m([31m<=[39;49;00m[37m [39;49;00m[33m1[39;49;00m[37m [39;49;00m([34mmod[39;49;00m[37m [39;49;00m[33msquare[39;49;00m[37m [39;49;00m[33m10[39;49;00m)[37m [39;49;00m[33m8[39;49;00m)[37m[39;49;00m
    37	[37m           [39;49;00m([34mpush[39;49;00m[37m [39;49;00m[33msquare[39;49;00m[37m [39;49;00m[33mresult[39;49;00m[37m [39;49;00m[34m-[39;49;00m[33m1[39;49;00m)))[37m[39;49;00m
    38	[33mresult[39;49;00m))[37m[39;49;00m
    39	[37m[39;49;00m
    40	[37m; make a board[39;49;00m[37m[39;49;00m
    41	[37m[39;49;00m
    42	([34mdefine[39;49;00m[37m [39;49;00m([31mmake-board[39;49;00m)[37m[39;49;00m
    43	[37m  [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m([34mdup[39;49;00m[37m [39;49;00m[33mouter[39;49;00m[37m [39;49;00m[33m100[39;49;00m))[37m[39;49;00m
    44	[37m  [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31ms[39;49;00m[37m [39;49;00m([31mall-squares[39;49;00m))[37m[39;49;00m
    45	[37m     [39;49;00m([34msetf[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33ms[39;49;00m)[37m [39;49;00m[33mempty[39;49;00m)))[37m[39;49;00m
    46	[37m[39;49;00m
    47	[37m; for testing and working at a terminal[39;49;00m[37m[39;49;00m
    48	[37m[39;49;00m
    49	([34mdefine[39;49;00m[37m [39;49;00m([34mprint[39;49;00m[34m-[39;49;00m[33mboard[39;49;00m)[37m[39;49;00m
    50	[37m  [39;49;00m([34mprint[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m [39;49;00m[33m}[39;49;00m)[37m[39;49;00m
    51	[37m  [39;49;00m([34mfor[39;49;00m[37m [39;49;00m([31mc[39;49;00m[37m [39;49;00m[33m1[39;49;00m[37m [39;49;00m[33m8[39;49;00m)[37m[39;49;00m
    52	[37m     [39;49;00m([34mprint[39;49;00m[37m [39;49;00m[33mc[39;49;00m))[37m[39;49;00m
    53	[37m  [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mc[39;49;00m[37m [39;49;00m[33m0[39;49;00m)[37m[39;49;00m
    54	[37m  [39;49;00m([34mfor[39;49;00m[37m [39;49;00m([31mi[39;49;00m[37m [39;49;00m[33m0[39;49;00m[37m [39;49;00m[33m99[39;49;00m)[37m[39;49;00m
    55	[37m     [39;49;00m([34mcond[39;49;00m[37m[39;49;00m
    56	[37m        [39;49;00m(([31m=[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33mi[39;49;00m)[37m [39;49;00m[33m0[39;49;00m)[37m [39;49;00m([34mprint[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m.[39;49;00m[33m}[39;49;00m))[37m[39;49;00m
    57	[37m        [39;49;00m(([31m=[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33mi[39;49;00m)[37m [39;49;00m[33m1[39;49;00m)[37m [39;49;00m([34mprint[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mb[39;49;00m[33m}[39;49;00m))[37m[39;49;00m
    58	[37m        [39;49;00m(([31m=[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33mi[39;49;00m)[37m [39;49;00m[33m2[39;49;00m)[37m [39;49;00m([34mprint[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mw[39;49;00m[33m}[39;49;00m)))[37m[39;49;00m
    59	[37m     [39;49;00m([34mif[39;49;00m[37m [39;49;00m([34mand[39;49;00m[37m [39;49;00m([31m<=[39;49;00m[37m [39;49;00m[33mi[39;49;00m[37m [39;49;00m[33m88[39;49;00m)[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m([34mmod[39;49;00m[37m [39;49;00m([31m+[39;49;00m[37m [39;49;00m[33mi[39;49;00m[37m [39;49;00m[33m1[39;49;00m)[37m [39;49;00m[33m10[39;49;00m)[37m [39;49;00m[33m0[39;49;00m))[37m [39;49;00m[37m; newline[39;49;00m[37m[39;49;00m
    60	[37m        [39;49;00m([34mprint[39;49;00m[37m [39;49;00m[33m"\n"[39;49;00m[37m [39;49;00m([34minc[39;49;00m[37m [39;49;00m[33mc[39;49;00m))))[37m[39;49;00m
    61	[37m  [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m[33m"\n"[39;49;00m))[37m[39;49;00m
    62	[37m[39;49;00m
    63	[37m; the initial starting pattern[39;49;00m[37m[39;49;00m
    64	[37m[39;49;00m
    65	([34mdefine[39;49;00m[37m [39;49;00m([31minitial-board[39;49;00m)[37m[39;49;00m
    66	[37m  [39;49;00m([31mmake-board[39;49;00m)[37m[39;49;00m
    67	[37m  [39;49;00m([34msetf[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33m44[39;49;00m)[37m [39;49;00m[33mwhite[39;49;00m)[37m[39;49;00m
    68	[37m  [39;49;00m([34msetf[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33m55[39;49;00m)[37m [39;49;00m[33mwhite[39;49;00m)[37m[39;49;00m
    69	[37m  [39;49;00m([34msetf[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33m45[39;49;00m)[37m [39;49;00m[33mblack[39;49;00m)[37m[39;49;00m
    70	[37m  [39;49;00m([34msetf[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33m54[39;49;00m)[37m [39;49;00m[33mblack[39;49;00m))[37m[39;49;00m
    71	[37m[39;49;00m
    72	([34mdefine[39;49;00m[37m [39;49;00m([31mopponent[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
    73	[37m  [39;49;00m([34mif[39;49;00m[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[33mblack[39;49;00m)[37m [39;49;00m[33mwhite[39;49;00m[37m [39;49;00m[33mblack[39;49;00m))[37m[39;49;00m
    74	[37m[39;49;00m
    75	([34mdefine[39;49;00m[37m [39;49;00m([31mplayer-name[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
    76	[37m  [39;49;00m([34mif[39;49;00m[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[33mwhite[39;49;00m)[37m [39;49;00m[33m"white"[39;49;00m[37m [39;49;00m[33m"black"[39;49;00m))[37m[39;49;00m
    77	[37m  [39;49;00m
    78	([34mdefine[39;49;00m[37m [39;49;00m([31mvalid-move?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m)[37m[39;49;00m
    79	[37m  [39;49;00m([34mand[39;49;00m[37m [39;49;00m
    80	[37m     [39;49;00m([34minteger[39;49;00m[33m?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m)[37m[39;49;00m
    81	[37m     [39;49;00m([31m<=[39;49;00m[37m [39;49;00m[33m11[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33m88[39;49;00m)[37m[39;49;00m
    82	[37m     [39;49;00m([31m<=[39;49;00m[37m [39;49;00m[33m1[39;49;00m[37m [39;49;00m([34mmod[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33m10[39;49;00m)[37m [39;49;00m[33m8[39;49;00m)))[37m[39;49;00m
    83	[37m[39;49;00m
    84	([34mdefine[39;49;00m[37m [39;49;00m([31mempty-square?[39;49;00m[37m [39;49;00m[33msquare[39;49;00m)[37m[39;49;00m
    85	[37m  [39;49;00m([34mand[39;49;00m[37m[39;49;00m
    86	[37m     [39;49;00m([31mvalid-move?[39;49;00m[37m [39;49;00m[33msquare[39;49;00m)[37m[39;49;00m
    87	[37m     [39;49;00m([31m=[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33msquare[39;49;00m)[37m [39;49;00m[33mempty[39;49;00m)))[37m[39;49;00m
    88	[37m     [39;49;00m
    89	[37m; test whether a move is legal. The square must be empty[39;49;00m[37m[39;49;00m
    90	[37m; and it must flip at least one of the opponent's piece[39;49;00m[37m[39;49;00m
    91	[37m[39;49;00m
    92	([34mdefine[39;49;00m[37m [39;49;00m([31mlegal-move?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
    93	[37m  [39;49;00m([34mand[39;49;00m[37m [39;49;00m
    94	[37m     [39;49;00m([31mempty-square?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m)[37m[39;49;00m
    95	[37m     [39;49;00m([34mexists[39;49;00m[37m [39;49;00m([34mfn[39;49;00m[37m [39;49;00m([31mdir[39;49;00m)[37m [39;49;00m([31mwould-flip?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[33mdir[39;49;00m))[37m [39;49;00m[33mall-directions[39;49;00m)))[37m[39;49;00m
    96	[37m[39;49;00m
    97	[37m; would this move by player result in any flips in the given direction?[39;49;00m[37m[39;49;00m
    98	[37m; if so, return the number of the 'opposite' (bracketing) piece's square[39;49;00m[37m[39;49;00m
    99	[37m[39;49;00m
   100	([34mdefine[39;49;00m[37m [39;49;00m([31mwould-flip?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[33mdir[39;49;00m)[37m [39;49;00m
   101	[37m  [39;49;00m([34mlet[39;49;00m[37m [39;49;00m
   102	[37m     [39;49;00m(([31mc[39;49;00m[37m [39;49;00m([31m+[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mdir[39;49;00m)))[37m[39;49;00m
   103	[37m     [39;49;00m([34mand[39;49;00m[37m [39;49;00m
   104	[37m        [39;49;00m([31m=[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33mc[39;49;00m)[37m [39;49;00m([31mopponent[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))[37m[39;49;00m
   105	[37m        [39;49;00m([34mfind[39;49;00m[34m-[39;49;00m[33mbracketing-piece[39;49;00m[37m [39;49;00m([31m+[39;49;00m[37m [39;49;00m[33mc[39;49;00m[37m [39;49;00m[33mdir[39;49;00m)[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[33mdir[39;49;00m))))[37m[39;49;00m
   106	[37m  [39;49;00m
   107	([34mdefine[39;49;00m[37m [39;49;00m([34mfind[39;49;00m[34m-[39;49;00m[33mbracketing-piece[39;49;00m[37m [39;49;00m[33msquare[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[33mdir[39;49;00m)[37m[39;49;00m
   108	[37m  [39;49;00m[37m; return the square of the bracketing piece, if any[39;49;00m[37m[39;49;00m
   109	[37m  [39;49;00m([34mcond[39;49;00m[37m[39;49;00m
   110	[37m     [39;49;00m(([31m=[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33msquare[39;49;00m)[37m [39;49;00m[33mplayer[39;49;00m)[37m [39;49;00m[33msquare[39;49;00m)[37m[39;49;00m
   111	[37m     [39;49;00m(([31m=[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33msquare[39;49;00m)[37m [39;49;00m([31mopponent[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))[37m[39;49;00m
   112	[37m        [39;49;00m([34mfind[39;49;00m[34m-[39;49;00m[33mbracketing-piece[39;49;00m[37m [39;49;00m([31m+[39;49;00m[37m [39;49;00m[33msquare[39;49;00m[37m [39;49;00m[33mdir[39;49;00m)[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[33mdir[39;49;00m))[37m[39;49;00m
   113	[37m     [39;49;00m([34mtrue[39;49;00m[37m [39;49;00m[34mnil[39;49;00m)))[37m[39;49;00m
   114	[37m[39;49;00m
   115	([34mdefine[39;49;00m[37m [39;49;00m([31mmake-flips[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[33mdir[39;49;00m)[37m[39;49;00m
   116	[37m  [39;49;00m([34mlet[39;49;00m[37m [39;49;00m
   117	[37m     [39;49;00m(([31mbracketer[39;49;00m[37m [39;49;00m([31mwould-flip?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[33mdir[39;49;00m))[37m[39;49;00m
   118	[37m      [39;49;00m([31mc[39;49;00m[37m [39;49;00m([31m+[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mdir[39;49;00m)))[37m[39;49;00m
   119	[37m  [39;49;00m([34mif[39;49;00m[37m [39;49;00m[33mbracketer[39;49;00m[37m[39;49;00m
   120	[37m     [39;49;00m([34mdo-until[39;49;00m[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m[33mc[39;49;00m[37m [39;49;00m[33mbracketer[39;49;00m)[37m[39;49;00m
   121	[37m        [39;49;00m([34msetf[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33mc[39;49;00m)[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   122	[37m        [39;49;00m([34mpush[39;49;00m[37m [39;49;00m[33mc[39;49;00m[37m [39;49;00m[34m*[39;49;00m[33mflips*[39;49;00m[37m [39;49;00m[34m-[39;49;00m[33m1[39;49;00m)[37m[39;49;00m
   123	[37m        [39;49;00m([34minc[39;49;00m[37m [39;49;00m[33mc[39;49;00m[37m [39;49;00m[33mdir[39;49;00m)))))[37m[39;49;00m
   124	[37m[39;49;00m
   125	[37m; make the move on the master game board, not yet visually[39;49;00m[37m[39;49;00m
   126	[37m[39;49;00m
   127	([34mdefine[39;49;00m[37m [39;49;00m([31mmake-move[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   128	[37m  [39;49;00m([34msetf[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33mmove[39;49;00m)[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   129	[37m  [39;49;00m([34mpush[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[34m*[39;49;00m[33mmoves*[39;49;00m[37m [39;49;00m[34m-[39;49;00m[33m1[39;49;00m)[37m[39;49;00m
   130	[37m  [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[34m*[39;49;00m[33mflips*[39;49;00m[37m [39;49;00m'())[37m [39;49;00m[37m; we're going to keep a record of the flips made[39;49;00m[37m[39;49;00m
   131	[37m  [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mdir[39;49;00m[37m [39;49;00m[33mall-directions[39;49;00m)[37m[39;49;00m
   132	[37m     [39;49;00m([31mmake-flips[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[33mdir[39;49;00m)))[37m[39;49;00m
   133	[37m[39;49;00m
   134	([34mdefine[39;49;00m[37m [39;49;00m([31mnext-to-play[39;49;00m[37m [39;49;00m[33mprevious-player[39;49;00m)[37m[39;49;00m
   135	[37m  [39;49;00m([34mlet[39;49;00m[37m [39;49;00m(([31mopp[39;49;00m[37m [39;49;00m([31mopponent[39;49;00m[37m [39;49;00m[33mprevious-player[39;49;00m)))[37m[39;49;00m
   136	[37m     [39;49;00m([34mcond[39;49;00m[37m[39;49;00m
   137	[37m        [39;49;00m(([31many-legal-move?[39;49;00m[37m [39;49;00m[33mopp[39;49;00m)[37m [39;49;00m[33mopp[39;49;00m)[37m[39;49;00m
   138	[37m        [39;49;00m(([31many-legal-move?[39;49;00m[37m [39;49;00m[33mprevious-player[39;49;00m)[37m[39;49;00m
   139	[37m           [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m([31mplayer-name[39;49;00m[37m [39;49;00m[33mopp[39;49;00m)[37m [39;49;00m[33m" has no moves"[39;49;00m)[37m[39;49;00m
   140	[37m           [39;49;00m[33mprevious-player[39;49;00m)[37m[39;49;00m
   141	[37m        [39;49;00m([34mtrue[39;49;00m[37m [39;49;00m[34mnil[39;49;00m))))[37m[39;49;00m
   142	[37m        [39;49;00m
   143	[37m; are there any legal moves (returns first) for this player?[39;49;00m[37m[39;49;00m
   144	([34mdefine[39;49;00m[37m [39;49;00m([31many-legal-move?[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   145	[37m  [39;49;00m([34mexists[39;49;00m[37m [39;49;00m([34mfn[39;49;00m[37m [39;49;00m([31mmove[39;49;00m)[37m [39;49;00m([31mlegal-move?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))[37m [39;49;00m
   146	[37m     [39;49;00m([31mall-squares[39;49;00m)))[37m[39;49;00m
   147	[37m[39;49;00m
   148	[37m; a list of all legal moves might be useful[39;49;00m[37m[39;49;00m
   149	([34mdefine[39;49;00m[37m [39;49;00m([31mlegal-moves[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   150	[37m  [39;49;00m([34mlet[39;49;00m[37m [39;49;00m(([31mresult[39;49;00m[37m [39;49;00m'()))[37m[39;49;00m
   151	[37m     [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mmove[39;49;00m[37m [39;49;00m([31mall-squares[39;49;00m))[37m[39;49;00m
   152	[37m        [39;49;00m([34mif[39;49;00m[37m [39;49;00m([31mlegal-move?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   153	[37m           [39;49;00m([34mpush[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mresult[39;49;00m)))[37m[39;49;00m
   154	[37m  [39;49;00m([34munique[39;49;00m[37m [39;49;00m[33mresult[39;49;00m)))[37m[39;49;00m
   155	[37m[39;49;00m
   156	[37m; define any number of strategies that can be called on to calculate[39;49;00m[37m[39;49;00m
   157	[37m; the next computer move. This is the only one I've done... - make [39;49;00m[37m[39;49;00m
   158	[37m; any legal move at random![39;49;00m[37m[39;49;00m
   159	[37m[39;49;00m
   160	([34mdefine[39;49;00m[37m [39;49;00m([34mrandom[39;49;00m[34m-[39;49;00m[33mstrategy[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   161	[37m  [39;49;00m([34mseed[39;49;00m[37m [39;49;00m([34mdate-value[39;49;00m))[37m[39;49;00m
   162	[37m  [39;49;00m([34mapply[39;49;00m[37m [39;49;00m[34mamb[39;49;00m[37m [39;49;00m([31mlegal-moves[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)))[37m[39;49;00m
   163	[37m[39;49;00m
   164	[37m; get the next move using a particular strategy[39;49;00m[37m[39;49;00m
   165	[37m[39;49;00m
   166	([34mdefine[39;49;00m[37m [39;49;00m([31mget-move[39;49;00m[37m [39;49;00m[33mstrategy[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   167	[37m [39;49;00m([34mlet[39;49;00m[37m [39;49;00m(([31mmove[39;49;00m[37m [39;49;00m([34mapply[39;49;00m[37m [39;49;00m[33mstrategy[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))))[37m[39;49;00m
   168	[37m  [39;49;00m([34mcond[39;49;00m[37m[39;49;00m
   169	[37m     [39;49;00m(([34mand[39;49;00m[37m[39;49;00m
   170	[37m        [39;49;00m([31mvalid-move?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m)[37m[39;49;00m
   171	[37m        [39;49;00m([31mlegal-move?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))[37m[39;49;00m
   172	[37m            [39;49;00m([31mmake-move[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))[37m[39;49;00m
   173	[37m     [39;49;00m([34mtrue[39;49;00m[37m  [39;49;00m
   174	[37m        [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m[33m"no valid or legal move for "[39;49;00m[37m [39;49;00m([31mplayer-name[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m [39;49;00m)[37m[39;49;00m
   175	[37m        [39;49;00m[34mnil[39;49;00m))[37m[39;49;00m
   176	[37m  [39;49;00m[33mmove[39;49;00m))[37m[39;49;00m
   177	[37m[39;49;00m
   178	[37m; that's about all the game algorithms for now[39;49;00m[37m[39;49;00m
   179	[37m; now for the interface[39;49;00m[37m[39;49;00m
   180	[37m[39;49;00m
   181	([34mif[39;49;00m[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m[34mostype[39;49;00m[37m [39;49;00m[33m"Win32"[39;49;00m)[37m[39;49;00m
   182	[37m   [39;49;00m([34mload[39;49;00m[37m [39;49;00m([34mstring[39;49;00m[37m [39;49;00m([34menv[39;49;00m[37m [39;49;00m[33m"PROGRAMFILES"[39;49;00m)[37m [39;49;00m[33m"/newlisp/guiserver.lsp"[39;49;00m))[37m[39;49;00m
   183	[37m   [39;49;00m([34mload[39;49;00m[37m [39;49;00m[33m"/usr/share/newlisp/guiserver.lsp"[39;49;00m)[37m[39;49;00m
   184	)[37m[39;49;00m
   185	[37m[39;49;00m
   186	([31mgs[39;49;00m:[33minit[39;49;00m)[37m[39;49;00m
   187	([34mmap[39;49;00m[37m [39;49;00m[34mset[39;49;00m[37m [39;49;00m'([31mscreen-width[39;49;00m[37m [39;49;00m[33mscreen-height[39;49;00m)[37m [39;49;00m([31mgs[39;49;00m:[33mget-screen[39;49;00m))[37m[39;49;00m
   188	([34mset[39;49;00m[37m [39;49;00m'[33mboard-width[39;49;00m[37m [39;49;00m[33m540[39;49;00m)[37m[39;49;00m
   189	[37m; center on screen[39;49;00m[37m[39;49;00m
   190	([31mgs[39;49;00m:[33mframe[39;49;00m[37m [39;49;00m'[33mReversi[39;49;00m[37m [39;49;00m([31m-[39;49;00m[37m [39;49;00m([31m/[39;49;00m[37m [39;49;00m[33mscreen-width[39;49;00m[37m [39;49;00m[33m2[39;49;00m)[37m [39;49;00m([31m/[39;49;00m[37m [39;49;00m[33mboard-width[39;49;00m[37m [39;49;00m[33m2[39;49;00m))[37m [39;49;00m[33m60[39;49;00m[37m [39;49;00m[33mboard-width[39;49;00m[37m [39;49;00m[33m660[39;49;00m[37m [39;49;00m[33m"Reversi"[39;49;00m)[37m[39;49;00m
   191	([31mgs[39;49;00m:[34mset[39;49;00m[34m-[39;49;00m[33mborder-layout[39;49;00m[37m [39;49;00m'[33mReversi[39;49;00m)[37m[39;49;00m
   192	[37m[39;49;00m
   193	([31mgs[39;49;00m:[33mcanvas[39;49;00m[37m [39;49;00m'[33mMyCanvas[39;49;00m[37m [39;49;00m'[33mReversi[39;49;00m)[37m[39;49;00m
   194	[37m  [39;49;00m([31mgs[39;49;00m:[34mset[39;49;00m[34m-[39;49;00m[33mbackground[39;49;00m[37m [39;49;00m'[33mMyCanvas[39;49;00m[37m [39;49;00m'([31m.8[39;49;00m[37m [39;49;00m[33m.9[39;49;00m[37m [39;49;00m[33m.7[39;49;00m[37m [39;49;00m[33m.8[39;49;00m))[37m[39;49;00m
   195	[37m  [39;49;00m([31mgs[39;49;00m:[33mmouse-released[39;49;00m[37m [39;49;00m'[33mMyCanvas[39;49;00m[37m [39;49;00m'[33mmouse-released-action[39;49;00m[37m [39;49;00m[34mtrue[39;49;00m)[37m[39;49;00m
   196	[37m[39;49;00m
   197	([31mgs[39;49;00m:[33mpanel[39;49;00m[37m [39;49;00m'[33mControls[39;49;00m)[37m[39;49;00m
   198	[37m  [39;49;00m([31mgs[39;49;00m:[33mbutton[39;49;00m[37m [39;49;00m'[33mStart[39;49;00m[37m [39;49;00m'[33mstart-game[39;49;00m[37m [39;49;00m[33m"Start"[39;49;00m)[37m[39;49;00m
   199	[37m[39;49;00m
   200	([31mgs[39;49;00m:[33mpanel[39;49;00m[37m [39;49;00m'[33mLower[39;49;00m)[37m[39;49;00m
   201	[37m  [39;49;00m([31mgs[39;49;00m:[33mlabel[39;49;00m[37m [39;49;00m'[33mWhiteScore[39;49;00m[37m [39;49;00m[33m""[39;49;00m)[37m[39;49;00m
   202	[37m  [39;49;00m([31mgs[39;49;00m:[33mlabel[39;49;00m[37m [39;49;00m'[33mBlackScore[39;49;00m[37m [39;49;00m[33m""[39;49;00m)[37m[39;49;00m
   203	[37m[39;49;00m
   204	([31mgs[39;49;00m:[34madd[39;49;00m[34m-[39;49;00m[33mto[39;49;00m[37m [39;49;00m'[33mControls[39;49;00m[37m [39;49;00m'[33mStart[39;49;00m[37m [39;49;00m)[37m[39;49;00m
   205	([31mgs[39;49;00m:[34madd[39;49;00m[34m-[39;49;00m[33mto[39;49;00m[37m [39;49;00m'[33mLower[39;49;00m[37m [39;49;00m'[33mWhiteScore[39;49;00m[37m [39;49;00m'[33mBlackScore[39;49;00m)[37m[39;49;00m
   206	([31mgs[39;49;00m:[34madd[39;49;00m[34m-[39;49;00m[33mto[39;49;00m[37m [39;49;00m'[33mReversi[39;49;00m[37m [39;49;00m'[33mMyCanvas[39;49;00m[37m [39;49;00m[33m"center"[39;49;00m[37m [39;49;00m'[33mControls[39;49;00m[37m [39;49;00m[33m"north"[39;49;00m[37m [39;49;00m'[33mLower[39;49;00m[37m [39;49;00m[33m"south"[39;49;00m)[37m[39;49;00m
   207	[37m[39;49;00m
   208	([31mgs[39;49;00m:[34mset[39;49;00m[34m-[39;49;00m[33manti-aliasing[39;49;00m[37m [39;49;00m[34mtrue[39;49;00m)[37m[39;49;00m
   209	([31mgs[39;49;00m:[34mset[39;49;00m[34m-[39;49;00m[33mvisible[39;49;00m[37m [39;49;00m'[33mReversi[39;49;00m[37m [39;49;00m[34mtrue[39;49;00m)[37m[39;49;00m
   210	[37m[39;49;00m
   211	[37m; size of board square, and radius/width of counter[39;49;00m[37m[39;49;00m
   212	([34mset[39;49;00m[37m [39;49;00m'[33msize[39;49;00m[37m [39;49;00m[33m60[39;49;00m[37m [39;49;00m'[33mwidth[39;49;00m[37m [39;49;00m[33m30[39;49;00m)[37m[39;49;00m
   213	[37m[39;49;00m
   214	[37m; initialize the master board[39;49;00m[37m[39;49;00m
   215	[37m[39;49;00m
   216	([34mdefine[39;49;00m[37m [39;49;00m([31minitial-board[39;49;00m)[37m[39;49;00m
   217	[37m  [39;49;00m([31mmake-board[39;49;00m)[37m[39;49;00m
   218	[37m  [39;49;00m([34msetf[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33m44[39;49;00m)[37m [39;49;00m[33mwhite[39;49;00m)[37m[39;49;00m
   219	[37m  [39;49;00m([34msetf[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33m55[39;49;00m)[37m [39;49;00m[33mwhite[39;49;00m)[37m[39;49;00m
   220	[37m  [39;49;00m([34msetf[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33m45[39;49;00m)[37m [39;49;00m[33mblack[39;49;00m)[37m[39;49;00m
   221	[37m  [39;49;00m([34msetf[39;49;00m[37m [39;49;00m([34m*[39;49;00m[33mboard*[39;49;00m[37m [39;49;00m[33m54[39;49;00m)[37m [39;49;00m[33mblack[39;49;00m)[37m  [39;49;00m
   222	)[37m[39;49;00m
   223	[37m[39;49;00m
   224	[37m; draw a graphical repesentation of the board[39;49;00m[37m[39;49;00m
   225	[37m[39;49;00m
   226	([34mdefine[39;49;00m[37m [39;49;00m([31mdraw-board[39;49;00m)[37m[39;49;00m
   227	[37m  [39;49;00m([34mlocal[39;49;00m[37m [39;49;00m([31mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m[39;49;00m
   228	[37m     [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mi[39;49;00m[37m [39;49;00m([31mall-squares[39;49;00m))[37m[39;49;00m
   229	[37m        [39;49;00m([34mmap[39;49;00m[37m [39;49;00m[34mset[39;49;00m[37m [39;49;00m'([31mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m [39;49;00m([31msquare-to-xy[39;49;00m[37m [39;49;00m[33mi[39;49;00m))[37m[39;49;00m
   230	[37m        [39;49;00m([31mgs[39;49;00m:[33mdraw-rect[39;49;00m[37m [39;49;00m
   231	[37m           [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m [39;49;00m
   232	[37m           [39;49;00m([31m-[39;49;00m[37m [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m)[37m [39;49;00m[37m; !!!!!![39;49;00m[37m[39;49;00m
   233	[37m           [39;49;00m([31m-[39;49;00m[37m [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m)[37m[39;49;00m
   234	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m[33m2[39;49;00m)[37m[39;49;00m
   235	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m[33m2[39;49;00m)[37m[39;49;00m
   236	[37m           [39;49;00m[33mgs[39;49;00m:[33mwhite[39;49;00m))))[37m[39;49;00m
   237	[37m[39;49;00m
   238	([34mdefine[39;49;00m[37m [39;49;00m([31mdraw-first-four-pieces[39;49;00m)[37m[39;49;00m
   239	[37m  [39;49;00m([31mdraw-piece[39;49;00m[37m [39;49;00m[33m44[39;49;00m[37m [39;49;00m[33m"white"[39;49;00m)[37m[39;49;00m
   240	[37m  [39;49;00m([31mdraw-piece[39;49;00m[37m [39;49;00m[33m55[39;49;00m[37m [39;49;00m[33m"white"[39;49;00m)[37m[39;49;00m
   241	[37m  [39;49;00m([31mdraw-piece[39;49;00m[37m [39;49;00m[33m45[39;49;00m[37m [39;49;00m[33m"black"[39;49;00m)[37m[39;49;00m
   242	[37m  [39;49;00m([31mdraw-piece[39;49;00m[37m [39;49;00m[33m54[39;49;00m[37m [39;49;00m[33m"black"[39;49;00m))[37m[39;49;00m
   243	[37m[39;49;00m
   244	[37m; this next function can mark the legal moves available to a player[39;49;00m[37m[39;49;00m
   245	[37m[39;49;00m
   246	([34mdefine[39;49;00m[37m [39;49;00m([31mshow-legal-moves[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   247	[37m  [39;49;00m([34mlocal[39;49;00m[37m [39;49;00m([31mlegal-move-list[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m[39;49;00m
   248	[37m     [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mlegal-move-list[39;49;00m[37m [39;49;00m([31mlegal-moves[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))[37m[39;49;00m
   249	[37m     [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mm[39;49;00m[37m [39;49;00m([31mall-squares[39;49;00m))[37m[39;49;00m
   250	[37m        [39;49;00m([34mmap[39;49;00m[37m [39;49;00m[34mset[39;49;00m[37m [39;49;00m'([31mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m [39;49;00m([31msquare-to-xy[39;49;00m[37m [39;49;00m[33mm[39;49;00m))[37m[39;49;00m
   251	[37m        [39;49;00m([31mgs[39;49;00m:[33mdraw-rect[39;49;00m[37m [39;49;00m
   252	[37m           [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m [39;49;00m
   253	[37m           [39;49;00m([31m-[39;49;00m[37m [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m)[37m [39;49;00m[37m; !!!!!![39;49;00m[37m[39;49;00m
   254	[37m           [39;49;00m([31m-[39;49;00m[37m [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m)[37m[39;49;00m
   255	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m[33m2[39;49;00m)[37m[39;49;00m
   256	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m[33m2[39;49;00m)[37m[39;49;00m
   257	[37m           [39;49;00m([34mif[39;49;00m[37m [39;49;00m([34mfind[39;49;00m[37m [39;49;00m[33mm[39;49;00m[37m [39;49;00m[33mlegal-move-list[39;49;00m)[37m [39;49;00m[33mgs[39;49;00m:[33mblue[39;49;00m[37m [39;49;00m[33mgs[39;49;00m:[33mwhite[39;49;00m)[37m[39;49;00m
   258	[37m        [39;49;00m)[37m[39;49;00m
   259	[37m     [39;49;00m)[37m[39;49;00m
   260	[37m  [39;49;00m)[37m[39;49;00m
   261	)[37m[39;49;00m
   262	[37m[39;49;00m
   263	[37m; convert the number of a square on the master board to coordinates[39;49;00m[37m[39;49;00m
   264	[37m[39;49;00m
   265	([34mdefine[39;49;00m[37m [39;49;00m([31msquare-to-xy[39;49;00m[37m [39;49;00m[33msquare[39;49;00m)[37m [39;49;00m
   266	[37m  [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([31m/[39;49;00m[37m [39;49;00m[33msquare[39;49;00m[37m [39;49;00m[33m10[39;49;00m)[37m [39;49;00m([34mmod[39;49;00m[37m [39;49;00m[33msquare[39;49;00m[37m [39;49;00m[33m10[39;49;00m)))[37m[39;49;00m
   267	[37m[39;49;00m
   268	[37m; draw one of the pieces[39;49;00m[37m[39;49;00m
   269	[37m[39;49;00m
   270	([34mdefine[39;49;00m[37m [39;49;00m([31mdraw-piece[39;49;00m[37m [39;49;00m[33msquare[39;49;00m[37m [39;49;00m[33mcolour[39;49;00m)[37m[39;49;00m
   271	[37m  [39;49;00m([34mlocal[39;49;00m[37m [39;49;00m([31mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m[39;49;00m
   272	[37m  [39;49;00m([34mmap[39;49;00m[37m [39;49;00m[34mset[39;49;00m[37m [39;49;00m'([31mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m [39;49;00m([31msquare-to-xy[39;49;00m[37m [39;49;00m[33msquare[39;49;00m))[37m[39;49;00m
   273	[37m  [39;49;00m([34mcond[39;49;00m[37m [39;49;00m
   274	[37m     [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcolour[39;49;00m[37m [39;49;00m[33m"white"[39;49;00m)[37m [39;49;00m
   275	[37m        [39;49;00m([31mgs[39;49;00m:[33mfill-circle[39;49;00m[37m [39;49;00m
   276	[37m           [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m [39;49;00m
   277	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m  [39;49;00m[37m; !!!!!!! y first, cos y is x ;-)[39;49;00m[37m[39;49;00m
   278	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m
   279	[37m           [39;49;00m[33mwidth[39;49;00m[37m[39;49;00m
   280	[37m           [39;49;00m[33mgs[39;49;00m:[33mwhite[39;49;00m))[37m[39;49;00m
   281	[37m     [39;49;00m
   282	[37m     [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcolour[39;49;00m[37m [39;49;00m[33m"black"[39;49;00m)[37m [39;49;00m
   283	[37m        [39;49;00m([31mgs[39;49;00m:[33mfill-circle[39;49;00m[37m [39;49;00m
   284	[37m           [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m [39;49;00m
   285	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m
   286	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m
   287	[37m           [39;49;00m[33mwidth[39;49;00m[37m[39;49;00m
   288	[37m           [39;49;00m[33mgs[39;49;00m:[33mblack[39;49;00m))[37m[39;49;00m
   289	[37m     [39;49;00m
   290	[37m     [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcolour[39;49;00m[37m [39;49;00m[33m"empty"[39;49;00m)[37m [39;49;00m
   291	[37m        [39;49;00m([31mgs[39;49;00m:[33mdraw-rect[39;49;00m[37m [39;49;00m
   292	[37m           [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m [39;49;00m
   293	[37m           [39;49;00m([31m-[39;49;00m[37m [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m)[37m [39;49;00m
   294	[37m           [39;49;00m([31m-[39;49;00m[37m [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m)[37m[39;49;00m
   295	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m[33m2[39;49;00m)[37m[39;49;00m
   296	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m[33m2[39;49;00m)[37m[39;49;00m
   297	[37m           [39;49;00m[33mgs[39;49;00m:[33mwhite[39;49;00m))[37m[39;49;00m
   298	[37m  [39;49;00m)))[37m[39;49;00m
   299	[37m[39;49;00m
   300	[37m; animate the pieces flipping[39;49;00m[37m[39;49;00m
   301	[37m[39;49;00m
   302	([34mdefine[39;49;00m[37m [39;49;00m([31mflip-piece[39;49;00m[37m [39;49;00m[33msquare[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   303	[37m; flip by drawing thinner and fatter ellipses [39;49;00m[37m[39;49;00m
   304	[37m; go from full disk in opposite colour to invisible[39;49;00m[37m[39;49;00m
   305	[37m; then from invisible to full disk in true colour[39;49;00m[37m[39;49;00m
   306	[37m  [39;49;00m([34mlocal[39;49;00m[37m [39;49;00m([31mx[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33mcolour[39;49;00m)[37m[39;49;00m
   307	[37m     [39;49;00m([34mmap[39;49;00m[37m [39;49;00m[34mset[39;49;00m[37m [39;49;00m'([31mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m [39;49;00m([31msquare-to-xy[39;49;00m[37m [39;49;00m[33msquare[39;49;00m))[37m[39;49;00m
   308	[37m     [39;49;00m[37m; delete original piece[39;49;00m[37m[39;49;00m
   309	[37m     [39;49;00m([31mgs[39;49;00m:[34mdelete[39;49;00m[34m-[39;49;00m[33mtag[39;49;00m[37m [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m))[37m[39;49;00m
   310	[37m     [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mcolour[39;49;00m[37m [39;49;00m([34mif[39;49;00m[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[33m2[39;49;00m)[37m [39;49;00m[33mgs[39;49;00m:[33mblack[39;49;00m[37m [39;49;00m[33mgs[39;49;00m:[33mwhite[39;49;00m[37m [39;49;00m))[37m [39;49;00m
   311	[37m     [39;49;00m([34mfor[39;49;00m[37m [39;49;00m([31mi[39;49;00m[37m [39;49;00m[33mwidth[39;49;00m[37m  [39;49;00m[33m1[39;49;00m[37m [39;49;00m[34m-[39;49;00m[33m3[39;49;00m)[37m[39;49;00m
   312	[37m        [39;49;00m([31mgs[39;49;00m:[33mfill-ellipse[39;49;00m[37m [39;49;00m
   313	[37m           [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mflip[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mi[39;49;00m)[37m [39;49;00m
   314	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m[37m; y first :-) !!! [39;49;00m[37m[39;49;00m
   315	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m
   316	[37m           [39;49;00m[33mi[39;49;00m[37m [39;49;00m
   317	[37m           [39;49;00m[33mwidth[39;49;00m[37m[39;49;00m
   318	[37m           [39;49;00m[33mcolour[39;49;00m)[37m[39;49;00m
   319	[37m        [39;49;00m([34msleep[39;49;00m[37m [39;49;00m[33m20[39;49;00m)[37m  [39;49;00m[37m; this might need adjusting...[39;49;00m[37m[39;49;00m
   320	[37m        [39;49;00m([31mgs[39;49;00m:[34mdelete[39;49;00m[34m-[39;49;00m[33mtag[39;49;00m[37m [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mflip[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mi[39;49;00m))[37m[39;49;00m
   321	[37m     [39;49;00m)[37m[39;49;00m
   322	[37m     [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mcolour[39;49;00m[37m [39;49;00m([34mif[39;49;00m[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[33m2[39;49;00m)[37m [39;49;00m[33mgs[39;49;00m:[33mwhite[39;49;00m[37m [39;49;00m[33mgs[39;49;00m:[33mblack[39;49;00m))[37m[39;49;00m
   323	[37m     [39;49;00m([34mfor[39;49;00m[37m [39;49;00m([31mi[39;49;00m[37m [39;49;00m[33m1[39;49;00m[37m [39;49;00m[33mwidth[39;49;00m[37m [39;49;00m[33m3[39;49;00m)[37m[39;49;00m
   324	[37m        [39;49;00m([31mgs[39;49;00m:[33mfill-ellipse[39;49;00m[37m [39;49;00m
   325	[37m           [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mflip[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mi[39;49;00m)[37m [39;49;00m
   326	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m[37m; :-) !!! [39;49;00m[37m[39;49;00m
   327	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m
   328	[37m           [39;49;00m[33mi[39;49;00m[37m [39;49;00m
   329	[37m           [39;49;00m[33mwidth[39;49;00m[37m[39;49;00m
   330	[37m           [39;49;00m[33mcolour[39;49;00m)[37m[39;49;00m
   331	[37m        [39;49;00m([34msleep[39;49;00m[37m [39;49;00m[33m20[39;49;00m)[37m  [39;49;00m
   332	[37m        [39;49;00m([31mgs[39;49;00m:[34mdelete[39;49;00m[34m-[39;49;00m[33mtag[39;49;00m[37m [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mflip[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mi[39;49;00m))[37m[39;49;00m
   333	[37m     [39;49;00m)[37m[39;49;00m
   334	[37m     [39;49;00m[37m; draw the piece again[39;49;00m[37m[39;49;00m
   335	[37m     [39;49;00m([31mgs[39;49;00m:[33mfill-circle[39;49;00m[37m [39;49;00m
   336	[37m           [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m)[37m [39;49;00m
   337	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m[39;49;00m
   338	[37m           [39;49;00m([31m*[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33msize[39;49;00m)[37m [39;49;00m
   339	[37m           [39;49;00m[33mwidth[39;49;00m[37m[39;49;00m
   340	[37m           [39;49;00m[33mcolour[39;49;00m)[37m[39;49;00m
   341	[37m  [39;49;00m)[37m[39;49;00m
   342	)[37m[39;49;00m
   343	[37m[39;49;00m
   344	([34mdefine[39;49;00m[37m [39;49;00m([31mdo-move[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   345	[37m  [39;49;00m([34mcond[39;49;00m[37m [39;49;00m
   346	[37m     [39;49;00m[37m; check if the move is good ...[39;49;00m[37m[39;49;00m
   347	[37m     [39;49;00m(([34mand[39;49;00m[37m [39;49;00m([31m!=[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m[37m [39;49;00m[34mnil[39;49;00m)[37m[39;49;00m
   348	[37m           [39;49;00m([31mvalid-move?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m)[37m[39;49;00m
   349	[37m           [39;49;00m([31mlegal-move?[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))[37m[39;49;00m
   350	[37m           [39;49;00m
   351	[37m           [39;49;00m[37m; ... play it[39;49;00m[37m[39;49;00m
   352	[37m              [39;49;00m[37m; make move on board[39;49;00m[37m[39;49;00m
   353	[37m              [39;49;00m([31mmake-move[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   354	[37m              [39;49;00m[37m; and on screen[39;49;00m[37m[39;49;00m
   355	[37m              [39;49;00m([31mdraw-piece[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m([31mplayer-name[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))[37m[39;49;00m
   356	[37m              [39;49;00m([31mgs[39;49;00m:[33mupdate[39;49;00m)[37m[39;49;00m
   357	[37m              [39;49;00m[37m; do flipping stuff[39;49;00m[37m[39;49;00m
   358	[37m              [39;49;00m
   359	[37m              [39;49;00m[37m; wait for a while[39;49;00m[37m[39;49;00m
   360	[37m              [39;49;00m([34msleep[39;49;00m[37m [39;49;00m[33m1000[39;49;00m)[37m[39;49;00m
   361	[37m  [39;49;00m
   362	[37m              [39;49;00m[37m; then do flipping[39;49;00m[37m[39;49;00m
   363	[37m              [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mf[39;49;00m[37m [39;49;00m[34m*[39;49;00m[33mflips*[39;49;00m)[37m[39;49;00m
   364	[37m                 [39;49;00m([31mflip-piece[39;49;00m[37m [39;49;00m[33mf[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))[37m[39;49;00m
   365	[37m              [39;49;00m
   366	[37m              [39;49;00m([34minc[39;49;00m[37m [39;49;00m[34m*[39;49;00m[33mmove-number*[39;49;00m)[37m[39;49;00m
   367	[37m              [39;49;00m([31mdraw-piece[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m([31mplayer-name[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))[37m[39;49;00m
   368	[37m              [39;49;00m([31mgs[39;49;00m:[33mupdate[39;49;00m)[37m[39;49;00m
   369	[37m[39;49;00m
   370	[37m              [39;49;00m[37m; update scores[39;49;00m[37m[39;49;00m
   371	[37m              [39;49;00m([31mgs[39;49;00m:[34mset[39;49;00m[34m-[39;49;00m[33mtext[39;49;00m[37m [39;49;00m'[33mWhiteScore[39;49;00m[37m [39;49;00m
   372	[37m                 [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33m"White: "[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mcount[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33mwhite[39;49;00m)[37m [39;49;00m[34m*[39;49;00m[33mboard*[39;49;00m))))[37m[39;49;00m
   373	[37m              [39;49;00m([31mgs[39;49;00m:[34mset[39;49;00m[34m-[39;49;00m[33mtext[39;49;00m[37m [39;49;00m'[33mBlackScore[39;49;00m[37m[39;49;00m
   374	[37m                 [39;49;00m([34mstring[39;49;00m[37m [39;49;00m[33m"Black: "[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mcount[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33mblack[39;49;00m)[37m [39;49;00m[34m*[39;49;00m[33mboard*[39;49;00m))))[37m[39;49;00m
   375	[37m              [39;49;00m)[37m[39;49;00m
   376	[37m     [39;49;00m[37m; or return nil[39;49;00m[37m[39;49;00m
   377	[37m     [39;49;00m([34mtrue[39;49;00m[37m [39;49;00m
   378	[37m           [39;49;00m[34mnil[39;49;00m)))[37m[39;49;00m
   379	[37m[39;49;00m
   380	[37m; the game is driven by the mouse clicks of the user[39;49;00m[37m[39;49;00m
   381	[37m; in reply, the computer plays a black piece[39;49;00m[37m[39;49;00m
   382	[37m; premature clicking is possible and possibly a bad thing...[39;49;00m[37m[39;49;00m
   383	[37m[39;49;00m
   384	([34mdefine[39;49;00m[37m [39;49;00m([31mmouse-released-action[39;49;00m[37m [39;49;00m[33mx[39;49;00m[37m [39;49;00m[33my[39;49;00m[37m [39;49;00m[33mbutton[39;49;00m[37m [39;49;00m[33mmodifiers[39;49;00m[37m [39;49;00m[33mtags[39;49;00m)[37m[39;49;00m
   385	[37m  [39;49;00m[37m; extract the tag of the clicked square[39;49;00m[37m[39;49;00m
   386	[37m  [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mmove[39;49;00m[37m [39;49;00m([34mint[39;49;00m[37m [39;49;00m([34mstring[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m[33mtags[39;49;00m))[37m [39;49;00m[33m0[39;49;00m[37m [39;49;00m[33m10[39;49;00m))[37m[39;49;00m
   387	[37m  [39;49;00m([34mif[39;49;00m[37m [39;49;00m([31mdo-move[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   388	[37m     [39;49;00m([34mbegin[39;49;00m[37m[39;49;00m
   389	[37m        [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mplayer[39;49;00m[37m [39;49;00m([31mnext-to-play[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))[37m[39;49;00m
   390	[37m        [39;49;00m[37m; there is a training mode - legal squares are highlighted[39;49;00m[37m[39;49;00m
   391	[37m        [39;49;00m[37m; you can uncomment the next line...[39;49;00m[37m[39;49;00m
   392	[37m        [39;49;00m[37m; (show-legal-moves player)[39;49;00m[37m[39;49;00m
   393	[37m        [39;49;00m([31mgs[39;49;00m:[33mupdate[39;49;00m)[37m[39;49;00m
   394	[37m        [39;49;00m
   395	[37m        [39;49;00m[37m; wait for black's reply[39;49;00m[37m[39;49;00m
   396	[37m        [39;49;00m([31mgs[39;49;00m:[34mset[39;49;00m[34m-[39;49;00m[33mcursor[39;49;00m[37m [39;49;00m'[33mReversi[39;49;00m[37m [39;49;00m[33m"wait"[39;49;00m)[37m[39;49;00m
   397	[37m        [39;49;00m([31mgs[39;49;00m:[34mset[39;49;00m[34m-[39;49;00m[33mtext[39;49;00m[37m [39;49;00m'[33mStart[39;49;00m[37m [39;49;00m[33m"black's move - thinking..."[39;49;00m)[37m[39;49;00m
   398	[37m        [39;49;00m[37m; give the illusion of Deep Thought...[39;49;00m[37m[39;49;00m
   399	[37m        [39;49;00m([34msleep[39;49;00m[37m [39;49;00m[33m2000[39;49;00m)[37m[39;49;00m
   400	[37m        [39;49;00m[37m; black's reply[39;49;00m[37m[39;49;00m
   401	[37m        [39;49;00m[37m; currently only the random strategy has been defined...[39;49;00m[37m[39;49;00m
   402	[37m        [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mstrategy[39;49;00m[37m [39;49;00m[34mrandom[39;49;00m[34m-[39;49;00m[33mstrategy[39;49;00m)[37m[39;49;00m
   403	[37m        [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mmove[39;49;00m[37m [39;49;00m([34mapply[39;49;00m[37m [39;49;00m[33mstrategy[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)))[37m[39;49;00m
   404	[37m        [39;49;00m([31mdo-move[39;49;00m[37m [39;49;00m[33mmove[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m)[37m[39;49;00m
   405	[37m        [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mplayer[39;49;00m[37m [39;49;00m([31mnext-to-play[39;49;00m[37m [39;49;00m[33mplayer[39;49;00m))[37m[39;49;00m
   406	[37m        [39;49;00m[37m; (show-legal-moves player) ; to see black's moves[39;49;00m[37m[39;49;00m
   407	[37m        [39;49;00m([31mgs[39;49;00m:[34mset[39;49;00m[34m-[39;49;00m[33mtext[39;49;00m[37m [39;49;00m'[33mStart[39;49;00m[37m [39;49;00m[33m"your move"[39;49;00m)[37m[39;49;00m
   408	[37m        [39;49;00m([31mgs[39;49;00m:[34mset[39;49;00m[34m-[39;49;00m[33mcursor[39;49;00m[37m [39;49;00m'[33mReversi[39;49;00m[37m [39;49;00m[33m"default"[39;49;00m)[37m[39;49;00m
   409	[37m        [39;49;00m([31mgs[39;49;00m:[33mupdate[39;49;00m))))[37m[39;49;00m
   410	[37m[39;49;00m
   411	([34mdefine[39;49;00m[37m [39;49;00m([31mstart-game[39;49;00m)[37m[39;49;00m
   412	[37m  [39;49;00m([31mgs[39;49;00m:[34mset[39;49;00m[34m-[39;49;00m[33mtext[39;49;00m[37m [39;49;00m'[33mStart[39;49;00m[37m [39;49;00m[33m"Click a square to place a piece!"[39;49;00m)[37m[39;49;00m
   413	[37m  [39;49;00m([31mgs[39;49;00m:[33mdisable[39;49;00m[37m [39;49;00m'[33mStart[39;49;00m)[37m[39;49;00m
   414	[37m  [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mplayer[39;49;00m[37m [39;49;00m[33mwhite[39;49;00m))[37m[39;49;00m
   415	[37m[39;49;00m
   416	([34mdefine[39;49;00m[37m [39;49;00m([31mstart[39;49;00m)[37m[39;49;00m
   417	[37m  [39;49;00m([31mgs[39;49;00m:[34mset[39;49;00m[34m-[39;49;00m[33mtext[39;49;00m[37m [39;49;00m'[33mStart[39;49;00m[37m [39;49;00m[33m"Start"[39;49;00m)[37m[39;49;00m
   418	[37m  [39;49;00m([31mgs[39;49;00m:[33menable[39;49;00m[37m [39;49;00m'[33mStart[39;49;00m)[37m[39;49;00m
   419	[37m  [39;49;00m([34mset[39;49;00m[37m  [39;49;00m'[34m*[39;49;00m[33mmove-number*[39;49;00m[37m [39;49;00m[33m1[39;49;00m[37m[39;49;00m
   420	[37m        [39;49;00m'[34m*[39;49;00m[33mflips*[39;49;00m[37m [39;49;00m'())[37m[39;49;00m
   421	[37m  [39;49;00m([31minitial-board[39;49;00m)[37m[39;49;00m
   422	[37m  [39;49;00m([31mdraw-board[39;49;00m)[37m[39;49;00m
   423	[37m  [39;49;00m([31mdraw-first-four-pieces[39;49;00m))[37m[39;49;00m
   424	[37m[39;49;00m
   425	([31mstart[39;49;00m)[37m[39;49;00m
   426	[37m[39;49;00m
   427	([31mgs[39;49;00m:[33mlisten[39;49;00m)
