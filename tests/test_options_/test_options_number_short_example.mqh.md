     1	[37m//+------------------------------------------------------------------+[39;49;00m
     2	[37m//|                                                        Array.mqh |[39;49;00m
     3	[37m//|                   Copyright 2009-2013, MetaQuotes Software Corp. |[39;49;00m
     4	[37m//|                                              http://www.mql4.com |[39;49;00m
     5	[37m//+------------------------------------------------------------------+[39;49;00m
     6	[36m#[39;49;00m[36minclude[39;49;00m[37m [39;49;00m[37m<Object.mqh>[39;49;00m[36m[39;49;00m
     7	[37m//+------------------------------------------------------------------+[39;49;00m
     8	[37m//| Class CArray                                                     |[39;49;00m
     9	[37m//| Purpose: Base class of dynamic arrays.                           |[39;49;00m
    10	[37m//|          Derives from class CObject.                             |[39;49;00m
    11	[37m//+------------------------------------------------------------------+[39;49;00m
    12	[34mclass[39;49;00m[37m [39;49;00m[04m[32mCArray[39;49;00m[37m [39;49;00m:[37m [39;49;00m[34mpublic[39;49;00m[37m [39;49;00mCObject[37m[39;49;00m
    13	[37m  [39;49;00m{[37m[39;49;00m
    14	[34mprotected[39;49;00m:[37m[39;49;00m
    15	[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00mm_step_resize;[37m      [39;49;00m[37m// increment size of the array[39;49;00m
    16	[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00mm_data_total;[37m       [39;49;00m[37m// number of elements[39;49;00m
    17	[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00mm_data_max;[37m         [39;49;00m[37m// maximmum size of the array without memory reallocation[39;49;00m
    18	[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00mm_sort_mode;[37m        [39;49;00m[37m// mode of array sorting[39;49;00m
    19	[37m[39;49;00m
    20	[34mpublic[39;49;00m:[37m[39;49;00m
    21	[37m                     [39;49;00mCArray([36mvoid[39;49;00m);[37m[39;49;00m
    22	[37m                    [39;49;00m~CArray([36mvoid[39;49;00m);[37m[39;49;00m
    23	[37m   [39;49;00m[37m//--- methods of access to protected data[39;49;00m
    24	[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mStep[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_step_resize);[37m [39;49;00m}[37m[39;49;00m
    25	[37m   [39;49;00m[36mbool[39;49;00m[37m              [39;49;00m[32mStep[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mstep);[37m[39;49;00m
    26	[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mTotal[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_data_total);[37m [39;49;00m}[37m[39;49;00m
    27	[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mAvailable[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_data_max-m_data_total);[37m [39;49;00m}[37m[39;49;00m
    28	[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mMax[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_data_max);[37m [39;49;00m}[37m[39;49;00m
    29	[37m   [39;49;00m[36mbool[39;49;00m[37m              [39;49;00m[32mIsSorted[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmode=[34m0[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_sort_mode==mode);[37m [39;49;00m}[37m[39;49;00m
    30	[37m   [39;49;00m[36mint[39;49;00m[37m               [39;49;00m[32mSortMode[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m[34mconst[39;49;00m[37m [39;49;00m{[37m [39;49;00m[34mreturn[39;49;00m(m_sort_mode);[37m [39;49;00m}[37m[39;49;00m
    31	[37m   [39;49;00m[37m//--- cleaning method[39;49;00m
    32	[37m   [39;49;00m[36mvoid[39;49;00m[37m              [39;49;00m[32mClear[39;49;00m([36mvoid[39;49;00m)[37m [39;49;00m{[37m [39;49;00mm_data_total=[34m0[39;49;00m;[37m [39;49;00m}[37m[39;49;00m
    33	[37m   [39;49;00m[37m//--- methods for working with files[39;49;00m
    34	[37m   [39;49;00m[34mvirtual[39;49;00m[37m [39;49;00m[36mbool[39;49;00m[37m      [39;49;00m[32mSave[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mfile_handle);[37m[39;49;00m
    35	[37m   [39;49;00m[34mvirtual[39;49;00m[37m [39;49;00m[36mbool[39;49;00m[37m      [39;49;00m[32mLoad[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mfile_handle);[37m[39;49;00m
    36	[37m   [39;49;00m[37m//--- sorting method[39;49;00m
    37	[37m   [39;49;00m[36mvoid[39;49;00m[37m              [39;49;00m[32mSort[39;49;00m([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmode=[34m0[39;49;00m);[37m[39;49;00m
    38	[37m[39;49;00m
    39	[34mprotected[39;49;00m:[37m[39;49;00m
    40	[37m   [39;49;00m[34mvirtual[39;49;00m[37m [39;49;00m[36mvoid[39;49;00m[37m      [39;49;00mQuickSort([36mint[39;49;00m[37m [39;49;00mbeg,[36mint[39;49;00m[37m [39;49;00mend,[34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmode=[34m0[39;49;00m)[37m [39;49;00m{[37m [39;49;00m}[37m[39;49;00m
    41	[37m  [39;49;00m};[37m[39;49;00m
    42	[37m//+------------------------------------------------------------------+[39;49;00m
    43	[37m//| Constructor                                                      |[39;49;00m
    44	[37m//+------------------------------------------------------------------+[39;49;00m
    45	CArray::CArray([36mvoid[39;49;00m)[37m [39;49;00m:[37m [39;49;00mm_step_resize([34m16[39;49;00m),[37m[39;49;00m
    46	[37m                       [39;49;00mm_data_total([34m0[39;49;00m),[37m[39;49;00m
    47	[37m                       [39;49;00mm_data_max([34m0[39;49;00m),[37m[39;49;00m
    48	[37m                       [39;49;00mm_sort_mode([34m-1[39;49;00m)[37m[39;49;00m
    49	[37m  [39;49;00m{[37m[39;49;00m
    50	[37m  [39;49;00m}[37m[39;49;00m
    51	[37m//+------------------------------------------------------------------+[39;49;00m
    52	[37m//| Destructor                                                       |[39;49;00m
    53	[37m//+------------------------------------------------------------------+[39;49;00m
    54	CArray::~CArray([36mvoid[39;49;00m)[37m[39;49;00m
    55	[37m  [39;49;00m{[37m[39;49;00m
    56	[37m  [39;49;00m}[37m[39;49;00m
    57	[37m//+------------------------------------------------------------------+[39;49;00m
    58	[37m//| Method Set for variable m_step_resize                            |[39;49;00m
    59	[37m//+------------------------------------------------------------------+[39;49;00m
    60	[36mbool[39;49;00m[37m [39;49;00mCArray::Step([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mstep)[37m[39;49;00m
    61	[37m  [39;49;00m{[37m[39;49;00m
    62	[37m//--- check[39;49;00m
    63	[37m   [39;49;00m[34mif[39;49;00m(step>[34m0[39;49;00m)[37m[39;49;00m
    64	[37m     [39;49;00m{[37m[39;49;00m
    65	[37m      [39;49;00mm_step_resize=step;[37m[39;49;00m
    66	[37m      [39;49;00m[34mreturn[39;49;00m([36mtrue[39;49;00m);[37m[39;49;00m
    67	[37m     [39;49;00m}[37m[39;49;00m
    68	[37m//--- failure[39;49;00m
    69	[37m   [39;49;00m[34mreturn[39;49;00m([36mfalse[39;49;00m);[37m[39;49;00m
    70	[37m  [39;49;00m}[37m[39;49;00m
    71	[37m//+------------------------------------------------------------------+[39;49;00m
    72	[37m//| Sorting an array in ascending order                              |[39;49;00m
    73	[37m//+------------------------------------------------------------------+[39;49;00m
    74	[36mvoid[39;49;00m[37m [39;49;00mCArray::Sort([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mmode)[37m[39;49;00m
    75	[37m  [39;49;00m{[37m[39;49;00m
    76	[37m//--- check[39;49;00m
    77	[37m   [39;49;00m[34mif[39;49;00m(IsSorted(mode))[37m[39;49;00m
    78	[37m      [39;49;00m[34mreturn[39;49;00m;[37m[39;49;00m
    79	[37m   [39;49;00mm_sort_mode=mode;[37m[39;49;00m
    80	[37m   [39;49;00m[34mif[39;49;00m(m_data_total<=[34m1[39;49;00m)[37m[39;49;00m
    81	[37m      [39;49;00m[34mreturn[39;49;00m;[37m[39;49;00m
    82	[37m//--- sort[39;49;00m
    83	[37m   [39;49;00mQuickSort([34m0[39;49;00m,m_data_total[34m-1[39;49;00m,mode);[37m[39;49;00m
    84	[37m  [39;49;00m}[37m[39;49;00m
    85	[37m//+------------------------------------------------------------------+[39;49;00m
    86	[37m//| Writing header of array to file                                  |[39;49;00m
    87	[37m//+------------------------------------------------------------------+[39;49;00m
    88	[36mbool[39;49;00m[37m [39;49;00mCArray::Save([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mfile_handle)[37m[39;49;00m
    89	[37m  [39;49;00m{[37m[39;49;00m
    90	[37m//--- check handle[39;49;00m
    91	[37m   [39;49;00m[34mif[39;49;00m(file_handle!=[31mINVALID_HANDLE[39;49;00m)[37m[39;49;00m
    92	[37m     [39;49;00m{[37m[39;49;00m
    93	[37m      [39;49;00m[37m//--- write start marker - 0xFFFFFFFFFFFFFFFF[39;49;00m
    94	[37m      [39;49;00m[34mif[39;49;00m([32mFileWriteLong[39;49;00m(file_handle,[34m-1[39;49;00m)==[34msizeof[39;49;00m([36mlong[39;49;00m))[37m[39;49;00m
    95	[37m        [39;49;00m{[37m[39;49;00m
    96	[37m         [39;49;00m[37m//--- write array type[39;49;00m
    97	[37m         [39;49;00m[34mif[39;49;00m([32mFileWriteInteger[39;49;00m(file_handle,Type(),INT_VALUE)==INT_VALUE)[37m[39;49;00m
    98	[37m            [39;49;00m[34mreturn[39;49;00m([36mtrue[39;49;00m);[37m[39;49;00m
    99	[37m        [39;49;00m}[37m[39;49;00m
   100	[37m     [39;49;00m}[37m[39;49;00m
   101	[37m//--- failure[39;49;00m
   102	[37m   [39;49;00m[34mreturn[39;49;00m([36mfalse[39;49;00m);[37m[39;49;00m
   103	[37m  [39;49;00m}[37m[39;49;00m
   104	[37m//+------------------------------------------------------------------+[39;49;00m
   105	[37m//| Reading header of array from file                                |[39;49;00m
   106	[37m//+------------------------------------------------------------------+[39;49;00m
   107	[36mbool[39;49;00m[37m [39;49;00mCArray::Load([34mconst[39;49;00m[37m [39;49;00m[36mint[39;49;00m[37m [39;49;00mfile_handle)[37m[39;49;00m
   108	[37m  [39;49;00m{[37m[39;49;00m
   109	[37m//--- check handle[39;49;00m
   110	[37m   [39;49;00m[34mif[39;49;00m(file_handle!=[31mINVALID_HANDLE[39;49;00m)[37m[39;49;00m
   111	[37m     [39;49;00m{[37m[39;49;00m
   112	[37m      [39;49;00m[37m//--- read and check start marker - 0xFFFFFFFFFFFFFFFF[39;49;00m
   113	[37m      [39;49;00m[34mif[39;49;00m([32mFileReadLong[39;49;00m(file_handle)==[34m-1[39;49;00m)[37m[39;49;00m
   114	[37m        [39;49;00m{[37m[39;49;00m
   115	[37m         [39;49;00m[37m//--- read and check array type[39;49;00m
   116	[37m         [39;49;00m[34mif[39;49;00m([32mFileReadInteger[39;49;00m(file_handle,INT_VALUE)==Type())[37m[39;49;00m
   117	[37m            [39;49;00m[34mreturn[39;49;00m([36mtrue[39;49;00m);[37m[39;49;00m
   118	[37m        [39;49;00m}[37m[39;49;00m
   119	[37m     [39;49;00m}[37m[39;49;00m
   120	[37m//--- failure[39;49;00m
   121	[37m   [39;49;00m[34mreturn[39;49;00m([36mfalse[39;49;00m);[37m[39;49;00m
   122	[37m  [39;49;00m}[37m[39;49;00m
   123	//+------------------------------------------------------------------+
