     1^I[34mxquery[39;49;00m [34mversion[39;49;00m[37m [39;49;00m[33m"3.0"[39;49;00m;[37m[39;49;00m$
     2^I[37m[39;49;00m$
     3^I[34mdeclare[39;49;00m [34mfunction[39;49;00m[37m [39;49;00m[32mlocal:add-log-message[39;49;00m([31m$[39;49;00mmessage[37m [39;49;00m[34mas[39;49;00m[37m [39;49;00m[36mxs:string[39;49;00m) [34mas[39;49;00m[37m [39;49;00m[94mempty-sequence[39;49;00m()?[37m[39;49;00m$
     4^I{[37m[39;49;00m$
     5^I[37m^I[39;49;00m[34mlet[39;49;00m [31m$[39;49;00mlogfile-collection[37m [39;49;00m:=[37m [39;49;00m[33m"/db/apps/exist101/log"[39;49;00m[37m[39;49;00m$
     6^I[37m^I[39;49;00m[34mlet[39;49;00m [31m$[39;49;00mlogfile-name[37m [39;49;00m:=[37m [39;49;00m[33m"exist101-log.xml"[39;49;00m[37m[39;49;00m$
     7^I[37m^I[39;49;00m[34mlet[39;49;00m [31m$[39;49;00mlogfile-full[37m [39;49;00m:=[37m [39;49;00m[32mconcat[39;49;00m([31m$[39;49;00mlogfile-collection,[37m [39;49;00m[33m'/'[39;49;00m,[37m [39;49;00m[31m$[39;49;00mlogfile-name)[37m[39;49;00m$
     8^I[37m^I[39;49;00m[34mlet[39;49;00m [31m$[39;49;00mlogfile-created[37m [39;49;00m:=[37m[39;49;00m$
     9^I[37m^I[39;49;00m[34mif[39;49;00m([32mdoc-available[39;49;00m([31m$[39;49;00mlogfile-full))[34mthen[39;49;00m[37m[39;49;00m$
    10^I[37m^I^I[39;49;00m[31m$[39;49;00mlogfile-full[37m[39;49;00m$
    11^I[37m^I[39;49;00m[34melse[39;49;00m[37m[39;49;00m$
    12^I[37m^I^I[39;49;00m[32mxmldb:store[39;49;00m([31m$[39;49;00mlogfile-collection,[37m [39;49;00m[31m$[39;49;00mlogfile-name,[37m [39;49;00m[94m<[39;49;00m[94meXist101-Log[39;49;00m[94m/>[39;49;00m)[37m[39;49;00m$
    13^I[37m^I[39;49;00m[34mreturn[39;49;00m[37m[39;49;00m$
    14^I[37m^I^I[39;49;00m[34mupdate[39;49;00m [34minsert[39;49;00m[37m[39;49;00m$
    15^I[37m^I^I^I[39;49;00m[94m<[39;49;00m[94mLogEntry[39;49;00m[37m [39;49;00m[94mtimestamp[39;49;00m="{[32mcurrent-dateTime[39;49;00m()}"[94m>[39;49;00m{[31m$[39;49;00mmessage}[94m</[39;49;00m[94mLogEntry[39;49;00m[94m>[39;49;00m[37m[39;49;00m$
    16^I[37m^I^I[39;49;00m[34minto[39;49;00m[37m [39;49;00m[32mdoc[39;49;00m([31m$[39;49;00mlogfile-full)/[94m*[39;49;00m[37m[39;49;00m$
    17^I};[37m[39;49;00m$
    18^I[37m[39;49;00m$
    19^I[34mdeclare[39;49;00m [34mfunction[39;49;00m[37m [39;49;00m[32mlocal:insert-attributes[39;49;00m()[37m [39;49;00m{[37m[39;49;00m$
    20^I[37m^I[39;49;00m[34mlet[39;49;00m [31m$[39;49;00melm[37m [39;49;00m[34mas[39;49;00m[37m [39;49;00m[94melement[39;49;00m()[37m [39;49;00m:=[37m [39;49;00m[32mdoc[39;49;00m([33m'/db/Path/To/Some/Document.xml'[39;49;00m)/[94m*[39;49;00m[37m[39;49;00m$
    21^I[37m^I[39;49;00m[34mreturn[39;49;00m[37m [39;49;00m([37m[39;49;00m$
    22^I[37m^I^I[39;49;00m[34mupdate[39;49;00m [34minsert[39;49;00m[37m [39;49;00m[94m<[39;49;00m[94mNEW[39;49;00m[94m/>[39;49;00m[37m [39;49;00m[34minto[39;49;00m[37m [39;49;00m[31m$[39;49;00melm,[37m[39;49;00m$
    23^I[37m^I^I[39;49;00m[34mupdate[39;49;00m [34minsert[39;49;00m[37m [39;49;00m[34mattribute[39;49;00m [31mx[39;49;00m[37m [39;49;00m{[37m [39;49;00m[33m'y'[39;49;00m[37m [39;49;00m}[37m [39;49;00m[34minto[39;49;00m[37m [39;49;00m[31m$[39;49;00melm/[94m*[39;49;00m[[32mlast[39;49;00m()],[37m[39;49;00m$
    24^I[37m^I^I[39;49;00m[34mupdate[39;49;00m [34minsert[39;49;00m[37m [39;49;00m[34mattribute[39;49;00m [31ma[39;49;00m[37m [39;49;00m{[37m [39;49;00m[33m'b'[39;49;00m[37m [39;49;00m}[37m [39;49;00m[34minto[39;49;00m[37m [39;49;00m[31m$[39;49;00melm/[94m*[39;49;00m[[32mlast[39;49;00m()][37m[39;49;00m$
    25^I[37m^I[39;49;00m)[37m[39;49;00m$
    26^I};[37m[39;49;00m$
    27^I[37m[39;49;00m$
    28^I[34mdeclare[39;49;00m [34mfunction[39;49;00m[37m [39;49;00m[32mlocal:insert-elem[39;49;00m()[37m [39;49;00m{[37m[39;49;00m$
    29^I[37m^I[39;49;00m[34mlet[39;49;00m [31m$[39;49;00melm[37m [39;49;00m[34mas[39;49;00m[37m [39;49;00m[94melement[39;49;00m()[37m [39;49;00m:=[37m [39;49;00m[32mdoc[39;49;00m([33m'/db/Path/To/Some/Document.xml'[39;49;00m)/[94m*[39;49;00m[37m[39;49;00m$
    30^I[37m^I[39;49;00m[34mreturn[39;49;00m[37m[39;49;00m$
    31^I[37m^I^I[39;49;00m[34mupdate[39;49;00m [34minsert[39;49;00m[37m [39;49;00m[94m<[39;49;00m[94mNEW[39;49;00m[37m [39;49;00m[94mx[39;49;00m="[36my[39;49;00m"[37m [39;49;00m[94ma[39;49;00m="[36mb[39;49;00m"[94m/>[39;49;00m[37m [39;49;00m[34minto[39;49;00m[37m [39;49;00m[31m$[39;49;00melm[37m[39;49;00m$
    32^I};[37m[39;49;00m$
    33^I[37m[39;49;00m$
    34^I[34mdeclare[39;49;00m [34mfunction[39;49;00m[37m [39;49;00m[32mlocal:insert-elem2[39;49;00m()[37m [39;49;00m{[37m[39;49;00m$
    35^I[37m^I[39;49;00m[34mlet[39;49;00m [31m$[39;49;00melm[37m [39;49;00m[34mas[39;49;00m[37m [39;49;00m[94melement[39;49;00m()[37m [39;49;00m:=[37m [39;49;00m[32mdoc[39;49;00m([33m'/db/Path/To/Some/Document.xml'[39;49;00m)/[94m*[39;49;00m[37m[39;49;00m$
    36^I[37m^I[39;49;00m[34mlet[39;49;00m [31m$[39;49;00mnew-element[37m [39;49;00m[34mas[39;49;00m[37m [39;49;00m[94melement[39;49;00m()[37m [39;49;00m:=[37m [39;49;00m[94m<[39;49;00m[94mNEW[39;49;00m[37m [39;49;00m[94mx[39;49;00m="[36my[39;49;00m"[37m [39;49;00m[94ma[39;49;00m="[36mb[39;49;00m"[94m/>[39;49;00m[37m[39;49;00m$
    37^I[37m^I[39;49;00m[34mreturn[39;49;00m[37m[39;49;00m$
    38^I[37m^I^I[39;49;00m[34mupdate[39;49;00m [34minsert[39;49;00m[37m [39;49;00m[31m$[39;49;00mnew-element[37m [39;49;00m[34minto[39;49;00m[37m [39;49;00m[31m$[39;49;00melm[37m^I[39;49;00m$
    39^I};[37m[39;49;00m$
    40^I[37m[39;49;00m$
    41^I[34mdeclare[39;49;00m [34mfunction[39;49;00m[37m [39;49;00m[32mlocal:insert-single[39;49;00m()[37m [39;49;00m{[37m[39;49;00m$
    42^I[37m^I[39;49;00m[34mupdate[39;49;00m [34minsert[39;49;00m[37m [39;49;00m[94m<[39;49;00m[94mLogEntry[39;49;00m[94m>[39;49;00mSomething happened...[94m</[39;49;00m[94mLogEntry[39;49;00m[94m>[39;49;00m[37m [39;49;00m[34minto[39;49;00m[37m [39;49;00m[32mdoc[39;49;00m([33m'/db/logs/mainlog.xml'[39;49;00m)/[94m*[39;49;00m[37m[39;49;00m$
    43^I};[37m[39;49;00m$
    44^I[37m[39;49;00m$
    45^I[37m[39;49;00m$
    46^I[34mdeclare[39;49;00m [34mfunction[39;49;00m[37m [39;49;00m[32mlocal:trim-insert[39;49;00m()[37m [39;49;00m{[37m[39;49;00m$
    47^I[37m^I[39;49;00m[34mlet[39;49;00m [31m$[39;49;00mdocument[37m [39;49;00m:=[37m [39;49;00m[32mdoc[39;49;00m([33m'/db/logs/mainlog.xml'[39;49;00m)[37m[39;49;00m$
    48^I[37m^I[39;49;00m[34mlet[39;49;00m [31m$[39;49;00mnewentry[37m [39;49;00m:=[37m [39;49;00m[94m<[39;49;00m[94mLogEntry[39;49;00m[94m>[39;49;00mSomething happened...[94m</[39;49;00m[94mLogEntry[39;49;00m[94m>[39;49;00m[37m[39;49;00m$
    49^I[37m^I[39;49;00m[34mreturn[39;49;00m[37m[39;49;00m$
    50^I[37m^I^I[39;49;00m[34mupdate[39;49;00m [34mdelete[39;49;00m[37m [39;49;00m[31m$[39;49;00mdocument/[94m*[39;49;00m/[94mLogEntry[39;49;00m[[32mposition[39;49;00m()[37m [39;49;00m[35mge[39;49;00m[37m [39;49;00m[34m10[39;49;00m],[37m[39;49;00m$
    51^I[37m^I^I[39;49;00m[34mif[39;49;00m([32mexists[39;49;00m([31m$[39;49;00mdocument/[94m*[39;49;00m/[94mLogEntry[39;49;00m[[34m1[39;49;00m]))[34mthen[39;49;00m[37m[39;49;00m$
    52^I[37m^I^I^I[39;49;00m[34mupdate[39;49;00m [34minsert[39;49;00m[37m [39;49;00m[31m$[39;49;00mnewentry[37m [39;49;00m[34mpreceding[39;49;00m[37m [39;49;00m[31m$[39;49;00mdocument/[94m*[39;49;00m/[94mLogEntry[39;49;00m[[34m1[39;49;00m][37m[39;49;00m$
    53^I[37m^I^I[39;49;00m[34melse[39;49;00m[37m[39;49;00m$
    54^I[37m^I^I^I[39;49;00m[34mupdate[39;49;00m [34minsert[39;49;00m[37m [39;49;00m[31m$[39;49;00mnewentry[37m [39;49;00m[34minto[39;49;00m[37m [39;49;00m[31m$[39;49;00mdocument/[94m*[39;49;00m[37m[39;49;00m$
    55^I};[37m[39;49;00m$
    56^I[37m[39;49;00m$
    57^I[37m[39;49;00m$
    58^I[34mdeclare[39;49;00m [34mfunction[39;49;00m[37m [39;49;00m[32mlocal:attempt-document-node-insert[39;49;00m()[37m [39;49;00m{[37m[39;49;00m$
    59^I[37m^I[39;49;00m$
    60^I[37m^I[39;49;00m[37m(:[39;49;00m[37m This is invalid[39;49;00m[37m:[39;49;00m[37m [39;49;00m[37m:)[39;49;00m[37m[39;49;00m$
    61^I[37m^I[39;49;00m[34mlet[39;49;00m [31m$[39;49;00mdocument[37m [39;49;00m[34mas[39;49;00m[37m [39;49;00m[94mdocument-node[39;49;00m()[37m [39;49;00m:=[37m [39;49;00m[94m<[39;49;00m[94mRoot[39;49;00m[94m>[39;49;00m[94m<[39;49;00m[94ma[39;49;00m[94m/>[39;49;00m[94m</[39;49;00m[94mRoot[39;49;00m[94m>[39;49;00m[37m[39;49;00m$
    62^I[37m^I[39;49;00m[34mreturn[39;49;00m[37m[39;49;00m$
    63^I[37m^I^I[39;49;00m[34mupdate[39;49;00m [34minsert[39;49;00m[37m [39;49;00m[94m<[39;49;00m[94mb[39;49;00m[94m/>[39;49;00m[37m [39;49;00m[34minto[39;49;00m[37m [39;49;00m[31m$[39;49;00mdocument/[94m*[39;49;00m[37m[39;49;00m$
    64^I};[37m[39;49;00m$
    65^I[37m[39;49;00m$
    66^I[34mdeclare[39;49;00m [34mfunction[39;49;00m[37m [39;49;00m[32mlocal:attempt-attr-update-with-node[39;49;00m()[37m [39;49;00m{[37m[39;49;00m$
    67^I[37m^I[39;49;00m[34mupdate[39;49;00m [34mreplace[39;49;00m[37m [39;49;00m[32mdoc[39;49;00m([33m'/db/test/test.xml'[39;49;00m)/[94m*[39;49;00m/[36m@name[39;49;00m[37m [39;49;00m[34mwith[39;49;00m[37m[39;49;00m$
    68^I[37m^I^I[39;49;00m[94m<[39;49;00m[94ma[39;49;00m[94m>[39;49;00maaa[94m<[39;49;00m[94mb[39;49;00m[94m>[39;49;00mbbb[94m</[39;49;00m[94mb[39;49;00m[94m>[39;49;00m[94m</[39;49;00m[94ma[39;49;00m[94m>[39;49;00m[37m[39;49;00m$
    69^I};[37m[39;49;00m$
    70^I[37m[39;49;00m$
    71^I[37m[39;49;00m$
    72^I(# [31mexist:batch-transaction[39;49;00m #)[37m [39;49;00m{[37m[39;49;00m$
    73^I[37m^I[39;49;00m[34mupdate[39;49;00m [34mdelete[39;49;00m[37m [39;49;00m[31m$[39;49;00mdocument/[94m*[39;49;00m/[94mLogEntry[39;49;00m[[32mposition[39;49;00m()[37m [39;49;00m[35mge[39;49;00m[37m [39;49;00m[34m10[39;49;00m],[37m[39;49;00m$
    74^I[37m^I[39;49;00m[34mupdate[39;49;00m [34minsert[39;49;00m[37m [39;49;00m[31m$[39;49;00mnewentry[37m [39;49;00m[34mpreceding[39;49;00m[37m [39;49;00m[31m$[39;49;00mdocument/[94m*[39;49;00m/[94mLogEntry[39;49;00m[[34m1[39;49;00m][37m[39;49;00m$
    75^I}$
