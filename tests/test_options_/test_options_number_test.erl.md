     1	-module(test).[37m[39;49;00m
     2	-export([listen/[34m1[39;49;00m,[37m[39;49;00m
     3	[37m         [39;49;00mhandle_client/[34m1[39;49;00m,[37m[39;49;00m
     4	[37m         [39;49;00mmaintain_clients/[34m1[39;49;00m,[37m[39;49;00m
     5	[37m         [39;49;00mstart/[34m1[39;49;00m,[37m[39;49;00m
     6	[37m         [39;49;00mstop/[34m0[39;49;00m,[37m[39;49;00m
     7	[37m         [39;49;00mcontroller/[34m1[39;49;00m]).[37m[39;49;00m
     8	[37m[39;49;00m
     9	-author([33m"[39;49;00m[33mjerith[39;49;00m[33m"[39;49;00m).[37m[39;49;00m
    10	[37m[39;49;00m
    11	-define([31mTCP_OPTIONS[39;49;00m,[list,[37m [39;49;00m{packet,[37m [39;49;00m[34m0[39;49;00m},[37m [39;49;00m{active,[37m [39;49;00mfalse},[37m [39;49;00m{reuseaddr,[37m [39;49;00mtrue}]).[37m[39;49;00m
    12	[37m[39;49;00m
    13	-record(player,[37m [39;49;00m{name=none,[37m [39;49;00msocket,[37m [39;49;00mmode}).[37m[39;49;00m
    14	[37m[39;49;00m
    15	[37m%% To allow incoming connections, we need to listen on a TCP port.[39;49;00m[37m[39;49;00m
    16	[37m%% This is also the entry point for our server as a whole, so it[39;49;00m[37m[39;49;00m
    17	[37m%% starts the client_manager process and gives it a name so the rest[39;49;00m[37m[39;49;00m
    18	[37m%% of the code can get to it easily.[39;49;00m[37m[39;49;00m
    19	[37m[39;49;00m
    20	[32mlisten[39;49;00m([31mPort[39;49;00m)[37m [39;49;00m->[37m[39;49;00m
    21	[37m    [39;49;00m{ok,[37m [39;49;00m[31mLSocket[39;49;00m}[37m [39;49;00m=[37m [39;49;00m[04m[36mgen_tcp[39;49;00m:[32mlisten[39;49;00m([31mPort[39;49;00m,[37m [39;49;00m?[31mTCP_OPTIONS[39;49;00m),[37m[39;49;00m
    22	[37m    [39;49;00m[36mregister[39;49;00m(client_manager,[37m [39;49;00m[36mspawn[39;49;00m(?[31mMODULE[39;49;00m,[37m [39;49;00mmaintain_clients,[37m [39;49;00m[[]])),[37m[39;49;00m
    23	[37m    [39;49;00mdo_accept([31mLSocket[39;49;00m).[37m[39;49;00m
    24	[37m[39;49;00m
    25	[37m%% Accepting a connection gives us a connection socket with the[39;49;00m[37m[39;49;00m
    26	[37m%% newly-connected client on the other end.  Since we want to accept[39;49;00m[37m[39;49;00m
    27	[37m%% more than one client, we spawn a new process for each and then wait[39;49;00m[37m[39;49;00m
    28	[37m%% for another connection on our listening socket.[39;49;00m[37m[39;49;00m
    29	[37m[39;49;00m
    30	[32mdo_accept[39;49;00m([31mLSocket[39;49;00m)[37m [39;49;00m->[37m[39;49;00m
    31	[37m    [39;49;00m[34mcase[39;49;00m[37m [39;49;00m[04m[36mgen_tcp[39;49;00m:[32maccept[39;49;00m([31mLSocket[39;49;00m)[37m [39;49;00m[34mof[39;49;00m[37m[39;49;00m
    32	[37m        [39;49;00m{ok,[37m [39;49;00m[31mSocket[39;49;00m}[37m [39;49;00m->[37m[39;49;00m
    33	[37m            [39;49;00m[36mspawn[39;49;00m(?[31mMODULE[39;49;00m,[37m [39;49;00mhandle_client,[37m [39;49;00m[[31mSocket[39;49;00m]),[37m[39;49;00m
    34	[37m            [39;49;00mclient_manager[37m [39;49;00m![37m [39;49;00m{connect,[37m [39;49;00m[31mSocket[39;49;00m};[37m[39;49;00m
    35	[37m        [39;49;00m{error,[37m [39;49;00m[31mReason[39;49;00m}[37m [39;49;00m->[37m[39;49;00m
    36	[37m            [39;49;00m[04m[36mio[39;49;00m:[32mformat[39;49;00m([33m"[39;49;00m[33mSocket accept error: [39;49;00m[33m~s[39;49;00m[33m~n[39;49;00m[33m"[39;49;00m,[37m [39;49;00m[[31mReason[39;49;00m])[37m[39;49;00m
    37	[37m    [39;49;00m[34mend[39;49;00m,[37m[39;49;00m
    38	[37m    [39;49;00mdo_accept([31mLSocket[39;49;00m).[37m[39;49;00m
    39	[37m[39;49;00m
    40	[37m%% All the client-socket process needs to do is wait for data and[39;49;00m[37m[39;49;00m
    41	[37m%% forward it to the client_manager process which decides what to do[39;49;00m[37m[39;49;00m
    42	[37m%% with it.  If the client disconnects, we let client_manager know and[39;49;00m[37m[39;49;00m
    43	[37m%% then quietly go away.[39;49;00m[37m[39;49;00m
    44	[37m[39;49;00m
    45	[32mhandle_client[39;49;00m([31mSocket[39;49;00m)[37m [39;49;00m->[37m[39;49;00m
    46	[37m    [39;49;00m[34mcase[39;49;00m[37m [39;49;00m[04m[36mgen_tcp[39;49;00m:[32mrecv[39;49;00m([31mSocket[39;49;00m,[37m [39;49;00m[34m0[39;49;00m)[37m [39;49;00m[34mof[39;49;00m[37m[39;49;00m
    47	[37m        [39;49;00m{ok,[37m [39;49;00m[31mData[39;49;00m}[37m [39;49;00m->[37m[39;49;00m
    48	[37m            [39;49;00mclient_manager[37m [39;49;00m![37m [39;49;00m{data,[37m [39;49;00m[31mSocket[39;49;00m,[37m [39;49;00m[31mData[39;49;00m},[37m[39;49;00m
    49	[37m            [39;49;00mhandle_client([31mSocket[39;49;00m);[37m[39;49;00m
    50	[37m        [39;49;00m{error,[37m [39;49;00mclosed}[37m [39;49;00m->[37m[39;49;00m
    51	[37m            [39;49;00mclient_manager[37m [39;49;00m![37m [39;49;00m{disconnect,[37m [39;49;00m[31mSocket[39;49;00m}[37m[39;49;00m
    52	[37m    [39;49;00m[34mend[39;49;00m.[37m[39;49;00m
    53	[37m[39;49;00m
    54	[37m%% This is the main loop of the client_manager process.  It maintains[39;49;00m[37m[39;49;00m
    55	[37m%% the list of "players" and calls the handler for client input.[39;49;00m[37m[39;49;00m
    56	[37m[39;49;00m
    57	[32mmaintain_clients[39;49;00m([31mPlayers[39;49;00m)[37m [39;49;00m->[37m[39;49;00m
    58	[37m    [39;49;00m[04m[36mio[39;49;00m:[32mformat[39;49;00m([33m"[39;49;00m[33mPlayers:[39;49;00m[33m~n[39;49;00m[33m"[39;49;00m,[37m [39;49;00m[]),[37m[39;49;00m
    59	[37m    [39;49;00m[04m[36mlists[39;49;00m:[32mforeach[39;49;00m([34mfun[39;49;00m([31mP[39;49;00m)[37m [39;49;00m->[37m [39;49;00m[04m[36mio[39;49;00m:[32mformat[39;49;00m([33m"[39;49;00m[33m>>> [39;49;00m[33m~w[39;49;00m[33m~n[39;49;00m[33m"[39;49;00m,[37m [39;49;00m[[31mP[39;49;00m])[37m [39;49;00m[34mend[39;49;00m,[37m [39;49;00m[31mPlayers[39;49;00m),[37m[39;49;00m
    60	[37m    [39;49;00m[34mreceive[39;49;00m[37m[39;49;00m
    61	[37m        [39;49;00m{connect,[37m [39;49;00m[31mSocket[39;49;00m}[37m [39;49;00m->[37m[39;49;00m
    62	[37m            [39;49;00m[31mPlayer[39;49;00m[37m [39;49;00m=[37m [39;49;00m#player{socket=[31mSocket[39;49;00m,[37m [39;49;00mmode=connect},[37m[39;49;00m
    63	[37m            [39;49;00msend_prompt([31mPlayer[39;49;00m),[37m[39;49;00m
    64	[37m            [39;49;00m[04m[36mio[39;49;00m:[32mformat[39;49;00m([33m"[39;49;00m[33mclient connected: [39;49;00m[33m~w[39;49;00m[33m~n[39;49;00m[33m"[39;49;00m,[37m [39;49;00m[[31mPlayer[39;49;00m]),[37m[39;49;00m
    65	[37m            [39;49;00m[31mNewPlayers[39;49;00m[37m [39;49;00m=[37m  [39;49;00m[[31mPlayer[39;49;00m[37m [39;49;00m|[37m [39;49;00m[31mPlayers[39;49;00m];[37m[39;49;00m
    66	[37m        [39;49;00m{disconnect,[37m [39;49;00m[31mSocket[39;49;00m}[37m [39;49;00m->[37m[39;49;00m
    67	[37m            [39;49;00m[31mPlayer[39;49;00m[37m [39;49;00m=[37m [39;49;00mfind_player([31mSocket[39;49;00m,[37m [39;49;00m[31mPlayers[39;49;00m),[37m[39;49;00m
    68	[37m            [39;49;00m[04m[36mio[39;49;00m:[32mformat[39;49;00m([33m"[39;49;00m[33mclient disconnected: [39;49;00m[33m~w[39;49;00m[33m~n[39;49;00m[33m"[39;49;00m,[37m [39;49;00m[[31mPlayer[39;49;00m]),[37m[39;49;00m
    69	[37m            [39;49;00m[31mNewPlayers[39;49;00m[37m [39;49;00m=[37m [39;49;00m[04m[36mlists[39;49;00m:[32mdelete[39;49;00m([31mPlayer[39;49;00m,[37m [39;49;00m[31mPlayers[39;49;00m);[37m[39;49;00m
    70	[37m        [39;49;00m{data,[37m [39;49;00m[31mSocket[39;49;00m,[37m [39;49;00m[31mData[39;49;00m}[37m [39;49;00m->[37m[39;49;00m
    71	[37m            [39;49;00m[31mPlayer[39;49;00m[37m [39;49;00m=[37m [39;49;00mfind_player([31mSocket[39;49;00m,[37m [39;49;00m[31mPlayers[39;49;00m),[37m[39;49;00m
    72	[37m            [39;49;00m[31mNewPlayers[39;49;00m[37m [39;49;00m=[37m [39;49;00mparse_data([31mPlayer[39;49;00m,[37m [39;49;00m[31mPlayers[39;49;00m,[37m [39;49;00m[31mData[39;49;00m),[37m[39;49;00m
    73	[37m            [39;49;00m[31mNewPlayer[39;49;00m[37m [39;49;00m=[37m [39;49;00mfind_player([31mSocket[39;49;00m,[37m [39;49;00m[31mNewPlayers[39;49;00m),[37m[39;49;00m
    74	[37m            [39;49;00msend_prompt([31mNewPlayer[39;49;00m)[37m[39;49;00m
    75	[37m    [39;49;00m[34mend[39;49;00m,[37m[39;49;00m
    76	[37m    [39;49;00mmaintain_clients([31mNewPlayers[39;49;00m).[37m[39;49;00m
    77	[37m[39;49;00m
    78	[37m%% find_player is a utility function to get a player record associated[39;49;00m[37m[39;49;00m
    79	[37m%% with a particular socket out of the player list.[39;49;00m[37m[39;49;00m
    80	[37m[39;49;00m
    81	[32mfind_player[39;49;00m([31mSocket[39;49;00m,[37m [39;49;00m[31mPlayers[39;49;00m)[37m [39;49;00m->[37m[39;49;00m
    82	[37m    [39;49;00m{value,[37m [39;49;00m[31mPlayer[39;49;00m}[37m [39;49;00m=[37m [39;49;00m[04m[36mlists[39;49;00m:[32mkeysearch[39;49;00m([31mSocket[39;49;00m,[37m [39;49;00m#player.socket,[37m [39;49;00m[31mPlayers[39;49;00m),[37m[39;49;00m
    83	[37m    [39;49;00m[31mPlayer[39;49;00m.[37m[39;49;00m
    84	[37m[39;49;00m
    85	[37m%% delete_player returns the player list without the given player.  It[39;49;00m[37m[39;49;00m
    86	[37m%% deletes the player from the list based on the socket rather than[39;49;00m[37m[39;49;00m
    87	[37m%% the whole record because the list might hold a different version.[39;49;00m[37m[39;49;00m
    88	[37m[39;49;00m
    89	[32mdelete_player[39;49;00m([31mPlayer[39;49;00m,[37m [39;49;00m[31mPlayers[39;49;00m)[37m [39;49;00m->[37m[39;49;00m
    90	[37m    [39;49;00m[04m[36mlists[39;49;00m:[32mkeydelete[39;49;00m([31mPlayer[39;49;00m#player.socket,[37m [39;49;00m#player.socket,[37m [39;49;00m[31mPlayers[39;49;00m).[37m[39;49;00m
    91	[37m[39;49;00m
    92	[37m%% Sends an appropriate prompt to the player.  Currently the only[39;49;00m[37m[39;49;00m
    93	[37m%% prompt we send is the initial "Name: " when the player connects.[39;49;00m[37m[39;49;00m
    94	[37m[39;49;00m
    95	[32msend_prompt[39;49;00m([31mPlayer[39;49;00m)[37m [39;49;00m->[37m[39;49;00m
    96	[37m    [39;49;00m[34mcase[39;49;00m[37m [39;49;00m[31mPlayer[39;49;00m#player.mode[37m [39;49;00m[34mof[39;49;00m[37m[39;49;00m
    97	[37m        [39;49;00mconnect[37m [39;49;00m->[37m[39;49;00m
    98	[37m            [39;49;00m[04m[36mgen_tcp[39;49;00m:[36msend[39;49;00m([31mPlayer[39;49;00m#player.socket,[37m [39;49;00m[33m"[39;49;00m[33mName: [39;49;00m[33m"[39;49;00m);[37m[39;49;00m
    99	[37m        [39;49;00mactive[37m [39;49;00m->[37m[39;49;00m
   100	[37m            [39;49;00mok[37m[39;49;00m
   101	[37m    [39;49;00m[34mend[39;49;00m.[37m[39;49;00m
   102	[37m[39;49;00m
   103	[37m%% Sends the given data to all players in active mode.[39;49;00m[37m[39;49;00m
   104	[37m[39;49;00m
   105	[32msend_to_active[39;49;00m([31mPrefix[39;49;00m,[37m [39;49;00m[31mPlayers[39;49;00m,[37m [39;49;00m[31mData[39;49;00m)[37m [39;49;00m->[37m[39;49;00m
   106	[37m    [39;49;00m[31mActivePlayers[39;49;00m[37m [39;49;00m=[37m [39;49;00m[04m[36mlists[39;49;00m:[32mfilter[39;49;00m([34mfun[39;49;00m([31mP[39;49;00m)[37m [39;49;00m->[37m [39;49;00m[31mP[39;49;00m#player.mode[37m [39;49;00m==[37m [39;49;00mactive[37m [39;49;00m[34mend[39;49;00m,[37m[39;49;00m
   107	[37m                                 [39;49;00m[31mPlayers[39;49;00m),[37m[39;49;00m
   108	[37m    [39;49;00m[04m[36mlists[39;49;00m:[32mforeach[39;49;00m([34mfun[39;49;00m([31mP[39;49;00m)[37m [39;49;00m->[37m [39;49;00m[04m[36mgen_tcp[39;49;00m:[36msend[39;49;00m([31mP[39;49;00m#player.socket,[37m [39;49;00m[31mPrefix[39;49;00m[37m [39;49;00m++[37m [39;49;00m[31mData[39;49;00m)[37m [39;49;00m[34mend[39;49;00m,[37m[39;49;00m
   109	[37m                  [39;49;00m[31mActivePlayers[39;49;00m),[37m[39;49;00m
   110	[37m    [39;49;00mok.[37m[39;49;00m
   111	[37m[39;49;00m
   112	[37m%% We don't really do much parsing, but that will probably change as[39;49;00m[37m[39;49;00m
   113	[37m%% more features are added.  Currently this handles naming the player[39;49;00m[37m[39;49;00m
   114	[37m%% when he first connects and treats everything else as a message to[39;49;00m[37m[39;49;00m
   115	[37m%% send.[39;49;00m[37m[39;49;00m
   116	[37m[39;49;00m
   117	[32mparse_data[39;49;00m([31mPlayer[39;49;00m,[37m [39;49;00m[31mPlayers[39;49;00m,[37m [39;49;00m[31mData[39;49;00m)[37m [39;49;00m->[37m[39;49;00m
   118	[37m    [39;49;00m[34mcase[39;49;00m[37m [39;49;00m[31mPlayer[39;49;00m#player.mode[37m [39;49;00m[34mof[39;49;00m[37m[39;49;00m
   119	[37m        [39;49;00mactive[37m [39;49;00m->[37m[39;49;00m
   120	[37m            [39;49;00msend_to_active([31mPlayer[39;49;00m#player.name[37m [39;49;00m++[37m [39;49;00m[33m"[39;49;00m[33m: [39;49;00m[33m"[39;49;00m,[37m[39;49;00m
   121	[37m              [39;49;00mdelete_player([31mPlayer[39;49;00m,[37m [39;49;00m[31mPlayers[39;49;00m),[37m [39;49;00m[31mData[39;49;00m),[37m[39;49;00m
   122	[37m            [39;49;00m[31mPlayers[39;49;00m;[37m[39;49;00m
   123	[37m        [39;49;00mconnect[37m [39;49;00m->[37m[39;49;00m
   124	[37m            [39;49;00m[31mUPlayer[39;49;00m[37m [39;49;00m=[37m [39;49;00m[31mPlayer[39;49;00m#player{name=bogostrip([31mData[39;49;00m),[37m [39;49;00mmode=active},[37m[39;49;00m
   125	[37m            [39;49;00m[[31mUPlayer[39;49;00m[37m [39;49;00m|[37m [39;49;00mdelete_player([31mPlayer[39;49;00m,[37m [39;49;00m[31mPlayers[39;49;00m)][37m[39;49;00m
   126	[37m    [39;49;00m[34mend[39;49;00m.[37m[39;49;00m
   127	[37m[39;49;00m
   128	[37m%% Utility methods to clean up the name before we apply it.  Called[39;49;00m[37m[39;49;00m
   129	[37m%% bogostrip rather than strip because it returns the first continuous[39;49;00m[37m[39;49;00m
   130	[37m%% block of non-matching characters rather stripping matching[39;49;00m[37m[39;49;00m
   131	[37m%% characters off the front and back.[39;49;00m[37m[39;49;00m
   132	[37m[39;49;00m
   133	[32mbogostrip[39;49;00m([31mString[39;49;00m)[37m [39;49;00m->[37m[39;49;00m
   134	[37m    [39;49;00mbogostrip([31mString[39;49;00m,[37m [39;49;00m[33m"[39;49;00m[33m\r[39;49;00m[33m\n[39;49;00m[33m\t[39;49;00m[33m [39;49;00m[33m"[39;49;00m).[37m[39;49;00m
   135	[37m[39;49;00m
   136	[32mbogostrip[39;49;00m([31mString[39;49;00m,[37m [39;49;00m[31mChars[39;49;00m)[37m [39;49;00m->[37m[39;49;00m
   137	[37m    [39;49;00m[31mLStripped[39;49;00m[37m [39;49;00m=[37m [39;49;00m[04m[36mstring[39;49;00m:[32msubstr[39;49;00m([31mString[39;49;00m,[37m [39;49;00m[04m[36mstring[39;49;00m:[32mspan[39;49;00m([31mString[39;49;00m,[37m [39;49;00m[31mChars[39;49;00m)+[34m1[39;49;00m),[37m[39;49;00m
   138	[37m    [39;49;00m[04m[36mstring[39;49;00m:[32msubstr[39;49;00m([31mLStripped[39;49;00m,[37m [39;49;00m[34m1[39;49;00m,[37m [39;49;00m[04m[36mstring[39;49;00m:[32mcspan[39;49;00m([31mLStripped[39;49;00m,[37m [39;49;00m[31mChars[39;49;00m)).[37m[39;49;00m
   139	[37m[39;49;00m
   140	[37m%% Here we have some extra code to test other bits of pygments' Erlang[39;49;00m[37m[39;49;00m
   141	[37m%% lexer.[39;49;00m[37m[39;49;00m
   142	[37m[39;49;00m
   143	[32mget_timestamp[39;49;00m()[37m [39;49;00m->[37m[39;49;00m
   144	[37m    [39;49;00m{{[31mYear[39;49;00m,[31mMonth[39;49;00m,[31mDay[39;49;00m},{[31mHour[39;49;00m,[31mMin[39;49;00m,[31mSec[39;49;00m}}[37m [39;49;00m=[37m [39;49;00m[04m[36merlang[39;49;00m:[32muniversaltime[39;49;00m(),[37m[39;49;00m
   145	[37m    [39;49;00m[04m[36mlists[39;49;00m:[32mflatten[39;49;00m([04m[36mio_lib[39;49;00m:[32mformat[39;49;00m([37m[39;49;00m
   146	[37m                    [39;49;00m[33m"[39;49;00m[33m~4.10.0B[39;49;00m[33m-[39;49;00m[33m~2.10.0B[39;49;00m[33m-[39;49;00m[33m~2.10.0B[39;49;00m[33mT[39;49;00m[33m~2.10.0B[39;49;00m[33m:[39;49;00m[33m~2.10.0B[39;49;00m[33m:[39;49;00m[33m~2.10.0B[39;49;00m[33mZ[39;49;00m[33m"[39;49;00m,[37m[39;49;00m
   147	[37m                    [39;49;00m[[31mYear[39;49;00m,[37m [39;49;00m[31mMonth[39;49;00m,[37m [39;49;00m[31mDay[39;49;00m,[37m [39;49;00m[31mHour[39;49;00m,[37m [39;49;00m[31mMin[39;49;00m,[37m [39;49;00m[31mSec[39;49;00m])).[37m[39;49;00m
   148	[37m[39;49;00m
   149	[32ma_binary[39;49;00m()[37m [39;49;00m->[37m[39;49;00m
   150	[37m    [39;49;00m<<[37m [39;49;00m[34m100[39;49;00m:[34m16[39;49;00m/integer,[37m [39;49;00m[34m16#7f[39;49;00m[37m [39;49;00m>>.[37m[39;49;00m
   151	[37m[39;49;00m
   152	[32ma_list_comprehension[39;49;00m()[37m [39;49;00m->[37m[39;49;00m
   153	[37m    [39;49;00m[[31mX[39;49;00m*[34m2[39;49;00m[37m [39;49;00m||[37m [39;49;00m[31mX[39;49;00m[37m [39;49;00m<-[37m [39;49;00m[[34m1[39;49;00m,[34m2[39;49;00m,[34m3[39;49;00m]].[37m[39;49;00m
   154	[37m[39;49;00m
   155	[32ma_map[39;49;00m()[37m [39;49;00m->[37m[39;49;00m
   156	[37m    [39;49;00m[31mM0[39;49;00m[37m [39;49;00m=[37m [39;49;00m#{[37m [39;49;00ma[37m [39;49;00m=>[37m [39;49;00m[34m1[39;49;00m,[37m [39;49;00mb[37m [39;49;00m=>[37m [39;49;00m[34m2[39;49;00m[37m [39;49;00m},[37m[39;49;00m
   157	[37m    [39;49;00m[31mM1[39;49;00m[37m [39;49;00m=[37m [39;49;00m[31mM0[39;49;00m#{[37m [39;49;00mb[37m [39;49;00m:=[37m [39;49;00m[34m200[39;49;00m[37m [39;49;00m}.[37m[39;49;00m
   158	[37m[39;49;00m
   159	[32mescape_sequences[39;49;00m()[37m [39;49;00m->[37m[39;49;00m
   160	[37m    [39;49;00m[[37m [39;49;00m[33m"[39;49;00m[33m\b[39;49;00m[33m\d[39;49;00m[33m\e[39;49;00m[33m\f[39;49;00m[33m\n[39;49;00m[33m\r[39;49;00m[33m\s[39;49;00m[33m\t[39;49;00m[33m\v[39;49;00m[33m\'[39;49;00m[33m\"[39;49;00m[33m\\[39;49;00m[33m"[39;49;00m[37m[39;49;00m
   161	[37m    [39;49;00m,[37m [39;49;00m[33m"[39;49;00m[33m\1[39;49;00m[33m\12[39;49;00m[33m\123[39;49;00m[33m"[39;49;00m[37m [39;49;00m[37m% octal[39;49;00m[37m[39;49;00m
   162	[37m    [39;49;00m,[37m [39;49;00m[33m"[39;49;00m[33m\x01[39;49;00m[33m"[39;49;00m[37m      [39;49;00m[37m% short hex[39;49;00m[37m[39;49;00m
   163	[37m    [39;49;00m,[37m [39;49;00m[33m"[39;49;00m[33m\x{fff}[39;49;00m[33m"[39;49;00m[37m   [39;49;00m[37m% long hex[39;49;00m[37m[39;49;00m
   164	[37m    [39;49;00m,[37m [39;49;00m[33m"[39;49;00m[33m\^a[39;49;00m[33m\^A[39;49;00m[33m"[39;49;00m[37m    [39;49;00m[37m% control characters[39;49;00m[37m[39;49;00m
   165	[37m    [39;49;00m].[37m[39;49;00m
   166	[37m[39;49;00m
   167	[32mmap[39;49;00m([31mFun[39;49;00m,[37m [39;49;00m[[31mH[39;49;00m|[31mT[39;49;00m])[37m [39;49;00m->[37m[39;49;00m
   168	[37m    [39;49;00m[[31mFun[39;49;00m([31mH[39;49;00m)[37m [39;49;00m|[37m [39;49;00mmap([31mFun[39;49;00m,[37m [39;49;00m[31mT[39;49;00m)];[37m[39;49;00m
   169	[37m[39;49;00m
   170	[32mmap[39;49;00m([31mFun[39;49;00m,[37m [39;49;00m[])[37m [39;49;00m->[37m[39;49;00m
   171	[37m    [39;49;00m[].[37m[39;49;00m
   172	[37m[39;49;00m
   173	[37m%% pmap, just because it's cool.[39;49;00m[37m[39;49;00m
   174	[37m[39;49;00m
   175	[32mpmap[39;49;00m([31mF[39;49;00m,[37m [39;49;00m[31mL[39;49;00m)[37m [39;49;00m->[37m[39;49;00m
   176	[37m    [39;49;00m[31mParent[39;49;00m[37m [39;49;00m=[37m [39;49;00mself(),[37m[39;49;00m
   177	[37m    [39;49;00m[[34mreceive[39;49;00m[37m [39;49;00m{[31mPid[39;49;00m,[37m [39;49;00m[31mResult[39;49;00m}[37m [39;49;00m->[37m[39;49;00m
   178	[37m             [39;49;00m[31mResult[39;49;00m[37m[39;49;00m
   179	[37m     [39;49;00m[34mend[39;49;00m[37m [39;49;00m||[37m [39;49;00m[31mPid[39;49;00m[37m [39;49;00m<-[37m [39;49;00m[[36mspawn[39;49;00m([34mfun[39;49;00m()[37m [39;49;00m->[37m[39;49;00m
   180	[37m                                  [39;49;00m[31mParent[39;49;00m[37m [39;49;00m![37m [39;49;00m{self(),[37m [39;49;00m[31mF[39;49;00m([31mX[39;49;00m)}[37m [39;49;00m
   181	[37m                          [39;49;00m[34mend[39;49;00m)[37m [39;49;00m||[37m [39;49;00m[31mX[39;49;00m[37m [39;49;00m<-[37m [39;49;00m[31mL[39;49;00m]].
