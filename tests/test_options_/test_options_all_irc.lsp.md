     1^I[36m#!/usr/bin/env newlisp[39;49;00m[37m[39;49;00m$
     2^I[37m[39;49;00m$
     3^I[37m;; @module IRC[39;49;00m[37m[39;49;00m$
     4^I[37m;; @description a basic irc library[39;49;00m[37m[39;49;00m$
     5^I[37m;; @version early alpha! 0.1 2011-10-31 14:21:26[39;49;00m[37m[39;49;00m$
     6^I[37m;; @author cormullion[39;49;00m[37m[39;49;00m$
     7^I[37m;; Usage:[39;49;00m[37m[39;49;00m$
     8^I[37m;; (IRC:init "newlithper") ; a username/nick (not that one obviously :-)[39;49;00m[37m[39;49;00m$
     9^I[37m;; (IRC:connect "irc.freenode.net" 6667) ; irc/server[39;49;00m[37m[39;49;00m$
    10^I[37m;; (IRC:join-channel {#newlisp}) ; join a room[39;49;00m[37m[39;49;00m$
    11^I[37m;; either (IRC:read-irc-loop) ; loop - monitor only, no input[39;49;00m[37m[39;49;00m$
    12^I[37m;; or     (IRC:session)       ; a command-line session, end with /QUIT[39;49;00m[37m[39;49;00m$
    13^I[37m[39;49;00m$
    14^I([34mcontext[39;49;00m[37m [39;49;00m'[33mIRC[39;49;00m)[37m[39;49;00m$
    15^I[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m)[37m[39;49;00m$
    16^I[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
    17^I[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m)[37m[39;49;00m$
    18^I[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mIconnected[39;49;00m)[37m[39;49;00m$
    19^I[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mIcallbacks[39;49;00m[37m [39;49;00m'())[37m[39;49;00m$
    20^I[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mIdle-time[39;49;00m[37m [39;49;00m[33m400[39;49;00m)[37m [39;49;00m[37m; seconds[39;49;00m[37m[39;49;00m$
    21^I[37m    [39;49;00m([34mdefine[39;49;00m[37m [39;49;00m[33mItime-stamp[39;49;00m)[37m   [39;49;00m[37m; time since last message was processed[39;49;00m[37m[39;49;00m$
    22^I[37m[39;49;00m$
    23^I([34mdefine[39;49;00m[37m [39;49;00m([31mregister-callback[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mfunction[39;49;00m)[37m[39;49;00m$
    24^I[37m    [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mregistering callback for [39;49;00m[33m}[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m : [39;49;00m[33m}[39;49;00m[37m [39;49;00m([34msym[39;49;00m[37m [39;49;00m([34mterm[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mfunction[39;49;00m)[37m [39;49;00m([34mprefix[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mfunction[39;49;00m)))[37m[39;49;00m$
    25^I[37m    [39;49;00m([34mpush[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m([34msym[39;49;00m[37m [39;49;00m([34mterm[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mfunction[39;49;00m)[37m [39;49;00m([34mprefix[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mfunction[39;49;00m)))[37m [39;49;00m[33mIcallbacks[39;49;00m))[37m [39;49;00m$
    26^I[37m[39;49;00m$
    27^I([34mdefine[39;49;00m[37m [39;49;00m([31mdo-callback[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33mdata[39;49;00m)[37m[39;49;00m$
    28^I[37m   [39;49;00m([34mwhen[39;49;00m[37m [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mfunc[39;49;00m[37m [39;49;00m([34mlookup[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33mIcallbacks[39;49;00m))[37m [39;49;00m[37m; find first callback[39;49;00m[37m[39;49;00m$
    29^I[37m         [39;49;00m([34mif-not[39;49;00m[37m [39;49;00m([34mcatch[39;49;00m[37m [39;49;00m([34mapply[39;49;00m[37m [39;49;00m[33mfunc[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33mdata[39;49;00m))[37m [39;49;00m'[33merror[39;49;00m)[37m[39;49;00m$
    30^I[37m                 [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33merror in callback [39;49;00m[33m}[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m: [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33merror[39;49;00m))))[37m[39;49;00m$
    31^I[37m[39;49;00m$
    32^I([34mdefine[39;49;00m[37m [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33mdata[39;49;00m)[37m[39;49;00m$
    33^I[37m   [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mrf[39;49;00m[37m [39;49;00m([34mref-all[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33mIcallbacks[39;49;00m))[37m[39;49;00m$
    34^I[37m        [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[34mcallback[39;49;00m[34m-[39;49;00m[33mentry[39;49;00m[37m [39;49;00m([31mIcallbacks[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m[33mrf[39;49;00m)))[37m[39;49;00m$
    35^I[37m        [39;49;00m([34mwhen[39;49;00m[37m   [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mfunc[39;49;00m[37m [39;49;00m([34mlast[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mentry[39;49;00m))[37m[39;49;00m$
    36^I[37m                [39;49;00m([34mif-not[39;49;00m[37m [39;49;00m([34mcatch[39;49;00m[37m [39;49;00m([34mapply[39;49;00m[37m [39;49;00m[33mfunc[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33mdata[39;49;00m))[37m [39;49;00m'[33merror[39;49;00m)[37m[39;49;00m$
    37^I[37m                [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33merror in callback [39;49;00m[33m}[39;49;00m[37m [39;49;00m[34mcallback[39;49;00m[34m-[39;49;00m[33mname[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m: [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33merror[39;49;00m)))))[37m[39;49;00m$
    38^I[37m[39;49;00m$
    39^I([34mdefine[39;49;00m[37m [39;49;00m([31minit[39;49;00m[37m [39;49;00m[33mstr[39;49;00m)[37m[39;49;00m$
    40^I[37m   [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mInickname[39;49;00m[37m [39;49;00m[33mstr[39;49;00m)[37m[39;49;00m$
    41^I[37m   [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mIconnected[39;49;00m[37m [39;49;00m[34mnil[39;49;00m)[37m[39;49;00m$
    42^I[37m   [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mIchannels[39;49;00m[37m [39;49;00m'())[37m[39;49;00m$
    43^I[37m   [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mItime-stamp[39;49;00m[37m [39;49;00m([34mtime-of-day[39;49;00m)))[37m[39;49;00m$
    44^I[37m[39;49;00m$
    45^I([34mdefine[39;49;00m[37m [39;49;00m([31mconnect[39;49;00m[37m [39;49;00m[33mserver[39;49;00m[37m [39;49;00m[33mport[39;49;00m)[37m[39;49;00m$
    46^I[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mIserver[39;49;00m[37m     [39;49;00m([34mnet-connect[39;49;00m[37m [39;49;00m[33mserver[39;49;00m[37m [39;49;00m[33mport[39;49;00m))[37m[39;49;00m$
    47^I[37m    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"USER %s %s %s :%s\r\n"[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m))[37m[39;49;00m$
    48^I[37m    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"NICK %s \r\n"[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m))[37m[39;49;00m$
    49^I[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mIconnected[39;49;00m[37m [39;49;00m[34mtrue[39;49;00m)[37m[39;49;00m$
    50^I[37m    [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"connect"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"server"[39;49;00m[37m [39;49;00m[33mserver[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"port"[39;49;00m[37m [39;49;00m[33mport[39;49;00m))))[37m[39;49;00m$
    51^I[37m[39;49;00m$
    52^I([34mdefine[39;49;00m[37m [39;49;00m([31midentify[39;49;00m[37m [39;49;00m[33mpassword[39;49;00m)[37m[39;49;00m$
    53^I[37m    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PRIVMSG nickserv :identify %s\r\n"[39;49;00m[37m [39;49;00m[33mpassword[39;49;00m)))[37m[39;49;00m$
    54^I[37m[39;49;00m$
    55^I([34mdefine[39;49;00m[37m [39;49;00m([34mjoin[39;49;00m[34m-[39;49;00m[33mchannel[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)[37m[39;49;00m$
    56^I[37m    [39;49;00m([34mwhen[39;49;00m[37m [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"JOIN %s \r\n"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m))[37m[39;49;00m$
    57^I[37m          [39;49;00m([34mpush[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
    58^I[37m          [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"join-channel"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"nickname"[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m)))))[37m[39;49;00m$
    59^I[37m[39;49;00m$
    60^I([34mdefine[39;49;00m[37m [39;49;00m([31mpart[39;49;00m[37m [39;49;00m[33mchan[39;49;00m)[37m[39;49;00m$
    61^I[37m    [39;49;00m([34mif-not[39;49;00m[37m [39;49;00m([31mempty?[39;49;00m[37m [39;49;00m[33mchan[39;49;00m)[37m[39;49;00m$
    62^I[37m        [39;49;00m[37m; leave specified[39;49;00m[37m[39;49;00m$
    63^I[37m        [39;49;00m([34mbegin[39;49;00m[37m[39;49;00m$
    64^I[37m            [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PART %s\r\n"[39;49;00m[37m [39;49;00m[33mchan[39;49;00m))[37m[39;49;00m$
    65^I[37m            [39;49;00m([34mreplace[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
    66^I[37m            [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"part"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m))))[37m[39;49;00m$
    67^I[37m        [39;49;00m[37m; leave all[39;49;00m[37m[39;49;00m$
    68^I[37m        [39;49;00m([34mbegin[39;49;00m[37m[39;49;00m$
    69^I[37m            [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mchannel[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
    70^I[37m                [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PART %s\r\n"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m))[37m[39;49;00m$
    71^I[37m                [39;49;00m([34mreplace[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
    72^I[37m                [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"part"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)))))))[37m[39;49;00m$
    73^I[37m[39;49;00m$
    74^I([34mdefine[39;49;00m[37m [39;49;00m([31mdo-quit[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)[37m[39;49;00m$
    75^I[37m    [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"quit"[39;49;00m[37m [39;49;00m'())[37m [39;49;00m[37m; chance to do stuff before quit...[39;49;00m[37m[39;49;00m$
    76^I[37m    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"QUIT :%s\r\n"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))[37m[39;49;00m$
    77^I[37m    [39;49;00m([34msleep[39;49;00m[37m [39;49;00m[33m1000[39;49;00m)[37m[39;49;00m$
    78^I[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mIchannels[39;49;00m[37m [39;49;00m'())[37m[39;49;00m$
    79^I[37m    [39;49;00m([34mclose[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m)[37m[39;49;00m$
    80^I[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mIconnected[39;49;00m[37m [39;49;00m[34mnil[39;49;00m))[37m[39;49;00m$
    81^I[37m[39;49;00m$
    82^I([34mdefine[39;49;00m[37m [39;49;00m([31mprivmsg[39;49;00m[37m [39;49;00m[33muser[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)[37m[39;49;00m$
    83^I[37m    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PRIVMSG %s :%s\r\n"[39;49;00m[37m [39;49;00m[33muser[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)))[37m[39;49;00m$
    84^I[37m[39;49;00m$
    85^I([34mdefine[39;49;00m[37m [39;49;00m([31mnotice[39;49;00m[37m [39;49;00m[33muser[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)[37m[39;49;00m$
    86^I[37m    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"NOTICE %s :%s\r\n"[39;49;00m[37m [39;49;00m[33muser[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)))[37m[39;49;00m$
    87^I[37m[39;49;00m$
    88^I([34mdefine[39;49;00m[37m [39;49;00m([34msend[39;49;00m[34m-[39;49;00m[33mto-server[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m([31mchannel[39;49;00m[37m [39;49;00m[34mnil[39;49;00m))[37m[39;49;00m$
    89^I[37m    [39;49;00m([34mcond[39;49;00m[37m[39;49;00m$
    90^I[37m        [39;49;00m(([34mstarts-with[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m/[39;49;00m[33m}[39;49;00m)[37m [39;49;00m[37m; default command character[39;49;00m[37m[39;49;00m$
    91^I[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mthe-message[39;49;00m[37m [39;49;00m([34mreplace[39;49;00m[37m [39;49;00m[33m"^/"[39;49;00m[37m [39;49;00m([34mcopy[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m))[37m [39;49;00m[37m; keep original[39;49;00m[37m[39;49;00m$
    92^I[37m            [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"%s \r\n"[39;49;00m[37m [39;49;00m[33mthe-message[39;49;00m))[37m [39;49;00m[37m; send it[39;49;00m[37m[39;49;00m$
    93^I[37m            [39;49;00m[37m; do a quit[39;49;00m[37m[39;49;00m$
    94^I[37m            [39;49;00m([34mif[39;49;00m[37m [39;49;00m([34mstarts-with[39;49;00m[37m [39;49;00m([34mlower-case[39;49;00m[37m [39;49;00m[33mthe-message[39;49;00m)[37m [39;49;00m[33m"quit"[39;49;00m)[37m[39;49;00m$
    95^I[37m                [39;49;00m([31mdo-quit[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m enough[39;49;00m[33m}[39;49;00m)))[37m[39;49;00m$
    96^I[37m        [39;49;00m([34mtrue[39;49;00m[37m [39;49;00m$
    97^I[37m            [39;49;00m([34mif[39;49;00m[37m [39;49;00m([34mnil[39;49;00m[33m?[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)[37m[39;49;00m$
    98^I[37m                [39;49;00m[37m; say to all channels[39;49;00m[37m[39;49;00m$
    99^I[37m                [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mc[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
   100^I[37m                        [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PRIVMSG %s :%s\r\n"[39;49;00m[37m [39;49;00m[33mc[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)))[37m[39;49;00m$
   101^I[37m                [39;49;00m[37m; say to specified channel[39;49;00m[37m[39;49;00m$
   102^I[37m                [39;49;00m([34mif[39;49;00m[37m [39;49;00m([34mfind[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
   103^I[37m                    [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PRIVMSG %s :%s\r\n"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))))[37m[39;49;00m$
   104^I[37m    [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"send-to-server"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))[37m[39;49;00m$
   105^I[37m[39;49;00m$
   106^I([34mdefine[39;49;00m[37m [39;49;00m([34mprocess[39;49;00m[34m-[39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33mtext[39;49;00m)[37m[39;49;00m$
   107^I[37m    [39;49;00m([34mcond[39;49;00m[37m[39;49;00m$
   108^I[37m        [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33m"PING"[39;49;00m)[37m[39;49;00m$
   109^I[37m            [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"PONG %s\r\n"[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m)))[37m[39;49;00m$
   110^I[37m        [39;49;00m(([34mor[39;49;00m[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m"NOTICE"[39;49;00m)[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m"PRIVMSG"[39;49;00m))[37m[39;49;00m$
   111^I[37m            [39;49;00m([34mprocess[39;49;00m[34m-[39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33mtext[39;49;00m))[37m[39;49;00m$
   112^I[37m        [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m"JOIN"[39;49;00m)[37m[39;49;00m$
   113^I[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33musername[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m!|:[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m))))[37m[39;49;00m$
   114^I[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mchannel[39;49;00m[37m  [39;49;00m([34mlast[39;49;00m[37m  [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m!|:[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m))))[37m[39;49;00m$
   115^I[37m            [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33musername [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m joined [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)[37m[39;49;00m$
   116^I[37m            [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"join"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mchannel[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m))))[37m[39;49;00m$
   117^I[37m        [39;49;00m([34mtrue[39;49;00m[37m[39;49;00m$
   118^I[37m            [39;49;00m[34mnil[39;49;00m)))[37m[39;49;00m$
   119^I[37m[39;49;00m$
   120^I([34mdefine[39;49;00m[37m [39;49;00m([34mprocess[39;49;00m[34m-[39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33mtext[39;49;00m)[37m[39;49;00m$
   121^I[37m    [39;49;00m([34mlet[39;49;00m[37m [39;49;00m(([31musername[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m))[37m[39;49;00m$
   122^I[37m        [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33musername[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m!|:[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m))))[37m[39;49;00m$
   123^I[37m        [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mtarget[39;49;00m[37m   [39;49;00m([34mtrim[39;49;00m[37m  [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33mtext[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m!|:[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m)))))[37m[39;49;00m$
   124^I[37m        [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mmessage[39;49;00m[37m  [39;49;00m([34mslice[39;49;00m[37m [39;49;00m[33mtext[39;49;00m[37m [39;49;00m([31m+[39;49;00m[37m [39;49;00m([34mfind[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m:[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mtext[39;49;00m)[37m [39;49;00m[33m1[39;49;00m)))[37m[39;49;00m$
   125^I[37m        [39;49;00m([34mcond[39;49;00m[37m [39;49;00m$
   126^I[37m            [39;49;00m(([34mstarts-with[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m"\001"[39;49;00m)[37m[39;49;00m$
   127^I[37m                [39;49;00m([34mprocess[39;49;00m[34m-[39;49;00m[33mctcp[39;49;00m[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))[37m[39;49;00m$
   128^I[37m            [39;49;00m(([34mfind[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
   129^I[37m                [39;49;00m([34mcond[39;49;00m[37m [39;49;00m$
   130^I[37m                    [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mPRIVMSG[39;49;00m[33m}[39;49;00m)[37m[39;49;00m$
   131^I[37m                        [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"channel-message"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))[37m[39;49;00m$
   132^I[37m                    [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mNOTICE[39;49;00m[33m}[39;49;00m)[37m[39;49;00m$
   133^I[37m                        [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"channel-notice"[39;49;00m[37m  [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))))[37m[39;49;00m$
   134^I[37m            [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m)[37m[39;49;00m$
   135^I[37m                [39;49;00m([34mcond[39;49;00m[37m [39;49;00m$
   136^I[37m                    [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mPRIVMSG[39;49;00m[33m}[39;49;00m)[37m[39;49;00m$
   137^I[37m                        [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"private-message"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))[37m[39;49;00m$
   138^I[37m                    [39;49;00m(([31m=[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mNOTICE[39;49;00m[33m}[39;49;00m)[37m[39;49;00m$
   139^I[37m                        [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"private-notice"[39;49;00m[37m  [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))))[37m[39;49;00m$
   140^I[37m            [39;49;00m([34mtrue[39;49;00m[37m                [39;49;00m$
   141^I[37m                [39;49;00m[34mnil[39;49;00m))))[37m[39;49;00m$
   142^I[37m  [39;49;00m$
   143^I([34mdefine[39;49;00m[37m [39;49;00m([34mprocess[39;49;00m[34m-[39;49;00m[33mctcp[39;49;00m[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)[37m[39;49;00m$
   144^I[37m    [39;49;00m([34mcond[39;49;00m[37m[39;49;00m$
   145^I[37m        [39;49;00m(([34mstarts-with[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m"\001VERSION\001"[39;49;00m)[37m[39;49;00m$
   146^I[37m            [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"NOTICE %s :\001VERSION %s\001\r\n"[39;49;00m[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m[33mversion[39;49;00m)))[37m[39;49;00m$
   147^I[37m        [39;49;00m(([34mstarts-with[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m"\001PING"[39;49;00m)[37m[39;49;00m$
   148^I[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mdata[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mrest[39;49;00m[37m [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m)))))[37m[39;49;00m$
   149^I[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mdata[39;49;00m[37m [39;49;00m([34mtrim[39;49;00m[37m [39;49;00m[33mdata[39;49;00m[37m [39;49;00m[33m"\001"[39;49;00m[37m [39;49;00m[33m"\001"[39;49;00m))[37m[39;49;00m$
   150^I[37m            [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m  [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"NOTICE %s :\001PING %s\001\r\n"[39;49;00m[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m[33mdata[39;49;00m)))[37m[39;49;00m$
   151^I[37m        [39;49;00m(([34mstarts-with[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m"\001ACTION"[39;49;00m)[37m[39;49;00m$
   152^I[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mdata[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mrest[39;49;00m[37m [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33m0[39;49;00m)))))[37m[39;49;00m$
   153^I[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mdata[39;49;00m[37m [39;49;00m([34mjoin[39;49;00m[37m [39;49;00m[33mdata[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m [39;49;00m[33m}[39;49;00m))[37m[39;49;00m$
   154^I[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mdata[39;49;00m[37m [39;49;00m([34mtrim[39;49;00m[37m [39;49;00m[33mdata[39;49;00m[37m [39;49;00m[33m"\001"[39;49;00m[37m [39;49;00m[33m"\001"[39;49;00m))[37m[39;49;00m$
   155^I[37m            [39;49;00m([34mif[39;49;00m[37m [39;49;00m([34mfind[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33mIchannels[39;49;00m)[37m[39;49;00m$
   156^I[37m                [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"channel-action"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m))))[37m[39;49;00m$
   157^I[37m            [39;49;00m([34mif[39;49;00m[37m [39;49;00m([31m=[39;49;00m[37m [39;49;00m[33mtarget[39;49;00m[37m [39;49;00m[33mInickname[39;49;00m)[37m[39;49;00m$
   158^I[37m                [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"private-action"[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"username"[39;49;00m[37m [39;49;00m[33musername[39;49;00m)[37m [39;49;00m([34mlist[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m)))))[37m[39;49;00m$
   159^I[37m        [39;49;00m(([34mstarts-with[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m"\001TIME\001"[39;49;00m)[37m[39;49;00m$
   160^I[37m            [39;49;00m([34mnet-send[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m([34mformat[39;49;00m[37m [39;49;00m[33m"NOTICE %s:\001TIME :%s\001\r\n"[39;49;00m[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m([34mdate[39;49;00m))))))[37m[39;49;00m$
   161^I[37m[39;49;00m$
   162^I([34mdefine[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[34m-[39;49;00m[33mbuffer[39;49;00m[37m [39;49;00m[33mraw-buffer[39;49;00m)[37m[39;49;00m$
   163^I[37m    [39;49;00m([34mlet[39;49;00m[37m [39;49;00m(([31mmessages[39;49;00m[37m [39;49;00m([34mclean[39;49;00m[37m [39;49;00m[33mempty?[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33mraw-buffer[39;49;00m[37m [39;49;00m[33m"\r\n"[39;49;00m[37m [39;49;00m[33m0[39;49;00m)))[37m[39;49;00m$
   164^I[37m          [39;49;00m([31msender[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mtext[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m))[37m[39;49;00m$
   165^I[37m        [39;49;00m[37m; check for elapsed time since last activity    [39;49;00m[37m[39;49;00m$
   166^I[37m        [39;49;00m([34mwhen[39;49;00m[37m [39;49;00m([31m>[39;49;00m[37m [39;49;00m([34msub[39;49;00m[37m [39;49;00m([34mtime-of-day[39;49;00m)[37m [39;49;00m[33mItime-stamp[39;49;00m)[37m [39;49;00m([34mmul[39;49;00m[37m [39;49;00m[33mIdle-time[39;49;00m[37m [39;49;00m[33m1000[39;49;00m))[37m[39;49;00m$
   167^I[37m              [39;49;00m([31mdo-callbacks[39;49;00m[37m [39;49;00m[33m"idle-event"[39;49;00m)[37m[39;49;00m$
   168^I[37m              [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mItime-stamp[39;49;00m[37m [39;49;00m([34mtime-of-day[39;49;00m)))[37m[39;49;00m$
   169^I[37m        [39;49;00m([34mdolist[39;49;00m[37m [39;49;00m([31mmessage[39;49;00m[37m [39;49;00m[33mmessages[39;49;00m)[37m[39;49;00m$
   170^I[37m            [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mmessage-parts[39;49;00m[37m [39;49;00m([34mparse[39;49;00m[37m [39;49;00m[33mmessage[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m [39;49;00m[33m}[39;49;00m))[37m           [39;49;00m$
   171^I[37m            [39;49;00m([34munless[39;49;00m[37m [39;49;00m([31mempty?[39;49;00m[37m [39;49;00m[33mmessage-parts[39;49;00m)[37m[39;49;00m$
   172^I[37m                [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33msender[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m[33mmessage-parts[39;49;00m))[37m[39;49;00m$
   173^I[37m                [39;49;00m([34mcatch[39;49;00m[37m [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mcommand[39;49;00m[37m [39;49;00m([34mfirst[39;49;00m[37m [39;49;00m([34mrest[39;49;00m[37m [39;49;00m[33mmessage-parts[39;49;00m)))[37m [39;49;00m'[33merror[39;49;00m)[37m[39;49;00m$
   174^I[37m                [39;49;00m([34mcatch[39;49;00m[37m [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mtext[39;49;00m[37m [39;49;00m([34mjoin[39;49;00m[37m [39;49;00m([34mrest[39;49;00m[37m [39;49;00m([34mrest[39;49;00m[37m [39;49;00m[33mmessage-parts[39;49;00m))[37m [39;49;00m[33m{[39;49;00m[33m [39;49;00m[33m}[39;49;00m))[37m [39;49;00m'[33merror[39;49;00m))[37m[39;49;00m$
   175^I[37m            [39;49;00m([34mprocess[39;49;00m[34m-[39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33msender[39;49;00m[37m [39;49;00m[33mcommand[39;49;00m[37m [39;49;00m[33mtext[39;49;00m))))[37m[39;49;00m$
   176^I[37m[39;49;00m$
   177^I([34mdefine[39;49;00m[37m [39;49;00m([34mread[39;49;00m[34m-[39;49;00m[33mirc[39;49;00m)[37m[39;49;00m$
   178^I[37m    [39;49;00m([34mlet[39;49;00m[37m [39;49;00m(([31mbuffer[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m))[37m[39;49;00m$
   179^I[37m        [39;49;00m([34mwhen[39;49;00m[37m [39;49;00m([31m!=[39;49;00m[37m [39;49;00m([34mnet-peek[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m)[37m [39;49;00m[33m0[39;49;00m)[37m [39;49;00m$
   180^I[37m              [39;49;00m([34mnet-receive[39;49;00m[37m [39;49;00m[33mIserver[39;49;00m[37m [39;49;00m[33mbuffer[39;49;00m[37m [39;49;00m[33m8192[39;49;00m[37m [39;49;00m[33m"\n"[39;49;00m)[37m[39;49;00m$
   181^I[37m              [39;49;00m([34munless[39;49;00m[37m [39;49;00m([31mempty?[39;49;00m[37m [39;49;00m[33mbuffer[39;49;00m)[37m[39;49;00m$
   182^I[37m                [39;49;00m([34mparse[39;49;00m[34m-[39;49;00m[33mbuffer[39;49;00m[37m [39;49;00m[33mbuffer[39;49;00m)))))[37m[39;49;00m$
   183^I[37m[39;49;00m$
   184^I([34mdefine[39;49;00m[37m [39;49;00m([34mread[39;49;00m[34m-[39;49;00m[33mirc-loop[39;49;00m)[37m [39;49;00m[37m; monitoring[39;49;00m[37m[39;49;00m$
   185^I[37m    [39;49;00m([34mlet[39;49;00m[37m [39;49;00m(([31mbuffer[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m}[39;49;00m))[37m       [39;49;00m$
   186^I[37m        [39;49;00m([34mwhile[39;49;00m[37m [39;49;00m[33mIconnected[39;49;00m[37m    [39;49;00m$
   187^I[37m            [39;49;00m([34mread[39;49;00m[34m-[39;49;00m[33mirc[39;49;00m)[37m[39;49;00m$
   188^I[37m            [39;49;00m([34msleep[39;49;00m[37m [39;49;00m[33m1000[39;49;00m))))[37m[39;49;00m$
   189^I[37m[39;49;00m$
   190^I([34mdefine[39;49;00m[37m [39;49;00m([34mprint[39;49;00m[34m-[39;49;00m[33mraw-message[39;49;00m[37m [39;49;00m[33mdata[39;49;00m)[37m [39;49;00m[37m; example of using a callback[39;49;00m[37m[39;49;00m$
   191^I[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mraw-data[39;49;00m[37m [39;49;00m([34mlookup[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mdata[39;49;00m))[37m[39;49;00m$
   192^I[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mchannel[39;49;00m[37m  [39;49;00m([34mlookup[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mdata[39;49;00m))[37m[39;49;00m$
   193^I[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mmessage-text[39;49;00m[37m [39;49;00m[33mraw-data[39;49;00m)[37m[39;49;00m$
   194^I[37m    [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m([34mdate[39;49;00m[37m [39;49;00m([34mdate-value[39;49;00m)[37m [39;49;00m[33m0[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m%H:%M:%S [39;49;00m[33m}[39;49;00m)[37m [39;49;00m[33musername[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m> [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mmessage-text[39;49;00m))[37m[39;49;00m$
   195^I[37m[39;49;00m$
   196^I([34mdefine[39;49;00m[37m [39;49;00m([34mprint[39;49;00m[34m-[39;49;00m[33moutgoing-message[39;49;00m[37m [39;49;00m[33mdata[39;49;00m)[37m[39;49;00m$
   197^I[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mraw-data[39;49;00m[37m [39;49;00m([34mlookup[39;49;00m[37m [39;49;00m[33m"message"[39;49;00m[37m [39;49;00m[33mdata[39;49;00m))[37m[39;49;00m$
   198^I[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mchannel[39;49;00m[37m  [39;49;00m([34mlookup[39;49;00m[37m [39;49;00m[33m"channel"[39;49;00m[37m [39;49;00m[33mdata[39;49;00m))[37m[39;49;00m$
   199^I[37m    [39;49;00m([34mset[39;49;00m[37m [39;49;00m'[33mmessage-text[39;49;00m[37m [39;49;00m[33mraw-data[39;49;00m)[37m[39;49;00m$
   200^I[37m    [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m([34mdate[39;49;00m[37m [39;49;00m([34mdate-value[39;49;00m)[37m [39;49;00m[33m0[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m%H:%M:%S [39;49;00m[33m}[39;49;00m)[37m [39;49;00m[33mInickname[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33m> [39;49;00m[33m}[39;49;00m[37m [39;49;00m[33mmessage-text[39;49;00m))[37m[39;49;00m$
   201^I[37m[39;49;00m$
   202^I([34mdefine[39;49;00m[37m [39;49;00m([31msession[39;49;00m)[37m; interactive terminal[39;49;00m[37m[39;49;00m$
   203^I[37m    [39;49;00m[37m; must add callbacks to display messages[39;49;00m[37m[39;49;00m$
   204^I[37m    [39;49;00m([31mregister-callback[39;49;00m[37m [39;49;00m[33m"channel-message"[39;49;00m[37m [39;49;00m'[34mprint[39;49;00m[34m-[39;49;00m[33mraw-message[39;49;00m)[37m[39;49;00m$
   205^I[37m    [39;49;00m([31mregister-callback[39;49;00m[37m [39;49;00m[33m"send-to-server"[39;49;00m[37m  [39;49;00m'[34mprint[39;49;00m[34m-[39;49;00m[33moutgoing-message[39;49;00m)[37m[39;49;00m$
   206^I[37m    [39;49;00m([34mwhile[39;49;00m[37m [39;49;00m[33mIconnected[39;49;00m[37m[39;49;00m$
   207^I[37m        [39;49;00m([34mwhile[39;49;00m[37m [39;49;00m([31mzero?[39;49;00m[37m [39;49;00m([34mpeek[39;49;00m[37m [39;49;00m[33m0[39;49;00m))[37m[39;49;00m$
   208^I[37m            [39;49;00m([34mread[39;49;00m[34m-[39;49;00m[33mirc[39;49;00m))[37m[39;49;00m$
   209^I[37m        [39;49;00m([34msend[39;49;00m[34m-[39;49;00m[33mto-server[39;49;00m[37m [39;49;00m([34mstring[39;49;00m[37m [39;49;00m([34mread-line[39;49;00m[37m [39;49;00m[33m0[39;49;00m))))[37m[39;49;00m$
   210^I[37m    [39;49;00m([34mprintln[39;49;00m[37m [39;49;00m[33m{[39;49;00m[33mfinished session [39;49;00m[33m}[39;49;00m[37m [39;49;00m([34mdate[39;49;00m))[37m[39;49;00m$
   211^I[37m    [39;49;00m([34mexit[39;49;00m))[37m[39;49;00m$
   212^I[37m[39;49;00m$
   213^I[37m; end of IRC code[39;49;00m$
